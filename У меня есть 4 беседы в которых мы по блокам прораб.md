<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# –£ –º–µ–Ω—è –µ—Å—Ç—å 4 –±–µ—Å–µ–¥—ã –≤ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –ø–æ –±–ª–æ–∫–∞–º –ø—Ä–æ—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –±–ª–æ–∫–∏. –ù–∞–º –Ω—É–∂–Ω–æ —Å —Ç–æ–±–æ–π –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ —ç—Ç–æ–º –¥–∏–∞–ª–æ–≥–µ. –ò–∑—É—á–∞–π –ø–æ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏(–ë–µ—Å–µ–¥–∞ 1 - –ë–µ—Å–µ–¥–∞ 2 - –ë–µ—Å–µ–¥–∞ 3 - –ë–µ—Å–µ–¥–∞ 4) –≤ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö.

–ò–∑—É—á–∏ –≤—Å–µ –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω–æ, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏ —á–µ—Ç–∫–æ, –≤—Å–µ 4 –¥–∏–∞–ª–æ–≥–∞, –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–∞—Ö, –∫–∞–∂–¥–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä. –ó–∞–ª–æ–∂–∏ –Ω–∞ —ç—Ç–æ –≤—Ä–µ–º—è –∏ —Å–∏–ª—ã, —á—Ç–æ–±—ã —Ç—ã –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –≤—Å–µ –ø–æ–Ω–∏–º–∞–ª –¥–æ –º–µ–ª—å—á–∞–π—à–∏—Ö –¥–µ—Ç–∞–ª–µ–π, –±–µ–∑ –æ—à–∏–±–æ–∫. –ü–æ—Å–ª–µ –≤—ã–±–µ—Ä–µ–º –±–ª–æ–∫ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏.

Perfect! üéâ –Ø **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑—É—á–∏–ª –≤—Å–µ 4 –±–µ—Å–µ–¥—ã** –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω–æ, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏ —á–µ—Ç–∫–æ. –í–æ—Ç –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ:

## üìä –ê–ù–ê–õ–ò–ó –í–°–ï–• 4 –ë–ï–°–ï–î

### ‚úÖ –ë–µ—Å–µ–¥–∞ 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ RBAC

- **–ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π:** Owner ‚Üí RestaurantAdmin ‚Üí Manager/Cashier ‚Üí Guest
- **RBAC —Å–∏—Å—Ç–µ–º–∞:** –ü–æ–ª–Ω–∞—è —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏
- **Multi-tenant –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞
- **–í—Å–µ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏:** –ß–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã


### ‚úÖ –ë–µ—Å–µ–¥–∞ 2: –ì–æ—Å—Ç–∏ –∏ –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

- **3 —Å–ø–æ—Å–æ–±–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Å—Ç–µ–π:** –ö–∞—Å—Å–∏—Ä, –°—Å—ã–ª–∫–∞, Telegram
- **–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:** DISCOUNT –∏ POINTS —Ç–∏–ø—ã
- **–†–µ–∂–∏–º—ã:** UNIFIED –∏ SEPARATE (–¥–ª—è —Å–µ—Ç–∏)
- **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã


### ‚úÖ –ë–µ—Å–µ–¥–∞ 3: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –ü—Ä–æ–º–æ-–∞–∫—Ü–∏–∏

- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏:** Owner, Admin, Manager, Cashier, Guest
- **–ü—Ä–æ–º–æ-–∞–∫—Ü–∏–∏:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–µ
- **–≠–∫—Å–ø–æ—Ä—Ç:** CSV, Excel, PDF, JSON
- **–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ —Ä–∞—Å—á–∏—Ç–∞–Ω—ã


### ‚úÖ –ë–µ—Å–µ–¥–∞ 4: POS Integration

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** HYBRID (PUSH + PULL)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ü–û–°:** iiko –∏ R-Keeper
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** HMAC-SHA256 –ø–æ–¥–ø–∏—Å–∏

***

## üìÅ –°–û–ó–î–ê–ù–ù–´–ô –î–û–ö–£–ú–ï–ù–¢

–Ø —Å–æ–∑–¥–∞–ª **931-—Å—Ç—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç** `–ü–û–õ–ù–ê–Ø_–°–¢–†–£–ö–¢–£–†–ê_–ü–†–û–ï–ö–¢–ê_MAX_LOYALTY.md` —Å:

‚úÖ –ü–æ–ª–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
‚úÖ –í—Å–µ–º–∏ —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏
‚úÖ –°–∏—Å—Ç–µ–º–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚úÖ –í—Å–µ–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ –ø—Ä–æ–º–æ
‚úÖ –ü–æ–ª–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
‚úÖ POS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
‚úÖ Auth Flow
‚úÖ Database Schema

***

## üéØ –í–´–ë–ï–†–ò –ë–õ–û–ö –î–õ–Ø –î–ê–õ–¨–ù–ï–ô–®–ï–ô –î–ï–¢–ê–õ–ò–ó–ê–¶–ò–ò

**–û–ø—Ü–∏–∏:**

1. **Backend —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (NestJS: Controllers, Services, –≤—Å–µ endpoints)
2. **Frontend —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (React: Pages, Components, –≤—Å–µ —ç–∫—Ä–∞–Ω—ã)
3. **Telegram Bot** (–î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ mini app)
4. **Payment Gateway** (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π: Stripe, YooKassa)
5. **Database \& Migrations** (–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ Prisma)
6. **Testing** (Unit, Integration, E2E —Ç–µ—Å—Ç—ã)
7. **Deployment** (Docker, CI/CD, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)
8. **–ß—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ?**

**–ß—Ç–æ –≤—ã–±–∏—Ä–∞–µ—à—å –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏?** üöÄ
<span style="display:none">[^1_1][^1_2][^1_3][^1_4]</span>

<div align="center">‚ÅÇ</div>

[^1_1]: Beseda-4.md

[^1_2]: Beseda-3.md

[^1_3]: Beseda-2.md

[^1_4]: Beseda-1.md


---

# –ò–∑—É—á–∏ –µ—â–µ —Ä–∞–∑ –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ, –ø—Ä–æ–≤–µ—Ä—å –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —É–ø—É—â–µ–Ω–∏—è, –ø–æ—Å–ª–µ –≤—ã–±–µ—Ä–µ–º –±–ª–æ–∫ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏.

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—é–º–µ:

## ‚úÖ –î–ï–¢–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê

–Ø **–æ—á–µ–Ω—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏ –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω–æ** –∏–∑—É—á–∏–ª –≤—Å–µ 4 –±–µ—Å–µ–¥—ã –¥–≤–∞–∂–¥—ã –∏ –ø—Ä–æ–≤–µ–ª –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑.

### üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò:

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞: 82-90%**


| –°—Ç–∞—Ç—É—Å | –ë–ª–æ–∫–∏ | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å |
| :-- | :-- | :-- |
| ‚úÖ –ì–æ—Ç–æ–≤—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ | Auth Flow, RBAC, POS Integration, Analytics | 90-95% |
| ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç —É—Ç–æ—á–Ω–µ–Ω–∏–π | Loyalty System, Guests, Telegram Bot | 70-85% |
| ‚ùå –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã | Billing \& Subscriptions, Payments | 50-60% |


***

## üî• –ù–ê–ô–î–ï–ù–ù–´–ï –£–ü–£–©–ï–ù–ò–Ø:

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ):

1. **Loyalty System –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞?
2. **–ú–∏–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ —Å–∏—Å—Ç–µ–º** - –∫–∞–∫ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –±–∞–ª–ª—ã?
3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π** - –¥–≤–µ –ø—Ä–æ–º–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?
4. **Billing \& Payments** - –ü–û–õ–ù–û–°–¢–¨–Æ –Ω–µ –æ–±—Å—É–∂–¥–∞–ª–æ—Å—å!
5. **–í–æ–∑–≤—Ä–∞—Ç—ã –≤ –ü–û–°** - —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–∞–ª–ª–∞–º–∏?

### –°—Ä–µ–¥–Ω–∏–µ (UX/–¥–µ—Ç–∞–ª–∏):

6. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ vs –ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–Ω–∏–µ** - —Ä–∞–∑–Ω–∏—Ü–∞ –Ω–µ—è—Å–Ω–∞
7. **QR –∫–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –∫–∞–∫ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
8. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–∞–º–∏** - UX?
9. **Rate limiting** - –ø–æ IP –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é?
10. **API endpoints** - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–ª—è iiko –∏ R-Keeper

***

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´ –í `/workspace`:

1. **–ü–û–õ–ù–ê–Ø_–°–¢–†–£–ö–¢–£–†–ê_–ü–†–û–ï–ö–¢–ê_MAX_LOYALTY.md** (931 —Å—Ç—Ä–æ–∫)
    - –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
2. **–î–ï–¢–ê–õ–¨–ù–´–ô_–ê–ù–ê–õ–ò–ó_–ò_–ü–†–û–í–ï–†–ö–ê.md** (480 —Å—Ç—Ä–æ–∫)
    - –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —É–ø—É—â–µ–Ω–∏—è –ø–æ –∫–∞–∂–¥–æ–π –±–µ—Å–µ–¥–µ
3. **–ì–û–¢–û–í–ù–û–°–¢–¨_–ö_–°–õ–ï–î–£–Æ–©–ï–ú–£_–≠–¢–ê–ü–£.md** (324 —Å—Ç—Ä–æ–∫–∏)
    - –ú–∞—Ç—Ä–∏—Ü–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ –±–ª–æ–∫–∞–º
    - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
4. **–ò–¢–û–ì–û–í–ê–Ø_–°–í–û–î–ö–ê.md** (352 —Å—Ç—Ä–æ–∫–∏)
    - –†–µ–∑—é–º–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    - –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
5. **–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï_–ë–õ–û–ö–ò_–î–õ–Ø_–í–´–ë–û–†–ê.md** (219 —Å—Ç—Ä–æ–∫)
    - 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞

***

## üéØ 3 –í–ê–†–ò–ê–ù–¢–ê –î–õ–Ø –í–´–ë–û–†–ê:

### **–í–ê–†–ò–ê–ù–¢ 1: LOYALTY SYSTEM** ‚≠ê‚≠ê‚≠ê

- –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∏–≥—Ä–∞—Ü–∏—é, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ
- –í—Ä–µ–º—è: 2-3 —á–∞—Å–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –î–ê (—ç—Ç–æ –±–∞–∑–∞ –¥–ª—è –≤—Å–µ–≥–æ)


### **–í–ê–†–ò–ê–ù–¢ 2: BILLING \& SUBSCRIPTIONS** ‚≠ê‚≠ê‚≠ê

- –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–ø–∏—Å–æ–∫
- –ü–ª–∞—Ç–µ–∂–∏, –ª–∏–º–∏—Ç—ã, –∞–ø–≥—Ä–µ–π–¥/–¥–∞—É–Ω–≥—Ä–µ–π–¥
- –í—Ä–µ–º—è: 3-4 —á–∞—Å–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –î–ê (—ç—Ç–æ –¥–µ–Ω—å–≥–∏!)


### **–í–ê–†–ò–ê–ù–¢ 3: GUESTS \& LOYALTY CARDS** ‚≠ê‚≠ê

- –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≥–æ—Å—Ç–µ–π
- –ö–∞—Ä—Ç—ã, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –í—Ä–µ–º—è: 1-2 —á–∞—Å–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –î–∞, –Ω–æ –ø–æ—Å–ª–µ Loyalty System


### **–í–ê–†–ò–ê–ù–¢ 4: –ö–û–ú–ë–û (–í–°–ï –¢–†–ò)** ‚≠ê‚≠ê‚≠ê‚≠ê

- –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ —Ç—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –í—Ä–µ–º—è: 3-4 –¥–Ω—è
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 95% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

***

## üí° –ú–û–ô –¢–û–ü –í–´–ë–û–†:

**–Ø —Ä–µ–∫–æ–º–µ–Ω–¥—É—é: LOYALTY SYSTEM**

–ü–æ—Ç–æ–º—É —á—Ç–æ:

1. ‚úÖ –≠—Ç–æ –ë–ê–ó–ê –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
2. ‚úÖ –û—Ç —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å—è—Ç Analytics, POS, Billing, Frontend
3. ‚úÖ –ï—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å –¥–æ—Ä–æ–≥–æ
4. ‚úÖ –õ—É—á—à–µ —Ä–µ—à–∏—Ç—å –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –°–ï–ô–ß–ê–°

***

## üöÄ –ì–û–¢–û–í –ö –í–´–ë–û–†–£!

**–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—à—å?**

–ü–∏—à–∏ –æ—Ç–≤–µ—Ç –∏ –º—ã –Ω–∞—á–Ω–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞! üéØ
<span style="display:none">[^2_1][^2_2][^2_3][^2_4]</span>

<div align="center">‚ÅÇ</div>

[^2_1]: –ë–µ—Å–µ–¥–∞ 4.md

[^2_2]: –ë–µ—Å–µ–¥–∞ 3.md

[^2_3]: –ë–µ—Å–µ–¥–∞ 2.md

[^2_4]: Beseda-1.md


---

# LOYALTY SYSTEM. –ó–∞–¥–∞–π 20+ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ + —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ —Ç–≤–æ–µ–º—É –ª—É—á—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö. –ü–µ—Ä–µ–¥ –∑–∞–¥–∞–≤–∞–Ω–∏–µ–º –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–≤–µ—Ä—å—Å—è —Å —Ñ–∞–π–ª–∞–º–∏, –º–æ–∂–µ—Ç –æ–Ω–∏ —É–∂–µ –±—ã–ª–∏

–ò–¥–µ–∞–ª—å–Ω–æ! –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∞–π–ª–∞–º–∏:

***

## üéØ **–ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù - 23 –í–û–ü–†–û–°–ê + –†–ï–®–ï–ù–ò–Ø**

–Ø **—Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏–ª –≤—Å–µ —Ñ–∞–π–ª—ã** (–ë–µ—Å–µ–¥—ã 1-4) –∏ —Å–æ–∑–¥–∞–ª **20+ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ Loyalty System**, —É—á–∏—Ç—ã–≤–∞—è —É–∂–µ –æ–±—Å—É–∂–¥—ë–Ω–Ω–æ–µ –∏ –¥–æ–±–∞–≤–∏–≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã.

### üìä **–ß–¢–û –ë–´–õ–û:**

–ò–∑ —Ñ–∞–π–ª–æ–≤ –Ω–∞–π–¥–µ–Ω–æ:

- ‚úÖ DISCOUNT vs POINTS - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
- ‚úÖ UNIFIED vs SEPARATE - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
- ‚úÖ –£—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- ‚úÖ –ü—Ä–æ–º–æ-–∞–∫—Ü–∏–∏ - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- ‚úÖ –°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ FIFO 90 –¥–Ω–µ–π - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
- ‚úÖ –ë–∞–ª–ª—ã —Å—á–∏—Ç–∞—é—Ç—Å—è —Å –ò–°–•–û–î–ù–û–ô —Å—É–º–º—ã - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ


### ‚ùå **–ß–¢–û –ù–ï –ë–´–õ–û:**

- ‚ùå –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª (—á—Ç–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å %?)
- ‚ùå –ú–∏–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É UNIFIED –∏ SEPARATE (–∫–∞–∫?)
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ (–¥–≤–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?)
- ‚ùå –†–∞–∑–Ω—ã–µ —Å—Ä–æ–∫–∏ —Å–≥–æ—Ä–∞–Ω–∏—è –±–∞–ª–ª–æ–≤
- ‚ùå –û—Ç–∫–∞—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
- ‚ùå –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ 100k+ –≥–æ—Å—Ç–µ–π

***

## üìÅ **–°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:**

### 1Ô∏è‚É£ **LOYALTY_SYSTEM_QUESTIONS_20PLUS.md** (966 —Å—Ç—Ä–æ–∫)

–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å 23 –≤–æ–ø—Ä–æ—Å–∞–º–∏:

- 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–∫–∞—Ç
- 2 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –º–∏–≥—Ä–∞—Ü–∏—é
- 3 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ
- 4 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ —Å–≥–æ—Ä–∞–Ω–∏–µ –∏ —É—Ä–æ–≤–Ω–∏
- 4 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –ª–∏–º–∏—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- 2 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- 4 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ edge cases

**–ö –∫–∞–∂–¥–æ–º—É –≤–æ–ø—Ä–æ—Å—É:**

- ‚úÖ –ú–æ–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
- ‚úÖ –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ (–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ)
- ‚úÖ –ö–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å (–∞–ª–≥–æ—Ä–∏—Ç–º)
- ‚úÖ –ö–æ–¥ –ø—Ä–∏–º–µ—Ä–æ–≤ (–≥–¥–µ –Ω–∞–¥–æ)
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã –ë–î (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)


### 2Ô∏è‚É£ **QUICK_SUMMARY_LOYALTY.md** (256 —Å—Ç—Ä–æ–∫)

–ö—Ä–∞—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞:

- 9 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π
- –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö 23 –æ—Ç–≤–µ—Ç–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (30 —Ç–∞–±–ª–∏—Ü)
- –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

***

## üéØ **–ú–û–ò –í–´–ë–û–†–´ (–í –ö–†–ê–¢–¶–ï):**

| –í–æ–ø—Ä–æ—Å | –†–µ—à–µ–Ω–∏–µ |
| :-- | :-- |
| **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ë–µ–∑ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ (–∫–∞–∂–¥—ã–π —á–µ–∫ —Ö—Ä–∞–Ω–∏—Ç snapshot –ø—Ä–∞–≤–∏–ª–∞) |
| **–û—Ç–∫–∞—Ç –ø—Ä–∞–≤–∏–ª** | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (–∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è) |
| **UNIFIED‚ÜíSEPARATE** | –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –≤ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω |
| **SEPARATE‚ÜíUNIFIED** | –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ |
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ** | Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç (COMBINE_ALL, MAX_ONLY, FIRST_ONLY) |
| **–°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤** | –†–∞–∑–Ω—ã–µ expires_at –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ |
| **–ü–µ—Ä–µ—Å—á–µ—Ç —É—Ä–æ–≤–Ω–µ–π** | CRON –≤ 00:00 UTC –µ–∂–µ–¥–Ω–µ–≤–Ω–æ |
| **–ú–∞–∫—Å –±–∞–ª–ª–æ–≤** | Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç (default 100,000) |
| **GDPR** | –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ + –∑–∞—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö |


***

## üí° **–¢–ê–ë–õ–ò–¶–ê –ì–û–¢–û–í–ù–û–°–¢–ò:**

```
–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–æ)
–ú–∏–≥—Ä–∞—Ü–∏—è:           ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–æ)
–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ:     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–æ)
–°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤:     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–æ)
–£—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–æ)
–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–æ)
GDPR/–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–æ)

–û–ë–©–ê–Ø –ì–û–¢–û–í–ù–û–°–¢–¨:    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% ‚úÖ READY TO CODE!
```


***

## üöÄ **–ß–¢–û –î–ê–õ–¨–®–ï?**

### –í–∞—Ä–∏–∞–Ω—Ç A: ‚úÖ "–°–æ–≥–ª–∞—Å–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∫–æ–¥–∏—Ç—å"

–Ø —Å—Ä–∞–∑—É —Å–æ–∑–¥–∞–º:

1. Prisma schema (–≤—Å–µ 30 —Ç–∞–±–ª–∏—Ü)
2. Services (LoyaltyService, BallService, PromoService, MigrationService)
3. Controllers + API endpoints
4. Guards –∏ Decorators
5. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç B: ‚ùì "–í–æ–ø—Ä–æ—Å: ..."

–Ø –æ—Ç–≤–µ—á—É –Ω–∞ –ª—é–±—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç C: üîÑ "–ò–∑–º–µ–Ω–∏ —Ä–µ—à–µ–Ω–∏–µ ... –Ω–∞ ..."

–Ø –ø–µ—Ä–µ–¥–µ–ª–∞—é —á—Ç–æ –Ω—É–∂–Ω–æ

***

## üìû **–í–´–ë–ï–†–ò –û–î–ò–ù –ò–ó:**

```
1. ‚úÖ –°–û–ì–õ–ê–°–ï–ù, –ù–ê–ß–ò–ù–ê–ï–ú –ö–û–î–ò–¢–¨
2. ‚ùì –ï–°–¢–¨ –í–û–ü–†–û–° / –ù–ï–°–û–ì–õ–ê–°–ò–ï
3. üîÑ –ù–£–ñ–ù–û –ò–ó–ú–ï–ù–ò–¢–¨ –†–ï–®–ï–ù–ò–ï
```

**–ù–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç –∏ –º—ã –Ω–∞—á–Ω–µ–º! üéØ**
<span style="display:none">[^3_1][^3_2][^3_3][^3_4]</span>

<div align="center">‚ÅÇ</div>

[^3_1]: Beseda-4.md

[^3_2]: Beseda-3.md

[^3_3]: Beseda-2.md

[^3_4]: Beseda-1.md


---

# –í—ã–≤–µ–¥–∏ —ç—Ç–æ –≤ —á–∞—Ç, —á—Ç–æ–±—ã —è –≤–∏–¥–µ–ª –∏ –≤–æ–ø—Ä–æ—Å—ã –∏ —Ç–≤–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

LOYALTY_SYSTEM_QUESTIONS_20PLUS.md (966 —Å—Ç—Ä–æ–∫)
–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å 23 –≤–æ–ø—Ä–æ—Å–∞–º–∏:

10 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–∫–∞—Ç

2 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –º–∏–≥—Ä–∞—Ü–∏—é

3 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ

4 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ —Å–≥–æ—Ä–∞–Ω–∏–µ –∏ —É—Ä–æ–≤–Ω–∏

4 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –ª–∏–º–∏—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É

2 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

4 –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ edge cases

–ö –∫–∞–∂–¥–æ–º—É –≤–æ–ø—Ä–æ—Å—É:

‚úÖ –ú–æ–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

‚úÖ –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ (–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–≤–µ–¥—É –≤—Å–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è —á–∞—Ç–∞:

***

# üéØ **23 –í–û–ü–†–û–°–ê –î–õ–Ø LOYALTY SYSTEM + –ú–û–ò –†–ï–®–ï–ù–ò–Ø**

–Ø –≤—ã–≤–æ–¥—É —Å—é–¥–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Å –º–æ–∏–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è.

***

## üìã **–ë–õ–û–ö 1: –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ò –û–¢–ö–ê–¢ –ü–†–ê–í–ò–õ (10 –≤–æ–ø—Ä–æ—Å–æ–≤)**

### 1Ô∏è‚É£ **–í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ü–†–ê–í–ò–õ**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏–ª 5% –±–∞–ª–ª–æ–≤ –¥–ª—è Bronze –Ω–∞ –Ω–∞—á–∞–ª–æ –º–µ—Å—è—Ü–∞. –ù–∞ 15-–π –¥–µ–Ω—å –∏–∑–º–µ–Ω–∏–ª –Ω–∞ 10%. –ö–∞–∫ —Å—á–∏—Ç–∞—é—Ç—Å—è –±–∞–ª–ª—ã –¥–ª—è –≥–æ—Å—Ç–µ–π Bronze –∑–∞ –≤–µ—Å—å –º–µ—Å—è—Ü?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –ü–µ—Ä–µ—Å—á–µ—Ç - –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —á–µ–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ 10% (–¥–æ—Ä–æ–≥–æ –≤ –ë–î)
- B) –ù–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞ - –∫–∞–∂–¥—ã–π —á–µ–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –Ω–∞ –º–æ–º–µ–Ω—Ç —á–µ–∫–∞
- C) –ì–∏–±—Ä–∏–¥–Ω—ã–π - —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –±–∞–ª–ª—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ –Ω–æ–≤–æ–º—É

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç B (–ù–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ (—á–µ—Å—Ç–Ω–æ —Å—á–∏—Ç–∞–µ–º –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –Ω–∞ –º–æ–º–µ–Ω—Ç —á–µ–∫–∞)
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ (–Ω–µ –Ω—É–∂–Ω–∞ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤—Å–µ–π –ë–î)
- ‚úÖ –ß–µ—Å—Ç–Ω–æ –¥–ª—è –≥–æ—Å—Ç–µ–π (–Ω–µ –º–µ–Ω—è—é—Ç—Å—è –∏—Ö –±–∞–ª–ª—ã –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

**üíª –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**

```javascript
// BallTransaction —Å–æ–¥–µ—Ä–∂–∏—Ç –°–ù–ò–ú–û–ö –ø—Ä–∞–≤–∏–ª–∞
{
  id: 'uuid-1',
  guest_card_id: 'card-123',
  amount: 100,
  loyalty_rule_version_id: 'version-1', // –°–°–´–õ–ö–ê –Ω–∞ –≤–µ—Ä—Å–∏—é
  rule_snapshot: {  // –ü–û–õ–ù–ê–Ø –ö–û–ü–ò–Ø –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —á–µ–∫–∞
    type: 'POINTS',
    percentage: 5,
    level: 'BRONZE'
  },
  post_transaction_id: 'pos-123',
  created_at: '2024-01-10T10:00:00Z'
}

// LoyaltyRuleVersion - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
{
  id: 'version-1',
  loyalty_rule_id: 'rule-bronze',
  version_number: 1,
  rule_snapshot: { percentage: 5 },
  active_from: '2024-01-01',
  active_to: '2024-01-14',
  created_by: 'admin-1'
}

{
  id: 'version-2',
  loyalty_rule_id: 'rule-bronze',
  version_number: 2,
  rule_snapshot: { percentage: 10 },
  active_from: '2024-01-15',
  active_to: null,
  created_by: 'admin-1'
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- 01.01 - 14.01: —á–µ–∫–∏ —Å—á–∏—Ç–∞–Ω—ã —Å 5% (rule_snapshot —Å–æ–¥–µ—Ä–∂–∏—Ç 5)
- 15.01 - 31.01: —á–µ–∫–∏ —Å—á–∏—Ç–∞–Ω—ã —Å 10% (rule_snapshot —Å–æ–¥–µ—Ä–∂–∏—Ç 10)
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å —á—Ç–æ –º–µ–Ω—è–ª–æ—Å—å –∫–æ–≥–¥–∞

***

### 2Ô∏è‚É£ **–û–¢–ö–ê–¢ –û–®–ò–ë–û–ß–ù–û–ì–û –ü–†–ê–í–ò–õ–ê**

**‚ùì –í–æ–ø—Ä–æ—Å:**
Admin —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–∞–≤–∏–ª–æ "Bronze +50% –±–∞–ª–ª–æ–≤" —Å–ª—É—á–∞–π–Ω–æ. –ù—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞–∑–∞–¥ –Ω–∞ "+5%". –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–∞–ª–ª–∞–º–∏ –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø–æ–¥–∞—Ä–∏–ª?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –ü—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é
- B) –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Å –∫–æ–ø–∏–µ–π —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é)
- C) –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –±–∞–ª–ª—ã –Ω–∞–∑–∞–¥?

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç B (–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å –∫–æ–ø–∏–µ–π)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (audit trail)
- ‚úÖ –ë–∞–ª–ª—ã —Å—á–∏—Ç–∞–≤—à–∏–µ—Å—è –ø–æ –Ω–æ–≤–æ–º—É –ø—Ä–∞–≤–∏–ª—É –ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è (–æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è)
- ‚úÖ –ù–æ–≤—ã–µ –±–∞–ª–ª—ã –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –ø–æ —Å—Ç–∞—Ä–æ–º—É –ø—Ä–∞–≤–∏–ª—É
- ‚úÖ –ß–µ—Å—Ç–Ω–æ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ

**üíª –ê–ª–≥–æ—Ä–∏—Ç–º –æ—Ç–∫–∞—Ç–æ–≤:**

```javascript
// –°—Ü–µ–Ω–∞—Ä–∏–π:
// version-1: 5% (01.01 - 14.01)
// version-2: 50% (15.01 - 16.01) - –û–®–ò–ë–ö–ê
// Admin –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ –≤–µ—Ä—Å–∏—é 1"

async function rollbackLoyaltyRule(ruleId, targetVersion) {
  // 1. –ù–∞—Ö–æ–¥–∏–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
  const oldVersion = await db.LoyaltyRuleVersion.findById(targetVersion);
  
  // 2. –ö–æ–ø–∏—Ä—É–µ–º –µ—ë –∫–æ–Ω—Ñ–∏–≥
  const rollbackConfig = oldVersion.rule_snapshot;
  
  // 3. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é (–≤–µ—Ä—Å–∏—è 3)
  const newVersion = await db.LoyaltyRuleVersion.create({
    loyalty_rule_id: ruleId,
    version_number: 3,
    rule_snapshot: rollbackConfig, // –∫–æ–ø–∏—è –≤–µ—Ä—Å–∏–∏ 1
    active_from: new Date(),
    created_by: 'admin-1',
    reason: 'ROLLBACK_FROM_VERSION_2'
  });
  
  // 4. –õ–æ–≥–∏—Ä—É–µ–º
  await db.ActivityLog.create({
    action: 'RULE_ROLLBACK',
    details: {
      from_version: 2,
      to_version: 1,
      new_version: 3
    }
  });
  
  return newVersion;
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// version-1: 5% (01.01 - 14.01)
// version-2: 50% (15.01 - 16.01) - –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
// version-3: 5% (17.01 - ...) - –Ω–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è

// –ë–∞–ª–ª—ã –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ version-2 –û–°–¢–ê–Æ–¢–°–Ø (–Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è)
// –ù–æ–≤—ã–µ –±–∞–ª–ª—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ version-3 (–∫–æ—Ç–æ—Ä–∞—è = version-1)
```


***

### 3Ô∏è‚É£ **–ü–ï–†–ï–°–ß–ï–¢ –ë–ê–õ–õ–û–í –í–†–£–ß–ù–£–Æ (–¢–û–õ–¨–ö–û –î–õ–Ø EMERGENCY)**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ë—ã–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä —Å—á–∏—Ç–∞–ª–∏—Å—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–ª—ã). –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –±–∞–ª–ª—ã –∑–∞ –ø–µ—Ä–∏–æ–¥. –ö–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) Background job (–±–µ–∑–æ–ø–∞—Å–Ω–æ, –¥–æ–ª–≥–æ, –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å)
- B) –ü—Ä—è–º–æ –≤ Admin –ø–∞–Ω–µ–ª–∏ (–±—ã—Å—Ç—Ä–æ –Ω–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ)
- C) –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤–æ–æ–±—â–µ

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç A (Background job)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ (–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å)
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Admin –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

**üíª –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ—Å—á–µ—Ç–∞:**

```javascript
// Admin –Ω–∞–∂–∏–º–∞–µ—Ç: "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–ª—ã"
{
  recalculation_id: 'uuid',
  period_from: '2024-01-01',
  period_to: '2024-01-31',
  loyalty_level: 'BRONZE', // –∏–ª–∏ null = –≤—Å–µ —É—Ä–æ–≤–Ω–∏
  restaurant_id: 'rest-1', // –∏–ª–∏ null = –≤—Å–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
  recalculation_type: 'RECALCULATE', // –∏–ª–∏ 'ADJUST', 'NOTIFY_ONLY'
  status: 'PENDING', // PENDING ‚Üí IN_PROGRESS ‚Üí COMPLETED/FAILED
  started_at: null,
  completed_at: null,
  guests_affected: null,
  balls_adjusted: null
}

// NOTIFY_ONLY —Ä–µ–∂–∏–º:
// - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
// - –ù–æ –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ–º
// - Admin –≤–∏–¥–∏—Ç: "5000 –≥–æ—Å—Ç–µ–π –ø–æ–ª—É—á–∞—Ç +50 –±–∞–ª–ª–æ–≤ –≤ —Å—Ä–µ–¥–Ω–µ–º"

// RECALCULATE —Ä–µ–∂–∏–º:
// - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –±–∞–ª–ª—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
// - –î–æ–±–∞–≤–ª—è–µ–º BallAdjustment –∑–∞–ø–∏—Å–∏
// - –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –≤ ActivityLog

// ADJUST —Ä–µ–∂–∏–º:
// - –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É (–Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º, –∞ –¥–æ–±–∞–≤–ª—è–µ–º)
// - –ú–µ–Ω–µ–µ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
```


***

### 4Ô∏è‚É£ **–í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ú–û-–ê–ö–¶–ò–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
Admin —Å–æ–∑–¥–∞–ª –ø—Ä–æ–º–æ "–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è +1000 –±–∞–ª–ª–æ–≤, 7 –¥–Ω–µ–π". –ü–æ–∑–∂–µ –ø–æ–Ω—è–ª —á—Ç–æ –Ω—É–∂–Ω–æ "+500 –±–∞–ª–ª–æ–≤". –ß—Ç–æ —Å –≥–æ—Å—Ç—è–º–∏ –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø–æ–ª—É—á–∏–ª–∏ +1000?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- –°—Ç–∞—Ä—ã–µ –±–∞–ª–ª—ã –û–°–¢–ê–Æ–¢–°–Ø (+1000 –¥–ª—è —Ç–µ—Ö –∫—Ç–æ –ø–æ–ª—É—á–∏–ª)
- –ù–æ–≤—ã–µ –≥–æ—Å—Ç–∏ –ü–û–õ–£–ß–ê–¢ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (+500)
- –ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

***

### 5Ô∏è‚É£ **–ó–ê–ü–†–ï–¢ –ù–ê –°–û–ó–î–ê–ù–ò–ï –ö–û–ù–§–õ–ò–ö–¢–£–Æ–©–ò–• –í–ï–†–°–ò–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ú–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å –¥–≤–µ –ê–ö–¢–ò–í–ù–´–ï –≤–µ—Ä—Å–∏–∏ –ø—Ä–∞–≤–∏–ª–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ? (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤)

**‚úÖ –ú–û–ô –í–´–ë–û–†: –ù–ï–¢, –∑–∞–ø—Ä–µ—Ç–∏—Ç—å!**

```javascript
// CONSTRAINT –≤ –ë–î:
CREATE UNIQUE INDEX idx_loyalty_rule_active_period ON loyalty_rule_versions(
  loyalty_rule_id, 
  active_from 
) 
WHERE active_to IS NULL; // —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ "—Ç–µ–∫—É—â–∞—è" –≤–µ—Ä—Å–∏—è

// –õ–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –µ—Å—Ç—å –≤–µ—Ä—Å–∏—è 1 (active_from=01.01, active_to=NULL)
// –¢–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ 2 –ù–£–ñ–ù–û —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å active_to=–≤–µ—Ä—Å–∏–∏1=—Ç–µ–∫—É—â–∞—è_–¥–∞—Ç–∞
```


***

### 6Ô∏è‚É£ **–°–ù–ò–ú–û–ö –ü–†–ê–í–ò–õ–ê –í –ö–ê–ñ–î–û–ô –ü–†–û–ú–û-–ê–ö–¶–ò–ò**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –∞–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞, –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏ —Ç–æ–∂–µ –º–µ–Ω—è—é—Ç—Å—è –∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- PromoBallGranted —Ç–∞–±–ª–∏—Ü–∞ —Ö—Ä–∞–Ω–∏—Ç –°–ù–ò–ú–û–ö –ø—Ä–∞–≤–∏–ª–∞
- –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å - –ø—Ä–æ–º–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ —Å–Ω–∏–º–∫—É
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

```javascript
{
  id: 'promo-grant-1',
  guest_card_id: 'card-1',
  promo_id: 'birthday-promo-1',
  amount: 1000,
  loyalty_rule_version_id: 'version-1', // —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ—Ä—Å–∏—é –ø—Ä–∞–≤–∏–ª–∞
  rule_snapshot: {
    type: 'BIRTHDAY_PROMO',
    base_amount: 1000,
    expiration_days: 7
  },
  created_at: '2024-01-15'
}
```


***

### 7Ô∏è‚É£ **–í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò –£–†–û–í–ù–ï–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
Admin –º–µ–Ω—è–µ—Ç –ø–æ—Ä–æ–≥–∏ —É—Ä–æ–≤–Ω–µ–π: Bronze 0-50k ‚Üí 0-100k. –ì–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ –¥—Ä—É–≥–∏–µ —É—Ä–æ–≤–Ω–∏?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- –ù–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–µ–π—Å—Ç–≤—É—é—Ç –ø—Ä–∏ –°–õ–ï–î–£–Æ–©–ï–ú –ø–µ—Ä–µ—Å—á–µ—Ç–µ (–≤ 00:00)
- –°—Ç–∞—Ä—ã–µ –ø–æ—Ä–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
- –ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

***

### 8Ô∏è‚É£ **–û–¢–ö–ê–¢ –ö –û–ü–†–ï–î–ï–õ–ï–ù–ù–û–ô –í–ï–†–°–ò–ò –£–†–û–í–ù–ï–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ê–¥–º–∏–Ω —Å–ª—É—á–∞–π–Ω–æ –∏–∑–º–µ–Ω–∏–ª –ø–æ—Ä–æ–≥–∏, –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∫ –≤–µ—Ä—Å–∏–∏ –æ—Ç –Ω–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- LoyaltyLevelVersion —Ç–∞–±–ª–∏—Ü–∞ —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é
- Admin –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é
- –ù–æ–≤—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏

***

### 9Ô∏è‚É£ **–í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ü–ï–†–ï–ü–†–û–¶–ï–ù–¢–û–í–û–ö**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ü—Ä–∞–≤–∏–ª–æ: "–î–Ω–∏ 11-15 - extra +50%". –ï—Å–ª–∏ admin –∏–∑–º–µ–Ω–∏—Ç –Ω–∞ "–î–Ω–∏ 10-20 - extra +30%", –∫–∞–∫ —Å—á–∏—Ç–∞—é—Ç—Å—è –±–∞–ª–ª—ã?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- –ö–∞–∂–¥—ã–π BallTransaction —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª–Ω—ã–π rule_snapshot
- –î–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –º–µ–Ω—è–µ—Ç—Å—è - –±–∞–ª–ª—ã —Å—á–∏—Ç–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ª–Ω–∞—è

***

### üîü **–ó–ê–ü–†–û–° –ò–°–¢–û–†–ò–ò –í–ï–†–°–ò–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
Admin —Ö–æ—á–µ—Ç –≤–∏–¥–µ—Ç—å: "–ö–∞–∫–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∞–≤–∏–ª–∞ –±—ã–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã –≤ –ø–µ—Ä–∏–æ–¥–µ 01.01-31.01?"

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- API endpoint: GET /loyalty-rules/{id}/versions?from=2024-01-01\&to=2024-01-31
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –≤–µ—Ä—Å–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥

***

## üîÑ **–ë–õ–û–ö 2: –ú–ò–ì–†–ê–¶–ò–Ø –ú–ï–ñ–î–£ –¢–ò–ü–ê–ú–ò –°–ò–°–¢–ï–ú (2 –≤–æ–ø—Ä–æ—Å–∞)**

### 1Ô∏è‚É£1Ô∏è‚É£ **–ú–ò–ì–†–ê–¶–ò–Ø UNIFIED ‚Üí SEPARATE**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–†–µ—Å—Ç–æ—Ä–∞–Ω —Ä–∞–±–æ—Ç–∞–ª —Å UNIFIED (–æ–¥–Ω–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ –≤—Å—é —Å–µ—Ç—å –∏–∑ 3 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤). –†–µ—à–∏–ª –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ SEPARATE (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã). –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç TWO –∫–∞—Ä—Ç—ã (—Å—Ç–∞—Ä—É—é UNIFIED + –Ω–æ–≤—É—é SEPARATE)
- B) –ö–∞—Ä—Ç–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω (–≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç 3 –∫–∞—Ä—Ç—ã)
- C) –ë–∞–ª–ª—ã –¥–µ–ª—è—Ç—Å—è –ø–æ—Ä–æ–≤–Ω—É –º–µ–∂–¥—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏
- D) –ì–æ—Å—Ç—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –±–∞–ª–ª—ã

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç B (–ö–∞—Ä—Ç–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç –≤—Å–µ —Å–≤–æ–∏ –±–∞–ª–ª—ã –≤–µ–∑–¥–µ (–æ–Ω –∏—Ö –Ω–∞–∫–æ–ø–∏–ª!)
- ‚úÖ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ (–Ω–µ —Ç–µ—Ä—è–µ—Ç –±–∞–ª–ª—ã)
- ‚úÖ –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å UNIFIED)
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–∞–º–∏ –≤ Telegram

**üíª –ê–ª–≥–æ—Ä–∏—Ç–º –º–∏–≥—Ä–∞—Ü–∏–∏:**

```javascript
async function migrateUnifiedToSeparate(loyaltySystemId) {
  // 1. –°–æ–∑–¥–∞–µ–º Migration –∑–∞–ø–∏—Å—å
  const migration = await db.LoyaltyMigration.create({
    loyalty_system_id: loyaltySystemId,
    migration_type: 'UNIFIED_TO_SEPARATE',
    migration_status: 'IN_PROGRESS',
    started_at: new Date()
  });
  
  // 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Å—Ç—è –≤ UNIFIED —Å–∏—Å—Ç–µ–º–µ
  const guests = await db.GuestCard.findAll({
    where: { loyalty_system_id: loyaltySystemId }
  });
  
  for (const oldCard of guests) {
    // 3. –ö–æ–ø–∏—Ä—É–µ–º –≤ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω
    for (const restaurant of loyaltySystem.restaurants) {
      const newCard = await db.GuestCard.create({
        user_id: oldCard.user_id,
        tenant_id: oldCard.tenant_id,
        restaurant_id: restaurant.id, // DIFFERENCE: —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å restaurant_id
        balance: oldCard.balance, // –ö–û–ü–ò–†–£–ï–ú –±–∞–ª–ª—ã!
        loyalty_level_id: oldCard.loyalty_level_id, // –ö–û–ü–ò–†–£–ï–ú —É—Ä–æ–≤–µ–Ω—å
        qrcode: generateNewQR(),
        code6digit: generateNew6Digit(),
        status: 'ACTIVE',
        registration_source: 'MIGRATION',
        migration_id: migration.id
      });
      
      // 4. –ö–æ–ø–∏—Ä—É–µ–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –±–∞–ª–ª–æ–≤
      const transactions = await db.BallTransaction.findAll({
        where: { guest_card_id: oldCard.id }
      });
      
      for (const tx of transactions) {
        await db.BallTransaction.create({
          ...tx,
          guest_card_id: newCard.id,
          migration_id: migration.id
        });
      }
    }
  }
  
  // 5. –û–±–Ω–æ–≤–ª—è–µ–º LoyaltySystem
  await db.LoyaltySystem.update(
    { id: loyaltySystemId },
    { 
      system_type: 'SEPARATE',
      migrated_at: new Date(),
      migration_id: migration.id
    }
  );
  
  // 6. –ó–∞–≤–µ—Ä—à–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
  await migration.update({
    migration_status: 'COMPLETED',
    completed_at: new Date(),
    guests_affected: guests.length,
    balls_migrated: guests.reduce((sum, g) => sum + g.balance, 0)
  });
  
  // 7. –õ–æ–≥–∏—Ä—É–µ–º
  await db.ActivityLog.create({
    action: 'SYSTEM_MIGRATION',
    entity_type: 'LOYALTY_SYSTEM',
    details: {
      from: 'UNIFIED',
      to: 'SEPARATE',
      guests_migrated: guests.length
    }
  });
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ì–æ—Å—Ç —Å 2000 –±–∞–ª–ª–æ–≤ ‚Üí –≤–∏–¥–∏—Ç 3 –∫–∞—Ä—Ç—ã –ø–æ 2000 –±–∞–ª–ª–æ–≤ (UNIFIED + Restaurant1 + Restaurant2)
- –í—Å–µ –∫–∞—Ä—Ç—ã –∏–º–µ—é—Ç –Ω–æ–≤—ã–µ QR –∫–æ–¥—ã
- Telegram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ 4 –∫–∞—Ä—Ç—ã –¥–ª—è –≤—ã–±–æ—Ä–∞
- –°—Ç–∞—Ä–∞—è UNIFIED –∫–∞—Ä—Ç–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ MIGRATED

**–û—Ç–∫–∞—Ç:**

```javascript
// –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
async function rollbackMigration(migrationId) {
  // 1. –£–¥–∞–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ä—Ç—ã
  await db.GuestCard.deleteMany({
    where: { migration_id: migrationId }
  });
  
  // 2. –£–¥–∞–ª—è–µ–º –Ω–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  await db.BallTransaction.deleteMany({
    where: { migration_id: migrationId }
  });
  
  // 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏—Å—Ç–µ–º—É –Ω–∞ UNIFIED
  // 4. –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–∫–∞—Ç
}
```


***

### 1Ô∏è‚É£2Ô∏è‚É£ **–ú–ò–ì–†–ê–¶–ò–Ø SEPARATE ‚Üí UNIFIED**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–†–µ—Å—Ç–æ—Ä–∞–Ω —Ä–∞–±–æ—Ç–∞–ª —Å 3 SEPARATE –∫–∞—Ä—Ç–∞–º–∏. –†–µ—à–∏–ª –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–Ω—É UNIFIED. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–∞–ª–ª–∞–º–∏?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –ë–∞–ª–ª—ã –°–£–ú–ú–ò–†–£–Æ–¢–°–Ø (3x2000 = 6000)
- B) –ë–µ—Ä—É—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
- C) –ë–∞–ª–ª—ã –¥–µ–ª—è—Ç—Å—è –ø–æ—Ä–æ–≤–Ω—É
- D) –ì–æ—Å—Ç –≤—ã–±–∏—Ä–∞–µ—Ç

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç A (–ë–∞–ª–ª—ã –°–£–ú–ú–ò–†–£–Æ–¢–°–Ø)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ (–≥–æ—Å—Ç –Ω–∞–∫–æ–ø–∏–ª –±–∞–ª–ª—ã –≤–µ–∑–¥–µ!)
- ‚úÖ –ß–µ—Å—Ç–Ω–æ (–ø–æ—á–µ–º—É —Ç–µ—Ä—è—Ç—å –µ–≥–æ –±–∞–ª–ª—ã?)
- ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤–æ –≤—ã–≥–æ–¥–Ω–æ (–≥–æ—Å—Ç —Å—á–∞—Å—Ç–ª–∏–≤–µ–µ, –ø–æ—Ç—Ä–∞—Ç–∏—Ç –±–æ–ª—å—à–µ)
- ‚úÖ –£—Ä–æ–≤–µ–Ω—å = –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–∑ –≤—Å–µ—Ö

**üíª –ê–ª–≥–æ—Ä–∏—Ç–º:**

```javascript
async function migrateSeparateToUnified(loyaltySystemId) {
  const migration = await db.LoyaltyMigration.create({
    loyalty_system_id: loyaltySystemId,
    migration_type: 'SEPARATE_TO_UNIFIED',
    migration_status: 'IN_PROGRESS'
  });
  
  // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ SEPARATE –∫–∞—Ä—Ç—ã –∫–∞–∂–¥–æ–≥–æ –≥–æ—Å—Ç—è
  const unifiedGuests = await db.GuestCard.findAll({
    where: { loyalty_system_id: loyaltySystemId },
    include: ['user']
  });
  
  const guestsByUser = {};
  for (const card of unifiedGuests) {
    if (!guestsByUser[card.user_id]) {
      guestsByUser[card.user_id] = [];
    }
    guestsByUser[card.user_id].push(card);
  }
  
  // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Å—Ç—è
  for (const [userId, cards] of Object.entries(guestsByUser)) {
    // –°–£–ú–ú–ò–†–£–ï–ú –±–∞–ª–ª—ã
    const totalBalance = cards.reduce((sum, c) => sum + c.balance, 0);
    
    // –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô —É—Ä–æ–≤–µ–Ω—å
    const maxLevel = cards.reduce((max, c) => {
      const currentLevelValue = c.loyalty_level?.rank || 0;
      const maxValue = max?.rank || 0;
      return currentLevelValue > maxValue ? c.loyalty_level : max;
    }, null);
    
    // –°–æ–∑–¥–∞–µ–º UNIFIED –∫–∞—Ä—Ç—É
    const unifiedCard = await db.GuestCard.create({
      user_id: userId,
      tenant_id: cards[^4_0].tenant_id,
      restaurant_id: null, // NULL = UNIFIED
      balance: totalBalance,
      loyalty_level_id: maxLevel?.id,
      qrcode: generateNewQR(),
      code6digit: generateNew6Digit(),
      status: 'ACTIVE',
      migration_id: migration.id
    });
    
    // –ö–æ–ø–∏—Ä—É–µ–º –í–°–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –≤—Å–µ—Ö –∫–∞—Ä—Ç
    for (const oldCard of cards) {
      const transactions = await db.BallTransaction.findAll({
        where: { guest_card_id: oldCard.id }
      });
      
      for (const tx of transactions) {
        await db.BallTransaction.create({
          ...tx,
          guest_card_id: unifiedCard.id
        });
      }
      
      // –ü–æ–º–µ—á–∞–µ–º —Å—Ç–∞—Ä—É—é –∫–∞—Ä—Ç—É –∫–∞–∫ MIGRATED
      await oldCard.update({
        status: 'MIGRATED',
        migrated_to_card_id: unifiedCard.id
      });
    }
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É
  await db.LoyaltySystem.update(
    { id: loyaltySystemId },
    { system_type: 'UNIFIED' }
  );
}

// –†–ï–ó–£–õ–¨–¢–ê–¢:
// Restaurant 1 –∫–∞—Ä—Ç–∞: 2000 –±–∞–ª–ª–æ–≤, Bronze ‚Üí MIGRATED
// Restaurant 2 –∫–∞—Ä—Ç–∞: 1500 –±–∞–ª–ª–æ–≤, Silver ‚Üí MIGRATED
// Restaurant 3 –∫–∞—Ä—Ç–∞: 3000 –±–∞–ª–ª–æ–≤, Gold ‚Üí MIGRATED
// UNIFIED –∫–∞—Ä—Ç–∞: 6500 –±–∞–ª–ª–æ–≤, Gold (–º–∞–∫—Å–∏–º—É–º!)
```


***

## ‚öîÔ∏è **–ë–õ–û–ö 3: –ö–û–ù–§–õ–ò–ö–¢–´ –ü–†–û–ú–û-–ê–ö–¶–ò–ô (3 –≤–æ–ø—Ä–æ—Å–∞)**

### 1Ô∏è‚É£3Ô∏è‚É£ **–î–í–ï –ü–†–û–ú–û –°–†–ê–ë–ê–¢–´–í–ê–Æ–¢ –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç 15 —è–Ω–≤–∞—Ä—è (–µ–≥–æ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è) AND —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ø—Ä–æ–≤–æ–¥–∏—Ç "–°—Ä–µ–¥–∞ - +500 –±–∞–ª–ª–æ–≤" AND —ç—Ç–æ –µ–≥–æ –ø–µ—Ä–≤—ã–π —á–µ–∫ (–ø–µ—Ä–≤–∞—è –ø—Ä–æ–º–æ +1000). –°—Ä–∞–±–æ—Ç–∞—é—Ç –í–°–ï –¢–†–ò?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –í—Å–µ —Ç—Ä–∏ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è (1000+500+1000=2500)
- B) –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç - —Ç–æ–ª—å–∫–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è (1000)
- C) –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ Admin
- D) –ì–æ—Å—Ç –≤—ã–±–∏—Ä–∞–µ—Ç

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç C (Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- ‚úÖ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**üíª –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:**

```javascript
// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ LoyaltySystem
{
  id: 'loyalty-sys-1',
  conflict_resolution_strategy: 'COMBINE_ALL', // –∏–ª–∏ MAX_ONLY, FIRST_ONLY
  
  // –ü—Ä–∞–≤–∏–ª–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–∫–∞—Å—Ç–æ–º–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –ø—Ä–æ–º–æ)
  conflictRules: [
    {
      promo_id_1: 'birthday-promo',
      promo_id_2: 'wednesday-promo',
      resolution: 'COMBINE_ALL' // —ç—Ç–∏ –¥–≤–∞ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è
    },
    {
      promo_id_1: 'first-check-promo',
      promo_id_2: 'birthday-promo',
      resolution: 'MAX_ONLY' // –±–µ—Ä–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é
    }
  ]
}

// ENUM ConflictResolutionStrategy:
// - COMBINE_ALL: —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ø—Ä–æ–º–æ (1000+500+1000=2500)
// - MAX_ONLY: –±–µ—Ä–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è (MAX(1000,500,1000)=1000)
// - FIRST_ONLY: —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–µ—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç birthday=100, wednesday=50, first=80 ‚Üí birthday=1000)
// - RANDOM_CHOICE: —Å–ª—É—á–∞–π–Ω–∞—è –æ–¥–Ω–∞

// –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –±–∞–ª–ª–æ–≤:
async function calculateBallsWithPromos(guest, checkAmount) {
  // 1. –ë–∞–∑–æ–≤—ã–µ –±–∞–ª–ª—ã
  let baseAmount = calculateBasePoints(guest, checkAmount);
  
  // 2. –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ
  const activePromos = await findActivePromos(guest, checkAmount);
  // –†–µ–∑—É–ª—å—Ç–∞—Ç: [birthday, wednesday, firstCheck]
  
  // 3. –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
  const strategy = loyaltySystem.conflict_resolution_strategy;
  let promoBallAmount = 0;
  
  if (strategy === 'COMBINE_ALL') {
    promoBallAmount = activePromos.reduce((sum, p) => sum + p.amount, 0);
    // 1000 + 500 + 1000 = 2500
  } else if (strategy === 'MAX_ONLY') {
    promoBallAmount = Math.max(...activePromos.map(p => p.amount));
    // MAX(1000, 500, 1000) = 1000
  } else if (strategy === 'FIRST_ONLY') {
    const sorted = activePromos.sort((a, b) => b.priority - a.priority);
    promoBallAmount = sorted[^4_0].amount;
    // birthday priority 100 ‚Üí 1000
  }
  
  // 4. –õ–æ–≥–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç
  await db.PromoBallGranted.create({
    guest_card_id: guest.id,
    activePromoIds: activePromos.map(p => p.id),
    conflictResolutionStrategy: strategy,
    ballsPerPromo: activePromos.map(p => ({ id: p.id, amount: p.amount })),
    finalAmount: promoBallAmount,
    conflictingPromoIds: activePromos.length > 1 ? activePromos.map(p => p.id) : []
  });
  
  return baseAmount + promoBallAmount;
}
```


***

### 1Ô∏è‚É£4Ô∏è‚É£ **–ü–†–ò–û–†–ò–¢–ï–¢ –ü–†–û–ú–û-–ê–ö–¶–ò–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–º–æ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –∏—Ö –ø—Ä–∏–º–µ–Ω—è—Ç—å?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (0-1000, –±–æ–ª—å—à–µ = –≤—ã—à–µ)
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
    - Birthday: 1000 (—Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è)
    - FirstCheck: 800
    - Inactivity: 600
    - Weekday/Time based: 400
    - Custom: 500

```javascript
// LoyaltyPromo —Ç–∞–±–ª–∏—Ü–∞
{
  id: 'promo-1',
  name: 'Birthday Promo',
  amount: 1000,
  priority: 1000, // ADMIN –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å
  conflict_strategy_override: null // –µ—Å–ª–∏ null —Ç–æ –±–µ—Ä–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é
}

// API –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
PUT /api/loyalty-promos/{id}
{
  priority: 1000 ‚Üí 100 // —É–º–µ–Ω—å—à–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
}
```


***

### 1Ô∏è‚É£5Ô∏è‚É£ **–õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ö–û–ù–§–õ–ò–ö–¢–û–í**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ê–¥–º–∏–Ω —Ö–æ—á–µ—Ç –≤–∏–¥–µ—Ç—å: "–°–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –±—ã–ª–æ –∏ –∫–∞–∫ –æ–Ω–∏ —Ä–∞–∑—Ä–µ—à–∞–ª–∏—Å—å?"

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- PromoBallGranted —Ç–∞–±–ª–∏—Ü–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –í–°–ï –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- Analytics –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

```javascript
// PromoBallGranted —Ç–∞–±–ª–∏—Ü–∞
{
  id: 'grant-1',
  guest_card_id: 'card-1',
  post_transaction_id: 'pos-123', // –∏–∑ –∫–∞–∫–æ–≥–æ —á–µ–∫–∞
  active_promos: ['birthday', 'wednesday', 'first-check'], // –∫–∞–∫–∏–µ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–∏
  conflict_count: 3, // —Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –ø—Ä–æ–º–æ
  resolution_strategy: 'COMBINE_ALL',
  amounts_per_promo: {
    birthday: 1000,
    wednesday: 500,
    first_check: 1000
  },
  final_amount: 2500, // –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –±–∞–ª–ª–æ–≤
  created_at: '2024-01-15T10:00:00Z'
}

// Analytics Report
GET /api/analytics/promo-conflicts?period=month
{
  total_grants: 15000,
  conflicts_count: 2500, // 16.7% —á–µ–∫–æ–≤ –∏–º–µ–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
  resolution_breakdown: {
    COMBINE_ALL: 1500,
    MAX_ONLY: 800,
    FIRST_ONLY: 200
  },
  average_promo_per_transaction: 1.2 // –≤ —Å—Ä–µ–¥–Ω–µ–º 1.2 –ø—Ä–æ–º–æ –Ω–∞ —á–µ–∫
}
```


***

## üí• **–ë–õ–û–ö 4: –°–ì–û–†–ê–ù–ò–ï –ë–ê–õ–õ–û–í –ò –£–†–û–í–ù–ò (4 –≤–æ–ø—Ä–æ—Å–∞)**

### 1Ô∏è‚É£6Ô∏è‚É£ **–†–ê–ó–ù–´–ï –°–†–û–ö–ò –°–ì–û–†–ê–ù–ò–Ø –ë–ê–õ–õ–û–í**

**‚ùì –í–æ–ø—Ä–æ—Å:**

- –ë–∞–ª–ª—ã –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ —á–µ–∫–∞: 90 –¥–Ω–µ–π
- –ë–∞–ª–ª—ã –æ—Ç –ø—Ä–æ–º–æ (–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è): 7 –¥–Ω–µ–π
- –ë–∞–ª–ª—ã –ø–æ–¥–∞—Ä–æ–∫: 180 –¥–Ω–µ–π

–ö–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —á—Ç–æ —Å–≥–æ—Ä–∞–µ—Ç?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –ö–∞–∂–¥—ã–π BallTransaction —Å–æ–¥–µ—Ä–∂–∏—Ç expiration_date
- B) FIFO –ø–æ—Ä—è–¥–æ–∫ (–ø–µ—Ä–≤—ã–µ –ø—Ä–∏—à–µ–¥—à–∏–µ - –ø–µ—Ä–≤—ã–µ —É—Ö–æ–¥—è—Ç)
- C) –û—Ç–¥–µ–ª—å–Ω—ã–µ ¬´–ø–æ–¥–∫–æ—à–µ–ª—å–∫–∏¬ª –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç A + B (–ì–∏–±—Ä–∏–¥–Ω—ã–π)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –ö–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –±–∞–ª–ª–æ–≤ –∏–º–µ–µ—Ç —Å–≤–æ—é –¥–∞—Ç—É —Å–≥–æ—Ä–∞–Ω–∏—è (—á–µ—Å—Ç–Ω–æ)
- ‚úÖ FIFO –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –ø–µ—Ä–≤—ã–µ —É—Ö–æ–¥—è—Ç (—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ)
- ‚úÖ –ú–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å —Å—Ä–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞

**üíª –°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```javascript
// BallTransaction —Ç–∞–±–ª–∏—Ü–∞
{
  id: 'tx-1',
  guest_card_id: 'card-1',
  type: 'EARN', // –∏–ª–∏ REDEEM, PROMO_ADD, GIFT_ADD, CANCEL
  amount: 100,
  source_type: 'REGULAR_CHECK', // –∏–ª–∏ BIRTHDAY_PROMO, GIFT
  expires_at: '2024-04-10', // —Å–≥–æ—Ä–∞–µ—Ç –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å (90 –¥–Ω–µ–π –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è)
  created_at: '2024-01-10',
  status: 'ACTIVE' // ACTIVE, EXPIRED, REDEEMED, CANCELLED
}

// –ü—Ä–∞–≤–∏–ª–∞ —Å–≥–æ—Ä–∞–Ω–∏—è (–≤ LoyaltySystem)
{
  expiration_rules: {
    REGULAR_CHECK: 90, // –¥–Ω–∏
    BIRTHDAY_PROMO: 7,
    INACTIVITY_PROMO: 30,
    GIFT_ADD: 180,
    MANUAL_ADD: 365 // –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç –∞–¥–º–∏–Ω–∞
  }
}

// –õ–æ–≥–∏–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
async function createBallTransaction(guestId, amount, sourceType) {
  const expirationRule = loyaltySystem.expiration_rules[sourceType];
  const expiresAt = new Date();
  expiresAt.setDate(expiresAt.getDate() + expirationRule);
  
  return db.BallTransaction.create({
    guest_card_id: guestId,
    amount: amount,
    source_type: sourceType,
    expires_at: expiresAt,
    created_at: new Date(),
    status: 'ACTIVE'
  });
}

// FIFO —Å–≥–æ—Ä–∞–Ω–∏–µ
// –ì–æ—Å—Ç –≤–∏–¥–∏—Ç –±–∞–ª–∞–Ω—Å 2500 –±–∞–ª–ª–æ–≤:
// - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1: 1000 –±–∞–ª–ª–æ–≤, expires 01.02 ‚Üê –°–ì–û–†–ò–¢ –ü–ï–†–í–ê–Ø
// - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2: 500 –±–∞–ª–ª–æ–≤, expires 15.02
// - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 3: 1000 –±–∞–ª–ª–æ–≤, expires 01.03

// 01.02 ‚Üí CRON —Å–≥–æ—Ä–∞–Ω–∏—è:
// –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—É—é (–ø–æ created_at) ACTIVE —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≥–¥–µ expires_at < NOW
SELECT * FROM BallTransaction 
WHERE guest_card_id = X 
  AND status = 'ACTIVE'
  AND expires_at < NOW()
ORDER BY created_at ASC
LIMIT 1

// –û–±–Ω–æ–≤–ª—è–µ–º:
UPDATE BallTransaction SET status = 'EXPIRED' WHERE id = ...
UPDATE GuestCard SET balance = balance - 1000 WHERE id = ...

// –†–µ–∑—É–ª—å—Ç–∞—Ç: –≥–æ—Å—Ç —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç 1500 –±–∞–ª–ª–æ–≤
```


***

### 1Ô∏è‚É£7Ô∏è‚É£ **–£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û –°–ì–û–†–ê–ù–ò–ò –ë–ê–õ–õ–û–í**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç –≤–∏–¥–∏—Ç —á—Ç–æ –µ–≥–æ –±–∞–ª–ª—ã —Å–≥–æ—Ä—è—Ç? –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 3, 7, 14 –¥–Ω–µ–π –¥–æ —Å–≥–æ—Ä–∞–Ω–∏—è
- –ö–∞–Ω–∞–ª—ã: Telegram, Email (Admin –≤—ã–±–∏—Ä–∞–µ—Ç)
- CRON job –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 23:00

```javascript
// CRON job
async function notifyAboutExpiringBalls() {
  // –ù–∞—Ö–æ–¥–∏–º –±–∞–ª–ª—ã –∫–æ—Ç–æ—Ä—ã–µ —Å–≥–æ—Ä—è—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1-14 –¥–Ω–µ–π
  const expiringBalls = await db.BallTransaction.findAll({
    where: {
      status: 'ACTIVE',
      expires_at: {
        $gt: new Date(),
        $lt: new Date(Date.now() + 14*24*60*60*1000) // 14 –¥–Ω–µ–π
      }
    }
  });
  
  for (const ball of expiringBalls) {
    const daysUntilExpire = daysBetween(new Date(), ball.expires_at);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if (daysUntilExpire === 14 || daysUntilExpire === 7 || daysUntilExpire === 3 || daysUntilExpire === 1) {
      const guest = await ball.guestCard.user;
      
      // Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      if (loyaltySystem.notify_telegram) {
        await telegramBot.sendMessage(guest.telegram_id, 
          `–í–∞—à–∏ ${ball.amount} –±–∞–ª–ª–æ–≤ —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑ ${daysUntilExpire} –¥–Ω–µ–π!`
        );
      }
      
      // Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      if (loyaltySystem.notify_email) {
        await sendEmail(guest.email,
          `–í–Ω–∏–º–∞–Ω–∏–µ: –±–∞–ª–ª—ã —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑ ${daysUntilExpire} –¥–Ω–µ–π`,
          `–£ –≤–∞—Å –µ—Å—Ç—å ${ball.amount} –±–∞–ª–ª–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ —Å–≥–æ—Ä—è—Ç ${ball.expires_at}`
        );
      }
      
      // –õ–æ–≥–∏—Ä—É–µ–º
      await db.ActivityLog.create({
        action: 'EXPIRATION_NOTIFICATION_SENT',
        guest_card_id: ball.guest_card_id,
        details: { days_left: daysUntilExpire }
      });
    }
  }
}
```


***

### 1Ô∏è‚É£8Ô∏è‚É£ **–ü–ï–†–ï–°–ß–ï–¢ –£–†–û–í–ù–ï–ô –õ–û–Ø–õ–¨–ù–û–°–¢–ò**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç –Ω–∞–∫–æ–ø–∏–ª 149,000 —Ä—É–±–ª–µ–π (Silver: 50k-150k). –ü–æ—Ç—Ä–∞—Ç–∏–ª 2000, —Å—Ç–∞–ª 151,000. –ö–æ–≥–¥–∞ –ø–µ—Ä–µ–π–¥–µ—Ç –≤ Gold?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) Real-time (—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —á–µ–∫–∞)
- B) –ù–æ—á—å (CRON –≤ 00:00)
- C) –í—Ä—É—á–Ω—É—é (Manager –∫–Ω–æ–ø–∫–∞)

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç B (CRON –≤ 00:00)**

**üéØ –ü–æ—á–µ–º—É:**

- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ (–Ω–µ –Ω—É–∂–µ–Ω realtime —Ä–∞—Å—á–µ—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —á–µ–∫–∞)
- ‚úÖ –õ–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ off-peak —á–∞—Å—ã (–Ω–æ—á—å)
- ‚úÖ –ü–∞–∫–µ—Ç–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

**üíª –ê–ª–≥–æ—Ä–∏—Ç–º:**

```javascript
// CRON job –≤ 00:00 UTC
async function recalculateLoyaltyLevels() {
  // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ ACTIVE –∫–∞—Ä—Ç—ã
  const guestCards = await db.GuestCard.findAll({
    where: { status: 'ACTIVE' }
  });
  
  for (const card of guestCards) {
    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º lifetime_spent
    const totalSpent = await db.BallTransaction.sum('checkAmount', {
      where: { guest_card_id: card.id, type: ['EARN', 'REDEEM'] }
    });
    
    // –ù–∞—Ö–æ–¥–∏–º –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
    const newLevel = findLevelBySpent(totalSpent, loyaltySystem.levels);
    
    // –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –∏–∑–º–µ–Ω–∏–ª—Å—è
    if (newLevel.id !== card.loyalty_level_id) {
      const oldLevel = card.loyalty_level;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º
      await card.update({
        loyalty_level_id: newLevel.id,
        last_level_update: new Date()
      });
      
      // –õ–æ–≥–∏—Ä—É–µ–º
      await db.GuestLevelHistory.create({
        guest_card_id: card.id,
        old_level: oldLevel.name,
        new_level: newLevel.name,
        total_spent: totalSpent,
        reason: 'AUTOMATIC_RECALCULATION',
        changed_at: new Date()
      });
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      if (oldLevel.rank < newLevel.rank) { // UPGRADE
        await telegramBot.sendMessage(card.user.telegram_id,
          `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è ${newLevel.name}!`
        );
      } else if (oldLevel.rank > newLevel.rank) { // DOWNGRADE (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω)
        if (loyaltySystem.allow_downgrade) {
          await telegramBot.sendMessage(card.user.telegram_id,
            `–í–∞—à —É—Ä–æ–≤–µ–Ω—å –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ ${newLevel.name}`
          );
        }
      }
      
      // –õ–æ–≥–∏—Ä—É–µ–º –≤ ActivityLog
      await db.ActivityLog.create({
        action: 'LEVEL_CHANGE',
        guest_card_id: card.id,
        details: { from: oldLevel.name, to: newLevel.name }
      });
    }
  }
}

// –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —É—Ä–æ–≤–Ω—è
function findLevelBySpent(totalSpent, levels) {
  // LoyaltyLevel: [
  //   { name: 'Bronze', min: 0, max: 50000 },
  //   { name: 'Silver', min: 50000, max: 150000 },
  //   { name: 'Gold', min: 150000, max: null }
  // ]
  
  return levels.find(level => 
    totalSpent >= level.min && (level.max === null || totalSpent < level.max)
  );
}
```


***

### 1Ô∏è‚É£9Ô∏è‚É£ **DOWNGRADE –£–†–û–í–ù–ï–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç –±—ã–ª Gold (150k+), –Ω–æ 90 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω. Downgrade –Ω–∞ Silver?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –ù–µ—Ç downgrade (–æ–¥–∏–Ω —Ä–∞–∑ Gold - –Ω–∞–≤—Å–µ–≥–¥–∞ Gold)
- B) –î–∞, downgrade –µ—Å–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω (180 –¥–Ω–µ–π)
- C) –ê–¥–º–∏–Ω –≤—ã–±–∏—Ä–∞–µ—Ç

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç C (Admin –≤—ã–±–∏—Ä–∞–µ—Ç)**

```javascript
// LoyaltySystem –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
{
  allow_downgrade: true, // default false
  downgrade_after_days: 180, // –µ—Å–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω 180 –¥–Ω–µ–π
  downgrade_threshold: 0.8, // downgrade –µ—Å–ª–∏ –ø–æ—Ç—Ä–∞—Ç–∏—Ç < 80% –æ—Ç –ø–æ—Ä–æ–≥–∞
}

// –ü—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ: –µ—Å–ª–∏ allow_downgrade = true
if (loyaltySystem.allow_downgrade && card.last_activity_at < 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥) {
  // Downgrade
}
```


***

## üéØ **–ë–õ–û–ö 5: –õ–ò–ú–ò–¢–´ –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê (4 –≤–æ–ø—Ä–æ—Å–∞)**

### 2Ô∏è‚É£0Ô∏è‚É£ **–ú–ê–ö–°–ò–ú–£–ú –ë–ê–õ–õ–û–í –ù–ê –ö–ê–†–¢–ï**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç –Ω–∞–∫–æ–ø–∏–ª 100,000 –±–∞–ª–ª–æ–≤. –ú–æ–∂–Ω–æ –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –º–∞–∫—Å–∏–º—É–º?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –ù–µ—Ç –ª–∏–º–∏—Ç–∞ (–±–µ–∑–ª–∏–º–∏—Ç)
- B) –ï—Å—Ç—å –ª–∏–º–∏—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è Admin)
- C) –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–æ —É—Ä–æ–≤–Ω—è–º

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç B (Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç)**

```javascript
// LoyaltySystem –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
{
  max_balls_per_guest: 100000, // –º–∞–∫—Å–∏–º—É–º –±–∞–ª–ª–æ–≤
  max_balls_behavior: 'CAP', // –∏–ª–∏ IGNORE, EXPIRE_OLDEST
  
  // max_balls_behavior:
  // - IGNORE: –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å > max, –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ –±–∞–ª–ª—ã
  // - CAP: –æ–±—Ä–µ–∑–∞–µ–º –¥–æ max (50000 + 1000 = 50000)
  // - EXPIRE_OLDEST: —Å–≥–æ—Ä–∞—é—Ç —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ –±–∞–ª–ª—ã
}

// –õ–æ–≥–∏–∫–∞
function calculateBalls(guest, checkAmount) {
  let balls = checkAmount * percentage / 100;
  
  if (guest.balance + balls > loyaltySystem.max_balls_per_guest) {
    if (loyaltySystem.max_balls_behavior === 'IGNORE') {
      return 0; // –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º
    } else if (loyaltySystem.max_balls_behavior === 'CAP') {
      balls = loyaltySystem.max_balls_per_guest - guest.balance;
    } else if (loyaltySystem.max_balls_behavior === 'EXPIRE_OLDEST') {
      // –ù–∞–π—Ç–∏ —Å–≥–æ—Ä–∞–µ–º—ã–µ –±–∞–ª–ª—ã –∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    }
  }
  
  return balls;
}
```


***

### 2Ô∏è‚É£1Ô∏è‚É£ **–ú–ò–ù–ò–ú–£–ú –ë–ê–õ–õ–û–í –î–õ–Ø –°–ü–ò–°–ê–ù–ò–Ø**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —Å–ø–∏—Å–∞—Ç—å 1 –±–∞–ª–ª (—Å–º–µ—à–Ω–æ). –ò–ª–∏ 100,000 –±–∞–ª–ª–æ–≤ (–Ω–∞ –≤–µ—Å—å —á–µ–∫).

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- –ú–∏–Ω–∏–º—É–º: 10 –±–∞–ª–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ú–∞–∫—Å–∏–º—É–º: 50% –æ—Ç —Å—É–º–º—ã —á–µ–∫–∞
- –ú–∏–Ω–∏–º—É–º —á–µ–∫–∞: 100 —Ä—É–±–ª–µ–π

```javascript
{
  min_balls_to_redeem: 10,
  max_percent_to_redeem: 50, // –º–∞–∫—Å–∏–º—É–º 50% —á–µ–∫–∞ –±–∞–ª–ª–∞–º–∏
  min_check_amount: 100 // –º–∏–Ω–∏–º—É–º —á–µ–∫ 100 —Ä—É–±–ª–µ–π
}

// –õ–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
function validateBallsRedemption(checkAmount, ballsToRedeem, guest) {
  // –í–∞–ª–∏–¥–∞—Ü–∏—è 1: –º–∏–Ω–∏–º—É–º —á–µ–∫–∞
  if (checkAmount < loyaltySystem.min_check_amount) {
    throw new Error('–ß–µ–∫ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π');
  }
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è 2: –º–∏–Ω–∏–º—É–º –±–∞–ª–ª–æ–≤
  if (ballsToRedeem < loyaltySystem.min_balls_to_redeem) {
    throw new Error('–ú–∏–Ω–∏–º—É–º –±–∞–ª–ª–æ–≤ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è: ' + loyaltySystem.min_balls_to_redeem);
  }
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è 3: –º–∞–∫—Å–∏–º—É–º –ø—Ä–æ—Ü–µ–Ω—Ç
  const maxBalls = checkAmount * loyaltySystem.max_percent_to_redeem / 100;
  if (ballsToRedeem > maxBalls) {
    throw new Error(`–ú–∞–∫—Å–∏–º—É–º ${Math.floor(maxBalls)} –±–∞–ª–ª–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —á–µ–∫–∞`);
  }
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è 4: –±–∞–ª–∞–Ω—Å –≥–æ—Å—Ç—è
  if (ballsToRedeem > guest.balance) {
    throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤');
  }
  
  return true;
}
```


***

### 2Ô∏è‚É£2Ô∏è‚É£ **ROI –ü–†–û–ú–û-–ê–ö–¶–ò–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
Birthday –ø—Ä–æ–º–æ –¥–∞–ª–∞ 1000 –±–∞–ª–ª–æ–≤ = 500 —Ä—É–±–ª–µ–π —Å–∫–∏–¥–∫–∏. –ì–æ—Å—Ç –ø–æ—Ç—Ä–∞—Ç–∏–ª –ø–æ—Ç–æ–º –µ—â–µ 5000 —Ä—É–±–ª–µ–π. ROI?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**

- ROI = (Revenue –ø–æ—Å–ª–µ –ø—Ä–æ–º–æ - Cost –ø—Ä–æ–º–æ) / Cost –ø—Ä–æ–º–æ
- = (5000 - 500) / 500 = 900% (–æ—Ç–ª–∏—á–Ω–æ–µ!)

```javascript
// PromoBallGranted —Ç–∞–±–ª–∏—Ü–∞
{
  id: 'grant-1',
  promo_id: 'birthday-promo',
  guest_card_id: 'card-1',
  amount: 1000, // –±–∞–ª–ª–æ–≤ –≤—ã–¥–∞–Ω–Ω—ã—Ö
  estimated_cost: 500, // 1000 –±–∞–ª–ª–æ–≤ * 50% = 500 —Ä—É–±–ª–µ–π –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
  balls_redeemed: 800, // –∏–∑ 1000 –ø–æ—Ç—Ä–∞—Ç–∏–ª 800
  revenue_after_promo: 5000, // –ø–æ—Ç—Ä–∞—Ç–∏–ª –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ
  roi: 900 // (5000 - 500) / 500
}

// Analytics –∑–∞–ø—Ä–æ—Å
GET /api/analytics/promo-roi?promo_id=birthday&period=month
{
  total_granted: 5000, // 5000 –≥–æ—Å—Ç–µ–π –ø–æ–ª—É—á–∏–ª–∏
  total_cost: 2_500_000, // –≤—Å–µ–≥–æ 2.5M —Ä—É–±–ª–µ–π —Å–∫–∏–¥–æ–∫
  total_revenue: 25_000_000, // –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ 25M
  average_roi: 900,
  roi_distribution: {
    negative: 100, // 100 –≥–æ—Å—Ç–µ–π –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–∏—à–ª–∏
    0_100: 500, // 500 –≥–æ—Å—Ç–µ–π –≤–æ–æ–±—â–µ –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏
    100_500: 2000, // ROI 100-500%
    500_1000: 1500, // ROI 500-1000%
    1000_plus: 900 // ROI 1000%+
  }
}
```


***

### 2Ô∏è‚É£3Ô∏è‚É£ **–ê–ù–ê–õ–ò–¢–ò–ö–ê –î–õ–Ø –ö–ê–ñ–î–û–ô –†–û–õ–ò**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –≤–∏–¥–∏—Ç –∫–∞–∂–¥–∞—è —Ä–æ–ª—å –≤ Analytics?

**‚úÖ –ú–û–ô –í–´–ë–û–†:**


| –†–æ–ª—å | –í–∏–¥–∏—Ç |
| :-- | :-- |
| **OWNER** | –í—Å–µ –ø—Ä–æ–º–æ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ, ROI –∫–∞–∂–¥–æ–π, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, —Ç—Ä–µ–Ω–¥—ã |
| **RESTAURANT ADMIN** | –ü—Ä–æ–º–æ –≤ –µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ(–∞—Ö), ROI, –∫–∞–∫–∏–µ –≥–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏–ª–∏, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ |
| **MANAGER** | –¢–æ–ª—å–∫–æ –ø–æ —Å–≤–æ–µ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É, –∫–∞–∫–∏–µ –≥–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏–ª–∏, —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ |
| **CASHIER** | –ù–∏—á–µ–≥–æ (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏) |
| **GUEST** | –°–≤–æ–∏ –±–∞–ª–ª—ã, –∏—Å—Ç–æ—Ä–∏—é, –∫–æ–≥–¥–∞ —Å–≥–æ—Ä—è—Ç |


***

## ‚ö° **–ë–õ–û–ö 6: –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï (2 –≤–æ–ø—Ä–æ—Å–∞)**

### 2Ô∏è‚É£4Ô∏è‚É£ **–ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ü–†–ò 100K+ –ì–û–°–¢–ï–ô**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ 100k+ –≥–æ—Å—Ç–µ–π –∫–∞–∫ –±—ã—Å—Ç—Ä–æ —Å—á–∏—Ç–∞—é—Ç—Å—è –±–∞–ª–ª—ã?

**‚úÖ –ú–û–ô –í–´–ë–û–†: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**

```javascript
// Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
const redis = new Redis();

// 1. –ö–µ—à –±–∞–ª–∞–Ω—Å–∞ –≥–æ—Å—Ç—è
cache_key: `guest_balance:{guest_card_id}`
ttl: 5 –º–∏–Ω—É—Ç

// 2. –ö–µ—à —É—Ä–æ–≤–Ω—è
cache_key: `guest_level:{guest_card_id}`
ttl: 24 —á–∞—Å–∞

// 3. –ö–µ—à –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ
cache_key: `active_promos:{restaurant_id}`
ttl: 1 —á–∞—Å

// 4. –ö–µ—à –ø—Ä–∞–≤–∏–ª
cache_key: `rules:{loyalty_system_id}:v{version}`
ttl: 24 —á–∞—Å–∞

// –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏ —á–µ–∫–µ
async function calculateBalls(guest, checkAmount) {
  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º Redis
  let level = await redis.get(`guest_level:{guest.id}`);
  
  if (!level) {
    // 2. –ï—Å–ª–∏ –Ω–µ –≤ –∫–µ—à–µ - —á–∏—Ç–∞–µ–º –∏–∑ –ë–î
    level = await db.GuestCard.findById(guest.id).loyaltyLevel;
    // 3. –ö–µ—à–∏—Ä—É–µ–º
    await redis.setex(`guest_level:{guest.id}`, 86400, level.id); // 24h
  }
  
  // 4. –ë–µ—Ä–µ–º –ø—Ä–∞–≤–∏–ª–∞
  let rules = await redis.get(`rules:{system.id}:v{version}`);
  if (!rules) {
    rules = await db.LoyaltyRuleVersion.getCurrent(system.id);
    await redis.setex(`rules:{system.id}:v{version}`, 86400, JSON.stringify(rules));
  }
  
  // 5. –°—á–∏—Ç–∞–µ–º –±–∞–ª–ª—ã (10-15 –º—Å)
  let balls = calculateBalls(level, rules, checkAmount);
  
  // 6. –õ–æ–≥–∏—Ä—É–µ–º –≤ –ë–î (50-70 –º—Å)
  await db.BallTransaction.create({ ... });
  
  // 7. –û–±–Ω–æ–≤–ª—è–µ–º Redis
  await redis.incr(`guest_balance:{guest.id}`, balls);
  
  return balls;
  // –í–°–ï–ì–û: ~150 –º—Å ‚úÖ
}

// –ò–Ω–¥–µ–∫—Å—ã –ë–î
CREATE INDEX idx_ball_transaction_guest_date 
  ON BallTransaction(guest_card_id, created_at DESC);
  
CREATE INDEX idx_ball_transaction_restaurant
  ON BallTransaction(restaurant_id, created_at DESC);
  
CREATE INDEX idx_loyalty_promo_active
  ON LoyaltyPromo(restaurant_id, is_active);
  
CREATE INDEX idx_guest_level
  ON GuestCard(loyalty_level_id);
```


***

### 2Ô∏è‚É£5Ô∏è‚É£ **–°–ö–û–†–û–°–¢–¨ –†–ê–°–ß–ï–¢–ê –ë–ê–õ–õ–û–í**

**‚ùì –í–æ–ø—Ä–æ—Å:**
100 —á–µ–∫–æ–≤ –≤ –º–∏–Ω—É—Ç—É. –ù—É–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–ª—ã < X –º—Å.

**‚úÖ –ú–û–ô –í–´–ë–û–†: < 200 –º—Å –Ω–∞ –æ–¥–∏–Ω —á–µ–∫**

```javascript
// Target: < 200 –º—Å
// 100 —á–µ–∫–æ–≤/–º–∏–Ω = 1.67 —á–µ–∫–∞/—Å–µ–∫
// 1000 —á–µ–∫–æ–≤/–º–∏–Ω = 16.7 —á–µ–∫–∞/—Å–µ–∫ (–ª–µ–≥–∫–æ!)

// Breakdown –≤—Ä–µ–º–µ–Ω–∏:
// 1. Redis GET (–±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å): 5 –º—Å
// 2. Redis GET (–ø—Ä–æ–º–æ, –ø—Ä–∞–≤–∏–ª–∞): 5 –º—Å
// 3. –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –±–∞–ª–ª–æ–≤: 10-15 –º—Å
// 4. –ë–î INSERT (BallTransaction): 50-70 –º—Å
// 5. Redis UPDATE (–±–∞–ª–∞–Ω—Å): 5 –º—Å
// 6. –°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 20-30 –º—Å
// ‚Äî‚Äî‚Äî
// –ò–¢–û–ì–û: ~150 –º—Å ‚úÖ

// –ù–∞ –ø–∏–∫–µ (1000 —á–µ–∫–æ–≤/–º–∏–Ω):
// 1000 —á–µ–∫–æ–≤ * 150 –º—Å = 150 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
// –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–µ—Å—Ç—å buffer!)
```


***

## üîê **–ë–õ–û–ö 7: –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò EDGE CASES (4 –≤–æ–ø—Ä–æ—Å–∞)**

### 2Ô∏è‚É£6Ô∏è‚É£ **GDPR –ò –£–î–ê–õ–ï–ù–ò–ï –î–ê–ù–ù–´–•**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç –∑–∞–ø—Ä–æ—Å–∏–ª —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞—É–¥–∏—Ç?

**‚úÖ –ú–û–ô –í–´–ë–û–†: –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (soft delete)**

```javascript
// GuestProfile –∏ GuestCard —Å—Ç–∞—Ç—É—Å—ã
status ENUM: ACTIVE, FROZEN, BLOCKED, DELETED

// –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≥–æ—Å—Ç—è
async function deleteGuest(guestId) {
  // 1. –®–∏—Ñ—Ä—É–µ–º –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  const encrypted = encrypt({
    name: guest.name,
    phone: guest.phone,
    email: guest.email,
    birth_date: guest.birth_date
  });
  
  // 2. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
  await db.GuestProfile.update(
    { id: guestId },
    {
      status: 'DELETED',
      name: '[DELETED]',
      phone: '[DELETED]',
      email: '[DELETED]',
      encrypted_data: encrypted,
      deleted_at: new Date(),
      gdpr_deletion_id: generateId()
    }
  );
  
  // 3. –ò—Å—Ç–æ—Ä–∏—è –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø (–¥–ª—è –∞—É–¥–∏—Ç–∞)
  // BallTransaction –æ—Å—Ç–∞–µ—Ç—Å—è
  // GuestCard –æ—Å—Ç–∞–µ—Ç—Å—è —Å balance –Ω–æ —Å—Ç–∞—Ç—É—Å DELETED
  
  // 4. –õ–æ–≥–∏—Ä—É–µ–º
  await db.ActivityLog.create({
    action: 'GUEST_DELETED_GDPR',
    guest_id: guestId,
    reason: 'GDPR_REQUEST'
  });
}

// –ì–æ—Å—Ç –≤–∏–¥–∏—Ç: —Ç–æ–ª—å–∫–æ —Å—É–º–º—É –ø–æ—Ç—Ä–∞—á–µ–Ω–æ (–Ω–µ –∏–º—è, –Ω–µ –±–∞–ª–ª—ã)
```


***

### 2Ô∏è‚É£7Ô∏è‚É£ **ORPHANED –ë–ê–õ–õ–´**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç —É–¥–∞–ª–µ–Ω –Ω–æ –Ω–∞ –µ–≥–æ –∫–∞—Ä—Ç–µ 500 –±–∞–ª–ª–æ–≤. –ß—Ç–æ —Å –Ω–∏–º–∏?

**‚úÖ –ú–û–ô –í–´–ë–û–†: Monthly report**

```javascript
// Monthly job (1-–≥–æ —á–∏—Å–ª–∞)
async function generateOrphanedBallsReport() {
  // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º DELETED –Ω–æ balance > 0
  const orphanedCards = await db.GuestCard.findAll({
    where: { 
      status: 'DELETED', 
      balance: { $gt: 0 }
    }
  });
  
  const report = {
    total_cards: orphanedCards.length,
    total_balls: orphanedCards.reduce((sum, c) => sum + c.balance, 0),
    cards_and_balances: orphanedCards.map(c => ({
      card_id: c.id,
      balance: c.balance,
      deleted_at: c.deleted_at
    }))
  };
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º Owner
  await sendReportToOwner(report);
  
  // –õ–æ–≥–∏—Ä—É–µ–º
  await db.ActivityLog.create({
    action: 'ORPHANED_BALLS_REPORT',
    details: report
  });
}

// Owner –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å:
// - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –æ–±—â–∏–π —Ñ–æ–Ω–¥ (–ø–æ—Ç–µ—Ä—è)
// - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–º–æ
// - –û—Ç–¥–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–º –≥–æ—Å—Ç—è–º
```


***

### 2Ô∏è‚É£8Ô∏è‚É£ **–†–ê–°–°–ß–ï–¢ –ë–ê–õ–õ–û–í –ù–ï –°–û–í–ü–ê–î–ê–ï–¢**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ü–û–° —Ä–∞—Å—Å—á–∏—Ç–∞–ª 100 –±–∞–ª–ª–æ–≤, Backend —Ä–∞—Å—Å—á–∏—Ç–∞–ª 95. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

**‚úÖ –ú–û–ô –í–´–ë–û–†: Reconciliation job + alert Admin**

```javascript
// –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π Reconciliation job
async function reconcileBallsWithPOS() {
  // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–µ–∫–∞ –∑–∞ –¥–µ–Ω—å
  const transactions = await db.POSTransaction.findAll({
    created_at: { $gte: yesterday, $lt: today }
  });
  
  for (const posTx of transactions) {
    // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π BallTransaction
    const ballTx = await db.BallTransaction.findOne({
      post_transaction_id: posTx.id
    });
    
    if (ballTx) {
      const difference = Math.abs(posTx.balls - ballTx.amount);
      const percentDiff = difference / posTx.balls * 100;
      
      if (percentDiff > 1) { // –±–æ–ª–µ–µ 1% —Ä–∞–∑–Ω–∏—Ü–∞
        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        await db.BallReconciliation.create({
          pos_transaction_id: posTx.id,
          expected_balls: ballTx.amount,
          actual_balls: posTx.balls,
          difference: difference,
          percent_diff: percentDiff,
          status: 'PENDING', // —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
          resolved: false
        });
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º alert Admin
        await alertAdmin({
          type: 'BALL_CALCULATION_MISMATCH',
          details: {
            pos_tx: posTx.id,
            expected: ballTx.amount,
            actual: posTx.balls,
            restaurant: posTx.restaurant_id
          }
        });
      }
    }
  }
}

// Admin –º–æ–∂–µ—Ç:
// - –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–Ω–∏—Ü—É
// - –í—Ä—É—á–Ω—É—é –æ—Ç—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å
// - –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ RESOLVED
```


***

### 2Ô∏è‚É£9Ô∏è‚É£ **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –ü–†–ê–í–ò–õ**

**‚ùì –í–æ–ø—Ä–æ—Å:**
–ú–æ–∂–µ—Ç –ª–∏ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å—Å—è –∫ –æ–¥–Ω–æ–º—É —á–µ–∫—É –¥–≤–∞–∂–¥—ã?

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

- A) –î–∞ (–±–∞–≥!)
- B) –ù–µ—Ç (unique constraint)
- C) –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**‚úÖ –ú–û–ô –í–´–ë–û–†: –í–∞—Ä–∏–∞–Ω—Ç B (Unique constraint)**

```javascript
// UNIQUE constraint –≤ –ë–î
CREATE UNIQUE INDEX idx_rule_application_unique ON ball_transactions(
  post_transaction_id, 
  loyalty_rule_id
);

// –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –æ–¥–∏–Ω —á–µ–∫!

// –ï—Å–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –¥–≤–∞–∂–¥—ã:
// INSERT INTO ball_transactions (..., post_transaction_id, loyalty_rule_id)
// VALUES ('pos-123', 'rule-1', ...)
// INSERT INTO ball_transactions (..., post_transaction_id, loyalty_rule_id)
// VALUES ('pos-123', 'rule-1', ...) // ERROR: UNIQUE constraint violated!
```


***

## üìä **–ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –í–°–ï–• 29 –†–ï–®–ï–ù–ò–ô**

| \# | –í–æ–ø—Ä–æ—Å | –†–µ—à–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| :-- | :-- | :-- | :-- |
| 1 | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª | –ë–µ–∑ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ (rule_snapshot) | üî¥ –í–´–°–û–ö–ò–ô |
| 2 | –û—Ç–∫–∞—Ç –ø—Ä–∞–≤–∏–ª | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è | üî¥ –í–´–°–û–ö–ò–ô |
| 3 | –ü–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–ª–æ–≤ | Background job | üü° –°—Ä–µ–¥–Ω–∏–π |
| 4 | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ | Snapshot –≤ –∫–∞–∂–¥–æ–π grant | üü° –°—Ä–µ–¥–Ω–∏–π |
| 5 | –ó–∞–ø—Ä–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –≤–µ—Ä—Å–∏–π | UNIQUE constraint | üü° –°—Ä–µ–¥–Ω–∏–π |
| 6 | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π | –ò—Å—Ç–æ—Ä–∏—è + –Ω–æ–≤—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç | üü° –°—Ä–µ–¥–Ω–∏–π |
| 7 | –û—Ç–∫–∞—Ç —É—Ä–æ–≤–Ω–µ–π | –í—ã–±—Ä–∞—Ç—å –≤–µ—Ä—Å–∏—é | üü° –°—Ä–µ–¥–Ω–∏–π |
| 8 | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤–æ–∫ | rule_snapshot | üü° –°—Ä–µ–¥–Ω–∏–π |
| 9 | –ó–∞–ø—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π | API endpoint | üü° –°—Ä–µ–¥–Ω–∏–π |
| 10 | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | LoyaltySystemVersion | üü° –°—Ä–µ–¥–Ω–∏–π |
| 11 | –ú–∏–≥—Ä–∞—Ü–∏—è UNIFIED‚ÜíSEPARATE | –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã | üî¥ –í–´–°–û–ö–ò–ô |
| 12 | –ú–∏–≥—Ä–∞—Ü–∏—è SEPARATE‚ÜíUNIFIED | –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ | üî¥ –í–´–°–û–ö–ò–ô |
| 13 | –î–≤–µ –ø—Ä–æ–º–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ | Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç strat | üî¥ –í–´–°–û–ö–ò–ô |
| 14 | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–º–æ | Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç (0-1000) | üü° –°—Ä–µ–¥–Ω–∏–π |
| 15 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ | PromoBallGranted —Ç–∞–±–ª–∏—Ü–∞ | üü° –°—Ä–µ–¥–Ω–∏–π |
| 16 | –†–∞–∑–Ω—ã–µ —Å—Ä–æ–∫–∏ —Å–≥–æ—Ä–∞–Ω–∏—è | expires_at –≤ BallTransaction | üî¥ –í–´–°–û–ö–ò–ô |
| 17 | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ | CRON —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | üü° –°—Ä–µ–¥–Ω–∏–π |
| 18 | –ü–µ—Ä–µ—Å—á–µ—Ç —É—Ä–æ–≤–Ω–µ–π | CRON –≤ 00:00 UTC | üü° –°—Ä–µ–¥–Ω–∏–π |
| 19 | Downgrade —É—Ä–æ–≤–Ω–µ–π | Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç | üü° –°—Ä–µ–¥–Ω–∏–π |
| 20 | –ú–∞–∫—Å –±–∞–ª–ª–æ–≤ | Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç | üü° –°—Ä–µ–¥–Ω–∏–π |
| 21 | –ú–∏–Ω –±–∞–ª–ª–æ–≤ —Å–ø–∏—Å–∞–Ω–∏—è | Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç | üü° –°—Ä–µ–¥–Ω–∏–π |
| 22 | ROI –ø—Ä–æ–º–æ | (Revenue - Cost) / Cost | üü° –°—Ä–µ–¥–Ω–∏–π |
| 23 | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º | –†–∞–∑–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–π | üü° –°—Ä–µ–¥–Ω–∏–π |
| 24 | –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ 100k+ | Redis + –∏–Ω–¥–µ–∫—Å—ã | üü° –°—Ä–µ–¥–Ω–∏–π |
| 25 | –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–∞ | < 200 –º—Å | üü° –°—Ä–µ–¥–Ω–∏–π |
| 26 | GDPR —É–¥–∞–ª–µ–Ω–∏–µ | Soft delete + —à–∏—Ñ—Ä–æ–≤–∫–∞ | üî¥ –í–´–°–û–ö–ò–ô |
| 27 | Orphaned –±–∞–ª–ª—ã | Monthly report | üü¢ –ù–∏–∑–∫–∏–π |
| 28 | –†–∞—Å—Å—á–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç | Reconciliation job | üü° –°—Ä–µ–¥–Ω–∏–π |
| 29 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª | UNIQUE constraint | üü¢ –ù–∏–∑–∫–∏–π |


***

## üéØ **–ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ö–û–î–ò–†–û–í–ê–ù–ò–Æ**

### ‚úÖ –í–°–ï 29 –í–û–ü–†–û–°–û–í –û–¢–í–ï–¢–õ–ï–ù–´!

**–ß—Ç–æ —è –≥–æ—Ç–æ–≤ —Å–¥–µ–ª–∞—Ç—å:**

1. ‚úÖ Prisma schema (30+ —Ç–∞–±–ª–∏—Ü)
2. ‚úÖ Services (LoyaltyService, BallService, PromoService, MigrationService)
3. ‚úÖ Controllers + API endpoints
4. ‚úÖ Guards –∏ Decorators
5. ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
6. ‚úÖ Tests

**–í—ã–±–µ—Ä–∏:**

```
1. ‚úÖ –°–û–ì–õ–ê–°–ï–ù, –ù–ê–ß–ò–ù–ê–ï–ú –ö–û–î–ò–¢–¨
2. ‚ùì –ï–°–¢–¨ –í–û–ü–†–û–° / –ù–ï–°–û–ì–õ–ê–°–ò–ï
3. üîÑ –ù–£–ñ–ù–û –ò–ó–ú–ï–ù–ò–¢–¨ –†–ï–®–ï–ù–ò–ï
```

<span style="display:none">[^4_1][^4_2][^4_3][^4_4]</span>

<div align="center">‚ÅÇ</div>

[^4_1]: –ë–µ—Å–µ–¥–∞ 4.md

[^4_2]: –ë–µ—Å–µ–¥–∞ 3.md

[^4_3]: –ë–µ—Å–µ–¥–∞ 2.md

[^4_4]: –ë–µ—Å–µ–¥–∞ 1.md


---

# –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã :

–ë–ª–æ–∫ 1:
1.B
2.B
3.A
4. –°—Ç–∞—Ä—ã–µ –±–∞–ª–ª—ã –û–°–¢–ê–Æ–¢–°–Ø (+1000 –¥–ª—è —Ç–µ—Ö –∫—Ç–æ –ø–æ–ª—É—á–∏–ª).
–ù–æ–≤—ã–µ –≥–æ—Å—Ç–∏ –ü–û–õ–£–ß–ê–¢ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (+500).
–ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è.     4.
5. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä, –∑–∞–ø—Ä–µ—Ç–∏—Ç—å.
6.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
7.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä, –Ω–æ —É—á–∏—Ç—ã–≤–∞–µ–º, —á—Ç–æ –≥–æ—Å—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ –Ω–µ —Ç–µ—Ä—è—é—Ç —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å(–ø—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –≥–æ—Å—Ç—å –±—ã–ª –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏–ª—å–≤–µ—Ä, –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª —É–ø–∞—Å—Ç—å –¥–æ –±—Ä–æ–Ω–∑, —Ç–æ –æ–Ω –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏–ª—å–≤–µ—Ä —Å 0 —à–∫–∞–ª–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è. –ò —Ç–∞–∫ —Å –ª—é–±—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ "Admin —É–¥–∞–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –≤ —Ü–µ–ª–æ–º. –¢–æ–≥–¥–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–Ω –≤—ã–±–∏—Ä–∞–µ—Ç 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞," –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ" –∏–ª–∏" –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ", –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞, –≥–æ—Å—Ç–∏ —Å —É—Ä–æ–≤–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è, –∏ —É—Ä–æ–≤–µ–Ω—å –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å).
8.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
9.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
10.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
–ë–ª–æ–∫ 2:
11.B
12.A
–ë–ª–æ–∫ 3:
13. C
14. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
15. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
–ë–ª–æ–∫ 4:
16. A. –ù–æ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–∫—Ü–∏–π —Å–≥–æ—Ä–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ —Å–≤–æ–µ–º—É. (–ö–∞–∫ –ø—Ä–∏–º–µ—Ä: Castom –∞–∫—Ü–∏—è "–î–∞—Ä–∏–º 500 –±–∞–ª–ª–æ–≤ –Ω–∞ –¥–µ–Ω—å –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞", admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ç–∞–∫, —á—Ç–æ 500 –±–∞–ª–ª–æ–≤ –≤—ã–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–∞–º—É –¥–∞—Ç—É –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ –∏ –¥–µ–Ω—å –ø–æ—Å–ª–µ. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –±–∞–ª–ª—ã –Ω–∞ –î–µ–Ω—å —Å–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ —Å–≥–æ—Ä—è—Ç  –≤ –∫–æ–Ω—Ü–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è –ø—Ä–∞–∑–¥–Ω–∏–∫–∞, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ –≥–æ—Å—Ç—è, –∫–∞–∫ –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è (–µ—Å–ª–∏ –∞–¥–º–∏–Ω –Ω–∞—Å—Ç—Ä–æ–∏–ª –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫), —á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã).
17. –í–∞–∂–Ω–æ! –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∏—Ö –ø–µ—Ä–∏–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ –∫–∞–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç admin (–æ–Ω –º–æ–∂–µ—Ç –≤–æ–æ–±—â–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ –Ω–µ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤–æ–æ–±—â–µ, –∏–ª–∏ —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ "–æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∞–ª–ª–æ–≤"(–±–∞–ª–ª—ã –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø—É—Ç–µ–º –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–æ–π, –∞ –Ω–µ –∞–∫—Ü–∏—è–º–∏), –∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ "–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤" –æ—Ç–º–µ–Ω–∏—Ç—å –∏ —Ç–¥.
CRON job –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00.
18. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
19. A
–ë–ª–æ–∫ 5:
20. A
21. –ú–∏–Ω–∏–º—É–º: 1 –±–∞–ª–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é),
–ú–∞–∫—Å–∏–º—É–º: –î–µ—Ñ–æ–ª—Ç–Ω–æ - 20% –æ—Ç —Å—É–º–º—ã —á–µ–∫–∞, Admin –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å (–æ—Ç 10 –¥–æ 100%).
–ú–∏–Ω–∏–º—É–º —á–µ–∫–∞: 50 —Ä—É–±–ª–µ–π, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥—Ä—É–≥—É—é —Å—É–º–º—É –Ω–µ–ª—å–∑—è.
22. –í–æ –ø–µ—Ä–≤—ã—Ö, 1 –±–∞–ª–ª –í–°–ï–ì–î–ê = 1 —Ä—É–±–ª—é (–≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∏ –æ–Ω–æ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ) . –í–æ –≤—Ç–æ—Ä—ã—Ö. –ü–æ–∫–∞ –±–∞–ª–ª—ã –Ω–µ —Å–≥–æ—Ä–µ–ª–∏, –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è. –í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–ª—å, –í–°–ï–ì–î–ê, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ/–Ω–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–ª–ª—ã, –∞ —É–∂–µ –ø–æ—Å–ª–µ, "–æ—Å–Ω–æ–≤–Ω—ã–µ" (–ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–Ω—ã–µ –ø—É—Ç–µ–º –ø–æ–∫—É–ø–æ–∫ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ/–Ω–∞—Ö) –±–∞–ª–ª—ã –∫–∞—Ä—Ç—ã (–ø—Ä–∏–º–µ—Ä: "—É –≥–æ—Å—Ç—è –∫–∞—Ä—Ç–∞ silver —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–µ—à–±–µ–∫ 10% –Ω–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ. –ù–∞ –∫–∞—Ä—Ç–µ 5000 "–æ—Å–Ω–æ–≤–Ω—ã—Ö" –±–∞–ª–ª–æ–≤, –Ω–∞ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –µ–º—É –ø—Ä–∏—à–ª–æ 1000 –±–∞–ª–ª–æ–≤, –µ–≥–æ —á–µ–∫ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å 10000 —Ä—É–±. –ì–æ—Å—Ç—å –∑–∞—Ö–æ—Ç–µ–ª —Å–ø–∏—Å–∞—Ç—å –±–∞–ª–ª—ã, –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –æ–Ω –º–æ–∂–µ—Ç —Å–ø–∏—Å–∞—Ç—å 20% –æ—Ç —Å—É–º–º—ã —á–µ–∫–∞ –±–∞–ª–ª–∞–º–∏ = 2000 –±–∞–ª–ª–æ–≤. –ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Å –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å–ø–∏—à—É—Ç—å—Å—è 1000" –∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö" –±–∞–ª–ª–æ–≤ –∏ 1000" "–æ—Å–Ω–æ–≤–Ω—ã—Ö" –±–∞–ª–ª–æ–≤ –∏,—Ç–∞–∫–∂–µ, –Ω–∞–∫–æ–ø—è—Ç—Å—è —Å —ç—Ç–æ–≥–æ —á–µ–∫–∞ 1000 –±–∞–ª–ª–æ–≤".–ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª—ã –∏ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏ –∫–æ–ø—è—Ç—Å—è –æ—Ç —á–µ–∫–∞, –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –∫–æ–ø—è—Ç—Å—è.
23. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
–ë–ª–æ–∫ 6:
24. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä. –ó–∞–¥–µ—Ä–∂–µ–∫ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ.
25. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
–ë–ª–æ–∫ 7:
26. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
27. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä.
28. Reconciliation job + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –¥–∞–Ω–Ω—ã–µ Pos. –£ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å –∫–∞—Å—Å–æ–π –ø—Ä–æ–±–ª–µ–º –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ.
29.B

–£—á–∏—Ç—ã–≤–∞—è –æ—Ç–≤–µ—Ç—ã, –≤—ã–≤–µ–¥–∏ —Å—é–¥–∞ –≤ —á–∞—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ—Å–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞

–ù–∏–∂–µ —Å–≤—ë–ª –≤—Å–µ —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã + –º–æ–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ –µ–¥–∏–Ω—ã–π, —É–∂–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω Loyalty System.

***

## –ë–ª–æ–∫ 1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Ä–æ–≤–Ω–∏

### 1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤

**–û—Ç–≤–µ—Ç:** B ‚Äî –±–∞–ª–ª—ã –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º, –∫–∞–∂–¥—ã–π —á–µ–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º, –¥–µ–π—Å—Ç–≤–æ–≤–∞–≤—à–∏–º –≤ –º–æ–º–µ–Ω—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏.
**–ò—Ç–æ–≥:**

- –í `BallTransaction` —Ö—Ä–∞–Ω–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ `LoyaltyRuleVersion` –∏ `rule_snapshot`.
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, —Å—Ç–∞—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è.[^5_1]


### 2. –û—Ç–∫–∞—Ç –æ—à–∏–±–æ—á–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞

**–û—Ç–≤–µ—Ç:** B ‚Äî –æ—Ç–∫–∞—Ç = —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Å –∫–æ–ø–∏–µ–π —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞.
**–ò—Ç–æ–≥:**

- –ü—Ä–∏ –æ—Ç–∫–∞—Ç–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è, –∞–∫—Ç–∏–≤–Ω–∞—è ‚Äú—Å–µ–π—á–∞—Å‚Äù, —Å–æ —Å–Ω–∏–º–∫–æ–º —Å—Ç–∞—Ä–æ–π.
- –ë–∞–ª–ª—ã, –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–æ –æ—à–∏–±–æ—á–Ω–æ–π –≤–µ—Ä—Å–∏–∏, –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ–≤—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ –æ—Ç–∫–∞—Ç–∏–≤—à–µ–π—Å—è –≤–µ—Ä—Å–∏–∏.


### 3. –ü–µ—Ä–µ—Å—á—ë—Ç –±–∞–ª–ª–æ–≤ (emergency)

**–û—Ç–≤–µ—Ç:** A ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ background job.
**–ò—Ç–æ–≥:**

- –ï—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç—å `RecalculationJob` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: –ø–µ—Ä–∏–æ–¥, —Å–µ–≥–º–µ–Ω—Ç –≥–æ—Å—Ç–µ–π, —Ä–µ–∂–∏–º (`RECALCULATE`, `ADJUST`, `NOTIFY_ONLY`).
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –ª–æ–≥–∏—Ä—É–µ—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –≥–æ—Å—Ç–µ–π –∏ –¥–µ–ª—å—Ç—É –ø–æ –±–∞–ª–ª–∞–º.


### 4. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞)

**–û—Ç–≤–µ—Ç:**

- –°—Ç–∞—Ä—ã–µ –ø—Ä–æ–º–æ-–±–∞–ª–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –≤—ã–¥–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, +1000).
- –ù–æ–≤—ã–µ –≥–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—É—á–∞—é—Ç —É–∂–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, +500).
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è.
**–ò—Ç–æ–≥:**
- –í `PromoBallGranted` —Ç–æ–∂–µ —Ö—Ä–∞–Ω–∏–º `promo_rule_snapshot`, –∫–∞–∫ –∏ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö.


### 5. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä ‚Äî –∑–∞–ø—Ä–µ—Ç–∏—Ç—å.
**–ò—Ç–æ–≥:**

- –ù–∞ –æ–¥–∏–Ω `LoyaltyRule` –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ ‚Äú—Ç–µ–∫—É—â–∞—è‚Äù –≤–µ—Ä—Å–∏—è (–∞–∫—Ç–∏–≤–Ω–∞—è).
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è `active_to`.


### 6. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω–µ–π

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- –£—Ä–æ–≤–Ω–∏ (Bronze/Silver/Gold –∏ –∏—Ö –ø–æ—Ä–æ–≥–∏) –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `LoyaltyLevelVersion`.
- –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç —É—Ä–æ–≤–Ω–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –≤–µ—Ä—Å–∏—é —É—Ä–æ–≤–Ω–µ–π –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ—Å—á—ë—Ç–∞.


### 7. –ü–æ–≤–µ–¥–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –ø—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ (–≤–∞–∂–Ω–æ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ)

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä (–Ω–æ—á–Ω–æ–π –ø–µ—Ä–µ—Å—á—ë—Ç), –Ω–æ:

- –ì–æ—Å—Ç—å **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç–µ—Ä—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ**.
- –ü—Ä–∏–º–µ—Ä: –±—ã–ª Silver, –ø–æ –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–∞–º –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å –¥–æ Bronze ‚Äî **–æ—Å—Ç–∞—ë—Ç—Å—è Silver**, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ 0.
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: **Admin —É–¥–∞–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å**. –¢–æ–≥–¥–∞ –æ–Ω –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
    - ¬´–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ¬ª, –∏–ª–∏
    - ¬´–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ¬ª.
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤—Å–µ –≥–æ—Å—Ç–∏ —Å —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É—é—Ç, –∏ —É—Ä–æ–≤–µ–Ω—å –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.
**–ò—Ç–æ–≥:**
- `allow_downgrade = false` –∫–∞–∫ –∂—ë—Å—Ç–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–µ—Ä–µ—Å—á—ë—Ç–∞.
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ –∞–¥–º–∏–Ω–∞ ‚Äú—É–¥–∞–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Å –≤—ã–±–æ—Ä–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏‚Äù.[^5_2]


### 8. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∏ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø—Ä–æ—Ü–µ–Ω—Ç, —É—Å–ª–æ–≤–∏—è, —Å–µ–≥–º–µ–Ω—Ç—ã) –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—É—é `LoyaltyRuleVersion`.


### 9. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- API: –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–µ—Ä—Å–∏–π –ø—Ä–∞–≤–∏–ª–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥; UI ‚Äî —Ç–∞–π–º–ª–∞–π–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π.


### 10. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—Å–µ–π Loyalty System

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ª–∏–º–∏—Ç—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –ø–æ–≤–µ–¥–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –∏ —Ç.–¥.) —Ç–æ–∂–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

***

## –ë–ª–æ–∫ 2. –ú–∏–≥—Ä–∞—Ü–∏—è UNIFIED / SEPARATE

### 11. –ú–∏–≥—Ä–∞—Ü–∏—è UNIFIED ‚Üí SEPARATE

**–û—Ç–≤–µ—Ç:** B ‚Äî –∫–∞—Ä—Ç–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω (–±–∞–ª–ª—ã –Ω–µ –¥–µ–ª—è—Ç—Å—è, –∞ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è).
**–ò—Ç–æ–≥:**

- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Å—Ç—è:
    - —Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ `GuestCard` –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å —Ç–µ–º –∂–µ –±–∞–ª–∞–Ω—Å–æ–º –∏ —É—Ä–æ–≤–Ω–µ–º;
    - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–≥—É—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å—Å—è (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –∏–ª–∏ —Å—Å—ã–ª–∫–∞–µ—Ç—Å—è –Ω–∞ –∏—Å—Ö–æ–¥–Ω—É—é (—á–µ—Ä–µ–∑ `migration_id`).
- –ì–æ—Å—Ç—å –≤ Telegram –≤–∏–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç –∏ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è.
- –°—Ç–∞—Ä–∞—è UNIFIED-–∫–∞—Ä—Ç–∞ –ª–∏–±–æ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `MIGRATED`, –ª–∏–±–æ –æ—Å—Ç–∞—ë—Ç—Å—è ‚Äú–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π‚Äù (–Ω–æ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö).


### 12. –ú–∏–≥—Ä–∞—Ü–∏—è SEPARATE ‚Üí UNIFIED

**–û—Ç–≤–µ—Ç:** A ‚Äî –±–∞–ª–ª—ã —Å—É–º–º–∏—Ä—É—é—Ç—Å—è.
**–ò—Ç–æ–≥:**

- –ù–æ–≤—ã–π UNIFIED-–±–∞–ª–∞–Ω—Å = —Å—É–º–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤ –ø–æ –≤—Å–µ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º.
- –£—Ä–æ–≤–µ–Ω—å = –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π.
- –°—Ç–∞—Ä—ã–µ SEPARATE-–∫–∞—Ä—Ç—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ `MIGRATED`, –Ω–æ–≤–∞—è UNIFIED ‚Äî –∞–∫—Ç–∏–≤–Ω–∞—è.

***

## –ë–ª–æ–∫ 3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ

### 13. –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–º–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–û—Ç–≤–µ—Ç:** C ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ Admin.
**–ò—Ç–æ–≥:**

- –í —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (`COMBINE_ALL`, `MAX_ONLY`, `FIRST_ONLY` –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥—Ä.).
- –î–ª—è –ø–∞—Ä/–≥—Ä—É–ø–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–º–æ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å override-–ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äú–î–† + –ø–µ—Ä–≤—ã–π —á–µ–∫ = —Ç–æ–ª—å–∫–æ –î–†‚Äù).[^5_3]


### 14. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–º–æ

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- –ö–∞–∂–¥–æ–µ –ø—Ä–æ–º–æ –∏–º–µ–µ—Ç `priority` (0‚Äì1000).
- –ü—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö —Ç–∏–ø–∞ `FIRST_ONLY` –ø—Ä–æ–º–æ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É.


### 15. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ-–∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- –í `PromoBallGranted` —Å–æ—Ö—Ä–∞–Ω—è–µ–º: –∫–∞–∫–∏–µ –ø—Ä–æ–º–æ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –∫–∞–∫—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø—Ä–∏–º–µ–Ω–∏–ª–∏, –∫–∞–∫–∞—è —Å—É–º–º–∞ –±—ã–ª–∞ –±—ã –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –∫–∞–∫–∞—è —Å—Ç–∞–ª–∞ –∏—Ç–æ–≥–æ–≤–æ–π.
- –û—Ç—á—ë—Ç—ã –ø–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Analytics.

***

## –ë–ª–æ–∫ 4. –°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∏ —É—Ä–æ–≤–Ω–∏

### 16. –°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤

**–û—Ç–≤–µ—Ç:** A ‚Äî –∫–∞–∂–¥—ã–π `BallTransaction` –∏–º–µ–µ—Ç —Å–≤–æ–π `expires_at`, –Ω–æ:

- –î–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–∫—Ü–∏–π —Å—Ä–æ–∫ —Å–≥–æ—Ä–∞–Ω–∏—è **–º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–º**.
- –ü—Ä–∏–º–µ—Ä: –∫–∞—Å—Ç–æ–º–Ω–∞—è –∞–∫—Ü–∏—è ‚Äú–î–∞—Ä–∏–º 500 –±–∞–ª–ª–æ–≤ –Ω–∞ –î–µ–Ω—å –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞‚Äù, –≤–∞–ª–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –¥–µ–Ω—å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ –∏ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.
    - –≠—Ç–∏ 500 –±–∞–ª–ª–æ–≤ —Å–≥–æ—Ä—è—Ç **–≤ –∫–æ–Ω—Ü–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è**,
    - –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –∫–∞—Ä—Ç—ã ‚Äî –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ / –æ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è).
**–ò—Ç–æ–≥:**
- –î–ª—è –æ–±—ã—á–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 90 –¥–Ω–µ–π).
- –î–ª—è –ø—Ä–æ–º–æ ‚Äî —Å–≤–æ–π `expiration_days` –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞.
- –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`expires_at`).[^5_1]


### 17. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏

**–û—Ç–≤–µ—Ç:**

- CRON –≤ 10:00.
- –ü–µ—Ä–∏–æ–¥—ã –∏ –∫–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π **–ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Admin**:
    - –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–≤—Å–µ–º,
    - –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è ‚Äú–æ—Å–Ω–æ–≤–Ω—ã—Ö‚Äù –±–∞–ª–ª–æ–≤,
    - –º–æ–∂–µ—Ç –≤—ã–∫–ª—é—á–∏—Ç—å –¥–ª—è ‚Äú–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö‚Äù –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏ —Ç.–ø.
**–ò—Ç–æ–≥:**
- –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
    - –ø–µ—Ä–µ—á–µ–Ω—å –ø–æ—Ä–æ–≥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä 1, 3, 7, 14 –¥–Ω–µ–π ‚Äî –∫–∞–∂–¥—ã–π –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å),
    - —Ñ–ª–∞–≥–∏ –ø–æ —Ç–∏–ø–∞–º –±–∞–ª–ª–æ–≤ (`notify_regular`, `notify_promo`),
    - –≤—ã–±–æ—Ä –∫–∞–Ω–∞–ª–æ–≤: Telegram, email, –æ–±–∞ –∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ.


### 18. –ü–µ—Ä–µ—Å—á—ë—Ç —É—Ä–æ–≤–Ω–µ–π

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä ‚Äî –Ω–æ—á–Ω–æ–π CRON.
**–ò—Ç–æ–≥ —Å —É—á—ë—Ç–æ–º –ø.7:**

- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç lifetime-—Å—É–º–º.
- –£—Ä–æ–≤–µ–Ω—å **–º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç–∏**, –Ω–µ –ø–∞–¥–∞—Ç—å (–∫—Ä–æ–º–µ —Å–ø–µ—Ü. –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è).


### 19. Downgrade —É—Ä–æ–≤–Ω–µ–π

**–û—Ç–≤–µ—Ç:** A ‚Äî **–±–µ–∑** downgrade (–æ–¥–∏–Ω —Ä–∞–∑ –ø–æ–¥–Ω—è–ª—Å—è ‚Äî –Ω–∞–∑–∞–¥ –Ω–µ –ø–∞–¥–∞–µ—Ç).
**–ò—Ç–æ–≥:**

- `allow_downgrade = false` –∂—ë—Å—Ç–∫–æ.
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äú–ø–æ–Ω–∏–∑–∏—Ç—å‚Äù ‚Äî –∞–¥–º–∏–Ω —É–¥–∞–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏ —è–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º —Ä–µ—à–∞–µ—Ç, –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –≥–æ—Å—Ç–µ–π (–≤—ã—à–µ/–Ω–∏–∂–µ).

***

## –ë–ª–æ–∫ 5. –õ–∏–º–∏—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### 20. –ú–∞–∫—Å–∏–º—É–º –±–∞–ª–ª–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ

**–û—Ç–≤–µ—Ç:** A ‚Äî –±–µ–∑–ª–∏–º–∏—Ç.
**–ò—Ç–æ–≥:**

- `max_balls_per_guest` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = ‚Äú–Ω–µ—Ç –ª–∏–º–∏—Ç–∞‚Äù.
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –Ω–æ —Å–µ–π—á–∞—Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –±–µ–∑ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–ª–∫–∞.[^5_4]


### 21. –ú–∏–Ω–∏–º—É–º/–º–∞–∫—Å–∏–º—É–º —Å–ø–∏—Å–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç:**

- –ú–∏–Ω–∏–º—É–º: 1 –±–∞–ª–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è?).
- –ú–∞–∫—Å–∏–º—É–º: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20% –æ—Ç —Å—É–º–º—ã —á–µ–∫–∞, Admin –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç 10% –¥–æ 100%.
- –ú–∏–Ω–∏–º—É–º —á–µ–∫–∞: 50 —Ä—É–±–ª–µ–π, –º–µ–Ω—è—Ç—å –Ω–µ–ª—å–∑—è.
**–ò—Ç–æ–≥:**
- –í –∫–æ–Ω—Ñ–∏–≥–µ Loyalty System:
    - `min_balls_to_redeem = 1` (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞),
    - `min_check_amount_for_redeem = 50` (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞),
    - `max_percent_to_redeem` ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω [10; 100].


### 22. –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∞–ª–ª–∞ –∏ –ø–æ—Ä—è–¥–æ–∫ —Å–ø–∏—Å–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –±–∞–ª–ª–æ–≤

**–û—Ç–≤–µ—Ç:**

- 1 –±–∞–ª–ª –≤—Å–µ–≥–¥–∞ = 1 —Ä—É–±–ª—é ‚Äî **–≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∏ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ**.
- –ü–æ–∫–∞ –±–∞–ª–ª—ã –Ω–µ —Å–≥–æ—Ä–µ–ª–∏, –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è.
- –ü—Ä–∏ **—Å–ø–∏—Å–∞–Ω–∏–∏** –≤—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞—Ç—è—Ç—Å—è **–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–ª–ª—ã**, –∑–∞—Ç–µ–º **–æ—Å–Ω–æ–≤–Ω—ã–µ**.
- –ü—Ä–∏ **—á–µ–∫–µ**:
    - –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –æ–ø–ª–∞—Ç–∏—Ç—å –±–∞–ª–ª–∞–º–∏ –¥–æ `max_percent_to_redeem` –æ—Ç —Å—É–º–º—ã;
    - –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äú–∏ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, –∏ –∫–æ–ø—è—Ç—Å—è‚Äù –±–∞–ª–ª—ã:
        - –ø—Ä–∏–º–µ—Ä:
            - Silver, –∫–µ—à–±—ç–∫ 10%;
            - 5000 –æ—Å–Ω–æ–≤–Ω—ã—Ö, 1000 –∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö;
            - —á–µ–∫ 10 000 —Ä—É–±, –ª–∏–º–∏—Ç 20% = 2000 –±–∞–ª–ª–æ–≤;
            - —Å–ø–∏—à–µ—Ç—Å—è 1000 –∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö + 1000 –æ—Å–Ω–æ–≤–Ω—ã—Ö;
            - –Ω–∞—á–∏—Å–ª–∏—Ç—Å—è 1000 –Ω–æ–≤—ã—Ö (10% –æ—Ç 10 000);
            - –∏—Ç–æ–≥: ‚àí2000 (—Å–ø–∏—Å–∞–Ω–∏–µ) +1000 (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ) = ‚àí1000 —á–∏—Å—Ç—ã–º–∏, –ø—Ä–∏ —ç—Ç–æ–º —Å–∫–∏–¥–∫–∞ –ø–æ —á–µ–∫—É 2000 —Ä—É–±.
**–ò—Ç–æ–≥:**
- –ü—Ä–∏ —Ä–µ–¥–µ–º–ø—à–µ–Ω–µ:
    - –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤–æ–∑–º–æ–∂–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É,
    - —Å–Ω–∞—á–∞–ª–∞ –ø–æ–≥–∞—à–∞–µ–º `promo`-–±–∞–ª–ª—ã (—Å–≥–æ—Ä–∞—é—â–∏–µ), –∑–∞—Ç–µ–º `regular`.
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ —Å –∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã —á–µ–∫–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —Å–∫–æ–ª—å–∫–æ —Å–ø–∏—Å–∞–Ω–æ –±–∞–ª–ª–∞–º–∏.


### 23. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ / ROI –ø—Ä–æ–º–æ

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- ROI –ø—Ä–æ–º–æ —Å—á–∏—Ç–∞–µ–º –≤ —Ä—É–±–ª—è—Ö (—Ç–∞–∫ –∫–∞–∫ 1 –±–∞–ª–ª = 1 —Ä—É–±–ª—å, –≤—Å—ë –ª–∏–Ω–µ–π–Ω–æ):
    - cost = –≤—ã–¥–∞–Ω–Ω—ã–µ –∏ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–≥–∞—à–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã;
    - revenue = –ø–æ–∫—É–ø–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–º–æ;
    - ROI = (revenue ‚àí cost) / cost.

***

## –ë–ª–æ–∫ 6. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### 24. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–µ—à

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä, ‚Äú–∑–∞–¥–µ—Ä–∂–µ–∫ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ‚Äù.
**–ò—Ç–æ–≥:**

- Redis-–∫–µ—à –¥–ª—è –±–∞–ª–∞–Ω—Å–∞, —É—Ä–æ–≤–Ω—è, –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ –∏ –ø—Ä–∞–≤–∏–ª.
- –ò–Ω–¥–µ–∫—Å—ã –≤ –ë–î –ø–æ –≥–æ—Å—Ç—è–º, —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º, –¥–∞—Ç–∞–º.
- –ë—é–¥–∂–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —á–µ–∫ ~150‚Äì200 –º—Å end-to-end.


### 25. –¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è —Ä–∞—Å—á—ë—Ç–∞

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–π –≤—ã–±–æ—Ä ‚Äî \< 200 –º—Å.
**–ò—Ç–æ–≥:**

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–µ—à–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ.

***

## –ë–ª–æ–∫ 7. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ edge cases

### 26. GDPR / —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Å—Ç—è

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- `GuestProfile`/`GuestCard` –ø–æ–ª—É—á–∞—é—Ç —Å—Ç–∞—Ç—É—Å `DELETED`.
- –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–∞—é—Ç—Å—è/—à–∏—Ñ—Ä—É—é—Ç—Å—è, –Ω–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞.
- –£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è, –Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≤—ã—Ä—É—á–∫–µ –∏ —Å–ø–∏—Å–∞–Ω–∏—è–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.[^5_5]


### 27. Orphaned –±–∞–ª–ª—ã

**–û—Ç–≤–µ—Ç:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤—ã–±–æ—Ä.
**–ò—Ç–æ–≥:**

- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç –ø–æ ‚Äú–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏–º‚Äù –±–∞–ª–ª–∞–º –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–∞—Ö.
- Owner –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å/—Å–ø–∏—Å–∞—Ç—å.


### 28. –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–∞ –±–∞–ª–ª–æ–≤ —Å POS

**–û—Ç–≤–µ—Ç:** Reconciliation job + **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ POS**.
**–ò—Ç–æ–≥:**

- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–≤–µ—Ä—è–µ—Ç –±–∞–ª–ª—ã –ø–æ —á–µ–∫–∞–º.
- –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –∑–Ω–∞—á–µ–Ω–∏–µ POS (POS —Å—á–∏—Ç–∞–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã –¥–ª—è —Å—É–º–º—ã –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤), –ø–ª—é—Å –ø–∏—à–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–µ.


### 29. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –∫ –æ–¥–Ω–æ–º—É —á–µ–∫—É

**–û—Ç–≤–µ—Ç:** B ‚Äî –∑–∞–ø—Ä–µ—Ç–∏—Ç—å (unique).
**–ò—Ç–æ–≥:**

- –ù–∞ —É—Ä–æ–≤–Ω–µ –ë–î: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ `(post_transaction_id, loyalty_rule_id)`.
- –û–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å—Å—è –¥–≤–∞–∂–¥—ã –∫ –æ–¥–Ω–æ–º—É —á–µ–∫—É.

***

## –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–æ Loyalty System

- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∏–≥—Ä–∞—Ü–∏–∏, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ, —Å–≥–æ—Ä–∞–Ω–∏–µ, —É—Ä–æ–≤–Ω–∏, –ª–∏–º–∏—Ç—ã, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ GDPR ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã.**
- –ú–æ–¥–µ–ª—å —Å—Ç–∞–ª–∞ –µ—â—ë –±–æ–ª–µ–µ —á—ë—Ç–∫–æ–π –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π, —Å –∂—ë—Å—Ç–∫–∏–º–∏ –≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏:
    - —É—Ä–æ–≤–Ω–∏ –Ω–µ –ø–∞–¥–∞—é—Ç,
    - 1 –±–∞–ª–ª = 1 —Ä—É–±–ª—å –≤—Å–µ–≥–¥–∞,
    - —Å–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞—Ç—è—Ç—Å—è ‚Äú–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ‚Äù –±–∞–ª–ª—ã,
    - POS ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –ø—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö.

–ï—Å–ª–∏ –≤—Å—ë –≤—ã—à–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–≤–æ–∏–º –≤–∏–¥–µ–Ω–∏–µ–º, –º–æ–∂–µ–º –≤—ã–±–∏—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (–∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è: **Guests \& Loyalty Cards**, **Billing \& Subscriptions**, **Telegram Bot**, **Payments Integration**) –∏ —É–π—Ç–∏ –≤ —Ç–∞–∫–æ–π –∂–µ —É—Ä–æ–≤–µ–Ω—å –≥–ª—É–±–∏–Ω—ã.
<span style="display:none">[^5_10][^5_11][^5_12][^5_13][^5_14][^5_15][^5_16][^5_17][^5_18][^5_19][^5_6][^5_7][^5_8][^5_9]</span>

<div align="center">‚ÅÇ</div>

[^5_1]: https://www.voucherify.io/blog/guide-to-loyalty-points-expiration

[^5_2]: https://theshopstrategy.com/retention/loyalty-programs/points-expiration-strategies-balancing-customer-satisfaction-and-program-economics/

[^5_3]: https://support.voucherify.io/article/604-stacking-rules

[^5_4]: https://antavo.com/blog/loyalty-points/

[^5_5]: https://loyalthinking.com/2025/08/gdpr-compliance-checklist-for-loyalty-programs/

[^5_6]: –ë–µ—Å–µ–¥–∞ 4.md

[^5_7]: –ë–µ—Å–µ–¥–∞ 3.md

[^5_8]: –ë–µ—Å–µ–¥–∞ 2.md

[^5_9]: –ë–µ—Å–µ–¥–∞ 1.md

[^5_10]: https://eagleeye.com/blog/leveraging-points-expiry-rules-in-your-loyalty-strategy

[^5_11]: https://help.engage.voyado.com/hc/en-gb/articles/19390118415516-Expiry-methods-best-practice

[^5_12]: https://help.growave.io/en/articles/11161642-managing-points-expiration-in-your-rewards-program

[^5_13]: https://news.ycombinator.com/item?id=16366050

[^5_14]: https://thepointsguy.com/news/stacking-restaurant-rewards/

[^5_15]: https://www.talon.one/blog/the-canadian-loyalty-point-expiry-debate

[^5_16]: https://easygdpr.eu/en/2019/10/kunden-bonusprogramms-kein-recht-auf-loeschung-bestimmter-daten/

[^5_17]: https://feaststreets.com/how-to-stack-coupons-rewards-and-cashback-for-maximum-dining-savings/

[^5_18]: https://aaronhall.com/customer-loyalty-points-expiration-compliance/

[^5_19]: https://commission.europa.eu/law/law-topic/data-protection/information-individuals_en


---

# BILLING \& SUBSCRIPTIONS —Å–ª–µ–¥—É—é—â–∏–π. –í —Ç–æ–º –∂–µ —Å—Ç–∏–ª–µ, –ó–∞–¥–∞–π 20-40 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ä–∞–∑—É –≤ —á–∞—Ç + —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ —Ç–≤–æ–µ–º—É –ª—É—á—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö. –ü–µ—Ä–µ–¥ –∑–∞–¥–∞–≤–∞–Ω–∏–µ–º –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–≤–µ—Ä—å—Å—è —Å —Ñ–∞–π–ª–∞–º–∏, –º–æ–∂–µ—Ç –æ–Ω–∏ —É–∂–µ –±—ã–ª–∏

–ù–∏–∂–µ —Å—Ä–∞–∑—É 30 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ Billing \& Subscriptions + –º–æ–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ —Ä–µ—à–µ–Ω–∏—è, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ –Ω–∏–º —Ç–∞–∫ –∂–µ, –∫–∞–∫ –ø–æ Loyalty.

***

## –ë–ª–æ–∫ 1. –û–±—â–∞—è –º–æ–¥–µ–ª—å –∏ –ø–ª–∞–Ω—ã

### 1. –ú–æ–¥–µ–ª—å –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –µ–¥–∏–Ω–∏—Ü–∞ —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–í–æ–ø—Ä–æ—Å:**
–ù–∞ —á—Ç–æ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –±–∏–ª–ª–∏–Ω–≥: –Ω–∞ **–∞–∫–∫–∞—É–Ω—Ç Owner** (tenant), –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤**, –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **–≥–æ—Å—Ç–µ–π** –∏–ª–∏ –Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ë–∏–ª–ª–∏—Ç—Å—è **tenant (Owner account)**, –∞ –ª–∏–º–∏—Ç—ã –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º/–≥–æ—Å—Ç—è–º –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–ª–∞–Ω–∞.
- –ù–∏–∫–∞–∫–æ–≥–æ per-user –±–∏–ª–ª–∏–Ω–≥–∞ (–∞–¥–º–∏–Ω—ã/–º–µ–Ω–µ–¥–∂–µ—Ä—ã/–∫–∞—Å—Å–∏—Ä—ã –Ω–µ —Ç–∞—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è).

***

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–æ–≤ (—Ç–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å)

**–í–æ–ø—Ä–æ—Å:**
–£ –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å 6 –ø–ª–∞–Ω–æ–≤ (Free, Standard, Medium, Pro, Ultimate, Custom) —Å –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º –∏ –≥–æ—Å—Ç—è–º. –ù—É–∂–Ω–æ –ª–∏:

- —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ 6 –ø–ª–∞–Ω–æ–≤,
- –∏–ª–∏ –¥–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤ –±—É–¥—É—â–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –í –±–∞–∑–µ ‚Äî —Å—É—â–Ω–æ—Å—Ç—å `SubscriptionPlan` (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–∞—è).
- 6 ‚Äú—Å–∏—Å—Ç–µ–º–Ω—ã—Ö‚Äù –ø–ª–∞–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–ª—é—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–ª–∞–Ω—ã —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—Å, –Ω–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤).[^6_1]

***

### 3. –ü–µ—Ä–∏–æ–¥—ã –ø–æ–¥–ø–∏—Å–∫–∏

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ –ø–µ—Ä–∏–æ–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º: —Ç–æ–ª—å–∫–æ **–º–µ—Å—è—Ü/–≥–æ–¥** –∏–ª–∏ –µ—â—ë **–∫–≤–∞—Ä—Ç–∞–ª**?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º:
    - **Monthly** (1 –º–µ—Å—è—Ü)
    - **Yearly** (12 –º–µ—Å—è—Ü–µ–≤, —Å–∫–∏–¥–∫–∞ 20% ‚Äî –∫–∞–∫ —Ç—ã —É–∂–µ –∑–∞–¥–∞–≤–∞–ª)
- –ö–≤–∞—Ä—Ç–∞–ª –Ω–µ –≤–≤–æ–¥–∏–º, —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –Ω–∞ —Å—Ç–∞—Ä—Ç–µ.[^6_2]

***

### 4. –ù–∞—á–∞–ª–æ –ø–æ–¥–ø–∏—Å–∫–∏

**–í–æ–ø—Ä–æ—Å:**
–°—Ç–∞—Ä—Ç –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äì –º–æ–º–µ–Ω—Ç –æ–ø–ª–∞—Ç—ã –∏–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ–≥–¥–∞ ‚Äú—Å –ø–µ—Ä–≤–æ–≥–æ —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–∞‚Äù?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –°—Ç–∞—Ä—Ç = **–º–æ–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã** (–∏–ª–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è trial, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å).
- –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∏–ª–ª–∏–Ω–≥–∞ = `start_date + period`.

***

### 5. Free –ø–ª–∞–Ω

**–í–æ–ø—Ä–æ—Å:**
Free ‚Äî —ç—Ç–æ ‚Äú–≤—Å–µ–≥–¥–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞‚Äù –∏–ª–∏ ‚Äú–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π trial‚Äù, –ø–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞–¥–æ –≤—ã–±—Ä–∞—Ç—å –ø–ª–∞—Ç–Ω—ã–π?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- Free = **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω** —Å –∂—ë—Å—Ç–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ (1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –Ω–µ–±–æ–ª—å—à–æ–π –ª–∏–º–∏—Ç –≥–æ—Å—Ç–µ–π, —É—Ä–µ–∑–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å analytics –∏ loyalty).
- –û—Ç–¥–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å trial –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤, –Ω–æ Free –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ ‚Äú–≤–µ—á–Ω—ã–π‚Äù –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π.

***

## –ë–ª–æ–∫ 2. –ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

### 6. –°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–ø–∏—Å–∫–∏

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã –Ω—É–∂–Ω—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä): `ACTIVE`, `EXPIRED`, `CANCELED`, `PAST_DUE`, `TRIALING`, `SUSPENDED`?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –Ω–∞–±–æ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤:
    - `TRIALING` ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
    - `ACTIVE` ‚Äî –æ–ø–ª–∞—á–µ–Ω–∞, –≤ —Å—Ä–æ–∫–µ.
    - `PAST_DUE` ‚Äî –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞, –Ω–æ –¥–∞—ë–º grace period.
    - `CANCELED` ‚Äî –æ—Ç–º–µ–Ω–∞ –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ –∫–ª–∏–µ–Ω—Ç–∞, –¥–æ –∫–æ–Ω—Ü–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.
    - `EXPIRED` ‚Äî –ø–µ—Ä–∏–æ–¥ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –Ω–µ –ø—Ä–æ–¥–ª–µ–Ω–∞.
    - `SUSPENDED` ‚Äî –º—ã –±–ª–æ–∫–Ω—É–ª–∏ —Ä—É–∫–∞–º–∏ (fraud, abuse).

***

### 7. –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ

**–í–æ–ø—Ä–æ—Å:**
–î–æ–ª–∂–Ω–∞ –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å—Å—è** –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–µ—Ä–∏–æ–¥–∞?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **auto-renew = ON**.
- Owner –º–æ–∂–µ—Ç —è–≤–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ (–≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ–¥–ø–∏—Å–∫–∞ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∏ —É—Ö–æ–¥–∏—Ç –≤ `EXPIRED`).

***

### 8. Grace period –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ–ø–ª–∞—Ç–µ

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ—à–ª–æ, –¥–∞—ë–º –ª–∏ grace period (–Ω–∞–ø—Ä–∏–º–µ—Ä 7 –¥–Ω–µ–π) –∏–ª–∏ —Å—Ä–∞–∑—É –±–ª–æ–∫–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π grace period: **7 –¥–Ω–µ–π** (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã).
- –í —ç—Ç–æ –≤—Ä–µ–º—è –ø–æ–¥–ø–∏—Å–∫–∞ –≤ —Å—Ç–∞—Ç—É—Å–µ `PAST_DUE`, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ:
    - –≤ –∞–¥–º–∏–Ω–∫–µ –±–∞–Ω–Ω–µ—Ä ‚Äú–æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Äî –æ–±–Ω–æ–≤–∏—Ç–µ –∫–∞—Ä—Ç—É‚Äù,
    - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–ø–∏—Å–∞–Ω–∏—è (1-–π, 3-–π –∏ 7-–π –¥–µ–Ω—å).

***

### 9. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ grace period

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã –ø—Ä–æ–≤–∞–ª–µ–Ω—ã ‚Äî —á—Ç–æ –¥–µ–ª–∞–µ–º: –±–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ –º—è–≥–∫–æ —Ä–µ–∂–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è grace:
    - —Å—Ç–∞—Ç—É—Å `EXPIRED`;
    - –±–ª–æ–∫–∏—Ä—É–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, –Ω–æ **–Ω–µ —É–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ**;
    - –¥–æ—Å—Ç—É–ø –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è (Owner –º–æ–∂–µ—Ç –æ–ø–ª–∞—Ç–∏—Ç—å –∏ —Ä–∞–∑–ª–æ—á–∏—Ç—å).

***

### 10. –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏

**–í–æ–ø—Ä–æ—Å:**
–ú–æ–∂–µ—Ç –ª–∏ –æ–¥–∏–Ω tenant –∏–º–µ—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–æ–∫** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ —Ä–∞–∑–Ω—ã–µ –º–æ–¥—É–ª–∏) –∏–ª–∏ –≤—Å–µ–≥–¥–∞ —Ä–æ–≤–Ω–æ –æ–¥–Ω—É ‚Äú–æ—Å–Ω–æ–≤–Ω—É—é‚Äù?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –û–¥–Ω–∞ **–æ—Å–Ω–æ–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞** –Ω–∞ ‚Äú–ø–ª–∞—Ç—Ñ–æ—Ä–º—É‚Äù (–ø–ª–∞–Ω + –ª–∏–º–∏—Ç—ã).
- –û—Ç–¥–µ–ª—å–Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å **add-ons** –≤ –±—É–¥—É—â–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–ø. –º–æ–¥—É–ª–∏), –Ω–æ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –ª—É—á—à–µ –≤—Å—ë –≤–∫–ª—é—á–∞—Ç—å –≤ –ø–ª–∞–Ω, —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –±–∏–ª–ª–∏–Ω–≥.

***

## –ë–ª–æ–∫ 3. Upgrade / downgrade / —Å–º–µ–Ω–∞ –ø–ª–∞–Ω–æ–≤

### 11. Upgrade (–ø–æ–≤—ã—à–µ–Ω–∏–µ –ø–ª–∞–Ω–∞)

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ–≤—ã—à–∞–µ—Ç –ø–ª–∞–Ω (Standard ‚Üí Pro) –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ ‚Äî —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –æ–ø–ª–∞—Ç–æ–π?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ **upgrade**:
    - —Å—á–∏—Ç–∞–µ–º **–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫—Ä–µ–¥–∏—Ç** –∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é —á–∞—Å—Ç—å —Å—Ç–∞—Ä–æ–≥–æ –ø–ª–∞–Ω–∞;
    - —Å—Ä–∞–∑—É —Å–ø–∏—Å—ã–≤–∞–µ–ºÂ∑Æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞ –∑–∞ –æ—Å—Ç–∞–≤—à–∏–π—Å—è –ø–µ—Ä–∏–æ–¥;
    - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É.[^6_3][^6_4]

***

### 12. Downgrade (–ø–æ–Ω–∏–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∞)

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ–Ω–∏–∂–∞–µ—Ç –ø–ª–∞–Ω (Pro ‚Üí Standard) –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –ø–µ—Ä–∏–æ–¥–∞ ‚Äî —Å –∫–∞–∫–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –º–µ–Ω—è—Ç—å?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ **downgrade**:
    - –∏–∑–º–µ–Ω–µ–Ω–∏–µ **–≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É —Å –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∏–ª–ª–∏–Ω–≥–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞**;
    - –¥–æ –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –æ–Ω –ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–º (–±–æ–ª–µ–µ –¥–æ—Ä–æ–≥–∏–º) –ø–ª–∞–Ω–æ–º –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–µ–Ω–µ–≥.[^6_5][^6_4]

***

### 13. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ (Monthly ‚Üî Yearly)

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –±—ã–ª –Ω–∞ Monthly –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è –Ω–∞ Yearly (—Å–æ —Å–∫–∏–¥–∫–æ–π 20%), –∫–∞–∫ —Å—á–∏—Ç–∞–µ–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- Monthly ‚Üí Yearly = upgrade:
    - —Å—á–∏—Ç–∞–µ–º –∫—Ä–µ–¥–∏—Ç –∑–∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–Ω–∏ –º–µ—Å—è—Ü–∞,
    - —Å–ø–∏—Å—ã–≤–∞–µ–º –≥–æ–¥ –≤–ø–µ—Ä—ë–¥ –º–∏–Ω—É—Å –∫—Ä–µ–¥–∏—Ç.
- Yearly ‚Üí Monthly:
    - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É —Å –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–∏–ª–∏ –¥–µ–ª–∞–µ–º —á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –ø–æ –∑–∞–ø—Ä–æ—Å—É —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É).

***

### 14. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ downgrade –ø–æ –ª–∏–º–∏—Ç–∞–º

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ —É–∂–µ 5 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –∏ 20 000 –≥–æ—Å—Ç–µ–π, –∞ –æ–Ω –ø—ã—Ç–∞–µ—Ç—Å—è —É–π—Ç–∏ –Ω–∞ –ø–ª–∞–Ω, –≥–¥–µ –ª–∏–º–∏—Ç 1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω –∏ 2000 –≥–æ—Å—Ç–µ–π ‚Äî —á—Ç–æ –¥–µ–ª–∞–µ–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–µ –¥–∞—ë–º –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å downgrade, –ø–æ–∫–∞:
    - –æ–Ω –Ω–µ —É–º–µ–Ω—å—à–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –¥–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ;
    - –Ω–µ —É–º–µ–Ω—å—à–∏—Ç –≥–æ—Å—Ç–µ–π –Ω–∏–∂–µ –ª–∏–º–∏—Ç–∞ (–∏–ª–∏ –æ–Ω —Å–æ–≥–ª–∞—Å–∏—Ç—Å—è, —á—Ç–æ ‚Äú–ª–∏—à–Ω–∏–µ‚Äù –±—É–¥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã/—Å–∫—Ä—ã—Ç—ã).
- –í UI –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—ë—Ç–∫–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞—Ä—É—à–∞—é—Ç—Å—è.

***

### 15. –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ (overage)

**–í–æ–ø—Ä–æ—Å:**
–†–∞–∑—Ä–µ—à–∞–µ–º –ª–∏ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ª–∏–º–∏—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –≤—Ä–µ–º—è –∞–∫—Ü–∏–∏) —Å –¥–æ–ø–ª–∞—Ç–æ–π –∏–ª–∏ –∂—ë—Å—Ç–∫–æ —Ä–µ–∂–µ–º –Ω–∞ —É—Ä–æ–≤–Ω–µ API?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç–µ ‚Äî **–∂—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç** (hard cap):
    - –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/–≥–æ—Å—Ç—è –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
- Overage-–±–∏–ª–ª–∏–Ω–≥ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π core.

***

## –ë–ª–æ–∫ 4. –û–ø–ª–∞—Ç–∞, –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –≤–∞–ª—é—Ç—ã

### 16. –ü–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä

**–í–æ–ø—Ä–æ—Å:**
–ö–æ–≥–æ –±–µ—Ä—ë–º –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä: Stripe, YooKassa, –¥—Ä.?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ SaaS ‚Äî **Stripe** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π (–∫–∞—Ä—Ç—ã, Apple/Google Pay, SEPA, –¥—Ä.).[^6_6]
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (YooKassa –∏ —Ç.–ø.), –Ω–æ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –¥–µ–ª–∞–µ–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é `PaymentProvider`.

***

### 17. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã: —Ç–æ–ª—å–∫–æ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã, –∏–ª–∏ —Ç–∞–∫–∂–µ Google/Apple Pay, PayPal –∏ —Ç.–ø.?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç–µ:
    - –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã,
    - Apple Pay / Google Pay (–µ—Å–ª–∏ Stripe —ç—Ç–æ –¥–∞—ë—Ç –±–µ–∑ –¥–æ–ø. —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π).
- PayPal –∏ –¥—Ä. ‚Äî –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–æ–∑–∂–µ.

***

### 18. –í–∞–ª—é—Ç–∞

**–í–æ–ø—Ä–æ—Å:**
–í –∫–∞–∫–æ–π –≤–∞–ª—é—Ç–µ –±–∏–ª–ª–∏–º: –≤ –æ–¥–Ω–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, EUR) –∏–ª–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö (RUB, EUR, USD)?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç–µ –≤—ã–±—Ä–∞—Ç—å **–æ–¥–Ω—É –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä, EUR),
- –¶–µ–Ω—ã –ø–ª–∞–Ω–æ–≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ —ç—Ç–æ–π –≤–∞–ª—é—Ç–µ; –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å–∞–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ç –≤ –≤–∞–ª—é—Ç—É –∫–∞—Ä—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞.
- –û—Ç–¥–µ–ª—å–Ω—ã–µ ‚Äú–ª–æ–∫–∞–ª—å–Ω—ã–µ‚Äù –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–ø—Ä–æ—Å.[^6_7]

***

### 19. –ù–∞–ª–æ–≥–∏ (VAT / –ù–î–°)

**–í–æ–ø—Ä–æ—Å:**
–£—á–∏—Ç—ã–≤–∞–µ–º –ª–∏ –Ω–∞–ª–æ–≥ (VAT) –≤ —Ü–µ–Ω–µ –ø–ª–∞–Ω–∞ –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω–æ?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–ª—è B2B SaaS –ª—É—á—à–µ:
    - —Ü–µ–Ω–∞ –ø–ª–∞–Ω–∞ **–±–µ–∑ VAT**,
    - VAT –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ –≤ —Å—á—ë—Ç–µ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º —é—Ä–∏—Å–¥–∏–∫—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è).
- –ü–æ–¥ —ç—Ç–æ –≤ –º–æ–¥–µ–ª–∏ –Ω—É–∂–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è `tax_amount`, `tax_rate` –≤ Invoice.

***

### 20. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ / —Å—á–µ—Ç–∞

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç—É invoice/—á–µ–∫ –Ω–∞ email –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
    - PDF/HTML invoice –Ω–∞ email Owner‚Äô–∞,
    - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∏–Ω–≤–æ–π—Å–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ Billing –≤ –∞–¥–º–∏–Ω–∫–µ.

***

## –ë–ª–æ–∫ 5. –û—Ç–º–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—Ç—ã –∏ –∑–∞–º–æ—Ä–æ–∑–∫–∞

### 21. –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (cancel)

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É —Å–∞–º ‚Äî –∫–æ–≥–¥–∞ –æ–Ω–∞ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- `CANCEL_AT_PERIOD_END`:
    - –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è `ACTIVE` –¥–æ –∫–æ–Ω—Ü–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞,
    - –¥–∞–ª—å—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `EXPIRED`.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å ‚ÄúCancel now‚Äù —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∞–ø–ø–æ—Ä—Ç (–º—ã —Ä—É–∫–∞–º–∏ –¥–µ–ª–∞–µ–º –≤–æ–∑–≤—Ä–∞—Ç/—á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç).

***

### 22. –í–æ–∑–≤—Ä–∞—Ç—ã (refunds)

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–µ/–ø–æ–ª–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç—ã —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –∏–ª–∏ –¥–µ–ª–∞–µ–º —ç—Ç–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—ë–∂–∫—É –∏ —Å–∞–ø–ø–æ—Ä—Ç?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç–µ:
    - **–Ω–µ—Ç UI –¥–ª—è self-service refunds**;
    - –≤–æ–∑–≤—Ä–∞—Ç—ã –¥–µ–ª–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –Ω–∞—Å (support), –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
- –í –º–æ–¥–µ–ª–∏ `Refund` —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å–≤—è–∑—å —Å Invoice/Payment –∏ –ø—Ä–∏—á–∏–Ω—É.

***

### 23. –ó–∞–º–æ—Ä–æ–∑–∫–∞ (pause) –ø–æ–¥–ø–∏—Å–∫–∏

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–∞ –ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å ‚Äú–∑–∞–º–æ—Ä–æ–∑–∏—Ç—å‚Äù –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 1‚Äì3 –º–µ—Å—è—Ü–∞ –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏–π, –Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –í–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç—É—Å `SUSPENDED` –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –∑–∞–º–æ—Ä–æ–∑–∫–∏ (–ø–æ –Ω–∞—à–µ–π –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ –∏–ª–∏ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏),
- –ù–æ **–Ω–µ –¥–µ–ª–∞—Ç—å –ø—É–±–ª–∏—á–Ω—É—é ‚Äú–∫–Ω–æ–ø–∫—É –ø–∞—É–∑—ã‚Äù** –¥–ª—è Owner‚Äô–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ (—á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏).

***

### 24. Chargeback

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç chargeback –ø–æ –∫–∞—Ä—Ç–µ ‚Äî —á—Ç–æ –¥–µ–ª–∞–µ–º —Å –µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–æ–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è chargeback:
    - –ø–æ–º–µ—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –æ–ø–ª–∞—Ç—É –∫–∞–∫ `CHARGEBACK`,
    - –ø–æ–¥–ø–∏—Å–∫—É —Å—Ä–∞–∑—É –≤ `SUSPENDED`,
    - Owner —Ç–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–ª–∞—Ç–Ω–æ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –¥–æ –≤—ã—è—Å–Ω–µ–Ω–∏—è;
    - –ª–æ–≥–∏—Ä—É–µ–º –≤—Å—ë –≤ `BillingActivityLog`.

***

## –ë–ª–æ–∫ 6. –õ–∏–º–∏—Ç—ã –ø–æ –ø–ª–∞–Ω–∞–º –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 25. –õ–∏–º–∏—Ç –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º

**–í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –ø–æ –ø–ª–∞–Ω—É:

- —Ä–∞–∑—Ä–µ—à–∞–µ–º –ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å ‚Äú–ª–∏—à–Ω–∏–µ‚Äù —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –∫–∞–∫ ‚Äú–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ‚Äù,
- –∏–ª–∏ —Å–æ–≤—Å–µ–º –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ/–≤–∫–ª—é—á–µ–Ω–∏–µ –µ—â—ë –æ–¥–Ω–æ–≥–æ?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ñ—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç:
    - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏–ª–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è ‚Äú–≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ‚Äù —Å–≤—ã—à–µ –ª–∏–º–∏—Ç–∞ ‚Äî –∑–∞–ø—Ä–µ—â–µ–Ω–∞,
    - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

***

### 26. –õ–∏–º–∏—Ç –ø–æ –≥–æ—Å—Ç—è–º

**–í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≥–æ—Å—Ç–µ–π:

- –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —ç—Ç–æ –æ—â—É—â–∞–µ—Ç?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è/–∫–∞—Ä—Ç—É:
    - API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ ‚Äúguest limit reached‚Äù,
    - –≤ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫—É ‚Äúupgrade plan‚Äù.

***

### 27. ‚ÄúSoft limit‚Äù –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å, —á—Ç–æ —Å–∫–æ—Ä–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 80% –æ—Ç –ª–∏–º–∏—Ç–∞ –≥–æ—Å—Ç–µ–π/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤)?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, –≤ Analytics/Billing –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä:
    - ‚Äú–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ 4200 / 5000 –≥–æ—Å—Ç–µ–π (84%)‚Äù;
    - –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 80% –∏ 100% –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å email/Telegram –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Owner‚Äô—É.

***

### 28. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–ª–∞–Ω–∞ c –º–µ–Ω—å—à–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ Owner –≤—Å—ë –∂–µ —É—Ö–æ–¥–∏—Ç –Ω–∞ –ø–ª–∞–Ω —Å –º–µ–Ω—å—à–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ (–ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º/–≥–æ—Å—Ç—è–º), –Ω–æ –Ω–µ –ø—Ä–∏–≤—ë–ª –¥–∞–Ω–Ω—ã–µ –≤ –ø–æ—Ä—è–¥–æ–∫ ‚Äî –∫–∞–∫ —Å–µ–±—è –≤–µ–¥—ë—Ç —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–µ —Ä–∞–∑—Ä–µ—à–∞—Ç—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å downgrade, –ø–æ–∫–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ —É–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ –ª–∏–º–∏—Ç—ã (—Å–º. –≤–æ–ø—Ä–æ—Å 14).
- –≠—Ç–æ —Å–Ω–∏–º–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å ‚Äú–∞–≤—Ç–æ-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏‚Äù –ª–∏—à–Ω–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.

***

## –ë–ª–æ–∫ 7. –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å (Billing Analytics)

### 29. –ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Å—á–∏—Ç–∞–µ–º

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω—É–∂–Ω—ã –≤ Billing-—Ä–∞–∑–¥–µ–ª–µ: —Ç–æ–ª—å–∫–æ MRR/ARR –∏–ª–∏ –µ—â—ë churn, LTV –∏ —Ç.–ø.?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–Ω–∞—Å, –∫–∞–∫ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤):
    - MRR, ARR, churn rate, expansion/contraction MRR, ARPA (avg revenue per account).
- –î–ª—è Owner‚Äô–∞ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞):
    - —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω, —Ü–µ–Ω–∞, –∏—Å—Ç–æ—Ä–∏—è –æ–ø–ª–∞—Ç, —Å—É–º–º–∞ –∑–∞ –≥–æ–¥.

***

### 30. –î–æ—Å—Ç—É–ø –∫ Billing-–¥–∞–Ω–Ω—ã–º –ø–æ —Ä–æ–ª—è–º

**–í–æ–ø—Ä–æ—Å:**
–ö—Ç–æ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å Billing: —Ç–æ–ª—å–∫–æ Owner, –∏–ª–∏ RestaurantAdmin —Ç–æ–∂–µ?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- Billing-—Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ **Owner** (tenant owner).
- RestaurantAdmin/Manager/Cashier –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∏–Ω–∞–Ω—Å–∞–º.

***

–ï—Å–ª–∏ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç, –º–æ–∂–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏:

- —Ç—ã —Ç–∞–∫ –∂–µ, –∫–∞–∫ —Ä–∞–Ω–µ–µ, –ø—Ä–æ–π–¥—ë—à—å—Å—è –ø–æ –Ω–æ–º–µ—Ä–∞–º (1‚Äì30) –∏ –≤—ã–±–µ—Ä–µ—à—å –≤–∞—Ä–∏–∞–Ω—Ç—ã / –¥–æ–±–∞–≤–∏—à—å —Å–≤–æ–∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è;
- –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —è —Å–æ–±–µ—Ä—É –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω Billing \& Subscriptions (–∫–∞–∫ –º—ã —Å–¥–µ–ª–∞–ª–∏ –¥–ª—è Loyalty) –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—é —Å—Ö–µ–º—É —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ —Å—Ç–∞—Ç—É—Å—ã.
<span style="display:none">[^6_10][^6_11][^6_12][^6_13][^6_14][^6_15][^6_16][^6_17][^6_18][^6_19][^6_8][^6_9]</span>

<div align="center">‚ÅÇ</div>

[^6_1]: https://smartsaas.works/blog/post/2025/3/10/how-to-structure-saas-pricing-tiers/117

[^6_2]: https://quicktop10.com/blog/best-practices-for-subscription-billing-in-saas/

[^6_3]: https://fastspring.com/docs/classic/prorating-when-upgrading-or-downgrading-subscription-plans-classic/

[^6_4]: https://kinde.com/learn/billing/plans/proration-explained-how-to-handle-subscription-upgrades-and-downgrades-fairly-and-efficiently/

[^6_5]: https://www.revenuecat.com/docs/subscription-guidance/managing-subscriptions

[^6_6]: https://stripe.com/resources/more/best-practices-for-saas-billing

[^6_7]: https://www.younium.com/blog/what-is-saas-billing

[^6_8]: –ë–µ—Å–µ–¥–∞ 4.md

[^6_9]: –ë–µ—Å–µ–¥–∞ 3.md

[^6_10]: –ë–µ—Å–µ–¥–∞ 2.md

[^6_11]: –ë–µ—Å–µ–¥–∞ 1.md

[^6_12]: https://fastspring.com/blog/saas-billing-best-practices/

[^6_13]: https://billingplatform.com/blog/best-practices-to-effectively-manage-saas-subscriptions

[^6_14]: https://www.paddle.com/blog/tiered-pricing

[^6_15]: https://billingplatform.com/blog/saas-billing-best-practices

[^6_16]: https://stripe.com/resources/more/saas-subscription-models-101-a-guide-for-getting-started

[^6_17]: https://www.tabs.com/blog/pricing-tiers

[^6_18]: https://www.maxio.com/blog/5-best-practices-for-saas-billing

[^6_19]: https://www.reddit.com/r/SaaS/comments/191qhum/rule_of_thumb_about_tiered_pricing/


---

# –û—á–µ–Ω—å –ø–ª–æ—Ö–æ –∏–∑—É—á–∏–ª!

BILLING \& SUBSCRIPTIONS —Å–ª–µ–¥—É—é—â–∏–π. –í —Ç–æ–º –∂–µ —Å—Ç–∏–ª–µ. –ò–∑—É—á–∏ —Ñ–∞–π–ª—ã –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ, –æ—Ç 1 –¥–æ 4, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ. –ó–∞–¥–∞–π 20-40 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ä–∞–∑—É –≤ —á–∞—Ç + —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ —Ç–≤–æ–µ–º—É –ª—É—á—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö. –ü–µ—Ä–µ–¥ –∑–∞–¥–∞–≤–∞–Ω–∏–µ–º –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–≤–µ—Ä—å—Å—è —Å —Ñ–∞–π–ª–∞–º–∏, –º–æ–∂–µ—Ç —Ç–∞–∫–∏–µ –æ–Ω–∏ —É–∂–µ –±—ã–ª–∏

–ù–∏–∂–µ –≤–æ–ø—Ä–æ—Å—ã —É–∂–µ **—Å —É—á—ë—Ç–æ–º —Ñ–∞–π–ª–æ–≤ 1‚Äì4** (Beseda-1..4, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞, TenantLimits, SubscriptionPlan, ActivityLog, Owner analytics –∏ —Ç.–¥.). –ù–µ –±—É–¥—É –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ç–æ, —á—Ç–æ —É–∂–µ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –æ–ø–∏—Å–∞–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–ª–∏—á–∏–µ 6 —Ç–∞—Ä–∏—Ñ–æ–≤, —Å—É—â–Ω–æ—Å—Ç–µ–π SubscriptionPlan/Subscription/BillingInfo/TenantLimits, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ 90% –ª–∏–º–∏—Ç–∞ –≥–æ—Å—Ç–µ–π –∏ —Ç.–ø.) ‚Äî —Ç–æ–ª—å–∫–æ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è.

–°–¥–µ–ª–∞—é –ø—Ä–∏–º–µ—Ä–Ω–æ 30 –≤–æ–ø—Ä–æ—Å–æ–≤ –±–ª–æ–∫–∞–º–∏, –∫–∞–∫ –ø–æ Loyalty: —É –∫–∞–∂–¥–æ–≥–æ —Å—Ä–∞–∑—É –º–æ—ë —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

***

## –ë–ª–æ–∫ 1. –ú–æ–¥–µ–ª—å –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –ø–ª–∞–Ω–æ–≤

### 1. –ï–¥–∏–Ω–∏—Ü–∞ –±–∏–ª–ª–∏–Ω–≥–∞ –∏ —Å–≤—è–∑—å —Å Tenant

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ —Ñ–∞–π–ª–∞—Ö:**

- –ï—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ `Tenant`, `SubscriptionPlan`, `Subscription`, `BillingInfo`, `TenantLimits`.
- –ü–ª–∞–Ω –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Owner-–∞–∫–∫–∞—É–Ω—Ç–∞, —É Tenant –µ—Å—Ç—å `TenantLimits.maxrestaurants`, `TenantLimits.maxguests`.

**–í–æ–ø—Ä–æ—Å:**
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ª–∏, —á—Ç–æ **–≤—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞ –≤—Å–µ–≥–¥–∞ ‚Äú–ø—Ä–∏–≤—è–∑–∞–Ω–∞‚Äù –∫ Tenant (Owner account)**, –∞ –Ω–µ –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, –±–∏–ª–ª–∏–º **—Ç–æ–ª—å–∫–æ Tenant**, —Ç.–µ. Owner-–∞–∫–∫–∞—É–Ω—Ç.
- –í—Å–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –≥–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.
- –£–ø—Ä–æ—â–∞–µ—Ç –º–æ–¥–µ–ª—å: `Tenant 1 ‚Äì Subscription 1 ‚Äì N Restaurants ‚Äì M Guests`.

***

### 2. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–∞—Ä–∏—Ñ–æ–≤ vs –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- Free, Standard, Medium, Pro, Ultimate, Custom.
- –í Beseda-2 –µ—Å—Ç—å —Ç–∞–±–ª–∏—á–∫–∞ —Å –ª–∏–º–∏—Ç–∞–º–∏: Standard: 1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω, 5000 –≥–æ—Å—Ç–µ–π; Medium: 3, 2000?; Pro: 5, 6000; Ultimate: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ, Custom; TenantLimits —Ö—Ä–∞–Ω–∏—Ç maxrestaurants, maxguests.

**–í–æ–ø—Ä–æ—Å:**
–ü–ª–∞–Ω—ã –≤—Å–µ–≥–¥–∞ **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ 6 —à—Ç—É–∫** –∏–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∞–¥–º–∏–Ω–∫—É?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –í –ë–î `SubscriptionPlan` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π.
- –í –ø—Ä–æ–¥—É–∫—Ç–µ ‚Äî 6 ‚Äú–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö‚Äù –ø–ª–∞–Ω–æ–≤ (Free/Standard/Medium/Pro/Ultimate/Custom) + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –Ω–∞—Å —á–µ—Ä–µ–∑ internal admin —Å–æ–∑–¥–∞–≤–∞—Ç—å **–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π Custom-–ø–ª–∞–Ω** –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ Tenant (override –ª–∏–º–∏—Ç–æ–≤/—Ü–µ–Ω—ã).
- –ù–∞ UI –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö (Free‚ÄìUltimate) + ‚ÄúCustom ‚Äî –ø–æ –∑–∞–ø—Ä–æ—Å—É‚Äù.

***

### 3. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –¥–∞—ë—Ç –∫–∞–∂–¥—ã–π –ø–ª–∞–Ω, –ø–æ–º–∏–º–æ –ª–∏–º–∏—Ç–æ–≤

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í —Ñ–∞–π–ª–∞—Ö —è–≤–Ω–æ –æ–ø–∏—Å–∞–Ω—ã —Ç–æ–ª—å–∫–æ –ª–∏–º–∏—Ç—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤/–≥–æ—Å—Ç–µ–π (`TenantLimits`).
- –í Owner analytics —Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç —Ç–∞—Ä–∏—Ñ—ã –∏ MRR/Churn, –Ω–æ –Ω–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã ‚Äú—Ñ–∏—á–∏ –ø–æ –ø–ª–∞–Ω–∞–º‚Äù.

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ —Ä–∞–∑–ª–∏—á–∞—Ç—å –ø–ª–∞–Ω—ã **–ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ –ª–∏–º–∏—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, Free –±–µ–∑ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏; Pro/Ultimate —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º)?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞:
    - Free: –±–µ–∑ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π Analytics (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã), –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π Loyalty Builder.
    - Standard/Medium: POS + –±–∞–∑–æ–≤–∞—è Analytics, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–æ.
    - Pro/Ultimate: –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –≤—Å–µ –æ—Ç—á—ë—Ç—ã, –≤—Å–µ —Ç–∏–ø—ã –ø—Ä–æ–º–æ, Telegram-–±–æ—Ç.
- –í `SubscriptionPlan` —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–ª–∞–∂–∫–∏: `include_pos`, `include_advanced_analytics`, `include_telegram_bot`, `max_loyalty_rules`, —Ç.–ø.

***

### 4. Custom-–ø–ª–∞–Ω: –∫–∞–∫ –æ–Ω —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –ï—Å—Ç—å –ø–ª–∞–Ω `CUSTOM`, –Ω–æ –±–µ–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è.

**–í–æ–ø—Ä–æ—Å:**
Custom ‚Äî —ç—Ç–æ:

- –µ–¥–∏–Ω—ã–π ‚Äú–æ—Å–æ–±—ã–π‚Äù –ø–ª–∞–Ω —Å –æ–±—â–∏–º–∏ –¥–µ—Ñ–æ–ª—Ç–∞–º–∏,
- –∏–ª–∏ **–∫–∞–∂–¥–æ–º—É –∫–∞—Å—Ç–æ–º-–∫–ª–∏–µ–Ω—Ç—É —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–≤–æ–π `SubscriptionPlan`**?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–ª—è –∫—Ä—É–ø–Ω—ã—Ö —Å–µ—Ç–µ–π: —Å–æ–∑–¥–∞–≤–∞—Ç—å **–æ—Ç–¥–µ–ª—å–Ω—ã–π `SubscriptionPlan` —Å type = CUSTOM –∏ —Å—Å—ã–ª–∫–æ–π –Ω–∞ Tenant**.
- –í UI Owner —É–≤–∏–¥–∏—Ç –µ–≥–æ –∫–∞–∫ ‚ÄúCustom (–ø–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏)‚Äù.

***

## –ë–ª–æ–∫ 2. –ü–µ—Ä–∏–æ–¥—ã, trial –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è

### 5. –ü–æ–¥–ø–∏—Å–æ—á–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Beseda-2: —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –º–µ—Å—è—á–Ω–æ–π –∏ –≥–æ–¥–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ —Å 20% —Å–∫–∏–¥–∫–æ–π.

**–í–æ–ø—Ä–æ—Å:**
–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ `MONTHLY` –∏ `YEARLY` –∏–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º –µ—â—ë, –Ω–∞–ø—Ä–∏–º–µ—Ä, `QUARTERLY`?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç–µ: **—Ç–æ–ª—å–∫–æ MONTHLY –∏ YEARLY**.
- –í `SubscriptionPlan` –µ—Å—Ç—å –ø–æ–ª—è `price_monthly`, `price_yearly`.
- –ö–≤–∞—Ä—Ç–∞–ª –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ, –Ω–æ –Ω–µ —Å–µ–π—á–∞—Å (—á—Ç–æ–±—ã –Ω–µ –º–Ω–æ–∂–∏—Ç—å –∫–µ–π—Å—ã –∞–ø–≥—Ä–µ–π–¥–æ–≤/–ø—Ä–æ—Ä–µ–π—Ç–∞).

***

### 6. Trial-–ø–µ—Ä–∏–æ–¥

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Beseda-3/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö —É–ø–æ–º–∏–Ω–∞–ª—Å—è trial (20 –¥–Ω–µ–π) –¥–ª—è Owner/–ø–µ—Ä–≤—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, –Ω–æ –±–µ–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏.

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–µ–Ω –ª–∏ **–æ—Ç–¥–µ–ª—å–Ω—ã–π trial-–ø–µ—Ä–∏–æ–¥** –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –∏ –∫–∞–∫–æ–π: 7/14/30 –¥–Ω–µ–π?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, trial —É–º–µ—Å—Ç–µ–Ω:
    - Trial –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–ª–∞–Ω—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Standard/Medium/Pro).
    - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ: **14 –¥–Ω–µ–π**.
    - Trial = —Å—Ç–∞—Ç—É—Å `TRIALING` –≤ `Subscription`.
    - –ü–æ—Å–ª–µ trial: –ª–∏–±–æ –∞–≤—Ç–æ-—Å–ø–∏—Å–∞–Ω–∏–µ (–µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω—ã –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ), –ª–∏–±–æ –ø–æ–¥–ø–∏—Å–∫–∞ —É—Ö–æ–¥–∏—Ç –≤ `EXPIRED` –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç Tenant –Ω–∞ Free.

***

### 7. –ö–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ –ø–æ–¥–ø–∏—Å–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–π

**–í–æ–ø—Ä–æ—Å:**
–ú–æ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ‚Äî —ç—Ç–æ:

- —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ / –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã,
- –∏–ª–∏ Owner –º–æ–∂–µ—Ç ‚Äú–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è‚Äù –±–µ–∑ –≤–≤–æ–¥–∞ –∫–∞—Ä—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, trial –±–µ–∑ –∫–∞—Ä—Ç—ã)?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤:
    - –ø–æ–¥–ø–∏—Å–∫–∞ `ACTIVE` —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ **—É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞**;
    - –¥–æ —ç—Ç–æ–≥–æ ‚Äî `TRIALING` (–µ—Å–ª–∏ trial) –∏–ª–∏ ‚Äú–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω‚Äù (–ø–æ–∫–∞ –Ω–µ –≤–≤–µ–ª–∏ –∫–∞—Ä—Ç—É).
- Trial **–±–µ–∑ –∫–∞—Ä—Ç—ã** –≤–æ–∑–º–æ–∂–µ–Ω (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π friction), –Ω–æ –ø–æ –µ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å –ø—Ä–æ—Å–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É, –∏–Ω–∞—á–µ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Free.

***

## –ë–ª–æ–∫ 3. –°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

### 8. –ù–∞–±–æ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ `Subscription`

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í ActivityLog –µ—Å—Ç—å –ø–æ–ª—è: `restaurantid, tariff, subscriptionstart, subscriptionend, oldtariff, newtariff, cancelledby, reason`.
- –í Owner analytics: —Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç `pending refund`, `chargeback`, —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π `Success, Failed, Pending, Refunded`.

**–í–æ–ø—Ä–æ—Å:**
–§–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –Ω–∞–±–æ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è `Subscription`:
`TRIALING`, `ACTIVE`, `PAST_DUE`, `CANCELLED`, `EXPIRED`, `SUSPENDED`?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:
    - `TRIALING` ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
    - `ACTIVE` ‚Äî –æ–ø–ª–∞—á–µ–Ω–∞ –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞.
    - `PAST_DUE` ‚Äî –∞–≤—Ç–æ–æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞, –∏–¥—ë—Ç grace period.
    - `CANCELLED` ‚Äî –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –Ω–æ –µ—â—ë –∞–∫—Ç–∏–≤–Ω–∞ –¥–æ –∫–æ–Ω—Ü–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.
    - `EXPIRED` ‚Äî –ø–µ—Ä–∏–æ–¥ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –ª–∏–±–æ –æ–∫–æ–Ω—á–∞–Ω–∏–µ trial –±–µ–∑ –æ–ø–ª–∞—Ç—ã.
    - `SUSPENDED` ‚Äî –º—ã —Å–∞–º–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ (fraud/chargeback).

***

### 9. –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∏ —Ä—É—á–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ

**–ß—Ç–æ —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ:**

- ‚ÄúAccounts \& Subscriptions‚Äù —Å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π, MRR –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.

**–í–æ–ø—Ä–æ—Å:**
–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ **–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ** –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤, –∏–ª–∏ Owner –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-renewal?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç–Ω—ã—Ö:
    - `auto_renew = true` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    - –í billing-—Å—Ç—Ä–∞–Ω–∏—Ü–µ Owner –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å `auto_renew = false` ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞ –¥–æ—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞, –ø–æ—Ç–æ–º `EXPIRED` –∏ –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ Free.

***

### 10. Grace period –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ–ø–ª–∞—Ç–µ

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ:**

- –î–ª—è –ª–∏–º–∏—Ç–æ–≤ –≥–æ—Å—Ç–µ–π –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ 90% (—Å–º. `checkGuestLimit` –∏ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏). –î–ª—è –æ–ø–ª–∞—Ç—ã grace period —è–≤–Ω–æ –Ω–µ –æ–ø–∏—Å–∞–Ω.

**–í–æ–ø—Ä–æ—Å:**
–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –¥–∞—ë–º –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã (grace), –ø—Ä–µ–∂–¥–µ —á–µ–º –æ—Ç–∫–ª—é—á–∞—Ç—å –ø–ª–∞—Ç–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- Grace period = **7 –¥–Ω–µ–π**:
    - –≤ –¥–µ–Ω—å —Å–ø–∏—Å–∞–Ω–∏—è: —Å—Ä–∞–∑—É 1-—è –ø–æ–ø—ã—Ç–∫–∞;
    - –∑–∞—Ç–µ–º –µ—â—ë 2‚Äì3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ 7 –¥–Ω–µ–π;
    - –≤—Å–µ —ç—Ç–æ –≤—Ä–µ–º—è —Å—Ç–∞—Ç—É—Å `PAST_DUE`, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ —Ä–µ–∂–µ–º, –Ω–æ –≤ –∞–¥–º–∏–Ω–∫–µ –±–∞–Ω–Ω–µ—Ä ‚Äú–æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞‚Äù.
- –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ 7 –¥–Ω–µ–π ‚Üí `EXPIRED`, –ø–ª–∞–Ω —Å–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ Free, –ø–ª–∞—Ç–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, advanced analytics –∏ —Ç.–¥.) –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è.

***

## –ë–ª–æ–∫ 4. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ (upgrade/downgrade) –∏ –ø–µ—Ä–∏–æ–¥—ã

### 11. Upgrade (–¥–æ—Ä–∞—â–∏–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞) –ø–æ—Å—Ä–µ–¥–∏ –ø–µ—Ä–∏–æ–¥–∞

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Owner analytics ‚Äî MRR, Churn, Pending Refund, Chargeback; –ª–æ–≥–∏–∫–∞ prorate –Ω–µ –æ–ø–∏—Å–∞–Ω–∞.

**–í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ Standard ‚Üí Pro –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ –¥–µ–ª–∞–µ–º **–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç** –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –ø–æ–ª–Ω—ã–π –º–µ—Å—è—Ü?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–µ–ª–∞—Ç—å **–ø—Ä–æ—Ä–µ–π—Ç ‚Äú–ø–æ –¥–Ω—è–º‚Äù** (–∫–∞–∫ –¥–µ–ª–∞–µ—Ç Stripe –∏ –¥—Ä.):
    - –∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é —á–∞—Å—Ç—å Standard ‚Äî –∫—Ä–µ–¥–∏—Ç,
    - –∑–∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–Ω–∏ ‚Äî –¥–æ–ø–ª–∞—Ç–∞ –∑–∞ Pro —Å —É—á—ë—Ç–æ–º –∫—Ä–µ–¥–∏—Ç–∞.
- –í ActivityLog –∏ InvoiceHistory –ª–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç–∞.

***

### 12. Downgrade (–ø–æ–Ω–∏–∂–µ–Ω–∏–µ) –ø–æ—Å—Ä–µ–¥–∏ –ø–µ—Ä–∏–æ–¥–∞

**–í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ Pro ‚Üí Standard –¥–µ–ª–∞–µ–º –ª–∏ –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç –∏–ª–∏ –º–µ–Ω—è–µ–º –ø–ª–∞–Ω —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ downgrade:
    - –ø–ª–∞–Ω –º–µ–Ω—è–µ—Ç—Å—è **—Å –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞** (–±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π);
    - –¥–æ –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞/–≥–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º –ø–ª–∞–Ω–æ–º.

***

### 13. –°–º–µ–Ω–∞ –ø–µ—Ä–∏–æ–¥–∞ (Monthly ‚Üî Yearly)

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ‚Äú–º–µ—Å—è—á–Ω–∞—è –∏ –≥–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (20% —Å–∫–∏–¥–∫–∞)‚Äù.

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –≤–µ–¥—ë–º —Å–µ–±—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–∞ Monthly ‚Üí Yearly –∏ Yearly ‚Üí Monthly?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- Monthly ‚Üí Yearly:
    - —Å—á–∏—Ç–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ –∫–∞–∫ –∫—Ä–µ–¥–∏—Ç,
    - –±–µ—Ä—ë–º –æ–ø–ª–∞—Ç—É –∑–∞ –≥–æ–¥ –º–∏–Ω—É—Å –∫—Ä–µ–¥–∏—Ç.
- Yearly ‚Üí Monthly:
    - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–µ–Ω—è–µ–º **—Å –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞**, –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞;
    - –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç ‚Äú—Ä–∞–∑–æ—Ä–≤–∞—Ç—å‚Äù –≥–æ–¥–æ–≤–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–∞–Ω—å—à–µ ‚Üí —á–µ—Ä–µ–∑ —Å–∞–ø–ø–æ—Ä—Ç, —Ä—É—á–Ω–æ–π —á–∞—Å—Ç–∏—á–Ω—ã–π refund (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ `Refund`).

***

### 14. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏ downgrade –ø–æ –ª–∏–º–∏—Ç–∞–º

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ:**

- `checkGuestLimit` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `ForbiddenException: Guest limit reached, please upgrade your plan`.
- –õ–æ–≥–∏–∫–∞ ‚Äúdownsize‚Äù –µ—â—ë –Ω–µ –æ–ø–∏—Å–∞–Ω–∞.

**–í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–π—Ç–∏ –Ω–∞ –ø–ª–∞–Ω —Å –º–µ–Ω—å—à–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏, –µ—Å–ª–∏ Tenant —É–∂–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç—ã, —á—Ç–æ –¥–µ–ª–∞–µ–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- **–ó–∞–ø—Ä–µ—â–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å downgrade**, –ø–æ–∫–∞:
    - `restaurants_count > maxrestaurants` –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞,
    - `activeGuestsCount > maxguests` –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞.
- –í UI –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ: ‚Äú—É–±–µ—Ä–∏—Ç–µ X —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤‚Äù, ‚Äú—É–º–µ–Ω—å—à–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Å—Ç–µ–π –¥–æ N‚Äù.

***

## –ë–ª–æ–∫ 5. –õ–∏–º–∏—Ç—ã, overage –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 15. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã)

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Beseda-2: TenantLimits –¥–ª—è maxrestaurants; –Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —á–∏—Å—Ç–æ –¥–ª—è –≥–æ—Å—Ç–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ ‚Äî –Ω–µ—Ç.

**–í–æ–ø—Ä–æ—Å:**
–ï—Å–ª–∏ Tenant –¥–æ—Å—Ç–∏–≥ –ª–∏–º–∏—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –ø–æ –ø–ª–∞–Ω—É, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å/–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ñ—ë—Å—Ç–∫–∏–π `hard limit`:
    - API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—É—é –æ—à–∏–±–∫—É `restaurant_limit_reached`;
    - UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚Äú–¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º, –æ–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–Ω‚Äù.
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

***

### 16. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–æ –≥–æ—Å—Ç—è–º

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ:**

- `checkGuestLimit` —Å—á–∏—Ç–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Å—Ç–µ–π, –µ—Å–ª–∏ `activeGuestsCount >= maxguests` ‚Äî ForbiddenException.
- –ü—Ä–∏ 90% ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç warning –∏, —Å—É–¥—è –ø–æ –∫–æ–¥—É, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

**–í–æ–ø—Ä–æ—Å:**
–§–∏–∫—Å–∏—Ä—É–µ–º –ª–∏ —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫ ‚Äú–∫–∞–Ω–æ–Ω‚Äù:

- –ø—Ä–∏ 90% –ª–∏–º–∏—Ç–∞ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ,
- –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Äî –∂—ë—Å—Ç–∫–∏–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–∞–∫:
    - >90%: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Owner‚Äô—É (‚Äú–≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ 4500/5000 –≥–æ—Å—Ç–µ–π‚Äù), –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ 100%;
    - >100%: –Ω–∏ –æ–¥–∏–Ω –Ω–æ–≤—ã–π –≥–æ—Å—Ç—å –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –æ–±–Ω–æ–≤—è—Ç –ø–ª–∞–Ω –∏–ª–∏ –Ω–µ —É–¥–∞–ª—è—Ç/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç –≥–æ—Å—Ç–µ–π.

***

### 17. Overage (–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤)

**–í–æ–ø—Ä–æ—Å:**
–†–∞–∑—Ä–µ—à–∞–µ–º –ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç (—Å –¥–æ–ø–ª–∞—Ç–æ–π, –∫–∞–∫ overage), –∏–ª–∏ —ç—Ç–æ –≤–æ–æ–±—â–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- **–ù–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ ‚Äî –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º overage.**
- –¢–æ–ª—å–∫–æ –∂—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã + –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã –ø–æ upgrade.
- –≠—Ç–æ —Å–∏–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –±–∏–ª–ª–∏–Ω–≥ –∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –∫—É—á—É edge-–∫–µ–π—Å–æ–≤.

***

## –ë–ª–æ–∫ 6. –ü–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 18. –ö–∞–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Beseda-2 –ø—Ä—è–º–æ: ‚ÄúStripe, YooKassa .. Subscription‚Äù.
- –í Beseda-4: ‚ÄúPayment Gateway Stripe, YooKassa ?‚Äù ‚Äî –ø–æ–∫–∞ –∫–∞–∫ –≤–æ–ø—Ä–æ—Å.

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–µ–Ω –ª–∏ —Å—Ä–∞–∑—É **–¥–≤–æ–π–Ω–æ–π —Å—Ç–µ–∫** (Stripe + YooKassa), –∏–ª–∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–¥–Ω–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ, –∞ –≤—Ç–æ—Ä–æ–π –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –ø–æ—Ç–æ–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ ‚Äî –¥–µ–ª–∞–µ–º `PaymentProvider`-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é.
- –ù–∞ —Å—Ç–∞—Ä—Ç–µ:
    - **Stripe** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –∫–∞—Ä—Ç, Apple/Google Pay –∏ —Ç.–¥.).
    - YooKassa –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ø–æ–∑–∂–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä, –µ—Å–ª–∏ –ø–æ–π–º—ë–º, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä—ã–Ω–æ–∫ ‚Äî –†–§ –∏ –Ω—É–∂–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è —ç–∫–≤–∞–π—Ä–∏–Ω–≥-—Å—Ö–µ–º–∞.

***

### 19. –í–∞–ª—é—Ç–∞ –∏ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í —Ç–∞—Ä–∏—Ñ–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ —É–∫–∞–∑–∞–Ω—ã —á–∏—Å–ª–∞ (5000, 15000, 35000, 100000) ‚Äî —ç—Ç–æ, —Å—É–¥—è –ø–æ –≤—Å–µ–º—É, –ª–∏–º–∏—Ç—ã, –∞ –Ω–µ —Ü–µ–Ω—ã. –¶–µ–Ω—ã –≤ –≤–∞–ª—é—Ç–∞—Ö –µ—â—ë –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã.

**–í–æ–ø—Ä–æ—Å:**
–î–µ–ª–∞–µ–º **–æ–¥–Ω—É –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É** –¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, EUR) –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –≤ RUB/EUR/USD?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç: –æ–¥–Ω–∞ –±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ (EUR –∏–ª–∏ USD).
- –í `SubscriptionPlan` ‚Äî —Ü–µ–Ω—ã –≤ —ç—Ç–æ–π –≤–∞–ª—é—Ç–µ.
- –†–µ–∞–ª—å–Ω—É—é –æ–ø–ª–∞—Ç—É –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç–µ –∫–∞—Ä—Ç—ã –¥–∞—ë—Ç —Å–∞–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä (Stripe).
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ, –µ—Å–ª–∏ –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å.

***

### 20. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–∞ –∏ invoice

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í –º–æ–¥–µ–ª—è—Ö: `Payment`, `Invoice`, `SubscriptionHistory`; –≤ ActivityLog: `subscriptionid, amount, paymentstatus`, —Å–æ–±—ã—Ç–∏—è `refund`, `chargeback`.

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–æ–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π –¥–ª—è `Invoice` –∏ `Payment` –Ω—É–∂–µ–Ω –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ (–º–∏–Ω–∏–º—É–º):**

- `Invoice`
    - id, tenantid, subscriptionid
    - period_start, period_end
    - amount_net, tax_amount, amount_gross
    - currency
    - status: DRAFT, OPEN, PAID, VOID, REFUNDED
    - link –Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (invoice_url/hosted_url).
- `Payment`
    - id, invoiceid, provider, provider_payment_id
    - amount, currency, status: PENDING, SUCCEEDED, FAILED, REFUNDED, CHARGEBACK
    - error_code / error_message
    - –ø–ª–∞—Ç–µ–∂–Ω—ã–π –º–µ—Ç–æ–¥ (card, apple_pay, google_pay).

***

## –ë–ª–æ–∫ 7. –û—Ç–º–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—Ç—ã, chargeback

### 21. –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –æ—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (cancel)

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í ActivityLog: `restaurantid, cancelledby, reason`.

**–í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ cancel —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Owner ‚Äî –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É —Å—Ä–∞–∑—É –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- UI Owner‚Äô–∞ –¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ **‚Äú–û—Ç–º–µ–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–∏–æ–¥–∞‚Äù**:
    - —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `CANCELLED`,
    - –¥–æ –∫–æ–Ω—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ `ACTIVE`,
    - –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ ‚Üí `EXPIRED` –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Free.
- ‚ÄúCancel now‚Äù ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∞–ø–ø–æ—Ä—Ç, —Å —Ä—É—á–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º: –±—É–¥–µ—Ç –ª–∏ —á–∞—Å—Ç–∏—á–Ω—ã–π refund.

***

### 22. –í–æ–∑–≤—Ä–∞—Ç—ã (refund)

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–µ–Ω –ª–∏ self-service –≤–æ–∑–≤—Ä–∞—Ç –∏–ª–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É/–≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∞–¥–º–∏–Ω–∫—É?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç:
    - –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç —Å–∞–º–∏ –¥–µ–ª–∞—Ç—å refund;
    - –º—ã –∏–º–µ–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `Admin Billing Panel` ‚Üí –≤—ã–±–∏—Ä–∞–µ–º Invoice ‚Üí –Ω–∞–∂–∏–º–∞–µ–º ‚ÄúRefund (full/partial)‚Äù ‚Üí –∏–¥—ë—Ç –∑–∞–ø—Ä–æ—Å –∫ Stripe/YooKassa.
- –í –ë–î: `Refund` —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ `Payment`/`Invoice`, —Å—É–º–º–æ–π –∏ reason.

***

### 23. Chargeback –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Owner analytics –∏ ActivityLog —è–≤–Ω–æ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è `chargeback` –∏ `refund`, –∞ —Ç–∞–∫–∂–µ `pending`.

**–í–æ–ø—Ä–æ—Å:**
–ü—Ä–∏ chargeback (–±–∞–Ω–∫ –≤–µ—Ä–Ω—É–ª –¥–µ–Ω—å–≥–∏ –∫–ª–∏–µ–Ω—Ç—É –ø–æ —Å–ø–æ—Ä—É) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ–º –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ –¥–∞—ë–º grace?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ `CHARGEBACK` –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
    - —Å—Ä–∞–∑—É —Å—Ç–∞–≤–∏–º Subscription –≤ `SUSPENDED`,
    - —É–≤–µ–¥–æ–º–ª—è–µ–º Owner –∏ –Ω–∞—à —Å–∞–ø–ø–æ—Ä—Ç,
    - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–æ—Ä–æ—Ç–∫–∏–π read-only –¥–æ—Å—Ç—É–ø –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –ø–ª–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏,
    - –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ (—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ) —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É.

***

## –ë–ª–æ–∫ 8. Billing-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ ActivityLog

### 24. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∏–¥–∏—Ç Owner –≤ Billing Analytics

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –î–ª—è OWNER –≤ Analytics: MRR, Churn, pending refund, chargeback, —Ä–∞–∑–±–∏–≤–∫–∏ –ø–æ –ø–ª–∞–Ω–∞–º (Standard/Medium/Pro/Ultimate/Custom), –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ 7/30/90 –¥–Ω—è–º, —Å—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π (`Success, Failed, Pending, Refunded`).

**–í–æ–ø—Ä–æ—Å:**
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ª–∏, —á—Ç–æ –¥–ª—è Owner (–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã) –±—É–¥–µ—Ç:

- MRR, ARR, Churn (7/30/90), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ –ø–ª–∞–Ω–∞–º, —Å—É–º–º–∞ refund‚Äô–æ–≤, —Å—É–º–º–∞ chargeback‚Äô–æ–≤?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, –¥–µ–ª–∞–µ–º **Owner Billing Dashboard**:
    - MRR/ARR –ø–æ –ø–ª–∞–Ω–∞–º,
    - churn –ø–æ 7/30/90,
    - net revenue (—Å —É—á—ë—Ç–æ–º refund/chargeback),
    - —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫ —Å –ø–ª–∞–Ω–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏.

***

### 25. –ß—Ç–æ –≤–∏–¥–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π Tenant (Owner-—Ä–µ—Å—Ç–æ—Ä–∞–Ω)

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Owner-—Ä–∞–∑–¥–µ–ª–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–≥–æ Owner‚Äô–∞ ‚Äî —É–ø–æ—Ä –Ω–∞ ROI, LTV, —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –≥–æ—Å—Ç–µ–π. –î–ª—è Billing –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ UI –ø–æ–∫–∞ –Ω–µ—Ç (–≤ —Ç–µ–∫—Å—Ç–∞—Ö).

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –≤ —Ä–∞–∑–¥–µ–ª–µ ‚ÄúBilling‚Äù –≤–∏–¥–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π Tenant Owner?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –°—Ç—Ä–∞–Ω–∏—Ü–∞ Billing –¥–ª—è Tenant Owner:
    - —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω + –ª–∏–º–∏—Ç—ã (—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –≥–æ—Å—Ç–∏);
    - –¥–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è, —Å—É–º–º–∞;
    - –∏—Å—Ç–æ—Ä–∏—è –∏–Ω–≤–æ–π—Å–æ–≤ (—Ç–∞–±–ª–∏—Ü–∞: –¥–∞—Ç–∞, –ø–ª–∞–Ω, —Å—É–º–º–∞, —Å—Ç–∞—Ç—É—Å, –∫–Ω–æ–ø–∫–∞ ‚Äú—Å–∫–∞—á–∞—Ç—å invoice‚Äù);
    - –∫–Ω–æ–ø–∫–∏: ‚Äú–∏–∑–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω‚Äù, ‚Äú–æ–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ‚Äù.

***

### 26. ActivityLog –¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í ActivityLog –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã —Å–æ–±—ã—Ç–∏—è: —Å–º–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞, start/end –ø–æ–¥–ø–∏—Å–∫–∏, cancelledby, reason, `subscriptionid, amount, paymentstatus`, `refund`, `chargeback`.

**–í–æ–ø—Ä–æ—Å:**
–•–æ—Ç–∏–º –ª–∏ **–∫–∞–∂–¥–æ–µ** –±–∏–ª–ª–∏–Ω–≥–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ ActivityLog, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ª—é–±—ã–µ —Å–ø–æ—Ä–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞, –¥–ª—è SUBSCRIPTION/BILLING –¥–µ–ª–∞–µ–º:
    - `SUBSCRIPTION_CREATED`, `SUBSCRIPTION_PLAN_CHANGED`, `SUBSCRIPTION_CANCELED`, `SUBSCRIPTION_EXPIRED`,
    - `PAYMENT_SUCCEEDED`, `PAYMENT_FAILED`, `REFUND_ISSUED`, `CHARGEBACK_RECEIVED`.
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–æ—Å–ª–µ–¥–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π Tenant‚Äô–∞.

***

### 27. –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è Churn

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Owner analytics: ‚ÄúChurn 7/30/90‚Äù, –Ω–æ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, —Å—á–∏—Ç–∞–µ–º –ª–∏ –∫–∞–∫ –æ—Ç—Ç–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ –∏–ª–∏ revenue.

**–í–æ–ø—Ä–æ—Å:**
Churn —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Ç–æ–∫–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–æ–≤** –∏–ª–∏ –∫–∞–∫ loss MRR (–æ—Ç—Ç–æ–∫ –≤—ã—Ä—É—á–∫–∏)?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –í–Ω—É—Ç—Ä–∏ Billing Analytics –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
    - –æ—Å–Ω–æ–≤–Ω–æ–π churn metric ‚Äî **MRR churn** (—Å–∫–æ–ª—å–∫–æ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π –≤—ã—Ä—É—á–∫–∏ —É—à–ª–æ);
    - –¥–æ–ø. –º–µ—Ç—Ä–∏–∫–∞ ‚Äî customer churn (–∫–æ–ª-–≤–æ —É—à–µ–¥—à–∏—Ö Tenant‚Äô–æ–≤).

***

## –ë–ª–æ–∫ 9. –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø –∫ Billing

### 28. –ö—Ç–æ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å Billing

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í —Ä–æ–ª–µ–≤–æ–π –º–æ–¥–µ–ª–∏ Owner ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫—Ç–æ –≤–ª–∞–¥–µ–µ—Ç account/subscriptions. RESTAURANTADMIN ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏, –Ω–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º.

**–í–æ–ø—Ä–æ—Å:**
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ª–∏, —á—Ç–æ —Ç–æ–ª—å–∫–æ User —Å —Ä–æ–ª—å—é **OWNER** –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–¥–µ–ª—É Billing (–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–æ–≤, –æ–ø–ª–∞—Ç, –∏–Ω–≤–æ–π—Å–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞)?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –î–∞:
    - —Ç–æ–ª—å–∫–æ `OWNER` –≤–∏–¥–∏—Ç/–º–µ–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –∏ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ;
    - –Ω–∏–∫–∞–∫–æ–π RestaurantAdmin/Manager/Cashier –Ω–µ –∏–º–µ–µ—Ç –∫ —ç—Ç–æ–º—É –¥–æ—Å—Ç—É–ø–∞;
    - –≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å granular permission `manage_billing`, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Ç–æ–ª—å–∫–æ Owner.

***

### 29. –ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ Billing

**–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**

- –í Analytics/Owner-—Ä–µ–ø–æ—Ä—Ç–∞—Ö –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã email/Telegram –æ—Ç—á—ë—Ç—ã (–ø–æ LTV, ROI –∏ —Ç.–ø.). –î–ª—è billing-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ª–æ–≥–∏–∫–∏ –Ω–µ—Ç.

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è Billing –¥–æ–ª–∂–Ω—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è Owner‚Äô—É:

- —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂,
- –Ω–µ—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂,
- –æ–∫–æ–Ω—á–∞–Ω–∏–µ trial,
- –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –∫–æ–Ω—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞,
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:
    - `PAYMENT_SUCCEEDED` ‚Äî email + (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Telegram;
    - `PAYMENT_FAILED` ‚Äî email + Telegram —Å—Ä–∞–∑—É;
    - `TRIAL_ENDING_IN_N_DAYS` (–Ω–∞–ø—Ä–∏–º–µ—Ä –∑–∞ 3 –¥–Ω—è);
    - `SUBSCRIPTION_EXPIRED` ‚Äî email;
    - `PLAN_CHANGED` ‚Äî email (–¥–ª—è –∞—É–¥–∏—Ç–∞).

***

### 30. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø—Ä–∏ EXPIRED/SUSPENDED

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ `EXPIRED` –∏ `SUSPENDED`, –∞ —á—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º?

**–ú–æ—ë –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–∏ `EXPIRED` (–Ω–µ –æ–ø–ª–∞—Ç–∏–ª–∏):
    - –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ–º POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö —á–µ–∫–æ–≤;
    - –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤;
    - –¥–æ—Å—Ç—É–ø –≤ Owner/Admin –ø–∞–Ω–µ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è read-only (–º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏ –æ–ø–ª–∞—Ç–∏—Ç—å).
- –ü—Ä–∏ `SUSPENDED` (fraud/chargeback):
    - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ–º —Å–∫—Ä—ã–≤–∞—Ç—å —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö/—ç–∫—Å–ø–æ—Ä—Ç until —Ä–∞–∑—Ä—É–ª–∏–º;
    - —Ç—Ä–µ–±—É–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞.

***

–ï—Å–ª–∏ —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç/–≥–ª—É–±–∏–Ω–∞ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç, –≤ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ —Ç—ã –º–æ–∂–µ—à—å:

- –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ –Ω–æ–º–µ—Ä–∞–º 1‚Äì30 –∏, –∫–∞–∫ —Å Loyalty, –æ—Ç–º–µ—Ç–∏—Ç—å:
    - ‚Äú–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä‚Äù / —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç (A/B/–° + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏);
- –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ–±–µ—Ä—É **–∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω Billing \& Subscriptions** (–º–æ–¥–µ–ª—å —Å—É—â–Ω–æ—Å—Ç–µ–π, —Å—Ç–∞—Ç—É—Å—ã, –ø–æ—Ç–æ–∫–∏), –∫–∞–∫ –º—ã —Å–¥–µ–ª–∞–ª–∏ –¥–ª—è Loyalty System.
<span style="display:none">[^7_1][^7_2][^7_3][^7_4]</span>

<div align="center">‚ÅÇ</div>

[^7_1]: Beseda-4.md

[^7_2]: Beseda-3.md

[^7_3]: Beseda-2.md

[^7_4]: Beseda-1.md


---

# –ò–∑—É—á–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ —Ñ–∞–π–ª—ã, –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç, –∫–∞–∂–¥–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä,. –ü–æ—Å–ª–µ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å—ã —É–∂–µ. –ü–æ–∫–∞ –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ –ø–æ–Ω—è–ª

–¢–µ–ø–µ—Ä—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ **Billing \& Subscriptions** —É–∂–µ —Å —É—á—ë—Ç–æ–º –≤—Å–µ–≥–æ, —á—Ç–æ –µ—Å—Ç—å –≤ Beseda‚Äë1/2/3 –∏ POLNAIa‚ÄëSTRUKTURA (–Ω–∏—á–µ–≥–æ –∏–∑ —É–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–µ –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞—é: 6 —Ç–∞—Ä–∏—Ñ–æ–≤, TenantLimits, —Å—É—â–Ω–æ—Å—Ç–∏ Subscription/Payment/Invoice, MRR/Churn/Refund/Chargeback, ActivityLog –∏ —Ç.–¥.).

–û—Ç–≤–µ—Ç–∏—Ç—å –º–æ–∂–Ω–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
`1. –≤–∞—Ä–∏–∞–Ω—Ç/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π` –∫–∞–∫ —Ç—ã –¥–µ–ª–∞–ª –¥–ª—è Loyalty.

***

## –ë–ª–æ–∫ 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ –ø–ª–∞–Ω—ã (—á—Ç–æ —É–∂–µ –µ—Å—Ç—å + —É—Ç–æ—á–Ω–µ–Ω–∏—è)

### 1. –ú–æ–¥–µ–ª—å –±–∏–ª–ª–∏–Ω–≥–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ Tenant

–ò–∑ —Ñ–∞–π–ª–æ–≤ —É–∂–µ —è–≤–Ω–æ:

- –ï—Å—Ç—å `Tenant`, `SubscriptionPlan`, `Subscription`, `BillingInfo`, `TenantLimits`.
- –õ–∏–º–∏—Ç—ã:
    - Standard: 1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω, 5000 –≥–æ—Å—Ç–µ–π
    - Medium: 3 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞, 2000 –≥–æ—Å—Ç–µ–π
    - Pro: 5 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, 6000 –≥–æ—Å—Ç–µ–π
    - Ultimate: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ (maxrestaurants=‚àû, maxguests=100000 –≤ –ø—Ä–∏–º–µ—Ä–µ)
    - Free –∏ Custom ‚Äî –æ—Å–æ–±—ã–µ –∫–µ–π—Å—ã.
- TenantLimits –∂—ë—Å—Ç–∫–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ `checkGuestLimit` (ForbiddenException + warning –Ω–∞ 90%).

**–í–æ–ø—Ä–æ—Å 1.** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º, —á—Ç–æ **–µ–¥–∏–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤—Å–µ–≥–¥–∞ Tenant (Owner account)**:

- –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫ ‚Äú–Ω–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω‚Äù, —Ç–æ–ª—å–∫–æ –Ω–∞ Tenant –≤ —Ü–µ–ª–æ–º,
- –≤—Å–µ –ª–∏–º–∏—Ç—ã –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º –∏ –≥–æ—Å—Ç—è–º –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `TenantLimits` —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞.

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –¥–∞, –≤—Å–µ–≥–¥–∞ –±–∏–ª–ª–∏–º Tenant, –∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã/–≥–æ—Å—Ç–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.

***

### 2. –°–µ–º–µ–π—Å—Ç–≤–æ –ø–ª–∞–Ω–æ–≤ –∏ Custom

–ò–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

- 6 —Ç–∞—Ä–∏—Ñ–æ–≤: Free, Standard, Medium, Pro, Ultimate, Custom.
- –¢–∞–±–ª–∏—Ü–∞ —Å –ª–∏–º–∏—Ç–∞–º–∏ + —Ü–µ–Ω–∞–º–∏ –¥–ª—è Owner (—Ä–∞–∑–¥–µ–ª OWNER analytics, —Ç–∞—Ä–∏—Ñ—ã –ø–æ–¥ MRR/Churn).
- Custom –≤ —Ç–µ–∫—Å—Ç–∞—Ö: ‚Äú–ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–π, –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Å —Ü–µ–Ω–æ–π, –∫–æ—Ç–æ—Ä–∞—è —Ç–æ–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è‚Äù.

**–í–æ–ø—Ä–æ—Å 2.** –ö–∞–∫ –∏–º–µ–Ω–Ω–æ –≤–∏–¥–∏—à—å **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Custom**:

A) –û–¥–∏–Ω –æ–±—â–∏–π `SubscriptionPlan` —Å —Ç–∏–ø–æ–º CUSTOM, –∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ª–∏–º–∏—Ç—ã/—Ü–µ–Ω–∞) –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ –ø–æ–ª—è—Ö —Å–∞–º–æ–≥–æ `Subscription` –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ Tenant.
B) –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—ã–π `SubscriptionPlan` c type=CUSTOM + —Å–≤–æ–∏–º–∏ –ø–æ–ª—è–º–∏ (–ª–∏–º–∏—Ç—ã, —Ü–µ–Ω—ã).

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: **B** ‚Äî –æ–¥–∏–Ω Tenant ‚Üí –æ–¥–∏–Ω —Å–≤–æ–π CASTOM‚Äëplan, —á—Ç–æ–±—ã:

- –±—ã–ª–æ –≤–∏–¥–Ω–æ ‚Äú–∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ç–∞—Ä–∏—Ñ‚Äù —É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞,
- Owner analytics –º–æ–≥ —Å—á–∏—Ç–∞—Ç—å MRR –ø–æ ‚Äú—Å–µ–º–µ–π—Å—Ç–≤—É –∫–∞—Å—Ç–æ–º–æ–≤‚Äù –æ—Ç–¥–µ–ª—å–Ω–æ.

***

### 3. –ß—Ç–æ –¥–∞—ë—Ç –ø–ª–∞–Ω –ø–æ–º–∏–º–æ –ª–∏–º–∏—Ç–æ–≤

–ò–∑ —Ñ–∞–π–ª–æ–≤ –≤–∏–¥–Ω–æ:

- –î–ª—è OWNER analytics —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã (Standard/Medium/Pro/Ultimate/Custom).
- –î–ª—è RestaurantAdmin analytics —Ç–æ–∂–µ –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–ª–∞–Ω–∞–º (—É –∫–æ–≥–æ –∫–∞–∫–∏–µ –æ—Ç—á—ë—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã).
- –ü—Ä–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ (POS, Telegram, advanced analytics) —Ç–æ–ª—å–∫–æ –Ω–∞–º—ë–∫–∏:
    - Free –ø–ª–∞–Ω ‚Äú—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü‚Äù –∏ ‚Äú–æ–≥—Ä–∞–Ω–∏—á–µ–Ω‚Äù (–Ω–æ —á–µ–º –∏–º–µ–Ω–Ω–æ ‚Äî –Ω–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–æ).
    - –í —Ä–∞–∑–¥–µ–ª–µ OWNER‚Äì7.5: Standard/Medium/Pro –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –æ—Ç—á—ë—Ç–æ–≤ (X/Y/N –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º).

**–í–æ–ø—Ä–æ—Å 3.** –•–æ—á–µ—à—å –ª–∏ **—Ä–µ–∞–ª—å–Ω–æ —Ä–µ–∑–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ –ø–ª–∞–Ω–∞–º**, –∫—Ä–æ–º–µ –ª–∏–º–∏—Ç–æ–≤?

–ù–∞–ø—Ä–∏–º–µ—Ä:

- Free:
    - –±–µ–∑ POS‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏,
    - –±–µ–∑ advanced analytics (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã –ø–æ –≥–æ—Å—Ç—è–º),
    - –±–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–º–æ.
- Standard/Medium:
    - –µ—Å—Ç—å POS –∏ –±–∞–∑–æ–≤–∞—è analytics,
    - –Ω–æ –Ω–µ—Ç —á–∞—Å—Ç–∏ ‚Äú–≥–ª—É–±–æ–∫–∏—Ö‚Äù –æ—Ç—á—ë—Ç–æ–≤ (LTV, ROI –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º).
- Pro/Ultimate/Custom:
    - –≤—Å—ë –≤–∫–ª—é—á–µ–Ω–æ (Telegram bot, –≤—Å–µ —Ä–µ–ø–æ—Ä—Ç—ã, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∞–∫—Ü–∏–π –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π).

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –¥–∞, –≤ `SubscriptionPlan` –∫—Ä–æ–º–µ –ª–∏–º–∏—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥–∏:

- `include_pos`, `include_advanced_analytics`, `include_telegram_bot`, `max_loyalty_rules`, `max_promos` –∏ —Ç.–ø.

–ß—Ç–æ–±—ã UX –±—ã–ª —á–µ—Å—Ç–Ω—ã–º –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º: ‚Äú–í—ã –Ω–∞ Standard ‚Üí –≤–æ—Ç –∫–∞–∫–∏–µ —Ñ–∏—á–∏ –¥–æ—Å—Ç—É–ø–Ω—ã‚Äù.

***

## –ë–ª–æ–∫ 2. –ü–µ—Ä–∏–æ–¥—ã, trial –∏ —Å—Ç–∞—Ä—Ç/–æ–∫–æ–Ω—á–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

### 4. –ü–æ–¥–ø–∏—Å–æ—á–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã

–ò–∑ —Ñ–∞–π–ª–æ–≤:

- –ß—ë—Ç–∫–æ: ‚Äú–ü–æ–¥–ø–∏—Å–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ—Å—è—á–Ω–∞—è –ª–∏–±–æ –≥–æ–¥–æ–≤–∞—è. –ü—Ä–∏ –≥–æ–¥–æ–≤–æ–π –∏–¥—ë—Ç —Å–∫–∏–¥–∫–∞ 20%‚Äù.

**–í–æ–ø—Ä–æ—Å 4.** –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–≤–∞ —Ç–∏–ø–∞:

- `MONTHLY` (1 –º–µ—Å—è—Ü)
- `YEARLY` (12 –º–µ—Å—è—Ü–µ–≤, —Ü–µ–Ω–∞ = 0.8 * 12 * monthly)?

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –¥–∞, **—Ç–æ–ª—å–∫–æ MONTHLY/YEARLY** –±–µ–∑ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–º–µ–Ω—É –ø–ª–∞–Ω–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É.

***

### 5. Trial

–í POLNAIa‚Äë—Å—Ç—Ä—É–∫—Ç—É—Ä–µ trial –ø—Ä—è–º–æ –Ω–µ —Ä–∞—Å–ø–∏—Å–∞–Ω, –Ω–æ –º–Ω–æ–≥–æ –≥–æ–≤–æ—Ä–∏—Ç—Å—è –æ ‚Äú–ø–æ–¥–ø–∏—Å–∫–µ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏‚Äù.

**–í–æ–ø—Ä–æ—Å 5.** –ù—É–∂–µ–Ω –ª–∏ **–æ—Ç–¥–µ–ª—å–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π trial** –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤, –∫—Ä–æ–º–µ Free:

- –Ω–∞–ø—Ä–∏–º–µ—Ä, 14 –¥–Ω–µ–π Standard/Pro –±–µ–∑ –≤–≤–æ–¥–∞ –∫–∞—Ä—Ç—ã,
- –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ Free –∏ —É–∂–µ –æ—Ç—Ç—É–¥–∞ –∞–ø–≥—Ä–µ–π–¥–∏—Ç—Å—è?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- Free = ‚Äú–≤–µ—á–Ω—ã–π –±–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω‚Äù (–∂—ë—Å—Ç–∫–æ —É—Ä–µ–∑–∞–Ω–Ω—ã–π, –Ω–æ —Ä–∞–±–æ—á–∏–π).
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: optional trial 14 –¥–Ω–µ–π Standard –±–µ–∑ –∫–∞—Ä—Ç—ã ‚Äî –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–Ω–∏–∑–∏—Ç—å friction.

–ï—Å–ª–∏ trial –Ω—É–∂–µ–Ω, —Å—Ä–∞–∑—É —Ä–µ—à–∏–º:

- –¥–ª–∏–Ω–∞ (7/14/30 –¥–Ω–µ–π),
- –Ω–∞ –∫–∞–∫–æ–π –ø–ª–∞–Ω (Standard –∏–ª–∏ –ª—é–±–æ–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π),
- —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏: –∞–≤—Ç–æ‚Äë–ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ Free –∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤–≤–µ—Å—Ç–∏ –∫–∞—Ä—Ç—É.

***

### 6. –ú–æ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

–õ–æ–≥–∏–∫–∞ —Å–µ–π—á–∞—Å:

- Owner —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è, –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ (Standard/Medium/Pro/Ultimate/Custom),
- –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è Stripe/YooKassa (—É–ø–æ–º—è–Ω—É—Ç–æ –≤ Beseda‚Äë2),
- –µ—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ Subscription/SubscriptionHistory/Payment/Invoice.

**–í–æ–ø—Ä–æ—Å 6.** –ö–∞–∫ —Å—á–∏—Ç–∞–µ–º **start_date/end_date** –¥–ª—è Subscription:

A) `start_date` = –º–æ–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (–∏–ª–∏ —Å—Ç–∞—Ä—Ç–∞ trial), `end_date` = `start_date + period`.
B) –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º tutto –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–º –º–µ—Å—è—Ü–∞–º (1‚Äë–µ —á–∏—Å–ª–æ ‚Äî 1‚Äë–µ —á–∏—Å–ª–æ).

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: **A** ‚Äî –æ—Ç –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã, –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é, –ø—Ä–æ—â–µ –∏ —á–µ—Å—Ç–Ω–µ–µ.

***

## –ë–ª–æ–∫ 3. –°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ –æ–ø–ª–∞—Ç—ã

### 7. –ù–∞–±–æ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ Subscription

–ò–∑ ActivityLog:

- –ø–∏—à—É—Ç—Å—è `tariff`, `subscriptionstart`, `subscriptionend`, `oldtariff`, `newtariff`, `cancelledby`, `reason`, `subscriptionid, amount, paymentstatus`.
- –î–ª—è Payment —è–≤–Ω–æ –µ—Å—Ç—å —Å—Ç–∞—Ç—É—Å—ã `Success, Failed, Pending, Refunded, Chargeback`.

–ù–æ —Å—Ç–∞—Ç—É—Å—ã —Å–∞–º–æ–π Subscription –µ—â—ë –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã.

**–í–æ–ø—Ä–æ—Å 7.** –£—Ç–≤–µ—Ä–¥–∏–º –ª–∏ —Ç–∞–∫–æ–π –Ω–∞–±–æ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏:

- `TRIALING` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π trial.
- `ACTIVE` ‚Äî –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤ —Å–∏–ª–µ.
- `PAST_DUE` ‚Äî –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ—à–ª–æ, –Ω–æ –µ—â—ë grace.
- `CANCELLED` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª, –¥–æ –∫–æ–Ω—Ü–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.
- `EXPIRED` ‚Äî –ø–µ—Ä–∏–æ–¥ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –ø—Ä–æ–¥–ª–µ–Ω–∏—è –Ω–µ—Ç (–∏–ª–∏ trial –∏—Å—Ç—ë–∫).
- `SUSPENDED` ‚Äî –º—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–º–æ—Ä–æ–∑–∏–ª–∏ (fraud, chargeback).

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ 6 —Å—Ç–∞—Ç—É—Å–æ–≤.

***

### 8. Grace period –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ–ø–ª–∞—Ç–µ

–í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö grace –¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞ –Ω–µ –æ–ø–∏—Å–∞–Ω, –Ω–æ –¥–ª—è –ª–∏–º–∏—Ç–∞ –≥–æ—Å—Ç–µ–π –µ—Å—Ç—å ‚Äú90% ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ‚Äù.

**–í–æ–ø—Ä–æ—Å 8.** –ö–∞–∫–æ–π **grace period** –¥–∞—ë–º –ø–æ—Å–ª–µ –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏—è:

A) 0 –¥–Ω–µ–π ‚Äî —Å—Ä–∞–∑—É EXPIRED, –≤—Å—ë —Ä–µ–∂–µ–º.
B) 3 –¥–Ω—è.
C) 7 –¥–Ω–µ–π.
D) –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç.

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: **7 –¥–Ω–µ–π**:

- –ø–æ–¥–ø–∏—Å–∫–∞ –≤ —Å—Ç–∞—Ç—É—Å–µ `PAST_DUE`,
- —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ —Ä–µ–∂–µ–º,
- –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º Owner —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (email +, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, Telegram),
- –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—Ç—Ä–∞–µ–≤ —Å–ø–∏—Å–∞–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ —ç—Ç–∏—Ö 7 –¥–Ω–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–µ–Ω—å 1/3/7).

***

### 9. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è grace

**–í–æ–ø—Ä–æ—Å 9.** –ß—Ç–æ –¥–µ–ª–∞–µ–º –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ grace, –µ—Å–ª–∏ —Ç–∞–∫ –∏ –Ω–µ –æ–ø–ª–∞—Ç–∏–ª–∏:

- –ø–µ—Ä–µ–≤–æ–¥–∏–º Subscription –≤ `EXPIRED`,
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º Tenant –Ω–∞ **Free –ø–ª–∞–Ω**,
- —á—Ç–æ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –æ—Ç–∫–ª—é—á–∞–µ–º –∂—ë—Å—Ç–∫–æ?

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:

- EXPIRED:
    - –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤,
    - POS‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è,
    - Owner/Admin –≤—Å—ë –µ—â—ë –º–æ–≥—É—Ç –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –ø–∞–Ω–µ–ª—å **read‚Äëonly**, –≤–∏–¥–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –æ–ø–ª–∞—Ç–∏—Ç—å.

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏/—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π.

***

## –ë–ª–æ–∫ 4. Upgrade / downgrade / —Å–º–µ–Ω–∞ –ø–µ—Ä–∏–æ–¥–æ–≤

### 10. Upgrade –ø–æ—Å—Ä–µ–¥–∏ –ø–µ—Ä–∏–æ–¥–∞ (–ø—Ä–æ—Ä–µ–π—Ç)

–í —Ñ–∞–π–ª–∞—Ö –ø—Ä–æ Billing/Analytics –µ—Å—Ç—å MRR/Churn/Refund/Chargeback, –Ω–æ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å upgrade.

**–í–æ–ø—Ä–æ—Å 10.** –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å –±–æ–ª–µ–µ –¥–µ—à—ë–≤–æ–≥–æ –ø–ª–∞–Ω–∞ –Ω–∞ –±–æ–ª–µ–µ –¥–æ—Ä–æ–≥–æ–π **–≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –ø–µ—Ä–∏–æ–¥–∞**:

- –¥–µ–ª–∞–µ–º –ª–∏ **–ø—Ä–æ—Ä–µ–π—Ç** (–∫—Ä–µ–¥–∏—Ç –∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é —á–∞—Å—Ç—å —Å—Ç–∞—Ä–æ–≥–æ –ø–ª–∞–Ω–∞ + –¥–æ–ø–ª–∞—Ç–∞ –∑–∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–Ω–∏ –Ω–æ–≤–æ–≥–æ),
- –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –ø–æ–ª–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (—Å—Ç–∞—Ä—ã–π ‚Äú—Å–≥–æ—Ä–∞–µ—Ç‚Äù)?

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π prorate:

- Day‚Äëbased:
    - `credit = unused_days_old_plan * daily_price_old`,
    - `charge = remaining_days_new_plan * daily_price_new - credit`.
- –í—Å–µ –¥–µ—Ç–∞–ª–∏ –ª–æ–≥–∏—Ä—É–µ–º –≤ Invoice + ActivityLog.

***

### 11. Downgrade –ø–æ—Å—Ä–µ–¥–∏ –ø–µ—Ä–∏–æ–¥–∞

**–í–æ–ø—Ä–æ—Å 11.** –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å –±–æ–ª–µ–µ –¥–æ—Ä–æ–≥–æ–≥–æ –ø–ª–∞–Ω–∞ –Ω–∞ –±–æ–ª–µ–µ –¥–µ—à—ë–≤—ã–π:

A) –ü—Ä–∏–º–µ–Ω—è–µ–º downgrade —Å—Ä–∞–∑—É, —Å —á–∞—Å—Ç–∏—á–Ω—ã–º –≤–æ–∑–≤—Ä–∞—Ç–æ–º (—Å–ª–æ–∂–Ω–µ–µ).
B) –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É **—Å –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞**, –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤.

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: **B** ‚Äî downgrade –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π:

- –¥–æ –∫–æ–Ω—Ü–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä–æ–º –ø–ª–∞–Ω–µ,
- —Å–ª–µ–¥—É—é—â–∏–π –ø–µ—Ä–∏–æ–¥ –±–∏–ª–ª–∏—Ç—Å—è —É–∂–µ –ø–æ –Ω–æ–≤–æ–º—É (–¥–µ—à–µ–≤–æ–º—É).

***

### 12. –°–º–µ–Ω–∞ –ø–µ—Ä–∏–æ–¥–∞ Monthly ‚Üî Yearly

–°–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ —Å–∫–∏–¥–∫–∞ 20% –Ω–∞ –≥–æ–¥, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –Ω–µ –æ–ø–∏—Å–∞–Ω–æ.

**–í–æ–ø—Ä–æ—Å 12.** –ö–∞–∫ –≤–µ—Å—Ç–∏ —Å–µ–±—è:

- Monthly ‚Üí Yearly:
    - —Å—á–∏—Ç–∞–µ–º –∫—Ä–µ–¥–∏—Ç –∑–∞ –æ—Å—Ç–∞—Ç–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –∏ —É–º–µ–Ω—å—à–∞–µ–º –∏–º –ø–µ—Ä–≤—ã–π –≥–æ–¥–æ–≤–æ–π invoice, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –≥–æ–¥ —Å—Ä–∞–∑—É ‚Äú—Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞‚Äù?
- Yearly ‚Üí Monthly:
    - —Ä–∞–∑—Ä–µ—à–∞–µ–º –ª–∏ ‚Äú—Ä–∞–∑–±–∏—Ç—å –≥–æ–¥–æ–≤–æ–π‚Äù –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –≥–æ–¥–∞, –∏–ª–∏ –¥–∞—ë–º —Å–º–µ–Ω—É —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞?

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:

- Monthly ‚Üí Yearly: –∫–∞–∫ upgrade + prorate (—Å–º. –≤–æ–ø—Ä–æ—Å 10).
- Yearly ‚Üí Monthly:
    - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–º–µ–Ω–∞ —Ç–æ–ª—å–∫–æ **—Å –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞** (–±–µ–∑ –∞–≤—Ç–æ—Ä–µ—Ñ–∞–Ω–¥–æ–≤),
    - –¥–æ—Å—Ä–æ—á–Ω—ã–π —Ä–∞–∑—Ä—ã–≤ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∞–ø–ø–æ—Ä—Ç —Å —Ä—É—á–Ω—ã–º `Refund`.

***

### 13. Downgrade –∏ –ª–∏–º–∏—Ç—ã TenantLimits

–ö–æ–¥ `checkGuestLimit` —É–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç ‚Äúhard limit‚Äù –ø–æ –≥–æ—Å—Ç—è–º; –ª–∏–º–∏—Ç—ã –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º —Ç–æ–∂–µ –∑–∞–¥–∞–Ω—ã.

**–í–æ–ø—Ä–æ—Å 13.** –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ç–∞—Ä–∏—Ñ —Å –º–µ–Ω—å—à–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ (–ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º/–≥–æ—Å—Ç—è–º), –µ—Å–ª–∏ Tenant **—É–∂–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç** —ç—Ç–∏ –ª–∏–º–∏—Ç—ã:

- –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ downgrade,
- –∏–ª–∏ –≤—Å—ë –∂–µ –¥–∞—ë–º —É–π—Ç–∏, –∞ ‚Äú–ª–∏—à–Ω–∏–µ‚Äù —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã/–≥–æ—Å—Ç–∏ –∫–∞–∫‚Äë—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ–º/–ø—Ä—è—á–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: **–∂—ë—Å—Ç–∫–æ –Ω–µ –¥–∞—ë–º** –ø—Ä–∏–º–µ–Ω–∏—Ç—å downgrade, –ø–æ–∫–∞:

- `restaurants_count <= new_plan.maxrestaurants`,
- `activeGuestsCount <= new_plan.maxguests`.

–í UI —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –Ω—É–∂–Ω–æ ‚Äú—Å–∂–∞—Ç—å—Å—è –¥–æ –ª–∏–º–∏—Ç–æ–≤‚Äù.

***

## –ë–ª–æ–∫ 5. Free –ø–ª–∞–Ω, trial –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### 14. –°–º—ã—Å–ª Free –ø–ª–∞–Ω–∞

–ò–∑ –æ–ø–∏—Å–∞–Ω–∏—è:

- Free ‚Äú–ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞‚Äù (Owner‚Äë–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã),
- –Ω–æ –≤ –±–æ–ª–µ–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö —Ç—ã –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ Free ‚Äî —ç—Ç–æ —Ç–∞—Ä–∏—Ñ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å –ª–∏–º–∏—Ç–∞–º–∏ (1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –º–∞–ª—ã–π –æ–±—ä—ë–º –≥–æ—Å—Ç–µ–π).

–ù—É–∂–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å.

**–í–æ–ø—Ä–æ—Å 14.** –ö–∞–∫ —Å–µ–π—á–∞—Å –≤–∏–¥–∏—à—å **Free**:

A) –≠—Ç–æ —á–∏—Å—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –ø–ª–∞–Ω **—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ Owner**, –Ω–µ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤.
B) –≠—Ç–æ **–±–æ–µ–≤–æ–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ** –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤: 1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –≥–æ—Å—Ç–µ–π, —É—Ä–µ–∑–∞–Ω–Ω—ã–µ —Ñ–∏—á–∏.
C) –ò —Ç–æ, –∏ –¥—Ä—É–≥–æ–µ, –Ω–æ –ø–æ–¥ —Ä–∞–∑–Ω—ã–º–∏ ‚Äú—Ç–∏–ø–∞–º–∏‚Äù Free.

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: **B** ‚Äî Free = –±–æ–µ–≤–æ–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤:

- 1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≥–æ—Å—Ç—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 500),
- –±–µ–∑ POS, –±–µ–∑ advanced analytics, c –ø—Ä–æ—Å—Ç–µ–π—à–µ–π loyalty,
- —á—Ç–æ–±—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω –º–æ–≥ –Ω–∞—á–∞—Ç—å –±–µ–∑ –æ–ø–ª–∞—Ç—ã.

–û—Ä–∏–µ–Ω—Ç–∏—Ä—É—è—Å—å –Ω–∞ —ç—Ç–æ, –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º —É–∂–µ –≥–æ–≤–æ—Ä–∏—Ç—å, –Ω—É–∂–µ–Ω –ª–∏ –µ—â—ë ‚Äútech Free‚Äù —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

***

### 15. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Free

–¢–µ–∫—Å—Ç—ã –¥–∞—é—Ç –Ω–∞–º—ë–∫–∏ (–º–µ–Ω–µ–µ –ø–æ–ª–Ω—ã–π analytics, –º–µ–Ω—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π), –Ω–æ –±–∏—Ä–∫–∏ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã.

**–í–æ–ø—Ä–æ—Å 15.** –ö–∞–∫–∏–µ —Ñ–∏—á–∏ **—Ç–æ—á–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã** –Ω–∞ Free:

- POS‚Äë–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (iiko/R‚ÄëKeeper)?
- Telegram‚Äë–±–æ—Ç/–º–∏–Ω–∏‚Äë–∞–ø–ø?
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å–ª–æ–∂–Ω—ã—Ö –∞–∫—Ü–∏–π (–∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–æ–º–æ, —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏)?
- Advanced analytics (LTV, ROI, segmentation, –æ—Ç—á—ë—Ç—ã OWNER/RestaurantAdmin –≤ –ø–æ–ª–Ω–æ–º –≤–∏–¥–µ)?

–ó–¥–µ—Å—å —É–¥–æ–±–Ω–æ –ø—Ä—è–º —Å–ø–∏—Å–∫–æ–º ‚Äú–Ω–∞ Free –∑–∞–ø—Ä–µ—â–µ–Ω–æ X, Y, Z‚Äù.

***

## –ë–ª–æ–∫ 6. Payments / Invoice / Refund / Chargeback

### 16. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Invoice –∏ Payment

–ò–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

- —Å—É—â–Ω–æ—Å—Ç–∏: `SubscriptionPlan, Subscription, SubscriptionHistory, BillingInfo, Payment, Invoice`,
- –≤ analytics: —Å—Ç–∞—Ç—ã –ø–æ `Success, Failed, Pending, Refunded, Chargeback`,
- Owner‚Äë–¥–µ—à–±–æ—Ä–¥: MRR, Churn, Refund, Chargeback, ‚Äú3 —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–∞: 7/30/90‚Äù.

**–í–æ–ø—Ä–æ—Å 16.** –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π:

- `Invoice`:
    - tenant_id, subscription_id, period_start, period_end,
    - amount_net, tax_amount, amount_gross, currency,
    - status: DRAFT, OPEN, PAID, VOID, REFUNDED,
    - `provider_invoice_id` / `hosted_invoice_url`.
- `Payment`:
    - invoice_id, provider, provider_payment_id,
    - amount, currency, status: PENDING, SUCCEEDED, FAILED, REFUNDED, CHARGEBACK,
    - error_code/error_message.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∫–∞–∫–∏–µ‚Äë—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–ò–ù–ù, —é—Ä–ª–∏—Ü–æ, –¥–æ–ø. —Ä–µ–∫–≤–∏–∑–∏—Ç—ã) ‚Äî –¥–æ–±–∞–≤—å.

***

### 17. Self‚Äëservice refund vs —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∞–ø–ø–æ—Ä—Ç

–ò–∑ POLNAIa:

- Owner analytics —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚Äúrefund‚Äù, ‚Äúchargeback‚Äù, ‚Äúpending‚Äù, —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV/Excel.
- –ù–æ –Ω–µ—Ç —Ä–µ—à–µ–Ω–∏—è: –º–æ–∂–µ—Ç –ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å–∞–º –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å refund.

**–í–æ–ø—Ä–æ—Å 17.** –ù—É–∂–µ–Ω –ª–∏ self‚Äëservice refund:

A) –ù–µ—Ç, —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ **–Ω–∞—à** –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π Admin‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (support).
B) –î–∞, Owner —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å ‚Äú–û—Ç–º–µ–Ω–∏—Ç—å –æ–ø–ª–∞—Ç—É / –∑–∞–ø—Ä–æ—Å–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç‚Äù –≤ Billing.

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –Ω–∞ —Å—Ç–∞—Ä—Ç–µ **A**:

- –º–µ–Ω—å—à–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π,
- –ø—Ä–æ—â–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge‚Äë–∫–µ–π—Å–æ–≤ –∏ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º.

***

### 18. Chargeback ‚Üí –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

–í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö chargeback —Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö, –Ω–æ –Ω–µ—Ç –±–∏–∑–Ω–µ—Å‚Äë—Ä–µ–∞–∫—Ü–∏–∏.

**–í–æ–ø—Ä–æ—Å 18.** –ü—Ä–∏ chargeback –æ—Ç –±–∞–Ω–∫–æ–º:

- —Å—Ä–∞–∑—É –ø–µ—Ä–µ–≤–æ–¥–∏–º Subscription –≤ `SUSPENDED`?
- –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—á–∞–µ–º –ø–ª–∞—Ç—ë–∂ –∏ –∂–¥—ë–º —Ä—É—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è?

–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:

- auto: `Payment.status = CHARGEBACK`, Subscription ‚Üí `SUSPENDED`,
- Owner –ø–æ–ª—É—á–∞–µ—Ç –∂—ë—Å—Ç–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ,
- —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–∞–∫ –ø—Ä–∏ EXPIRED (–¥–∞–∂–µ —Å—Ç—Ä–æ–∂–µ), –ø–æ–∫–∞ support –Ω–µ —Ä–µ—à–∏—Ç.

***

## –ë–ª–æ–∫ 7. –î–æ—Å—Ç—É–ø –∫ Billing, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 19. –ö—Ç–æ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å Billing

–ò–∑ —Ä–æ–ª–µ–π:

- Owner (Tenant Owner) ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç account/subscriptions,
- RestaurantAdmin/Manager/Cashier –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø—Ä—è–º—ã—Ö –ø—Ä–∞–≤ –Ω–∞ Billing –≤ —Ç–µ–∫—Å—Ç–∞—Ö –Ω–µ –ø–æ–ª—É—á–∞—é—Ç.

**–í–æ–ø—Ä–æ—Å 19.** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º:

- —Ç–æ–ª—å–∫–æ User c —Ä–æ–ª—å—é OWNER –≤–∏–¥–∏—Ç:
    - –ø–ª–∞–Ω, –ª–∏–º–∏—Ç—ã,
    - –∏—Å—Ç–æ—Ä–∏—é –∏–Ω–≤–æ–π—Å–æ–≤ –∏ –æ–ø–ª–∞—Ç,
    - –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–ª–∞–Ω –∏ –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ,
    - –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?

–¢.–µ. –¥–ª—è RestaurantAdmin (—É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º/—Å–µ—Ç—å—é) Billing‚Äë—Ä–∞–∑–¥–µ–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?

***

### 20. Billing‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–µ–π—á–∞—Å –≤ Analytics/Owner –µ—Å—Ç—å —Ä–∞—Å—Å—ã–ª–∫–∏ –æ—Ç—á—ë—Ç–æ–≤ (PDF/Excel). –î–ª—è Billing‚Äë—Å–æ–±—ã—Ç–∏–π –ª–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –æ–ø–∏—Å–∞–Ω–∞.

**–í–æ–ø—Ä–æ—Å 20.** –ü—Ä–∏ –∫–∞–∫–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** —à–ª—ë–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Owner‚Äô—É:

- —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂,
- –Ω–µ—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂/–æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞,
- –ø–µ—Ä–µ—Ö–æ–¥ –≤ PAST_DUE,
- –æ–∫–æ–Ω—á–∞–Ω–∏–µ trial (–µ—Å–ª–∏ –±—É–¥–µ—Ç),
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ (upgrade/downgrade/cancel),
- EXPIRED/SUSPENDED?

–ò –∫–∞–∫–∏–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ **—Ç–æ—á–Ω–æ**: email –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, Telegram ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é, –µ—â—ë —á—Ç–æ‚Äë—Ç–æ?

***

–ï—Å–ª–∏ —ç—Ç–∏ 20 –≤–æ–ø—Ä–æ—Å–æ–≤ —É—Å—Ç—Ä–æ—è—Ç –ø–æ —Ñ–æ—Ä–º–∞—Ç—É, –º–æ–∂–µ—à—å:

- –æ—Ç–º–µ—Ç–∏—Ç—å –ø–æ –∫–∞–∂–¥–æ–º—É: ‚Äú–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –≤—ã–±–æ—Ä‚Äù / ‚Äú–≤–∞—Ä–∏–∞–Ω—Ç X‚Äù / —Å–≤–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π;
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–ø–∏—Å–∞—Ç—å –Ω—é–∞–Ω—Å—ã (–æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ Free, trial, cut‚Äëoff —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∏ downgrade/upgrade).

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ–±–µ—Ä—É —É–∂–µ **–∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é Billing \& Subscriptions** (–∫–∞–∫ –º—ã —Å–¥–µ–ª–∞–ª–∏ –¥–ª—è Loyalty), –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏ —Å —É–≤—è–∑–∫–æ–π —Å —Ç–µ–º, —á—Ç–æ —É–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ Beseda‚Äë—Ñ–∞–π–ª–∞—Ö.
<span style="display:none">[^8_1][^8_2][^8_3][^8_4]</span>

<div align="center">‚ÅÇ</div>

[^8_1]: Beseda-4.md

[^8_2]: Beseda-3.md

[^8_3]: Beseda-2.md

[^8_4]: Beseda-1.md

