<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>
–ò–∑—É—á–∏ –≤—Å–µ –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω–æ, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏ —á–µ—Ç–∫–æ, –≤—Å–µ 5 –¥–∏–∞–ª–æ–≥–æ–≤, –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–∞—Ö, –∫–∞–∂–¥–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä. –ó–∞–ª–æ–∂–∏ –Ω–∞ —ç—Ç–æ –≤—Ä–µ–º—è –∏ —Å–∏–ª—ã, —á—Ç–æ–±—ã —Ç—ã –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –≤—Å–µ –ø–æ–Ω–∏–º–∞–ª –¥–æ –º–µ–ª—å—á–∞–π—à–∏—Ö –¥–µ—Ç–∞–ª–µ–π, –±–µ–∑ –æ—à–∏–±–æ–∫. –ü–æ—Å–ª–µ –≤—ã–±–µ—Ä–µ–º –±–ª–æ–∫ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏.

–ò–∑ –≤—Å–µ—Ö 5 –±–µ—Å–µ–¥ –∫–∞—Ä—Ç–∏–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª–æ–∂–∏–ª–∞—Å—å, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Å —É—á—ë—Ç–æ–º –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É—Ç–æ—á–Ω–µ–Ω–∏–π –∏–∑ ¬´–ë–µ—Å–µ–¥—ã 5¬ª. –í—Å–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º–∏ –∏ –Ω–æ–≤—ã–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏ —Å–Ω—è—Ç—ã, —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã.

–ö–æ—Ä–æ—Ç–∫–æ, —á—Ç–æ —Å–µ–π—á–∞—Å —É–∂–µ **–∂—ë—Å—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ**:

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**
    - Multi-tenant SaaS: `Tenant` = –∞–∫–∫–∞—É–Ω—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏, pooled –ë–î —Å `tenant_id`.
    - –†–æ–ª–∏: **Owner ‚Üí Restaurant Admin ‚Üí Manager ‚Üí Cashier ‚Üí Guest** + –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ permissions.
    - –¢–∞—Ä–∏—Ñ—ã: Free, Standard, Medium, Pro, Ultimate, Custom —Å –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º –∏ –≥–æ—Å—Ç—è–º, —Å–∫–∏–¥–∫–∞ 20% –Ω–∞ –≥–æ–¥.
- **Auth + RBAC**
    - JWT + refresh –≤ HttpOnly cookie, rate limiting, —Å–µ—Å—Å–∏–∏, soft blacklist.
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –ø–æ —Å–ø–µ—Ü-—Å—Å—ã–ª–∫–µ, –≥–æ—Å—Ç–∏ ‚Äî —á–µ—Ä–µ–∑ –∫–∞—Å—Å—É, —Å—Å—ã–ª–∫—É, Telegram.
    - RBAC: —Ä–æ–ª–∏ + —Ç–æ–Ω–∫–∏–µ –ø—Ä–∞–≤–∞, Owner –º–æ–∂–µ—Ç impersonate –ª—é–±–æ–≥–æ, –≤–∏–¥–µ—Ç—å –≤—Å—ë –∏ –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª–∏.
- **Guests \& Loyalty Cards**
    - –ü—Ä–æ—Ñ–∏–ª—å –≥–æ—Å—Ç—è, –¥–µ—Ç–∏, –æ–¥–Ω–∞ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç UNIFIED/SEPARATE.
    - QR + 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥, –æ–±–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ).
    - –ì–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ 3 –º–µ—Å—è—Ü–∞, —Å–º–µ–Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–Ω–æ—Å –≤—Å–µ—Ö –±–∞–ª–ª–æ–≤/—É—Ä–æ–≤–Ω—è.
- **Loyalty System + Rules + Levels (–ø–æ—Å–ª–µ ¬´–ë–µ—Å–µ–¥—ã 5¬ª):**
    - –¢–∏–ø —Å–∏—Å—Ç–µ–º—ã: **—Å–∫–∏–¥–æ—á–Ω–∞—è** –∏–ª–∏ **–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è**, —Å –≥–∏–±–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.
    - **1 –±–∞–ª–ª –≤—Å–µ–≥–¥–∞ = 1 —Ä—É–±–ª—é**, —ç—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ, –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–µ –ø—Ä–∞–≤–∏–ª–æ.
    - –ë–∞–ª–ª—ã **–≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã —á–µ–∫–∞**, –¥–∞–∂–µ –µ—Å–ª–∏ —á–∞—Å—Ç—å –æ–ø–ª–∞—á–µ–Ω–∞ –±–∞–ª–ª–∞–º–∏.
    - –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ:
        - –°–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞—Ç—è—Ç—Å—è **–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ** –±–∞–ª–ª—ã, –ø–æ—Ç–æ–º **–æ—Å–Ω–æ–≤–Ω—ã–µ**.
        - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ —Å–ø–∏—Å—ã–≤–∞–µ–º, –∏ –Ω–∞—á–∏—Å–ª—è–µ–º (–∫–µ—à–±—ç–∫ –æ—Ç –ø–æ–ª–Ω–æ–π —Å—É–º–º—ã).
    - –£—Ä–æ–≤–Ω–∏:
        - –û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Å—É–º–º–µ –≤—Å–µ—Ö —á–µ–∫–æ–≤ (lifetime).
        - –£—Ä–æ–≤–µ–Ω—å **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–Ω–∏–∂–∞–µ—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; downgrade –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –∞–¥–º–∏–Ω—Å–∫–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ (—É–¥–∞–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å –≤—ã–±–æ—Ä–æ–º, –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π).
        - –ü–µ—Ä–µ—Å—á—ë—Ç —É—Ä–æ–≤–Ω–µ–π ‚Äî –Ω–æ—á–Ω–æ–π CRON, –Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ.
    - –°–≥–æ—Ä–∞–Ω–∏–µ:
        - –ë–∞–ª–ª—ã —Å–≥–æ—Ä–∞—é—Ç **–ø–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**, –ø–µ—Ä–∏–æ–¥ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Admin, –Ω–æ –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ 90 –¥–Ω–µ–π.
        - –î–ª—è –ø—Ä–æ–º–æ ‚Äî —Å–≤–æ–∏ —Å—Ä–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Ç–æ–ª—å–∫–æ –¥–µ–Ω—å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ + —Å–ª–µ–¥—É—é—â–∏–π¬ª).
        - –í—Å–µ –±–∞–ª–ª—ã –Ω–∞ –∫–∞—Ä—Ç–µ —Å–≥–æ—Ä–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –Ω–æ –ª–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º.
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏:
        - –ü–µ—Ä–∏–æ–¥—ã –∏ –∫–∞–Ω–∞–ª—ã (Telegram/email) –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Admin.
        - CRON –≤ 10:00, –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–ª–∏ —Ä–∞–∑–¥–µ–ª—è—Ç—å –¥–ª—è ¬´–æ—Å–Ω–æ–≤–Ω—ã—Ö¬ª –∏ ¬´–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö¬ª.
    - –õ–∏–º–∏—Ç—ã:
        - **–ú–∞–∫—Å–∏–º—É–º –±–∞–ª–ª–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ ‚Äî –±–µ–∑–ª–∏–º–∏—Ç.**
        - **–ú–∏–Ω–∏–º—É–º –∫ —Å–ø–∏—Å–∞–Ω–∏—é: 1 –±–∞–ª–ª.** –ë–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å < 1, –µ—Å–ª–∏ –Ω–µ –æ–±–Ω—É–ª—è–µ–º –∫–∞—Ä—Ç—É.
        - –ú–∞–∫—Å–∏–º—É–º –∫ —Å–ø–∏—Å–∞–Ω–∏—é ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—É–º–º—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20%, –¥–∏–∞–ø–∞–∑–æ–Ω 10‚Äì100%), –º–∏–Ω–∏–º—É–º —á–µ–∫–∞ = 50 —Ä—É–± (—Ñ–∏–∫—Å, –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è).
    - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
        - –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞, —É—Ä–æ–≤–Ω–∏, –ø—Ä–æ–º–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è, –≤ `BallTransaction` –∏ –ø—Ä–æ–º–æ-—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ‚Äî snapshot.
        - –ü–µ—Ä–µ—Å—á—ë—Ç–æ–≤ –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º –Ω–µ—Ç, –∫—Ä–æ–º–µ emergency-job —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º audit-—Å–ª–æ–µ–º.
    - –ú–∏–≥—Ä–∞—Ü–∏–∏ UNIFIED ‚Üî SEPARATE –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–∏—Å–∞–Ω—ã (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ/—Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤, –∏—Å—Ç–æ—Ä–∏—è, –æ—Ç–∫–∞—Ç).
- **–ü—Ä–æ–º–æ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã**
    - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–æ–º–æ (–î–† –≥–æ—Å—Ç—è, –î–† —Ä–µ–±—ë–Ω–∫–∞, –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–µ—Ä–≤—ã–π —á–µ–∫, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏ —Ç.–¥.).
    - –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–æ–º–æ:
        - –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (**COMBINE_ALL / MAX_ONLY / FIRST_ONLY**).
        - Override –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä –ø—Ä–æ–º–æ.
        - –í—Å—ë –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `PromoBallGranted` —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–º–æ.
- **POS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (iiko / R-Keeper)**
    - –ì–∏–±—Ä–∏–¥: **PUSH —á–µ—Ä–µ–∑ webhooks + PULL –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç** –∫–∞–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞.
    - POS ‚Äî **–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –ø–æ —á–µ–∫–∞–º –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–º —Ç–∞–º –±–∞–ª–ª–∞–º**; –ø—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö ‚Äî reconciliation job –∏ –∞–≤—Ç–æ–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ POS (—Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ—Ä—Ä–µ–∫—Ü–∏–π).
    - HMAC-–ø–æ–¥–ø–∏—Å—å webhook‚Äô–æ–≤, —Å—Ç–∞—Ç—É—Å—ã —Å–∏–Ω–∫–æ–≤: `SUCCESS / FAILED / PARTIAL / PENDING`.
    - –î–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ Admin –≤—ã–±–æ—Ä POS –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ API —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
- **Analytics \& Reports**
    - –ë–∞–∑–æ–≤—ã–π –¥–∏–∑–∞–π–Ω –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ —Ä–æ–ª—è–º —É–∂–µ –µ—Å—Ç—å:
        - Owner ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ç–∞—Ä–∏—Ñ—ã, —Ñ–∏–Ω–∞–Ω—Å—ã, MRR/Churn.
        - Restaurant Admin ‚Äî —Å–µ—Ç—å –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã: –≤—ã—Ä—É—á–∫–∞, —á–µ–∫–∏, –±–∞–ª–ª—ã, ROI –ø—Ä–æ–º–æ, —Å–µ–≥–º–µ–Ω—Ç—ã –≥–æ—Å—Ç–µ–π.
        - Manager ‚Äî —Ç–æ–ª—å–∫–æ —Å–≤–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω.
        - Guest ‚Äî —Ç–æ–ª—å–∫–æ —Å–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è ¬´–º–∏–Ω–∏-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞¬ª.
    - –ü—Ä–æ–¥—É–º–∞–Ω—ã –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (`AnalyticsDailySnapshot`, `AnalyticsMonthlySnapshot`, `GuestSegmentation`, `PromoBallGranted`, `RuleActivationLog`) –∏ CRON‚Äô—ã –ø—Ä–µ–¥—Ä–∞—Å—á—ë—Ç–∞.
- **GDPR / –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / edge-cases**
    - Soft delete –≥–æ—Å—Ç—è: —Å—Ç–∞—Ç—É—Å `DELETED`, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—Ç–∏—Ä–∞—é—Ç—Å—è/—à–∏—Ñ—Ä—É—é—Ç—Å—è, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è.
    - Orphaned –±–∞–ª–ª—ã ‚Äî –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç –≤–ª–∞–¥–µ–ª—å—Ü—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞, —Ä–µ—à–µ–Ω–∏—è –∑–∞ –Ω–∏–º.
    - –ñ—ë—Å—Ç–∫–∏–π –∑–∞–ø—Ä–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –∫ –æ–¥–Ω–æ–º—É —á–µ–∫—É (UNIQUE constraint).

–°–µ–π—á–∞—Å —Å–∏—Å—Ç–µ–º–∞ –≤ –≥–æ–ª–æ–≤–µ —Ü–µ–ª—å–Ω–∞—è: –æ—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏ –±–∏–ª–ª–∏–Ω–≥–∞ —Ç–∞—Ä–∏—Ñ–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ edge-case‚Äô–∞ –≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∏ POS-—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö.

***

–î–∞–ª—å—à–µ –ª–æ–≥–∏—á–Ω–æ –≤—ã–±—Ä–∞—Ç—å **—Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏**, –ø—Ä–∏—á—ë–º —É–∂–µ —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö —ç—Ç–∏—Ö —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª. –ü—Ä–µ–¥–ª–∞–≥–∞—é —Ç–∞–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

1. **Billing \& Subscriptions + Payments Integration**
    - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–¥–ø–∏—Å–∫–∏: —Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, —Å–º–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞, –ø–∞—É–∑–∞, –æ—Ç–º–µ–Ω–∞.
    - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç—ë–∂–∫–æ–π (YooKassa/Stripe –∏ —Ç.–ø.), webhooks –ø–ª–∞—Ç–µ–∂–µ–π.
    - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ª–∏–º–∏—Ç–∞–º (—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã/–≥–æ—Å—Ç–∏) –Ω–∞ —É—Ä–æ–≤–Ω–µ middleware –∏ UI.
    - –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è Owner –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞.
2. **Telegram Bot + Mini App**
    - –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±–æ—Ç–∞: /start, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—Ä—Ç (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ UNIFIED/SEPARATE), —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
    - –≠–∫—Ä–∞–Ω –∫–∞—Ä—Ç—ã, –∏—Å—Ç–æ—Ä–∏–∏, –ø—Ä–æ—Ñ–∏–ª—è, –¥–µ—Ç–µ–π, –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
    - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ø—Ä–∏–≤—è–∑–∫–∞ telegram_id ‚Üî Guest, —Ä–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏/—Å–µ—Ç—è–º–∏).
3. **POS Integration (—É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤)**
    - –ß—ë—Ç–∫–∏–µ –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è iiko –∏ R-Keeper.
    - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ endpoints, —Ñ–æ—Ä–º–∞—Ç—ã webhooks, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–æ–≤.
    - –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ reconciliation –∏ —Ä—É—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è Admin.
4. **Backend Services/Controllers –¥–ª—è Loyalty Engine**
    - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è API –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–ø—Ä–∞–≤–∏–ª–∞, —É—Ä–æ–≤–Ω–∏, –ø—Ä–æ–º–æ).
    - Endpoints —Ä–∞—Å—á—ë—Ç–∞ –±–∞–ª–ª–æ–≤ –¥–ª—è POS, –ø–∞–Ω–µ–ª–∏ –∏ Telegram.
    - –í—Å–µ CRUD –ø–æ —É—Ä–æ–≤–Ω—è–º/–ø—Ä–∞–≤–∏–ª–∞–º —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

–°–∫–∞–∂–∏, **–∫–∞–∫–æ–π –∏–∑ —ç—Ç–∏—Ö –±–ª–æ–∫–æ–≤ –±–µ—Ä—ë–º —Å–ª–µ–¥—É—é—â–∏–º** (–∏–ª–∏ —É–∫–∞–∂–∏ —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –¥–ª—è —Ç–µ–±—è), –∏ —Å—Ä–∞–∑—É —É–π–¥—ë–º –≤ —Ç—É –∂–µ –≥–ª—É–±–∏–Ω—É, —á—Ç–æ –≤ ¬´–ë–µ—Å–µ–¥–µ 5¬ª.
<span style="display:none">[^1_1][^1_2][^1_3][^1_4]</span>

<div align="center">‚ÅÇ</div>

[^1_1]: Beseda-5.md

[^1_2]: Beseda-4.md

[^1_3]: Beseda-3.md

[^1_4]: Beseda-2.md


---

# –ò–∑—É—á–∏ –µ—â–µ —Ä–∞–∑ –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ, –ø—Ä–æ–≤–µ—Ä—å –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —É–ø—É—â–µ–Ω–∏—è, –ø–æ—Å–ª–µ –≤—ã–±–µ—Ä–µ–º –±–ª–æ–∫ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏

–°–µ–π—á–∞—Å –∫–∞—Ä—Ç–∏–Ω–∞ —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ü–µ–ª—å–Ω–∞—è, –Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ **–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞** –∏ **–æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∑–æ–Ω—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏/–ø—Ä–æ–≤–µ—Ä–∫–∏**, —á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –ø—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.

–ù–∏–∂–µ ‚Äî –Ω–µ –ø–µ—Ä–µ—Å–∫–∞–∑, –∞ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É –±–µ—Å–µ–¥–∞–º–∏.

***

## 1. –ì–¥–µ –±—ã–ª–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏ –∫–∞–∫ –æ–Ω–∏ —É–∂–µ —Ä–µ—à–µ–Ω—ã

### 1.1. –°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤: —Å—Ç–∞—Ä–∞—è –º–æ–¥–µ–ª—å vs –Ω–æ–≤–∞—è

–í —Ä–∞–Ω–Ω–∏—Ö –±–µ—Å–µ–¥–∞—Ö (–ë–µ—Å–µ–¥–∞ 1‚Äì3) –±—ã–ª–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å:

- –£ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ `BallTransaction` —Å–≤–æ—ë `expires_at`.
- –õ–æ–≥–∏–∫–∞ —Å–≥–æ—Ä–∞–Ω–∏—è ‚Äî –≥–∏–±—Ä–∏–¥: A + B (per-transaction expiry + FIFO).
- –ë–∞–ª–ª—ã —Å–≥–æ—Ä–∞—é—Ç –ø–∞–∫–µ—Ç–∞–º–∏, –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–í –ë–µ—Å–µ–¥–µ 5 —Ç—ã —É—Ç–æ—á–Ω–∏–ª:

- –û—Å–Ω–æ–≤–∞ ‚Äî **—Å–≥–æ—Ä–∞–Ω–∏–µ –ø–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≥–æ—Å—Ç—è**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ —Å—Ä–æ–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å –ø–µ—Ä–∏–æ–¥ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, **–Ω–æ –Ω–µ –º–µ–Ω—å—à–µ 90 –¥–Ω–µ–π**.
- –ü—Ä–∏ —Å–≥–æ—Ä–∞–Ω–∏–∏ **—Å–≥–æ—Ä–∞—é—Ç –≤—Å–µ –±–∞–ª–ª—ã –Ω–∞ –∫–∞—Ä—Ç–µ —Å—Ä–∞–∑—É**, –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏.
- –ü—Ä–∏ —ç—Ç–æ–º –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–º–æ (–∫–∞—Å—Ç–æ–º–Ω—ã–µ –∞–∫—Ü–∏–∏) –º–æ–≥—É—Ç –±—ã—Ç—å **—Å–≤–æ–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Å—Ä–æ–∫–∏**, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    - ¬´500 –±–∞–ª–ª–æ–≤ –Ω–∞ –î–µ–Ω—å —Å–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞, –¥–µ–π—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –¥–µ–Ω—å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ –∏ –¥–µ–Ω—å –ø–æ—Å–ª–µ¬ª.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

- –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å —Ä–∞–Ω–Ω–∏—Ö –±–µ—Å–µ–¥ (—Å—Ç—Ä–æ–≥–∏–π per-transaction expiry + FIFO) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞**:
    - –ü–æ–ª–µ `expires_at` –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π —Ç–µ–ø–µ—Ä—å –∏–≥—Ä–∞–µ—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ä–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏), –Ω–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–≥–æ—Ä–∞–Ω–∏—è –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ **–¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä ¬´inactivity_days¬ª.
    - –î–ª—è –ø—Ä–æ–º–æ —Å –∂—ë—Å—Ç–∫–∏–º —Å—Ä–æ–∫–æ–º ‚Äî `expires_at` –æ—Å—Ç–∞—ë—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω—ã–º.

–û—à–∏–±–∫–∞/—É–ø—É—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–∂–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å:

- –í –∫–æ–¥–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö –ë–µ—Å–µ–¥—ã 5 (–±–ª–æ–∫ –ø—Ä–æ —Å–≥–æ—Ä–∞–Ω–∏–µ) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —Å–≥–æ—Ä–∞–Ω–∏—è –ø–æ `expires_at` –∏ CRON, –∫–æ—Ç–æ—Ä—ã–π –∏—â–µ—Ç **–ø–∞–∫–µ—Ç—ã** –¥–ª—è EXPIRE.
- –í —Ç–≤–æ—ë–º —Ç–µ–∫—Å—Ç–µ-–æ—Ç–≤–µ—Ç–µ —Ç—ã —É–∂–µ —Å–º–µ—Å—Ç–∏–ª –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —Å–≥–æ—Ä–∞–Ω–∏–µ **–≤—Å–µ—Ö –±–∞–ª–ª–æ–≤ –∫–∞—Ä—Ç—ã —Ä–∞–∑–æ–º –ø–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**.

–≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º —è–≤–Ω–æ–≥–æ **–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ EXPIRE** –≤ –ø–æ–ª—å–∑—É:

- `GuestCard.last_activity_at` + `loyaltySystem.inactivity_expire_days` (>= 90),
- –∏ –æ—Ç–¥–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–º–æ-–ø–∞–∫–µ—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫—Ä–∞—Ç–∫–∏–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è.

***

### 1.2. Downgrade —É—Ä–æ–≤–Ω–µ–π: –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ —Ä–µ—à–µ–Ω–æ

–†–∞–Ω–µ–µ:

- –í –ë–µ—Å–µ–¥–µ 5 –±—ã–ª –≤–æ–ø—Ä–æ—Å: –¥–æ–ø—É—Å–∫–∞—Ç—å –ª–∏ downgrade (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, 180 –¥–Ω–µ–π –∏ —Ç.–ø.).
- –ü—Ä–µ–¥–ª–∞–≥–∞–ª–æ—Å—å: `allow_downgrade` = true/false.

–¢–≤–æ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä:

- **¬´One way up¬ª:** –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ–ª—É—á–∏–≤ —É—Ä–æ–≤–µ–Ω—å, –≥–æ—Å—Ç—å –µ–≥–æ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç–µ—Ä—è–µ—Ç** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ —è–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ **—É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è**:
    - Admin —É–¥–∞–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å ‚Üí –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å:
        - –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ, –∏–ª–∏
        - –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ.
- –ü—Ä–∏ –ª—é–±–æ–º –ø–µ—Ä–µ—Å—á—ë—Ç–µ –≥–æ—Å—Ç–∏ **–Ω–µ –ø–∞–¥–∞—é—Ç –≤–Ω–∏–∑**:
    - –º–∞–∫—Å–∏–º—É–º ‚Äî –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ—ë–º —É—Ä–æ–≤–Ω–µ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º 0 –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ.

–°–ª–µ–¥—Å—Ç–≤–∏–µ:

- –ü–æ–ª—è –≤—Ä–æ–¥–µ `allow_downgrade`, `downgrade_after_days` –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω—É–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å **—É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏** –∏ –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
- –ù–æ—á–Ω–æ–π CRON –ø–µ—Ä–µ—Å—á—ë—Ç–∞ —É—Ä–æ–≤–Ω–µ–π –¥–æ–ª–∂–µ–Ω:
    - —Ç–æ–ª—å–∫–æ –ø–æ–≤—ã—à–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å, –µ—Å–ª–∏ –ø–æ—Ä–æ–≥ –ø—Ä–µ–æ–¥–æ–ª—ë–Ω;
    - –ª–∏–±–æ –æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º.

***

### 1.3. –õ–∏–º–∏—Ç—ã –±–∞–ª–ª–æ–≤: —Ä–∞–Ω–Ω–∏–π –ª–∏–º–∏—Ç vs —Ç–≤–æ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä

–í –ë–µ—Å–µ–¥–µ 5 –≤ –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö –æ–±—Å—É–∂–¥–∞–ª–æ—Å—å:

- –í–∞—Ä–∏–∞–Ω—Ç B: `max_balls_per_guest` —Å —Ä–∞–∑–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º (IGNORE, CAP, EXPIRE_OLDEST).

–¢–≤–æ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä:

- **–ü—É–Ω–∫—Ç 20: ¬´A. –ù–µ—Ç –ª–∏–º–∏—Ç–∞ (–±–µ–∑–ª–∏–º–∏—Ç)¬ª** ‚Äî –∑–Ω–∞—á–∏—Ç:
    - –ü–æ–ª–µ `max_balls_per_guest` **–Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ**, –∫–∞–∫ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ.
    - –í—Å—è –ª–æ–≥–∏–∫–∞ CAP/IGNORE/EXPIRE_OLDEST ‚Äî —ç—Ç–æ –±—ã–ª –≤–∞—Ä–∏–∞–Ω—Ç, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å.
- –ü—Ä–∏ —ç—Ç–æ–º –ø—É–Ω–∫—Ç 21 –≤–≤–æ–¥–∏—Ç **–ª–∏–º–∏—Ç –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ**, –∞ –Ω–µ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ:
    - –ú–∏–Ω–∏–º—É–º –∫ —Å–ø–∏—Å–∞–Ω–∏—é: 1 –±–∞–ª–ª.
    - –ú–∞–∫—Å–∏–º—É–º: –¥–µ—Ñ–æ–ª—Ç 20% –æ—Ç —Å—É–º–º—ã —á–µ–∫–∞, Admin –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç 10% –¥–æ 100%.
    - –ú–∏–Ω–∏–º—É–º —Å—É–º–º—ã —á–µ–∫–∞: 50 —Ä—É–±–ª–µ–π, –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è.

–°–ª–µ–¥—Å—Ç–≤–∏–µ:

- –í–æ –≤—Å–µ—Ö —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Å–ø–µ–∫–∞—Ö `max_balls_per_guest` –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ –Ω—É–∂–Ω–æ **—É–¥–∞–ª–∏—Ç—å**, —á—Ç–æ–±—ã –Ω–µ –ø–æ—è–≤–ª—è–ª–æ—Å—å –≤ API/–ë–î-—Å—Ö–µ–º–µ.
- –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ:
    - –ª–∏–º–∏—Ç –Ω–∞ **–ø—Ä–æ—Ü–µ–Ω—Ç —Å–ø–∏—Å–∞–Ω–∏—è –æ—Ç —á–µ–∫–∞**,
    - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `min_check_amount = 50`.

***

### 1.4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤: –≤—Ä–µ–º—è CRON + –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

–†–∞–Ω–µ–µ:

- CRON –≤ 23:00, –∂—ë—Å—Ç–∫–∏–µ —à–∞–≥–∏ (3/7/14 –¥–Ω–µ–π).

–¢—ã —É—Ç–æ—á–Ω–∏–ª:

- CRON –≤ **10:00**.
- –ê–¥–º–∏–Ω **—Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç**:
    - –±—É–¥—É—Ç –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–æ–æ–±—â–µ,
    - –ø–æ –∫–∞–∫–∏–º —Ç–∏–ø–∞–º –±–∞–ª–ª–æ–≤ (–æ—Å–Ω–æ–≤–Ω—ã–µ/–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ),
    - –ø–æ –∫–∞–∫–∏–º –ø–µ—Ä–∏–æ–¥–∞–º (–º–æ–∂–Ω–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å—Å—è 3/7/14).

–°–ª–µ–¥—Å—Ç–≤–∏–µ:

- –í —Å—Ç–∞—Ä—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö —Å CRON –≤ 23:00 –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ ‚Äî —ç—Ç–æ –Ω—É–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å **–ø—Ä–∏–º–µ—Ä–æ–º**, –∞ –Ω–µ –ø—Ä–∞–≤–∏–ª–æ–º.
- –í —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ:
    - –≤—ã–Ω–µ—Å—Ç–∏ –ø–µ—Ä–∏–æ–¥—ã –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –±–∞–ª–ª–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥ `LoyaltySystem`,
    - CRON –≤—Ä–µ–º—è —Ç–æ–∂–µ –ª–æ–≥–∏—á–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º, –Ω–æ –º–∏–Ω–∏–º—É–º: –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ, —á—Ç–æ ¬´–¥–µ—Ñ–æ–ª—Ç –ø–æ —Å–∏—Å—Ç–µ–º–µ¬ª ‚Äî 10:00.

***

### 1.5. –ò—Å—Ç–æ—á–Ω–∏–∫ —Å—É–º–º—ã –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏

–†–∞–Ω–µ–µ:

- –í–æ–ø—Ä–æ—Å, –æ—Ç –∫–∞–∫–æ–π —Å—É–º–º—ã —Å—á–∏—Ç–∞—Ç—å –±–∞–ª–ª—ã, –æ—Å—Ç–∞–≤–∞–ª—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º.

–¢—ã —Ñ–∏–Ω–∞–ª—å–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª:

- **–í—Å–µ–≥–¥–∞ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã —á–µ–∫–∞**:
    - –ï—Å–ª–∏ —á–µ–∫ 2000, —Å–ø–∏—Å–∞–ª–∏ 100 –±–∞–ª–ª–∞–º–∏, –æ–ø–ª–∞—Ç–∏–ª–∏ 1900 —Ä—É–± –¥–µ–Ω—å–≥–∞–º–∏:
        - –±–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —Å 2000,
        - —Å–ø–∏—Å–∞–Ω–∏–µ –∏–¥—ë—Ç —Å–Ω–∞—á–∞–ª–∞ —Å –∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö, –ø–æ—Ç–æ–º —Å –æ—Å–Ω–æ–≤–Ω—ã—Ö.

–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ, –æ–Ω–æ —É–∂–µ –Ω–µ–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ —Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –∏ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –¥—Ä—É–≥–∏–º –±–ª–æ–∫–∞–º.

***

### 1.6. –ú–æ–¥–µ–ª—å UNIFIED / SEPARATE: –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ Telegram

–ú–∏–≥—Ä–∞—Ü–∏–∏:

- UNIFIED ‚Üí SEPARATE:
    - –ö–∞—Ä—Ç—É/–±–∞–ª–ª—ã –∏ –∏—Å—Ç–æ—Ä–∏—é **–∫–æ–ø–∏—Ä—É–µ–º –≤ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω**, –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç (UNIFIED + –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º).
- SEPARATE ‚Üí UNIFIED:
    - –ë–∞–ª–ª—ã **—Å—É–º–º–∏—Ä—É—é—Ç—Å—è**, –±–µ—Ä—ë—Ç—Å—è **–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å**.

–¢–≤–æ—ë —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ:

- –í –ë–µ—Å–µ–¥–µ 2‚Äì3 —É–∂–µ —á—ë—Ç–∫–æ –≤—ã–±—Ä–∞–Ω–æ: **–í–∞—Ä–∏–∞–Ω—Ç C ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π**, –∞–¥–º–∏–Ω —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç **–æ–±—â—É—é –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã** –∏ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ—Å–ª–µ.
- –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤ –ë–µ—Å–µ–¥–µ 5 –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —Å —ç—Ç–∏–º.

–û—à–∏–±–æ–∫ –∑–¥–µ—Å—å –Ω–µ—Ç, –Ω–æ –≤–∞–∂–Ω–æ:

- –í —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram mini-app –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å:
    - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç** (–ø—Ä–∏ SEPARATE/–º–∏–≥—Ä–∞—Ü–∏—è—Ö),
    - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∞—Ä–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ (MIGRATED) –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç—ã.

***

## 2. –ß—Ç–æ –µ—â—ë –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–æ–ª–Ω–æ—Å—Ç—å—é ¬´–∑–∞—à–∏—Ç–æ¬ª –∏ —Ç—Ä–µ–±—É–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∂–µ

–≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∏, –∞ —Å–∫–æ—Ä–µ–µ **–º–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –±—ã–ª–∏ –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞ –ø–æ—Ç–æ–º**, –∏ –∏—Ö –Ω–∞–¥–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞.

### 2.1. –ë–∏–ª–ª–∏–Ω–≥ –∏ –ø–ª–∞—Ç—ë–∂–Ω—ã–π —à–ª—é–∑

–°–µ–π—á–∞—Å:

- –õ–æ–≥–∏–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤, –ª–∏–º–∏—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫ –æ–ø–∏—Å–∞–Ω–∞ –æ—á–µ–Ω—å –¥–µ—Ç–∞–ª—å–Ω–æ.
- –ù–æ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä** (YooKassa, Stripe, CloudPayments –∏ —Ç.–ø.) –∏ –ø–æ–ª–Ω—ã–π flow –≤—Ö–æ–¥—è—â–∏—Ö webhooks –µ—â—ë –Ω–µ —Å–ø–µ—Ü–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.

–ù—É–∂–µ–Ω –±—É–¥–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫:

- –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã `/billing/webhook`,
- —Å—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π, –æ—à–∏–±–∫–∏, —Ä–µ—Ç—Ä–∞–∏,
- —Å–≤—è–∑—å `Subscription` ‚Üî `Invoice` ‚Üî `Payment`.


### 2.2. POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: —É—Ä–æ–≤–µ–Ω—å —Ä–µ–∞–ª—å–Ω—ã—Ö API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ:

- HYBRID PUSH/PULL, HMAC, —Å—Ç–∞—Ç—É—Å—ã —Å–∏–Ω–∫–∞, reconciliation ‚Äî —É–∂–µ –≤—ã–±—Ä–∞–Ω–æ –∏ –æ–ø–∏—Å–∞–Ω–æ.
- –ù–æ –ø–æ–∫–∞ –Ω–µ—Ç:
    - —Ç–æ—á–Ω—ã—Ö JSON-—Å—Ö–µ–º webhooks –æ—Ç iiko/R-Keeper,
    - –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤,
    - —Ç–∞–±–ª–∏—Ü —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π (–Ω–∞–ø—Ä. `pos_guest_id` ‚Üî `GuestCard`, `check_id` ‚Üî `POSTransaction` + `BallTransaction`),
    - –¥–µ—Ç–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ edge-cases (–æ—Ç–º–µ–Ω–∞ —á–µ–∫–∞, —á–∞—Å—Ç–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞, –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç–µ–∂–µ–π –≤ –æ–¥–Ω–æ–º —á–µ–∫–µ).

–≠—Ç–æ –ª–æ–≥–∏—á–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π ¬´—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π¬ª –±–ª–æ–∫.

### 2.3. Telegram Bot + Mini App: UX –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–°–µ–π—á–∞—Å –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ –≤—Å—ë —è—Å–Ω–æ:

- –ë–æ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏,
- –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ Telegram ID / —Ç–µ–ª–µ—Ñ–æ–Ω—É,
- mini-app —Å –∫–∞—Ä—Ç–æ–π, –±–∞–ª–∞–Ω—Å–æ–º, –∏—Å—Ç–æ—Ä–∏–µ–π, –¥–µ—Ç—å–º–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

–ù–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ:

- –∫–∞–∫–∏–µ **—ç–∫—Ä–∞–Ω—ã** (UI states) –∏ –∫–∞–∫–∏–µ **API** –æ–Ω–∏ –≤—ã–∑—ã–≤–∞—é—Ç,
- –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç **–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–∞–º–∏** (–µ—Å–ª–∏ —É –≥–æ—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤/—Å–∏—Å—Ç–µ–º),
- –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –≥–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (ballexpire, –ø—Ä–æ–º–æ, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ —Ç.–¥.).

***

## 3. –í—ã–≤–æ–¥: –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å

–ü–æ—Å–ª–µ —Å–≤–µ—Ä–∫–∏:

- –í—Å–µ ¬´—Å–∏–ª—å–Ω—ã–µ¬ª –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è (burning, downgrade, –ª–∏–º–∏—Ç –±–∞–ª–ª–æ–≤, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –º–∏–≥—Ä–∞—Ü–∏–∏ UNIFIED/SEPARATE) **—Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–≤–æ–∏–º–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏**.
- –û—Å—Ç–∞–≤—à–∏–µ—Å—è –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –∫–æ–¥–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö ‚Äî –Ω–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, –∞ –ø—Ä–æ—Å—Ç–æ —Ä–∞–Ω–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –º–æ–¥—É–ª—è –±—É–¥—É—Ç –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –ø–æ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞.

–ï—Å–ª–∏ –æ–±–æ–±—â–∏—Ç—å:

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ä–æ–ª–∏, —Ç–∞—Ä–∏—Ñ—ã, guests/loyalty, —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å POS –∏ Telegram ‚Äî **–≤—ã–¥–µ—Ä–∂–∞–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ**.
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∏–∑–Ω–µ—Å–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (1 –±–∞–ª–ª = 1 —Ä—É–±–ª—å, no downgrade, no max balance, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã —á–µ–∫–∞, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–ø–∏—Å–∞–Ω–∏—è –∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤) —É–∂–µ –∂—ë—Å—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –±–µ–∑ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π.

***

## 4. –ß—Ç–æ –ª–æ–≥–∏—á–Ω–µ–µ –≤—Å–µ–≥–æ –≤—ã–±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –±–ª–æ–∫–æ–º

–° —É—á—ë—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ:

- –ë–ª–æ–∫ Loyalty System \& Rules —É –Ω–∞—Å —É–∂–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ **–∑–∞–∫—Ä—ã—Ç** –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (–ë–µ—Å–µ–¥–∞ 5),
- RBAC/Auth/Guests/Levels —É–∂–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã,
- –ù–∞–∏–±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö ¬´—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö¬ª –≤–æ–ø—Ä–æ—Å–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å —É POS –∏ Telegram,

—Å–∞–º—ã–π –ª–æ–≥–∏—á–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö:

1. **POS Integration (iiko/R-Keeper) –Ω–∞ —É—Ä–æ–≤–Ω–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤**
–ß—Ç–æ–±—ã ¬´–ø—Ä–∏–∑–µ–º–ª–∏—Ç—å¬ª –≤–µ—Å—å points engine –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —á–µ–∫–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.
2. **Telegram Bot + Mini App (—Ñ—Ä–æ–Ω—Ç–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ—Å—Ç–µ–≤–æ–≥–æ –æ–ø—ã—Ç–∞)**
–ß—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å, –∫–∞–∫ –≥–æ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–æ –≤–∏–¥–∏—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—é —ç—Ç—É –º–æ—â–Ω—É—é –ª–æ–≥–∏–∫—É.

–ï—Å–ª–∏ –¥–ª—è —Ç–µ–±—è —Å–µ–π—á–∞—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ **–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ —Å–≤—è–∑–∫–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–∞—Å—Å–∞–º–∏**, –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –ø–µ—Ä–≤—ã–º–∏ –¥–æ–±–∏—Ç—å **POS Integration**.
–ï—Å–ª–∏ –∂–µ –≤–∞–∂–Ω–µ–µ **–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π/–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –æ–ø—ã—Ç –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞**, –ª–æ–≥–∏—á–Ω–µ–µ —Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å **Telegram Bot + Mini App**.

–ù–∞–ø–∏—à–∏, –∫–∞–∫–æ–π –∏–∑ —ç—Ç–∏—Ö –¥–≤—É—Ö –±–ª–æ–∫–æ–≤ —Ö–æ—á–µ—à—å –≤–∑—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–º, –∏ –¥–∞–ª—å—à–µ –ø–æ–π–¥—ë–º —É–∂–µ –Ω–µ –æ–±—â–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –∞ –≤ –¥—É—Ö–µ –ë–µ—Å–µ–¥—ã 5: —Å–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ + –∂—ë—Å—Ç–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É.
<span style="display:none">[^2_1][^2_2][^2_3][^2_4][^2_5]</span>

<div align="center">‚ÅÇ</div>

[^2_1]: –ë–µ—Å–µ–¥–∞ 5.md

[^2_2]: –ë–µ—Å–µ–¥–∞ 4.md

[^2_3]: –ë–µ—Å–µ–¥–∞ 3.md

[^2_4]: –ë–µ—Å–µ–¥–∞ 2.md

[^2_5]: –ë–µ—Å–µ–¥–∞ 1.md


---

# POS Integration (iiko/R-Keeper). –ó–∞–¥–∞–π 20+ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ + —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ —Ç–≤–æ–µ–º—É –ª—É—á—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö. –ü–µ—Ä–µ–¥ –∑–∞–¥–∞–≤–∞–Ω–∏–µ–º –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–≤–µ—Ä—å—Å—è —Å —Ñ–∞–π–ª–∞–º–∏, –º–æ–∂–µ—Ç –æ–Ω–∏ —É–∂–µ –±—ã–ª–∏

–ù–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∏–∂–µ —É–∂–µ **—É—á–∏—Ç—ã–≤–∞—é—Ç –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è –∏–∑ –ø—Ä–æ—à–ª—ã—Ö –±–µ—Å–µ–¥** (HYBRID PUSH+PULL, HMAC, 30 –º–∏–Ω—É—Ç PULL, —Ä–∞—Å—á—ë—Ç –±–∞–ª–ª–æ–≤ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã, —Å—Ç–∞—Ç—É—Å—ã —Å–∏–Ω–∫–∞ –∏ —Ç.–¥.) –∏ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç —Ç–µ 10 –±–∞–∑–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã —É–∂–µ –æ—Ç–≤–µ—Ç–∏–ª.

–°–¥–µ–ª–∞—é –±–ª–æ–∫–∞–º–∏: **–≤–æ–ø—Ä–æ—Å ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí –º–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ**.

***

## –ë–ª–æ–∫ 1. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ—Å—Ç—è –∏ –∫–∞—Ä—Ç—ã –≤ POS

1Ô∏è‚É£ **–ö–ª—é—á–µ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥–æ—Å—Ç—è –≤ POS**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–∞–∫ –≥–ª–∞–≤–Ω—ã–π ¬´–º–æ—Å—Ç¬ª –º–µ–∂–¥—É POS –∏ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π: —Ç–µ–ª–µ—Ñ–æ–Ω, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π POS-ID –≥–æ—Å—Ç—è, –Ω–∞—à `guest_card_id`, –∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–ª—É—á—à–µ–µ –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã):**

- –í POS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∫–æ–º–±–∏–Ω–∞—Ü–∏—é**:
    - **–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á –¥–ª—è –ø–æ–∏—Å–∫–∞**: –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∫–∞–∫ —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω–æ –≤ —Å–∏—Å—Ç–µ–º–µ).
    - **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π mapping**: POS-–≥–æ—Å—Ç—å ‚Üî –Ω–∞—à `guest_card_id` —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `POSGuestLink`:
        - `pos_guest_id`, `pos_system` (IIKO/RK), `guest_card_id`, `tenant_id`, `restaurant_id`.
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —á–µ–∫–µ, –µ—Å–ª–∏ POS –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–ª–µ—Ñ–æ–Ω:
    - –ú—ã –∏—â–µ–º `GuestCard` –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.
    - –ï—Å–ª–∏ –Ω–∞—à–ª–∏ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º `pos_guest_id` –≤ `POSGuestLink`.
    - –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ ‚Äî –ª–∏–±–æ —Å–æ–∑–¥–∞—ë–º –≥–æ—Å—Ç—è, –ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É –≤ POS (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏).

***

2Ô∏è‚É£ **–ü–æ–≤–µ–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ POS –ø—Ä–∏—Å–ª–∞–ª —Ç–æ–ª—å–∫–æ —á–µ–∫ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω, –Ω–æ –≥–æ—Å—Ç—å —É –Ω–∞—Å –Ω–µ –Ω–∞–π–¥–µ–Ω**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –∫–æ–≥–¥–∞ POS —à–ª—ë—Ç webhook —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –≥–æ—Å—Ç—è, –∞ –≤ –Ω–∞—à–µ–π –±–∞–∑–µ –≥–æ—Å—Ç—è –µ—â—ë –Ω–µ—Ç?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í –∫–æ–Ω—Ñ–∏–≥–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ POS –Ω–∞ —É—Ä–æ–≤–Ω–µ `POSIntegration` —Å–¥–µ–ª–∞—Ç—å —Ñ–ª–∞–≥:
    - `auto_create_guest_on_pos_webhook: boolean`.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **true** (—á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å —á–µ–∫–∏).
    - –ï—Å–ª–∏ –≥–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É:
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë–º `User + GuestProfile + GuestCard` –≤ –Ω—É–∂–Ω–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ.
        - –ú–∞—Ä–∫–∏—Ä—É–µ–º `registration_source = POS_AUTO`.
        - –õ–æ–≥–∏—Ä—É–µ–º –≤ ActivityLog.
- –ï—Å–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Ö–æ—á–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≥–æ—Å—Ç–µ–π –≤—Ä—É—á–Ω—É—é ‚Äî –≤—ã–∫–ª—é—á–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–ª–∞–≥.

***

## –ë–ª–æ–∫ 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ webhook –æ—Ç POS

3Ô∏è‚É£ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ webhook `POST /webhooks/pos/transaction`**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–æ–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ webhook –æ—Ç POS?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:
    - `pos_system` (enum: `IIKO` / `RKEEPER`)
    - `tenant_id` –∏–ª–∏ `external_tenant_code`
    - `restaurant_external_id` (—á—Ç–æ–±—ã –º–∞–ø–ø–∏—Ç—å –Ω–∞ –Ω–∞—à `Restaurant`)
    - `pos_check_id` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —á–µ–∫–∞ –≤ POS)
    - `guest_phone` (–∏–ª–∏ `pos_guest_id`)
    - `check_amount` (–∏—Å—Ö–æ–¥–Ω–∞—è —Å—É–º–º–∞ —á–µ–∫–∞, –¥–æ —Å–∫–∏–¥–æ–∫)
    - `discount_amount` (–æ–±—â–∞—è —Å–∫–∏–¥–∫–∞ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–µ–Ω—å–≥–∞–º–∏)
    - `paid_amount` (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–ø–ª–∞—á–µ–Ω–Ω–∞—è —Å—É–º–º–∞)
    - `paid_with_points` (—Å–∫–æ–ª—å–∫–æ —Å–ø–∏—Å–∞–Ω–æ –±–∞–ª–ª–∞–º–∏ –≤ POS, –µ—Å–ª–∏ POS —É–º–µ–µ—Ç)
    - `timestamp` (–¥–∞—Ç–∞-–≤—Ä–µ–º—è —á–µ–∫–∞)
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π (–∂–µ–ª–∞—Ç–µ–ª–µ–Ω):
    - `items` ‚Äî –º–∞—Å—Å–∏–≤ –ø–æ–∑–∏—Ü–∏–π:
        - `item_id`, `name`, `category`, `price`, `quantity`, `total`.
    - `cashier_id`, `payment_method`, `order_type` (dine-in / takeaway / delivery).
- –í—Å—ë –≤ **JSON**, —Å HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å—é –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ.

***

4Ô∏è‚É£ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ webhook‚Äô–æ–≤**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç webhook‚Äô–æ–≤, –Ω–µ –ª–æ–º–∞—è —Å—Ç–∞—Ä—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–∫–ª—é—á–∏—Ç—å –≤ –∫–∞–∂–¥—ã–π webhook –ø–æ–ª–µ `schema_version` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1`, `2`, ‚Ä¶).
- –í –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ:
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–µ—Ä—Å–∏–∏.
    - –ü–∞—Ä—Å–µ—Ä webhook‚Äô–æ–≤ —Ä–æ—É—Ç–∏—Ç—Å—è –ø–æ –≤–µ—Ä—Å–∏–∏.
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª–µ–π:
    - –°–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–µ–º –∏—Ö **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏**.
    - –ù–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥–µ–ª–∞–µ–º `schema_version = 2`, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º 1 –∏ 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

***

## –ë–ª–æ–∫ 3. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —á–µ–∫–∞ –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

5Ô∏è‚É£ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ —á–µ–∫—É**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —á–µ–∫ –∏–∑ POS –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ webhook)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í —Ç–∞–±–ª–∏—Ü–µ `POSTransaction`:
    - –•—Ä–∞–Ω–∏—Ç—å `pos_check_id`, `pos_system`, `restaurant_id`, `tenant_id`.
    - –í–≤–µ—Å—Ç–∏ **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å**: `(tenant_id, pos_system, pos_check_id)`.
- –ü—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ webhook:
    - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å —Ç–∞–∫–∏–º `pos_check_id` —É–∂–µ –µ—Å—Ç—å ‚Üí –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º OK, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –Ω–æ–≤—ã—Ö `BallTransaction` (–∏–ª–∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏ –ª–æ–≥–∏—Ä—É–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ).
- –í `BallTransaction` —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É `postransaction_id` –∏ —Å—Ç–∞–≤–∏—Ç—å UNIQUE constraint –Ω–∞ `(postransaction_id, loyalty_rule_id)` (–∫–∞–∫ —Ç—ã —É–∂–µ —É—Ç–≤–µ—Ä–¥–∏–ª –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞).

***

6Ô∏è‚É£ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã/–≤–æ–∑–≤—Ä–∞—Ç–∞ —á–µ–∫–∞**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ —á–µ–∫ –≤ POS –æ—Ç–º–µ–Ω—ë–Ω –∏–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç –ø–æ–∑–∂–µ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- POS –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ/–≤–æ–∑–≤—Ä–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π webhook:
    - `type: "CANCEL" | "REFUND"`,
    - `original_pos_check_id`,
    - `refund_amount` (–µ—Å–ª–∏ —á–∞—Å—Ç–∏—á–Ω—ã–π).
- –ú—ã:
    - –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `POSTransaction` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ `BallTransaction`.
    - –°–æ–∑–¥–∞—ë–º **–æ–±—Ä–∞—Ç–Ω—ã–µ** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ `BallTransaction`:
        - –¢–∏–ø `CANCEL` / `REFUND`, —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º `amount`, –±–∞–ª–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫ –ø—Ä–µ–∂–Ω–µ–º—É —É—Ä–æ–≤–Ω—é.
    - –í `GuestVisit` –ø–æ–º–µ—á–∞–µ–º –≤–∏–∑–∏—Ç –∫–∞–∫ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–π/–≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã–π.
- –í—Å–µ —Ç–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∂—ë—Å—Ç–∫–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ ActivityLog.

***

## –ë–ª–æ–∫ 4. –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–æ–∫ –∏ –±–∞–ª–ª–æ–≤ –≤ —Å–≤—è–∑–∫–µ —Å POS

7Ô∏è‚É£ **–ì–¥–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–∫–∏–¥–∫–∞ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤: —É –Ω–∞—Å –∏–ª–∏ –≤ POS**

**–í–æ–ø—Ä–æ—Å:**
–ö—Ç–æ ¬´–≤–µ–¥—É—â–∏–π¬ª –≤ —Ä–∞—Å—á—ë—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º—ã –∫ –æ–ø–ª–∞—Ç–µ –∏ —Å—É–º–º—ã —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ ‚Äî POS –∏–ª–∏ –Ω–∞—à backend?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–∞—Ä–∏–∞–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ª—É—á—à–µ –≤—Å–µ–≥–æ –±—å—ë—Ç—Å—è —Å —É–∂–µ –ø—Ä–∏–Ω—è—Ç—ã–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏:
    - **POS ‚Üí –≤–µ–¥—É—â–∏–π –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º–µ —á–µ–∫–∞** (–≤—Å—ë, —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–º —á–µ–∫–æ–º).
    - **–ù–∞—à backend ‚Üí –≤–µ–¥—É—â–∏–π –≤ —Ä–∞—Å—á—ë—Ç–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**.
- –ü–æ—Ç–æ–∫:

1. POS –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π —á–µ–∫–∞ –¥–µ–ª–∞–µ—Ç **API-–∑–∞–ø—Ä–æ—Å –∫ –Ω–∞–º**:
        - `/api/loyalty/calculate` —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –≥–æ—Å—Ç–µ –∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Å–∫–∏–¥–∫–∞—Ö/—Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤.
2. –ú—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º:
        - —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—É—é —Å–∫–∏–¥–∫—É,
        - —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—É—é —Å—É–º–º—É —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ (—Å —É—á—ë—Ç–æ–º –ª–∏–º–∏—Ç–æ–≤),
        - –∏—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—é.
3. POS –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∫–∏–¥–∫—É –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ —Å–≤–æ–∏–º –ø—Ä–∞–≤–∏–ª–∞–º, –Ω–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π webhook:
        - –ø–µ—Ä–µ–¥–∞—ë—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–ø–∏—Å–∞–Ω–Ω—ã–µ –±–∞–ª–ª—ã –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—É–º–º—ã.
4. –í –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–º reconciliation —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º ¬´–æ–∂–∏–¥–∞–µ–º—ã–µ¬ª –∏ ¬´—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ¬ª –∑–Ω–∞—á–µ–Ω–∏—è.

***

8Ô∏è‚É£ **Reconciliation –ø–æ —Å–∫–∏–¥–∫–∞–º/–±–∞–ª–ª–∞–º –º–µ–∂–¥—É POS –∏ backend**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ POS –≤ –∏—Ç–æ–≥–µ –ø—Ä–∏–º–µ–Ω–∏–ª —Å–∫–∏–¥–∫—É/—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —Ç–∞–∫, –∫–∞–∫ –º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª–∏?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–µ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—É `BallReconciliation`:
    - `postransaction_id`, `expected_earned_points`, `actual_earned_points`, `expected_redeemed`, `actual_redeemed`, `difference`, `status`.
- –ù–æ—á–Ω–æ–π/–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π job:
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤—ã—à–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, >1% –∏–ª–∏ >10 –±–∞–ª–ª–æ–≤).
    - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ `BallReconciliation` –∏ —à–ª—ë—Ç –∞–ª–µ—Ä—Ç—ã Admin‚Äô—É.
- Admin –≤ UI:
    - –í–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π.
    - –ú–æ–∂–µ—Ç:
        - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω—è—Ç—å POS –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–∞—è `BallTransaction`,
        - –≤—Ä—É—á–Ω—É—é —Ä–µ—à–∏—Ç—å, —á—Ç–æ –¥–µ–ª–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å, –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ `RESOLVED_IGNORE`).

***

## –ë–ª–æ–∫ 5. PULL-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –±—ç–∫–∞–ø

9Ô∏è‚É£ **–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –∑–∞–±–∏—Ä–∞—Ç—å –≤ PULL-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –∑–∞ –∫–∞–∫–æ–π –ø–µ—Ä–∏–æ–¥ –º—ã –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –∏–∑ POS –≤ —Ä–µ–∂–∏–º–µ PULL?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç:
    - –ó–∞–±–∏—Ä–∞–µ–º **—Å–ø–∏—Å–æ–∫ —á–µ–∫–æ–≤**, –∑–∞–∫—Ä—ã—Ç—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, 2‚Äì4 —á–∞—Å–∞ (—Å –∑–∞–ø–∞—Å–æ–º) –ø–æ –∫–∞–∂–¥–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É.
    - –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ `last_sync_time` –Ω–∞ –Ω–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å.
    - –ü–æ –∫–∞–∂–¥–æ–º—É —á–µ–∫—É:
        - —Å–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤ `POSTransaction`,
        - –µ—Å–ª–∏ webhook –Ω–µ –ø—Ä–∏—à—ë–ª ‚Äî —Å–æ–∑–¥–∞—ë–º `POSTransaction` –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `BallTransaction`.
- –¢–∞–∫–∂–µ PULL –º–æ–∂–µ—Ç:
    - –ø–æ–¥—Ç—è–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –≥–æ—Å—Ç–µ–π POS (–µ—Å–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –¥–æ –Ω–∞—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª POS-–∫–ª–∏–µ–Ω—Ç–æ–≤),
    - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å admin ¬´–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª –∏—Ö –≤ –Ω–∞—à—É —Å–∏—Å—Ç–µ–º—É.

***

üîü **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—è / –æ—à–∏–±–æ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ 3 –¥–Ω—è, –∞ –ø–æ—Ç–æ–º –≤–∫–ª—é—á–∏–ª–∞—Å—å?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í `POSIntegration` —Ö—Ä–∞–Ω–∏—Ç—å:
    - `last_successful_pull_at`,
    - `last_successful_push_at`,
    - `is_paused`.
- –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏/—Ä–∞–∑–ø–∞—É–∑–µ:
    - –∑–∞–ø—É—Å–∫–∞–µ–º **one-time backfill**:
        - PULL –≤—Å–µ—Ö —á–µ–∫–æ–≤ –∑–∞ `N` –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (N –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7).
    - –û—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞: `BACKFILL_IN_PROGRESS`.
- –ù–∞ UI admin –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å:
    - —Å–∫–æ–ª—å–∫–æ —á–µ–∫–æ–≤ –ø–æ–¥—Ç—è–Ω—É—Ç–æ, —Å–∫–æ–ª—å–∫–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ,
    - –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã (–µ—Å–ª–∏ –≥–æ—Å—Ç—å/–∫–∞—Ä—Ç–∞ —É–∂–µ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã, –∏ —Ç.–ø.).

***

## –ë–ª–æ–∫ 6. Multi-restaurant, multi-POS –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

1Ô∏è‚É£1Ô∏è‚É£ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö POS-—Å–∏—Å—Ç–µ–º –≤ –æ–¥–Ω–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ**

**–í–æ–ø—Ä–æ—Å:**
–ú–æ–∂–µ—Ç –ª–∏ –æ–¥–∏–Ω —Ä–µ—Å—Ç–æ—Ä–∞–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, iiko + R-Keeper (—Ä–∞–∑–Ω—ã–µ –∫–∞—Å—Å—ã/–∑–∞–ª—ã)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `POSIntegration`:
    - `tenant_id`, `restaurant_id`, `pos_system`, `pos_instance_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–∑–∞–ª 1¬ª, ¬´–¥–æ—Å—Ç–∞–≤–∫–∞¬ª).
- –†–∞–∑—Ä–µ—à–∞—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π** –Ω–∞ –æ–¥–∏–Ω —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –Ω–æ:
    - –∫–∞–∂–¥–∞—è —Å–æ —Å–≤–æ–∏–º `pos_instance_id`.
    - –í —á–µ–∫–µ POS –ø—Ä–∏—Å—ã–ª–∞–µ—Ç `pos_instance_id`.
- –ù–∞ —É—Ä–æ–≤–Ω–µ –ª–æ–≥–∏–∫–∏:
    - –¥–ª—è –≥–æ—Å—Ç—è –∏ –±–∞–ª–ª–æ–≤ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –≤–∞–∂–Ω–æ, –æ—Ç –∫–∞–∫–æ–π –∫–∞—Å—Å—ã/—Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏—à—ë–ª —á–µ–∫ ‚Äî –≤—Å–µ –∏–¥—É—Ç –≤ –æ–¥–Ω—É `GuestCard`.

***

1Ô∏è‚É£2Ô∏è‚É£ **–í–µ–¥–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ POS ‚Üî –Ω–∞—à–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –º–∞–ø–ø–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏–∑ POS –Ω–∞ –Ω–∞—à `Restaurant`?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í —Ç–∞–±–ª–∏—Ü–µ `POSIntegrationRestaurants`:
    - `tenant_id`, `restaurant_id`, `pos_system`, `pos_unit_id`, `pos_unit_name`.
- –ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
    - Admin –≤ UI –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤/–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –∏–∑ POS (—á–µ—Ä–µ–∑ API).
    - –î–µ–ª–∞–µ—Ç –º–∞–ø–ø–∏–Ω–≥:
        - POS-—Ä–µ—Å—Ç–æ—Ä–∞–Ω ‚Üí –Ω–∞—à Restaurant.
- –í webhook‚Äô–∞—Ö POS –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç `pos_unit_id`, –º—ã –∏—â–µ–º —Å–≤—è–∑–∫—É –∏ –ø–æ–ª—É—á–∞–µ–º –Ω–∞—à `restaurant_id`.

***

## –ë–ª–æ–∫ 7. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ SLA

1Ô∏è‚É£3Ô∏è‚É£ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP / —Å–µ—Ç–∏ –¥–ª—è webhook‚Äô–æ–≤**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ HMAC –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å IP-–∞–¥—Ä–µ—Å–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ webhook‚Äô–æ–≤?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–∞, –Ω–æ –∫–∞–∫ **–≤—Ç–æ—Ä—É—é –ª–∏–Ω–∏—é –∑–∞—â–∏—Ç—ã**:
    - –í –∫–æ–Ω—Ñ–∏–≥–µ `POSIntegration` —Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP/–¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (–µ—Å–ª–∏ POS-–ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç).
    - –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ webhook —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å HMAC, –ø–æ—Ç–æ–º IP:
        - –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –æ–∫, IP –≤–Ω–µ —Å–ø–∏—Å–∫–∞ ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π, –Ω–æ –º–æ–∂–Ω–æ –ø–æ –∂–µ–ª–∞–Ω–∏—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –ª–∏–±–æ –ø—Ä–∏—ë–º, –ª–∏–±–æ –±–ª–æ–∫.

***

1Ô∏è‚É£4Ô∏è‚É£ **–¢–∞–π–º–∞—É—Ç—ã –∏ —Ä–µ—Ç—Ä–∞–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ POS API (PULL, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã)**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API POS?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –¢–∞–π–º–∞—É—Ç—ã:
    - `connect_timeout` 2‚Äì3 —Å–µ–∫—É–Ω–¥—ã,
    - `read_timeout` 5‚Äì10 —Å–µ–∫—É–Ω–¥.
- –†–µ—Ç—Ä–∞–∏:
    - –¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫ —Å backoff (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1s, 3s, 10s).
- –ü—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö:
    - –ø–æ–º–µ—á–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∫–∞–∫ `DEGRADED`,
    - –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Admin‚Äô—É –∏ Owner‚Äô—É (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è).

***

## –ë–ª–æ–∫ 8. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ UI –¥–ª—è –∞–¥–º–∏–Ω–∞

1Ô∏è‚É£5Ô∏è‚É£ **–£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ –ø–æ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ `POSSync` –∏ ActivityLog, —á—Ç–æ–±—ã –∏ –Ω–µ –∑–∞–±–∏—Ç—å –ë–î –º—É—Å–æ—Ä–æ–º, –∏ –∏–º–µ—Ç—å –ø–æ–ª–Ω—É—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í `POSSync`:
    - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ PULL/PUSH:
        - —Ç–∏–ø (`PULL_CHECKS`, `PULL_GUESTS`, `WEBHOOK_TRANSACTION`),
        - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π,
        - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–æ—à–∏–±–æ—á–Ω—ã—Ö,
        - —Å—Ç–∞—Ç—É—Å (SUCCESS, FAILED, PARTIAL),
        - –æ—à–∏–±–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å).
- –í ActivityLog:
    - —Ç–æ–ª—å–∫–æ **—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è**:
        - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏,
        - –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ/–ø–∞—É–∑—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏,
        - –∑–Ω–∞—á–∏–º—ã–µ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, N –ø–æ–¥—Ä—è–¥ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö PULL‚Äô–æ–≤),
        - —Ä—É—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è admin –ø–æ —Ä–∞–∑—Ä—É–ª–∏–≤–∞–Ω–∏—é –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

***

1Ô∏è‚É£6Ô∏è‚É£ **UI-–¥—ç—à–±–æ—Ä–¥ ¬´–∑–¥–æ—Ä–æ–≤—å—è¬ª POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–∫–∞–∑–∞—Ç—å Admin‚Äô—É –ø–æ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ù–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ ¬´–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞—Å—Å–∞–º–∏¬ª:
    - –°—Ç–∞—Ç—É—Å –ø–æ –∫–∞–∂–¥–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É –∏ POS-—Å–∏—Å—Ç–µ–º–µ:
        - `ACTIVE`, `DEGRADED`, `DISABLED`, `ERROR`.
    - –ü–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π webhook, –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π PULL.
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞:
        - —á–µ—Ä–µ–∑ webhook,
        - —á–µ—Ä–µ–∑ PULL.
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–µ–∫–æ–≤ / –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–∏–∑ `BallReconciliation`).
- –¶–≤–µ—Ç–æ–≤–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∏ –∞–ª–µ—Ä—Ç—ã (e-mail/Telegram Owner/Restaurant Admin).

***

## –ë–ª–æ–∫ 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–µ—Ä—Å–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

1Ô∏è‚É£7Ô∏è‚É£ **Sandbox / test-—Ä–µ–∂–∏–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–µ–Ω –ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π ¬´—Ç–µ—Å—Ç–æ–≤—ã–π¬ª —Ä–µ–∂–∏–º –¥–ª—è POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω –º–æ–≥ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∂–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í `POSIntegration` –∏–º–µ—Ç—å:
    - `mode: "PRODUCTION" | "SANDBOX"`.
- –í SANDBOX:
    - Webhook‚Äô–∏ –∏ PULL:
        - –ø–∏—à—É—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã/—Ç–µ–Ω–∞–Ω—Ç—ã –∏–ª–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è —Ñ–ª–∞–≥–æ–º `is_test:true`.
    - –ë–∞–ª–ª—ã –∏ –≥–æ—Å—Ç–∏:
        - –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è, –Ω–æ:
            - –ª–∏–±–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º ¬´—Ç–µ—Å—Ç–æ–≤–æ–º¬ª —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ,
            - –ª–∏–±–æ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ —É–¥–∞–ª—è—é—Ç—Å—è/–æ–±–Ω—É–ª—è—é—Ç—Å—è.
- –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ iiko/R-Keeper –∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º.

***

1Ô∏è‚É£8Ô∏è‚É£ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –Ω–∞ –Ω–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–¥–∏–Ω —Ä–µ—Å—Ç–æ—Ä–∞–Ω —É–∂–µ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ö–µ–º–µ POS, –∞ –¥—Ä—É–≥–æ–π –µ—â—ë –Ω–∞ —Å—Ç–∞—Ä–æ–π?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í `POSIntegration`:
    - –ø–æ–ª–µ `integration_version` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1`, `2`).
- –í –∫–æ–¥–µ backend:
    - –∫–∞–∂–¥—ã–π POS-–ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–º ¬´–∞–¥–∞–ø—Ç–µ—Ä–æ–º¬ª:
        - `IikoAdapterV1`, `IikoAdapterV2`, `RKeeperAdapterV1`, –∏ —Ç.–ø.
    - Webhook-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç –Ω—É–∂–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä –ø–æ `pos_system + integration_version`.
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –±–µ–∑–±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ API POS.

***

## –ë–ª–æ–∫ 10. –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –∏ —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

1Ô∏è‚É£9Ô∏è‚É£ **–ö—Ç–æ –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å —Ä–µ-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**

**–í–æ–ø—Ä–æ—Å:**
–ö—Ç–æ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä—É—á–Ω–æ–π ¬´Re-sync —Å POS –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —á–∞—Å–æ–≤/–¥–Ω–µ–π¬ª?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü—Ä–∞–≤–∞:
    - Owner: –¥–ª—è –ª—é–±–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞.
    - Restaurant Admin: —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–≤–æ–µ–≥–æ tenant‚Äô–∞.
- –í UI:
    - –ö–Ω–æ–ø–∫–∞ ¬´–ü–µ—Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫–∏¬ª:
        - –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞),
        - –≤—ã–±—Ä–∞—Ç—å POS-–∏–Ω—Å—Ç–∞–Ω—Å.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
    - –ù–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ X –º–∏–Ω—É—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15), —á—Ç–æ–±—ã –Ω–µ –ø–æ–ª–æ–∂–∏—Ç—å POS –∏ –Ω–∞—à backend.

***

2Ô∏è‚É£0Ô∏è‚É£ **–†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –±–∞–ª–ª–æ–≤ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É POS-—á–µ–∫—É**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–µ–Ω –ª–∏ —É–¥–æ–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —á—Ç–æ–±—ã Admin/Manager –º–æ–≥ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –±–∞–ª–ª—ã –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —á–µ–∫—É, –µ—Å–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∞–ª–∞ —Å–±–æ–π?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–∞, —ç—Ç–æ —Å–∏–ª—å–Ω–æ —Å–Ω–∏–∑–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É:
    - –í –∫–∞—Ä—Ç–æ—á–∫–µ –≥–æ—Å—Ç—è / –∏—Å—Ç–æ—Ä–∏–∏ —á–µ–∫–æ–≤:
        - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–∑–∏—Ç–∞ (—Å–≤—è–∑–∞–Ω–Ω—ã–π —Å `POSTransaction`) –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É ¬´–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–ª—ã¬ª.
    - –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏:
        - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞:
            - ¬´–¥–æ–±–∞–≤–∏—Ç—å¬ª –∏–ª–∏ ¬´—Å–ø–∏—Å–∞—Ç—å¬ª –±–∞–ª–ª—ã,
            - –ø—Ä–∏—á–∏–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ),
            - —Å—Å—ã–ª–∫–∞ –Ω–∞ —á–µ–∫.
    - –í –ë–î:
        - —Å–æ–∑–¥–∞—ë—Ç—Å—è `BallTransaction` —Ç–∏–ø–∞ `MANUAL_ADJUST_POS_MISMATCH`.
- –≠—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—Ç—å –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –æ–±—ä—ë–º —Ä—É—á–Ω—ã—Ö –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤.

***

2Ô∏è‚É£1Ô∏è‚É£ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è Cashier vs Manager –≤ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã Cashier, –∞ –∫–∞–∫–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ Manager/Admin?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **Cashier**:
    - –º–æ–∂–µ—Ç –ª–∏—à—å –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–±–∏—Ç–∏–∏ —á–µ–∫–∞ (—á–µ—Ä–µ–∑ POS).
    - –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, —Ä–µ-—Å–∏–Ω–∫–∞–º, –∫–æ–Ω—Ñ–∏–≥–∞–º.
- **Manager / Restaurant Admin**:
    - –¥–æ—Å—Ç—É–ø –∫:
        - —Ä—É—á–Ω—ã–º —Ä–µ-—Å–∏–Ω–∫–∞–º,
        - –ø—Ä–æ—Å–º–æ—Ç—Ä—É —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏,
        - —Ä—É—á–Ω—ã–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞–º –ø–æ —á–µ–∫–∞–º.
- –í—Å—ë —ç—Ç–æ —É–∂–µ –ª–æ–∂–∏—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é RBAC-—Å–∏—Å—Ç–µ–º—É: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ permissions, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    - `manage_pos_integration`, `trigger_pos_resync`, `adjust_points_for_pos_transaction`.

***

–ï—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–µ–±–µ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—Ç–∏–º –µ–≥–æ –∫–∞–∫ ¬´–æ—Ç–∫–ª–æ–Ω—ë–Ω¬ª –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –¥—Ä—É–≥–æ–π.
–î–∞–ª—å—à–µ –º–æ–∂–Ω–æ:

- –ª–∏–±–æ –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ —ç—Ç–∏–º 20+ –≤–æ–ø—Ä–æ—Å–∞–º –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å/–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å,
- –ª–∏–±–æ —Å–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –±–ª–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å/–º—É–ª—å—Ç–∏-—Ä–µ—Å—Ç–æ—Ä–∞–Ω) –≤–∞–∂–Ω–µ–µ —É—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–µ—Ä–≤—ã–º–∏ ‚Äî –∏ –Ω–∞—á–Ω—ë–º —Å –Ω–∏—Ö.
<span style="display:none">[^3_1][^3_2][^3_3][^3_4][^3_5]</span>

<div align="center">‚ÅÇ</div>

[^3_1]: Beseda-5.md

[^3_2]: Beseda-4.md

[^3_3]: Beseda-3.md

[^3_4]: Beseda-2.md

[^3_5]: Beseda-1.md


---

# –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã :

    1. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    2.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    3.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    4.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    5.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    6.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    7.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    8.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    9.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ù–æ "–ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å" –∞–¥–º–∏–Ω—É –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤ —Å–∏—Å—Ç–µ–º—É –∏ –≤—Å–µ. 
    10.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    11.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    12.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    13.–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å IP-–∞–¥—Ä–µ—Å–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–µ –Ω—É–∂–Ω–æ. 
    14.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    15.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    16.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    17.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    18.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    19.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    20.–¢–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –Ω—É–∂–µ–Ω. 
    21.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    –£—á–∏—Ç—ã–≤–∞—è –æ—Ç–≤–µ—Ç—ã, –≤—ã–≤–µ–¥–∏ —Å—é–¥–∞ –≤ —á–∞—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ—Å–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞.

–ù–∏–∂–µ ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å POS (iiko / R-Keeper) —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö —Ç–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.

***

## 1. –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**:
    - **PUSH**: POS —à–ª—ë—Ç webhooks –ø–æ –∫–∞–∂–¥–æ–º—É —á–µ–∫—É.
    - **PULL**: –Ω–∞—à backend –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç POS –∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç —á–µ–∫–∏/–¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–ª—É—á–∞–π –ø–æ—Ç–µ—Ä—å webhook‚Äô–æ–≤ –∏ –¥–ª—ë–Ω–Ω—ã—Ö –ø—Ä–æ—Å—Ç–æ–µ–≤.
- POS ‚Äî **–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –ø–æ —á–µ–∫–∞–º –∏ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º–µ**.
- –ù–∞—à backend ‚Äî **–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –ø–æ –±–∞–ª–ª–∞–º, —É—Ä–æ–≤–Ω—è–º –∏ –ª–æ–≥–∏–∫–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**.
- –ë–∞–ª–ª—ã:
    - –≤—Å–µ–≥–¥–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è **–æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã —á–µ–∫–∞** (–¥–æ —Å–∫–∏–¥–æ–∫),
    - 1 –±–∞–ª–ª = 1 —Ä—É–±–ª—å,
    - –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏: —Å–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞—Ç—è—Ç—Å—è **–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ** –±–∞–ª–ª—ã, –ø–æ—Ç–æ–º **–æ—Å–Ω–æ–≤–Ω—ã–µ**,
    - –¥–∞–∂–µ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤, –∫–µ—à–±—ç–∫ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –æ—Ç **–ø–æ–ª–Ω–æ–π —Å—É–º–º—ã —á–µ–∫–∞**.

***

## 2. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ—Å—Ç—è –∏ –∫–∞—Ä—Ç—ã

### 2.1. –ö–ª—é—á–∏ —Å–≤—è–∑–∏ POS ‚Üî –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞

- –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á –¥–ª—è –ø–æ–∏—Å–∫–∞ –≥–æ—Å—Ç—è –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ: **–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞**.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥:
    - –¢–∞–±–ª–∏—Ü–∞ `POSGuestLink`:
        - `tenant_id`
        - `restaurant_id`
        - `pos_system` (IIKO / RKEEPER)
        - `pos_guest_id`
        - `guest_card_id`
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —á–µ–∫–µ:
    - –ï—Å–ª–∏ POS —à–ª—ë—Ç `guest_phone`:
        - –∏—â–µ–º `GuestCard` –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É,
        - –µ—Å–ª–∏ –Ω–∞—à–ª–∏ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤—è–∑–∫—É `pos_guest_id ‚Üî guest_card_id` –≤ `POSGuestLink`.


### 2.2. –ï—Å–ª–∏ –≥–æ—Å—Ç—å –∏–∑ POS –Ω–µ –Ω–∞–π–¥–µ–Ω —É –Ω–∞—Å

- –í `POSIntegration` –µ—Å—Ç—å —Ñ–ª–∞–≥ `auto_create_guest_on_pos_webhook` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **true**).
- –ï—Å–ª–∏ –≥–æ—Å—Ç—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –Ω–µ –Ω–∞–π–¥–µ–Ω:
    - **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë–º**:
        - `User` (role = GUEST),
        - `GuestProfile`,
        - `GuestCard` –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Ç–µ–Ω–∞–Ω—Ç–∞,
        - `registration_source = POS_AUTO`.
    - –°—Ä–∞–∑—É —Å–≤—è–∑—ã–≤–∞–µ–º —Å `pos_guest_id` —á–µ—Ä–µ–∑ `POSGuestLink`.
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∞–¥–º–∏–Ω—É ¬´–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª –≤—Ä—É—á–Ω—É—é ‚Äî –∏–º–ø–æ—Ä—Ç –∏–¥—ë—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**.

***

## 3. Webhook –æ—Ç POS (PUSH)

### 3.1. Endpoint –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞

- Endpoint: `POST /api/pos/webhooks/transaction`.
- –§–æ—Ä–º–∞—Ç: **JSON**.
- –ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–π (–º–∏–Ω–∏–º—É–º):

```json
{
  "schema_version": 1,
  "pos_system": "IIKO",                // –∏–ª–∏ "RKEEPER"
  "tenant_external_code": "TENANT_X",  // –∏–ª–∏ tenant_id, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  "pos_unit_id": "REST_01",           // –≤–Ω–µ—à–Ω–∏–π ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –≤ POS
  "pos_check_id": "CHK-123456",       // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —á–µ–∫–∞ –≤ POS
  "guest_phone": "+79991234567",
  "pos_guest_id": "GUEST-987",
  "check_amount": 2000.00,            // —Å—É–º–º–∞ –¥–æ —Å–∫–∏–¥–æ–∫
  "discount_amount": 100.00,          // –æ–±—â–∞—è —Å–∫–∏–¥–∫–∞ –¥–µ–Ω—å–≥–∞–º–∏
  "paid_amount": 1900.00,             // —Ä–µ–∞–ª—å–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ –¥–µ–Ω—å–≥–∞–º–∏
  "paid_with_points": 100.00,         // –µ—Å–ª–∏ POS —Å–∞–º —á—Ç–æ-—Ç–æ —Å–ø–∏—Å–∞–ª –±–∞–ª–ª–∞–º–∏
  "timestamp": "2026-02-06T12:34:56Z",
  "items": [
    {
      "item_id": "ITEM-1",
      "name": "–ü–∏—Ü—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞",
      "category": "–ü–∏—Ü—Ü–∞",
      "price": 500.00,
      "quantity": 2,
      "total": 1000.00
    }
  ],
  "cashier_id": "CASH-1",
  "payment_method": "CARD",
  "order_type": "DINE_IN"
}
```


### 3.2. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ —á–µ–∫—É

- –¢–∞–±–ª–∏—Ü–∞ `POSTransaction`:
    - `tenant_id`, `restaurant_id`, `pos_system`, `pos_check_id`, ... + —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å:
    - `(tenant_id, pos_system, pos_check_id)` ‚Äî –∏—Å–∫–ª—é—á–∞–µ—Ç –¥–≤–æ–π–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —á–µ–∫–∞.
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º webhook —Å —Ç–µ–º –∂–µ `pos_check_id`:
    - –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º OK,
    - –µ—Å–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è ‚Äî —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤ reconciliation (—Å–º. –Ω–∏–∂–µ).

***

## 4. –û—Ç–º–µ–Ω–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã —á–µ–∫–æ–≤

- POS –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ/–≤–æ–∑–≤—Ä–∞—Ç–µ —à–ª—ë—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π webhook, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```json
{
  "schema_version": 1,
  "pos_system": "IIKO",
  "tenant_external_code": "TENANT_X",
  "pos_unit_id": "REST_01",
  "type": "REFUND",                   // –∏–ª–∏ "CANCEL"
  "original_pos_check_id": "CHK-123456",
  "refund_amount": 2000.00,
  "timestamp": "2026-02-06T15:00:00Z"
}
```

- –ú—ã:
    - –Ω–∞—Ö–æ–¥–∏–º `POSTransaction` –ø–æ `original_pos_check_id`,
    - –Ω–∞—Ö–æ–¥–∏–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ `BallTransaction`,
    - —Å–æ–∑–¥–∞—ë–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏:
        - `BallTransaction` —Å —Ç–∏–ø–æ–º `REFUND`/`CANCEL` –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º `amount`,
    - –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã,
    - –ø–æ–º–µ—á–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `GuestVisit` –∫–∞–∫ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–π/–≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã–π.

***

## 5. –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–æ–∫ –∏ –±–∞–ª–ª–æ–≤ –≤ —Å–≤—è–∑–∫–µ —Å POS

### 5.1. API ¬´—Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π¬ª

- –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ POS –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç —Å–∫–∏–¥–∫—É/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤, –æ–Ω –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –Ω–∞–º:

`POST /api/loyalty/calculate`

–í—Ö–æ–¥:

- –¥–∞–Ω–Ω—ã–µ –æ –≥–æ—Å—Ç–µ (—Ç–µ–ª–µ—Ñ–æ–Ω / `guest_card_id` / `pos_guest_id`),
- –ø–ª–∞–Ω–∏—Ä—É–µ–º–∞—è —Å—É–º–º–∞ —á–µ–∫–∞,
- –∂–µ–ª–∞–µ–º–∞—è —Å—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ (–µ—Å–ª–∏ –∫–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç –≤—Ä—É—á–Ω—É—é),
- –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–≤—Ä–µ–º—è, —Ç–∏–ø –∑–∞–∫–∞–∑–∞, —Ä–µ—Å—Ç–æ—Ä–∞–Ω –∏ —Ç.–¥.).

–ú—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º:

- –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—É—é —Å—É–º–º—É —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ (—Å —É—á—ë—Ç–æ–º:
    - `min_balls_to_redeem = 1`,
    - `min_check_amount = 50`,
    - `% –ª–∏–º–∏—Ç–∞ –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ —Å–∏—Å—Ç–µ–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20%, admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç 10‚Äì100%),
- —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—É—é –∫ —Å–ø–∏—Å–∞–Ω–∏—é —Å—É–º–º—É,
- –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ –Ω–∞—á–∏—Å–ª—è–µ–º—ã–º –±–∞–ª–ª–∞–º –æ—Ç **–∏—Å—Ö–æ–¥–Ω–æ–π** —Å—É–º–º—ã —á–µ–∫–∞,
- –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞/–ø—Ä–æ–º–æ.

POS –º–æ–∂–µ—Ç:

- –ø—Ä–∏–Ω—è—Ç—å –Ω–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –µ—Å—Ç—å,
- –∏–ª–∏ –æ—Ç—Å—Ç—É–ø–∏—Ç—å (—Ç–æ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è reconciliation).


### 5.2. Reconciliation (—Å–≤–µ—Ä–∫–∞)

- –¢–∞–±–ª–∏—Ü–∞ `BallReconciliation`:
    - `postransaction_id`,
    - `expected_earned_points`, `actual_earned_points`,
    - `expected_redeemed_points`, `actual_redeemed_points`,
    - `difference`, `percent_diff`, `status`.
- –ù–æ—á–Ω–æ–π/–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π job:
    - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, >1% –∏–ª–∏ >10 –±–∞–ª–ª–æ–≤),
    - —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ `BallReconciliation`,
    - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Restaurant Admin‚Äô—É.
- Admin –≤ UI:
    - –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π,
    - –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ (–∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ—Ç–º–µ—Ç–∏—Ç—å ¬´–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ¬ª / ¬´—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–±—ä—è—Å–Ω–∏–º–æ¬ª).
- **–†—É—á–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ ¬´–ø–æ–ø—Ä–∞–≤–∏—Ç—å –±–∞–ª–ª—ã –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —á–µ–∫—É¬ª –Ω–µ –¥–µ–ª–∞–µ–º** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –¥–µ–ª–∞—é—Ç—Å—è –¥—Ä—É–≥–∏–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ (—Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ Manager/Admin, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ).

***

## 6. PULL-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

### 6.1. –ß—Ç–æ –∑–∞–±–∏—Ä–∞–µ–º

- –ö–∞–∂–¥—ã–µ **30 –º–∏–Ω—É—Ç** backend –∑–∞–ø—É—Å–∫–∞–µ—Ç job:

1. –ü–æ –∫–∞–∂–¥–æ–º—É `POSIntegration`:
    - —á–∏—Ç–∞–µ—Ç `last_successful_pull_at`.
2. –ü–æ –∫–∞–∂–¥–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É/–∏–Ω—Å—Ç–∞–Ω—Å—É POS:
    - –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ POS API –∑–∞ —á–µ–∫–∞–º–∏, –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥:
        - –ø—Ä–∏–º–µ—Ä–Ω–æ `[last_successful_pull_at - –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å, now]`.
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–µ–∫–∞:
    - –µ—Å–ª–∏ `pos_check_id` –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `POSTransaction`:
        - —Å–æ–∑–¥–∞—ë–º `POSTransaction`,
        - —Å–æ–∑–¥–∞—ë–º/–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º `GuestVisit`,
        - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—á–∏—Å–ª—è–µ–º/–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –±–∞–ª–ª—ã (`BallTransaction`), –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤–∏–ª.

### 6.2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–æ—Å—Ç–æ–µ–≤

- –í `POSIntegration`:
    - `last_successful_pull_at`,
    - `is_paused`,
    - `backfill_status` (NONE / IN_PROGRESS / COMPLETED / FAILED).
- –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏–ª–∏ —Å–Ω—è—Ç–∏–∏ –ø–∞—É–∑—ã:
    - –∑–∞–ø—É—Å–∫–∞–µ–º **—Ä–∞–∑–æ–≤—ã–π backfill**:
        - –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º —á–µ–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, 7),
        - –ø–æ–º–µ—á–∞–µ–º —Å—Ç–∞—Ç—É—Å–æ–º `BACKFILL_IN_PROGRESS` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ UI.

***

## 7. Multi-restaurant –∏ multi-POS

### 7.1. –ù–µ—Å–∫–æ–ª—å–∫–æ POS-—Å–∏—Å—Ç–µ–º –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞

- –í–æ–∑–º–æ–∂–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —Ä–µ—Å—Ç–æ—Ä–∞–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ POS-–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤:
    - —Ä–∞–∑–Ω—ã–µ –∑–∞–ª—ã, –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ —Ç.–ø.,
    - –∏–ª–∏ –¥–∞–∂–µ —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (iiko + R-Keeper).
- –í `POSIntegration` –∏ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ:
    - `tenant_id`
    - `restaurant_id`
    - `pos_system` (IIKO / RKEEPER)
    - `pos_instance_id` (—Å—Ç—Ä–æ–∫–∞: ¬´–∑–∞–ª1¬ª, ¬´–¥–æ—Å—Ç–∞–≤–∫–∞¬ª, –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π ID)
- –í –∫–∞–∂–¥–æ–º —á–µ–∫–æ–≤–æ–º webhook POS –ø—Ä–∏—Å—ã–ª–∞–µ—Ç `pos_instance_id`, –º—ã –ø–æ –Ω–µ–º—É –Ω–∞—Ö–æ–¥–∏–º –Ω—É–∂–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω.


### 7.2. –ú–∞–ø–ø–∏–Ω–≥ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ POS ‚Üî –Ω–∞—à–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã

- –¢–∞–±–ª–∏—Ü–∞ `POSIntegrationRestaurants`:
    - `tenant_id`
    - `restaurant_id`
    - `pos_system`
    - `pos_unit_id` (–≤–Ω–µ—à–Ω–∏–π ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –≤ POS)
    - `pos_unit_name`
- –ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
    - —á–µ—Ä–µ–∑ POS API –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π,
    - Restaurant Admin –≤ UI –º–∞–ø–ø–∏—Ç –∏—Ö –Ω–∞ –Ω–∞—à–∏ `Restaurant`.

***

## 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

### 8.1. HMAC-–ø–æ–¥–ø–∏—Å—å webhook‚Äô–æ–≤

- –ö–∞–∂–¥—ã–π webhook –æ—Ç POS –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è HMAC-SHA256:
    - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `POSIntegration`,
    - –ø–æ–¥–ø–∏—Å—å –∏–¥—ë—Ç –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä `X-Signature`.
- –ù–∞—à backend:
    - –±–µ—Ä—ë—Ç ¬´—Å—ã—Ä–æ–µ¬ª —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞,
    - –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç HMAC –ø–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —Å–µ–∫—Ä–µ—Ç—É,
    - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º.
- –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Äî –∑–∞–ø—Ä–æ—Å –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç—Å—è, –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞, –Ω–æ IP-–∞–¥—Ä–µ—Å **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP –º—ã –Ω–µ –≤–≤–æ–¥–∏–º).


### 8.2. –¢–∞–π–º–∞—É—Ç—ã –∏ —Ä–µ—Ç—Ä–∞–∏ –ø—Ä–∏ PULL

- –ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è—Ö –∫ POS API:
    - `connect_timeout` ~ 2‚Äì3 —Å–µ–∫—É–Ω–¥—ã,
    - `read_timeout` ~ 5‚Äì10 —Å–µ–∫—É–Ω–¥.
- –†–µ—Ç—Ä–∞–∏:
    - –¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff: 1s ‚Üí 3s ‚Üí 10s.
- –ü—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö:
    - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `DEGRADED`,
    - Restaurant Admin –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

***

## 9. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 9.1. –¢–∞–±–ª–∏—Ü–∞ `POSSync`

- –î–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ PULL/PUSH/logging webhook‚Äô–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å:
    - `id`,
    - `tenant_id`, `restaurant_id`, `pos_system`, `pos_instance_id`,
    - `operation_type` (`WEBHOOK_TRANSACTION`, `PULL_CHECKS`, `PULL_GUESTS`, `BACKFILL`),
    - `records_total`, `records_success`, `records_failed`,
    - `status` (`SUCCESS`, `FAILED`, `PARTIAL`, `PENDING`),
    - `error_message` (–µ—Å–ª–∏ –µ—Å—Ç—å),
    - `started_at`, `finished_at`.


### 9.2. ActivityLog

- –í ActivityLog –ø–∏—à—É—Ç—Å—è —Ç–æ–ª—å–∫–æ **–∑–Ω–∞—á–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ/–ø–∞—É–∑–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏,
    - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∫–ª—é—á–∏, POS-–∏–Ω—Å—Ç–∞–Ω—Å—ã, –º–∞–ø–ø–∏–Ω–≥ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤),
    - —Ä–µ–∑–∫–∏–µ/—á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

***

## 10. UI –¥–ª—è –∞–¥–º–∏–Ω–∞: –¥—ç—à–±–æ—Ä–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- –û—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª ¬´–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞—Å—Å–∞–º–∏¬ª:

–ü–æ –∫–∞–∂–¥–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É / POS-–∏–Ω—Å—Ç–∞–Ω—Å—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:
    - –°—Ç–∞—Ç—É—Å: `ACTIVE`, `DEGRADED`, `DISABLED`, `ERROR`.
    - –î–∞—Ç–∞/–≤—Ä–µ–º—è:
        - –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ webhook,
        - –ø–æ—Å–ª–µ–¥–Ω–µ–π —É—Å–ø–µ—à–Ω–æ–π PULL-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
    - –ö–æ–ª-–≤–æ —á–µ–∫–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞:
        - –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ webhooks,
        - –¥–æ—Ç—è–Ω—É—Ç—ã—Ö —á–µ—Ä–µ–∑ PULL.
    - –ö–æ–ª-–≤–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ `BallReconciliation`.
- –ö–Ω–æ–ø–∫–∏/–¥–µ–π—Å—Ç–≤–∏—è:
    - ¬´–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É¬ª / ¬´–°–Ω—è—Ç—å —Å –ø–∞—É–∑—ã¬ª –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.
    - ¬´–ü–µ—Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥¬ª (—Å–º. –Ω–∏–∂–µ).

***

## 11. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ sandbox-—Ä–µ–∂–∏–º

### 11.1. Sandbox

- –í `POSIntegration`:
    - `mode: "PRODUCTION" | "SANDBOX"`.
- –í SANDBOX:
    - webhooks –∏ PULL-–∑–∞–ø—Ä–æ—Å—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤—ã–µ,
    - –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –∏–¥—Ç–∏ –ª–∏–±–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –≤–Ω—É—Ç—Ä–∏ —Ç–µ–Ω–∞–Ω—Ç–∞, –ª–∏–±–æ –≤ ¬´–ø–µ—Å–æ—á–Ω–∏—Ü—É¬ª (–ø–æ –∫–æ–Ω—Ñ–∏–≥—É),
    - –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç–ª–∞–¥–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –±–æ–µ–≤—ã–µ –±–∞–ª–∞–Ω—Å—ã –≥–æ—Å—Ç–µ–π.


### 11.2. –í–µ—Ä—Å–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- –í `POSIntegration`:
    - `integration_version` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1`, `2`).
- –ü–æ–¥ –∫–∞–∂–¥—É—é –≤–µ—Ä—Å–∏—é –¥–µ–ª–∞–µ—Ç—Å—è —Å–≤–æ–π –∞–¥–∞–ø—Ç–µ—Ä:
    - `IikoAdapterV1`, `IikoAdapterV2`, `RKeeperAdapterV1` –∏ —Ç.–ø.
- Webhook-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ `pos_system + integration_version` –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä.

***

## 12. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 12.1. –ö—Ç–æ —á—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å

- **Cashier**:
    - —á–µ—Ä–µ–∑ POS –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ (–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —á–µ–∫–∞–º–∏),
    - –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –Ω–∞—à–µ–π –∞–¥–º–∏–Ω–∫–µ.
- **Manager / Restaurant Admin**:
    - –≤–∏–¥—è—Ç –¥—ç—à–±–æ—Ä–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏,
    - –º–æ–≥—É—Ç:
        - –∏–∑–º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–≤ —Ä–∞–º–∫–∞—Ö —Å–≤–æ–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤/—Ç–µ–Ω–∞–Ω—Ç–∞),
        - –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä—É—á–Ω—ã–µ PULL-–æ–ø–µ—Ä–∞—Ü–∏–∏ (re-sync –∑–∞ –ø–µ—Ä–∏–æ–¥),
    - –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ permissions –≤ RBAC:
    - `manage_pos_integration`,
    - `trigger_pos_resync`,
    - `view_pos_integration_status`.


### 12.2. –†—É—á–Ω–∞—è —Ä–µ-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

- –ö–Ω–æ–ø–∫–∞ ¬´–ü–µ—Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫–∏¬ª:
    - –¥–æ—Å—Ç—É–ø–Ω–∞ Owner‚Äô—É –¥–ª—è –ª—é–±—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –∏ Restaurant Admin‚Äô—É –≤ —Å–≤–æ—ë–º tenant‚Äô–µ,
    - –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å:
        - POS-–∏–Ω—Å—Ç–∞–Ω—Å,
        - –ø–µ—Ä–∏–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞).
    - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã:
        - –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, 15 –º–∏–Ω—É—Ç –Ω–∞ –æ–¥–∏–Ω POS-–∏–Ω—Å—Ç–∞–Ω—Å.
- **–û—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ ¬´—Ä—É—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –±–∞–ª–ª–æ–≤ —Ä–æ–≤–Ω–æ –ø–æ —ç—Ç–æ–º—É —á–µ–∫—É¬ª –Ω–µ –¥–µ–ª–∞–µ–º** ‚Äî –¥–ª—è —Ä—É—á–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è Manager/Admin, –Ω–æ –Ω–µ –∑–∞–≤—è–∑–∞–Ω–Ω—ã–µ –Ω–∞ UI —á–µ–∫–∞.

***

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –º–æ–∂–Ω–æ –ø–æ—Å–≤—è—Ç–∏—Ç—å:

- –ª–∏–±–æ **Telegram Bot + Mini App** (–≥–æ—Å—Ç–µ–≤–æ–π UX),
- –ª–∏–±–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, **Billing \& Subscriptions / Payments**,
–≤ —Ç–∞–∫–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ: —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ + –º–æ–∏ –ª—É—á—à–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏–π. –ù–∞–ø–∏—à–∏, –∫–∞–∫–æ–π –±–ª–æ–∫ –±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º.
<span style="display:none">[^4_1][^4_2][^4_3][^4_4][^4_5]</span>

<div align="center">‚ÅÇ</div>

[^4_1]: –ë–µ—Å–µ–¥–∞ 5.md

[^4_2]: –ë–µ—Å–µ–¥–∞ 4.md

[^4_3]: –ë–µ—Å–µ–¥–∞ 3.md

[^4_4]: –ë–µ—Å–µ–¥–∞ 2.md

[^4_5]: –ë–µ—Å–µ–¥–∞ 1.md


---

# Billing \& Subscriptions / Payments —Å–ª–µ–¥—É—é—â–∏–π. –í —Ç–∞–∫–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ

–ù–∏–∂–µ –±–ª–æ–∫ **Billing \& Subscriptions / Payments** –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ: 20+ –≤–æ–ø—Ä–æ—Å–æ–≤ + –º–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.
–Ø –æ–ø–∏—Ä–∞—é—Å—å –Ω–∞ —É–∂–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—â–∏:

- 6 —Ç–∞—Ä–∏—Ñ–æ–≤ (Free, Standard, Medium, Pro, Ultimate, Custom),
- –ª–∏–º–∏—Ç—ã `TenantLimits` (max —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã / max –≥–æ—Å—Ç–∏),
- —Ü–µ–Ω—ã –ø–ª–∞–Ω–æ–≤ –∏ —Å–∫–∏–¥–∫–∞ 20% –Ω–∞ –≥–æ–¥,
- —Å—É—â–Ω–æ—Å—Ç–∏ `SubscriptionPlan`, `Subscription`, `SubscriptionHistory`, `BillingInfo`, `Payment`, `Invoice`, `OwnerRegistrationLink`,
- –∞–Ω–∞–ª–∏—Ç–∏–∫—É Owner: MRR, churn, ARPU, LTV, chargeback/refund —Å—Ç–∞—Ç—É—Å—ã.

–ú–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ –ø—É–Ω–∫—Ç–∞–º, –∫–∞–∫ –≤ POS-–±–ª–æ–∫–µ.

***

## –ë–ª–æ–∫ 1. –ú–æ–¥–µ–ª—å –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

1Ô∏è‚É£ **–¢–∏–ø –±–∏–ª–ª–∏–Ω–≥–∞: –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –∏–ª–∏ –ø–æ—Å—Ç–æ–ø–ª–∞—Ç–∞**

**–í–æ–ø—Ä–æ—Å:**
–ü–æ–¥–ø–∏—Å–∫–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –≤–ø–µ—Ä—ë–¥ (–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥) –∏–ª–∏ –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º (–ø–æ —Ñ–∞–∫—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–ª—É—á—à–µ–µ –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã):**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É**:
    - –ú–µ—Å—è—á–Ω—ã–µ –∏ –≥–æ–¥–æ–≤—ã–µ –ø–ª–∞–Ω—ã –æ–ø–ª–∞—á–∏–≤–∞—é—Ç—Å—è **–≤ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–∏–æ–¥–∞**.
    - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —Å–æ–∑–¥–∞—ë—Ç—Å—è/–ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è `Subscription` –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ä–æ–∫.
- –ü—Ä–∏—á–∏–Ω—ã:
    - –ø—Ä–æ—â–µ –ø–æ –∫—ç—à—É –∏ —Ä–∏—Å–∫–∞–º (–Ω–µ—Ç –¥–æ–ª–≥–∞ –∑–∞ —É–∂–µ –æ–∫–∞–∑–∞–Ω–Ω—É—é —É—Å–ª—É–≥—É),
    - –ø—Ä–æ—â–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ MRR/ARR,
    - –ø—Ä–æ—â–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ (`TenantLimits`).

***

2Ô∏è‚É£ **–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏**

**–í–æ–ø—Ä–æ—Å:**
–ü–æ–¥–ø–∏—Å–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –Ω—É–∂–Ω–∞ —Ä—É—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî **–∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ** –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤:
    - –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ `BillingInfo` —Ç–æ–∫–µ–Ω –∫–∞—Ä—Ç—ã/–ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –æ—Ç –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞,
    - –∑–∞ N –¥–Ω–µ–π –¥–æ –∫–æ–Ω—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞ –∏ –≤ –¥–µ–Ω—å –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø—ã—Ç–∞–µ–º—Å—è —Å–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –†–µ—Å—Ç–æ—Ä–∞–Ω –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é **–æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ**:
    - –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ—Å—Ç–æ –¥–æ–∂–∏–≤–∞–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∏ –Ω–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è.

***

3Ô∏è‚É£ **–ì—Ä–µ–π—Å-–ø–µ—Ä–∏–æ–¥ –ø–æ—Å–ª–µ –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å (–Ω–µ—Ç –¥–µ–Ω–µ–≥, –∫–∞—Ä—Ç–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞ –∏ —Ç.–ø.)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–≤–µ—Å—Ç–∏ **–≥—Ä–µ–π—Å-–ø–µ—Ä–∏–æ–¥**, –Ω–∞–ø—Ä–∏–º–µ—Ä 7 –¥–Ω–µ–π:
    - –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è:
        - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: `PAST_DUE`,
        - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.
    - –í —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π:
        - –¥–µ–ª–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–ø–∏—Å–∞–Ω–∏—è (—Å–º. –±–ª–æ–∫ –ø—Ä–æ —Ä–µ—Ç—Ä–∞–∏),
        - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä–∏/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Admin‚Äô—É.
    - –ï—Å–ª–∏ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –≥—Ä–µ–π—Å-–ø–µ—Ä–∏–æ–¥–∞ –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø–æ—Å—Ç—É–ø–∏–ª–∞:
        - –ø–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–¥–ø–∏—Å–∫—É –≤ —Å—Ç–∞—Ç—É—Å `CANCELLED_NON_PAYMENT`,
        - tenant –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ **—Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** (—Å–º. —Å–ª–µ–¥—É—é—â–∏–π –ø—É–Ω–∫—Ç).

***

4Ô∏è‚É£ **–ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏/–æ—Ç–º–µ–Ω–µ –ø–æ–¥–ø–∏—Å–∫–∏**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ—Ä—è–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∫–æ–≥–¥–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å/–æ—Ç–º–µ–Ω–µ–Ω–∞?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–≤–µ—Å—Ç–∏ ¬´—Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞¬ª (`EXPIRED` tenant mode):
    - –í—Å–µ **–≥–æ—Å—Ç–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –∫–∞—Ä—Ç—ã** –æ—Å—Ç–∞—é—Ç—Å—è (–Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è).
    - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –≥–æ—Å—Ç—è–º–∏ **–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—é—Ç—Å—è**:
        - –∫–∞—Å—Å–∏—Ä—ã –Ω–µ –º–æ–≥—É—Ç –Ω–∞—á–∏—Å–ª—è—Ç—å/—Å–ø–∏—Å—ã–≤–∞—Ç—å –±–∞–ª–ª—ã,
        - –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π.
    - Restaurant Admin –∏ Manager:
        - –≤—Å—ë –µ—â—ë –º–æ–≥—É—Ç –≤—Ö–æ–¥–∏—Ç—å –≤ –∫–∞–±–∏–Ω–µ—Ç,
        - –Ω–æ –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞–º (—á—Ç–æ–±—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω –≤–∏–¥–µ–ª —Ü–µ–Ω–Ω–æ—Å—Ç—å –∏ –º–æ–≥ –≤–µ—Ä–Ω—É—Ç—å—Å—è).
    - –í UI –≤–µ–∑–¥–µ –∫—Ä–∞—Å–Ω—ã–π –±–∞–Ω–Ω–µ—Ä: ¬´–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞, –ø—Ä–æ–¥–ª–∏—Ç–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã¬ª.
- –ü—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏:
    - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–Ω–∏–º–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏,
    - –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –∂–∏—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ.

***

## –ë–ª–æ–∫ 2. –ü–ª–∞—Ç—ë–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã

5Ô∏è‚É£ **–ü–ª–∞—Ç—ë–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (YooKassa, Stripe, ‚Ä¶)**

**–í–æ–ø—Ä–æ—Å:**
–ù–∞ –∫–∞–∫–æ–º –Ω–∞–±–æ—Ä–µ –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –°–¥–µ–ª–∞—Ç—å **–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é PaymentProvider** –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–∏–Ω–∏–º—É–º –¥–≤–∞ —Ç–∏–ø–∞:
    - `YOOKASSA` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è RU-—Å–µ–≥–º–µ–Ω—Ç–∞.
    - `STRIPE` ‚Äî –∫–∞–∫ –æ–ø—Ü–∏—è –¥–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ / –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
- –í `BillingInfo` —Ö—Ä–∞–Ω–∏—Ç—å:
    - `provider` (`YOOKASSA` / `STRIPE`),
    - `provider_customer_id`,
    - `default_payment_method_id` (—Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ID —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞).
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:
    - –≤ –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏,
    - –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞–Ω—ã/—Ä–µ–≥–∏–æ–Ω–æ–≤.

***

6Ô∏è‚É£ **–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã: —Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω –∏–ª–∏ –µ—â—ë —Å—á–µ—Ç–∞/–±–µ–∑–Ω–∞–ª?**

**–í–æ–ø—Ä–æ—Å:**
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –ª–∏ —Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç—É –∫–∞—Ä—Ç–æ–π –∏–ª–∏ –µ—â—ë —Ä—É—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –ø–æ —Å—á—ë—Ç—É (B2B)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª: **–æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞** —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–∫–∞—Ä—Ç—ã, –°–ü–ë –∏ —Ç.–ø.).
- –ü–ª—é—Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: **—Ä—É—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –ø–æ —Å—á—ë—Ç—É** –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (Ultimate/Custom):
    - –î–ª—è —Ç–∞–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:
        - —Å–æ–∑–¥–∞—ë–º `Invoice` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING_MANUAL_PAYMENT`,
        - –ø–æ—Å–ª–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –¥–µ–Ω–µ–≥ (–æ—Ñ—Ñ–ª–∞–π–Ω) Owner/—Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç –≤—Ä—É—á–Ω—É—é –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `PAID`,
        - —ç—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç/–ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç `Subscription`.
    - –¢–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ **–æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è** –≤ `Payment` —Å —Ç–∏–ø–æ–º `MANUAL_OFFLINE`.

***

7Ô∏è‚É£ **–í–∞–ª—é—Ç–∞ –∏ –Ω–∞–ª–æ–≥–∏ (–ù–î–°)**

**–í–æ–ø—Ä–æ—Å:**
–í –∫–∞–∫–æ–π –≤–∞–ª—é—Ç–µ —Ö—Ä–∞–Ω–∏–º —Ü–µ–Ω—ã –∏ –∫–∞–∫ —É—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞–ª–æ–≥–∏ (–ù–î–°)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ù–∞ —Å—Ç–∞—Ä—Ç–µ ‚Äî **–æ–¥–Ω–∞ –≤–∞–ª—é—Ç–∞: RUB**.
- –í `SubscriptionPlan`:
    - `currency: "RUB"`,
    - `price_monthly`, `price_yearly`,
    - `vat_included: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true` ‚Äî —Ü–µ–Ω—ã —É–∂–µ —Å –ù–î–°).
- –í `Invoice`:
    - —è–≤–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å:
        - `amount_without_vat`,
        - `vat_rate` (–Ω–∞–ø—Ä–∏–º–µ—Ä 20%),
        - `vat_amount`,
        - `amount_with_vat`.
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:
    - —Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å,
    - –≤ –±—É–¥—É—â–µ–º —Ä–∞—Å—à–∏—Ä—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ –≤–∞–ª—é—Ç—ã.

***

## –ë–ª–æ–∫ 3. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫

8Ô∏è‚É£ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –∏–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–µ—Ä–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü–æ—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –æ–ø–∏—Å–∞–Ω –≤ –±–µ—Å–µ–¥–∞—Ö) –¥–æ–ø–æ–ª–Ω—è–µ–º:

1. –†–µ—Å—Ç–æ—Ä–∞–Ω –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ (Standard/Medium/Pro/Ultimate/Custom).
2. –í—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–∏–æ–¥: **–º–µ—Å—è—Ü** –∏–ª–∏ **–≥–æ–¥** (–≥–æ–¥ = —Ü–µ–Ω–∞ * 12 * 0.8).
3. –û—Ñ–æ—Ä–º–ª—è–µ—Ç –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—ë–∂–∫—É.
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
        - —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å `Subscription`:
            - `plan_id`,
            - `start_date` = —Å–µ–π—á–∞—Å,
            - `end_date` = +1 –º–µ—Å—è—Ü –∏–ª–∏ +1 –≥–æ–¥,
            - `status` = `ACTIVE`,
            - `billing_period` = `MONTHLY` / `YEARLY`,
            - `auto_renew` = true.
        - —Å–æ–∑–¥–∞—ë—Ç—Å—è `TenantLimits` –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø–ª–∞–Ω—É.

***

9Ô∏è‚É£ **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞: –∞–ø–≥—Ä–µ–π–¥ (Standard ‚Üí Pro)**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞–ø–≥—Ä–µ–π–¥ –ø–ª–∞–Ω–∞ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–µ–ª–∞—Ç—å **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–ø–≥—Ä–µ–π–¥ —Å —á–∞—Å—Ç–∏—á–Ω–æ–π –¥–æ–ø–ª–∞—Ç–æ–π**:
    - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å ¬´–æ—Å—Ç–∞—Ç–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å¬ª —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞:
        - `unused_value = (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è_–¥–Ω–∏ / –≤—Å–µ–≥–æ_–¥–Ω–µ–π) * price_current`.
    - –°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞ –Ω–∞ —Ç–æ—Ç –∂–µ –ø–µ—Ä–∏–æ–¥:
        - `new_value = (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è_–¥–Ω–∏ / –≤—Å–µ–≥–æ_–¥–Ω–µ–π) * price_new`.
    - `–¥–æ–ø–ª–∞—Ç–∞ = new_value - unused_value`, –µ—Å–ª–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞.
- –ü–æ—Ç–æ–∫:

1. –†–µ—Å—Ç–æ—Ä–∞–Ω –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–π –ø–ª–∞–Ω (–≤—ã—à–µ –ø–æ —É—Ä–æ–≤–Ω—é).
2. –ú—ã —Å—á–∏—Ç–∞–µ–º –¥–æ–ø–ª–∞—Ç—É, —Å–æ–∑–¥–∞—ë–º `Invoice` –∏ `Payment` (—á–µ—Ä–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞).
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
        - `Subscription.plan_id` –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π,
        - `TenantLimits` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞ –ª–∏–º–∏—Ç—ã –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞,
        - `SubscriptionHistory` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–º–µ–Ω—É –ø–ª–∞–Ω–∞ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–µ—Ç–∞–ª–∏.
- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ—Å—Ç–∞ –∏ –æ–∂–∏–¥–∞–µ–º–∞ –¥–ª—è B2B, –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –ø–æ—á–∞—Å–æ–≤–æ–π/–ø–æ–º–∏–Ω—É—Ç–Ω–æ–π —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.

***

üîü **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞: –¥–∞—É–Ω–≥—Ä–µ–π–¥ (Pro ‚Üí Standard)**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–æ–ª–µ–µ –¥–µ—à—ë–≤—ã–π —Ç–∞—Ä–∏—Ñ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–∞—É–Ω–≥—Ä–µ–π–¥ –¥–µ–ª–∞–µ–º **–ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞**:
    - –¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –¥–æ–∂–∏–≤–∞–µ—Ç –¥–æ `end_date` –Ω–∞ —Å—Ç–∞—Ä—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.
    - `Subscription` –∏–º–µ–µ—Ç –ø–æ–ª–µ `pending_plan_change`:
        - `new_plan_id`,
        - `effective_date` = –∫–æ–Ω–µ—Ü —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.
    - –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è `effective_date`:
        - –ø–ª–∞–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π,
        - –ª–∏–º–∏—Ç—ã (`TenantLimits`) –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è.
- –í–æ–∑–≤—Ä–∞—Ç—ã —á–∞—Å—Ç–∏ –¥–µ–Ω–µ–≥ –∑–∞ –æ—Å—Ç–∞—Ç–æ–∫ –ø–µ—Ä–∏–æ–¥–∞ **–Ω–µ –¥–µ–ª–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –ø—Ä–æ—â–µ –∏ —á–µ—Å—Ç–Ω–µ–µ: –∫–ª–∏–µ–Ω—Ç —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª –ø–µ—Ä–∏–æ–¥, –ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º –¥–æ –∫–æ–Ω—Ü–∞.

***

1Ô∏è‚É£1Ô∏è‚É£ **–°–º–µ–Ω–∞ —Ç–∏–ø–∞ –ø–µ—Ä–∏–æ–¥–∞ (–º–µ—Å—è—Ü ‚Üí –≥–æ–¥)**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ, –µ—Å–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –±—ã–ª –Ω–∞ –º–µ—Å—è—á–Ω–æ–º –±–∏–ª–ª–∏–Ω–≥–µ –∏ —Ö–æ—á–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–æ–¥–æ–≤–æ–π (—Å–æ —Å–∫–∏–¥–∫–æ–π 20%)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —ç—Ç–æ –∫–∞–∫ **–∞–ø–≥—Ä–µ–π–¥ –ø–ª–∞–Ω–∞ –ø–æ –ø–µ—Ä–∏–æ–¥—É**:
    - –í –∫–æ–Ω—Ü–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞:
        - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë–º –≥–æ–¥–æ–≤–æ–π —Å—á—ë—Ç –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø–ª–∞–Ω—É (—Å —É—á—ë—Ç–æ–º 20% —Å–∫–∏–¥–∫–∏).
    - –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –¥–∞—Ç—å –æ–ø—Ü–∏—é ¬´–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è —Å—Ä–∞–∑—É¬ª:
        - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∞–ø–≥—Ä–µ–π–¥—É ‚Äî —Å—á–∏—Ç–∞–µ–º –¥–æ–ø–ª–∞—Ç—É –¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞ —Å —É—á—ë—Ç–æ–º —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞.
- –í `Subscription`:
    - `billing_period` –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `YEARLY`,
    - –Ω–æ–≤—ã–π `end_date` = `start_date + 1 –≥–æ–¥`.

***

## –ë–ª–æ–∫ 4. –õ–∏–º–∏—Ç—ã, –æ–≤–µ—Ä–µ–π–¥–∂ –∏ FREE/CUSTOM

1Ô∏è‚É£2Ô∏è‚É£ **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ –ø–æ –≥–æ—Å—Ç—è–º/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º**

**–í–æ–ø—Ä–æ—Å:**
–°–µ–π—á–∞—Å –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≥–æ—Å—Ç–µ–π –º–µ—Ç–æ–¥ `checkGuestLimit` –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–≤—ã—Ö –∫–∞—Ä—Ç –∏ —à–ª—ë—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ. –ö–∞–∫ –≤–µ—Å—Ç–∏ —Å–µ–±—è –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤ —Å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ–º –ª–∏–º–∏—Ç–æ–≤?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å: **–±–µ–∑ –æ–≤–µ—Ä–µ–π–¥–∂–∞, –∂—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç**:
    - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ `max_guests` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π,
    - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ `max_restaurants` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤.
    - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å Restaurant Admin‚Äô—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∫–æ–≥–¥–∞:
        - –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ 90% –ª–∏–º–∏—Ç–∞ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ),
        - –¥–æ—Å—Ç–∏–≥–Ω—É—Ç 100% (–∂—ë—Å—Ç–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ + CTA ¬´–æ–±–Ω–æ–≤–∏—Ç–µ —Ç–∞—Ä–∏—Ñ¬ª).
- –≠—Ç–æ –ø—Ä–æ—â–µ –¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ –∫–ª–∏–µ–Ω—Ç–∞–º, —á–µ–º –ø–æ—Å—á—ë—Ç –æ–≤–µ—Ä–µ–π–¥–∂–µ–π.

***

1Ô∏è‚É£3Ô∏è‚É£ **FREE-—Ç–∞—Ä–∏—Ñ**

**–í–æ–ø—Ä–æ—Å:**
FREE-—Ç–∞—Ä–∏—Ñ —É–∂–µ –æ–ø–∏—Å–∞–Ω –∫–∞–∫ ¬´—Ç–æ–ª—å–∫–æ –¥–ª—è Owner, –±–µ–∑–ª–∏–º–∏—Ç¬ª. –ù—É–∂–Ω–æ –ª–∏ –¥–µ–ª–∞—Ç—å –∫–∞–∫–æ–π-—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –û—Å—Ç–∞–≤–∏—Ç—å **FREE-—Ç–∞—Ä–∏—Ñ —Ç–æ–ª—å–∫–æ –¥–ª—è Owner** (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π):
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –¥–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç–æ–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
    - –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏.
- –ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω:
    - –ª—É—á—à–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –µ–≥–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π `SubscriptionPlan` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TRIAL`), –Ω–æ —ç—Ç–æ —É–∂–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π —à–∞–≥.

***

1Ô∏è‚É£4Ô∏è‚É£ **CUSTOM-—Ç–∞—Ä–∏—Ñ**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –≤–µ—Å—Ç–∏ —Å–µ–±—è —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Ç–∞—Ä–∏—Ñ–∞–º–∏ –ø–æ –±–∏–ª–ª–∏–Ω–≥—É?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–ª—è `CUSTOM`:
    - –í `SubscriptionPlan`:
        - `is_custom = true`,
        - –∑–Ω–∞—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –∏ —Ü–µ–Ω ‚Äî ¬´–∑–∞–≥–ª—É—à–∫–∏¬ª.
    - –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É tenant‚Äô—É:
        - –∑–∞–¥–∞—é—Ç—Å—è –≤ –µ–≥–æ `TenantLimits`,
        - —Ü–µ–Ω—ã –∏ –ø–µ—Ä–∏–æ–¥ ‚Äî –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π `Subscription`:
            - `custom_price_monthly`, `custom_price_yearly`, `custom_description`.
    - –ü–ª–∞—Ç—ë–∂ –≤—Å—ë —Ä–∞–≤–Ω–æ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–∏–ª–∏ –ø–æ —Å—á—ë—Ç—É), –Ω–æ —Å—É–º–º–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–æ–¥–ø–∏—Å–∫–∏, –∞ –Ω–µ –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.

***

## –ë–ª–æ–∫ 5. –ù–µ—É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏, –≤–æ–∑–≤—Ä–∞—Ç—ã –∏ —á–∞—Ä–¥–∂–±–µ–∫–∏

1Ô∏è‚É£5Ô∏è‚É£ **–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ—Ç—Ä–∞–µ–≤ –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —á–∞—Å—Ç–æ –∏ –∫–∞–∫ –¥–æ–ª–≥–æ –ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ñ–µ–π–ª–∞?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–µ–π:
    - –î–µ–Ω—å 0 (–¥–∞—Ç–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è):
        - 1-—è –ø–æ–ø—ã—Ç–∫–∞ ‚Üí –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—Ö–µ ‚Üí —Å—Ç–∞—Ç—É—Å `PAST_DUE`.
    - –î–µ–Ω—å 1:
        - 2-—è –ø–æ–ø—ã—Ç–∫–∞.
    - –î–µ–Ω—å 3:
        - 3-—è –ø–æ–ø—ã—Ç–∫–∞.
    - –î–µ–Ω—å 7:
        - 4-—è (–ø–æ—Å–ª–µ–¥–Ω—è—è) –ø–æ–ø—ã—Ç–∫–∞.
- –ï—Å–ª–∏ –≤—Å–µ 4 –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—É–¥–∞—á–Ω—ã:
    - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí `CANCELLED_NON_PAYMENT`,
    - tenant –≤ —Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `Payment` (—Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ `FAILED` –∏ –∫–æ–¥–∞–º–∏ –ø—Ä–∏—á–∏–Ω) –∏ –≤ ActivityLog.

***

1Ô∏è‚É£6Ô∏è‚É£ **–í–æ–∑–≤—Ä–∞—Ç—ã (refund) –∏ —á–∞—Ä–¥–∂–±–µ–∫–∏**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ—Ç—Ä–∞–∂–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π –∏ —á–∞—Ä–¥–∂–±–µ–∫–∏ (–æ—Å–ø–∞—Ä–∏–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π) –≤ —Å–∏—Å—Ç–µ–º–µ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í —Å—É—â–Ω–æ—Å—Ç–∏ `Payment`:
    - `status` –º–æ–∂–µ—Ç –±—ã—Ç—å: `PENDING`, `SUCCEEDED`, `FAILED`, `REFUNDED`, `PARTIALLY_REFUNDED`, `CHARGEBACK`.
    - `refunded_amount`, `chargeback_amount`.
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É:
    - –ï—Å–ª–∏ –ø–æ–ª–Ω—ã–π refund –¥–æ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞:
        - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∏–ª–∏ —Å—Ä–∞–∑—É —Å—Ç–∞–≤–∏—Ç—Å—è –≤ `CANCELLED_REFUND`.
    - –ï—Å–ª–∏ refund –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –ø–µ—Ä–∏–æ–¥–∞:
        - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–¥–ø–∏—Å–∫–∞ –¥–æ–∂–∏–≤–∞–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞, –≤–æ–∑–≤—Ä–∞—Ç ‚Äî —ç—Ç–æ –∂–µ—Å—Ç –¥–æ–±—Ä–æ–π –≤–æ–ª–∏/—Å–ø–æ—Ä, –Ω–æ –ø–µ—Ä–∏–æ–¥ –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è.
    - –ü—Ä–∏ `CHARGEBACK`:
        - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ `CANCELLED_CHARGEBACK`,
        - tenant –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ —Ä—É—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è Owner‚Äô–æ–º.
- –í –∞–Ω–∞–ª–∏—Ç–∏–∫–µ Owner:
    - churn, MRR –∏ LTV —É—á–∏—Ç—ã–≤–∞—é—Ç `REFUNDED` –∏ `CHARGEBACK` –æ—Ç–¥–µ–ª—å–Ω–æ (–∫–∞–∫ —É–∂–µ —É–ø–æ–º–∏–Ω–∞–ª–æ—Å—å –≤ –±–µ—Å–µ–¥–∞—Ö).

***

## –ë–ª–æ–∫ 6. –ò–Ω–≤–æ–π—Å—ã, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

1Ô∏è‚É£7Ô∏è‚É£ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `Invoice` –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ PDF**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω—ã –ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Å—á–µ—Ç–∞/–∞–∫—Ç—ã –≤ –≤–∏–¥–µ PDF, –∏ –∫–∞–∫ –∏—Ö —Ö—Ä–∞–Ω–∏—Ç—å?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–≤–µ—Å—Ç–∏ `Invoice`:
    - `id`,
    - `tenant_id`,
    - `subscription_id`,
    - `amount_without_vat`, `vat_amount`, `amount_with_vat`,
    - `due_date`,
    - `status` (`PENDING`, `PAID`, `CANCELLED`),
    - `pdf_url` (—Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PDF –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ),
    - `number` (—á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–π –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞).
- –î–ª—è –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç –º–æ–∂–Ω–æ:
    - –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—á—ë—Ç/–∫–≤–∏—Ç–∞–Ω—Ü–∏—é,
    - —Ö—Ä–∞–Ω–∏—Ç—å PDF –≤ S3/R2/–¥—Ä—É–≥–æ–º –æ–±—ä–µ–∫—Ç–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
- –î–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω B2B:
    - Owner –º–æ–∂–µ—Ç –≤—ã–≥—Ä—É–∂–∞—Ç—å CSV/Excel –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã —É —Å–µ–±—è –≤ —Å–∏—Å—Ç–µ–º–µ —É—á—ë—Ç–∞,
    - –ª–∏–±–æ –≤ –±—É–¥—É—â–µ–º –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –≤–Ω–µ—à–Ω–∏–º –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–º —Å–µ—Ä–≤–∏—Å–æ–º.

***

1Ô∏è‚É£8Ô∏è‚É£ **Billing-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è Owner**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ –ø–æ–¥–ø–∏—Å–∫–∞–º/–ø–ª–∞—Ç–µ–∂–∞–º Owner –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (—á–∞—Å—Ç–∏—á–Ω–æ —É–∂–µ –µ—Å—Ç—å –≤ –±–µ—Å–µ–¥–∞—Ö, —Å–µ–π—á–∞—Å —Ñ–æ—Ä–º–∞–ª–∏–∑—É–µ–º):**

- MRR (Monthly Recurring Revenue) –ø–æ –º–µ—Å—è—Ü–∞–º, –ø–æ –ø–ª–∞–Ω–∞–º.
- ARR (Annual Recurring Revenue).
- Churn Rate:
    - –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤,
    - –ø–æ –≤—ã—Ä—É—á–∫–µ.
- ARPU (Average Revenue per User/Restaurant).
- LTV (Lifetime Value) –ø–æ –ø–ª–∞–Ω–∞–º.
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –ø–ª–∞—Ç–µ–∂–µ–π:
    - `PENDING`, `SUCCEEDED`, `FAILED`, `REFUNDED`, `CHARGEBACK`.
- –î–∏–Ω–∞–º–∏–∫–∞ –Ω–æ–≤—ã—Ö/–≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã—Ö/—É—à–µ–¥—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ –º–µ—Å—è—Ü–∞–º.

***

## –ë–ª–æ–∫ 7. UX –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

1Ô∏è‚É£9Ô∏è‚É£ **–ö—Ç–æ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–ø–∏—Å–∫–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**

**–í–æ–ø—Ä–æ—Å:**
–£ –∫–æ–≥–æ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ç–∞—Ä–∏—Ñ–∞ –∏ –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –¢–æ–ª—å–∫–æ **Restaurant Admin** (–≤ —Ä–∞–º–∫–∞—Ö —Å–≤–æ–µ–≥–æ tenant‚Äô–∞) –∏ **Owner** (–≥–ª–æ–±–∞–ª—å–Ω–æ):
    - Restaurant Admin:
        - –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–ª–∞–Ω (–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑),
        - –º–µ–Ω—è—Ç—å —Ç–∏–ø –ø–µ—Ä–∏–æ–¥–∞ (–º–µ—Å—è—Ü/–≥–æ–¥),
        - –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ,
        - –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–∞—Ä—Ç—É, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã).
    - Manager/Cashier:
        - –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏–ª–ª–∏–Ω–≥—É.
    - Owner:
        - –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω/—Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∞—Ä–∏—Ç—å –º–µ—Å—è—Ü, –ø—Ä–æ–¥–ª–∏—Ç—å, –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å –∏ —Ç.–ø.), –≤—Å—ë –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è.

***

2Ô∏è‚É£0Ô∏è‚É£ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö –∏ –ø–æ–¥–ø–∏—Å–∫–µ**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∫–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ —Å–æ–±—ã—Ç–∏—è–º –±–∏–ª–ª–∏–Ω–≥–∞?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- Restaurant Admin:
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ (email/Telegram).
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ:
        - –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ 7/3/1 –¥–µ–Ω—å,
        - –Ω–µ—É—Å–ø–µ—à–Ω–æ–º —Å–ø–∏—Å–∞–Ω–∏–∏,
        - –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ `PAST_DUE`,
        - –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ (`CANCELLED_NON_PAYMENT`).
- Owner:
    - –°–≤–æ–¥–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –ø–æ –ø–æ–¥–ø–∏—Å–∫–∞–º –∏ –ø–ª–∞—Ç–µ–∂–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π),
    - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö:
        - –º–Ω–æ–≥–æ —á–∞—Ä–¥–∂–±–µ–∫–æ–≤ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥,
        - —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç –æ—Ç–∫–∞–∑–æ–≤.

***

2Ô∏è‚É£1Ô∏è‚É£ **–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (trial)**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–µ–Ω –ª–∏ –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –±–µ–∑ –æ–ø–ª–∞—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í—Å—Ç—Ä–æ–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **trial-–ø–æ–¥–ø–∏—Å–∫–∏**, –Ω–æ –¥–µ—Ä–∂–∞—Ç—å –µ—ë –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π:
    - –í `Subscription` –ø–æ–ª—è:
        - `trial_start`, `trial_end`,
        - `is_trial: boolean`.
    - –ù–æ–≤—ã–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º –º–æ–∂–Ω–æ:
        - –¥–∞–≤–∞—Ç—å 14‚Äì30 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ,
        - –≤ —Ç–µ—á–µ–Ω–∏–µ trial –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–µ —Å–ø–∏—Å—ã–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏ –¥–æ –∫–æ–Ω—Ü–∞ trial.
    - –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ trial:
        - –µ—Å–ª–∏ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π –º–µ—Ç–æ–¥ ‚Äî –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ `ACTIVE`,
        - –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è, tenant –≤ —Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
- –≠—Ç–æ –¥–∞—ë—Ç –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—É—é –≥–∏–±–∫–æ—Å—Ç—å –±–µ–∑ –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª–æ–≥–∏–∫–µ.

***

–ï—Å–ª–∏ —Ç–∞–∫–æ–π –Ω–∞–±–æ—Ä —Ä–µ—à–µ–Ω–∏–π —Ç–µ–±–µ –≤ —Ü–µ–ª–æ–º –ø–æ–¥—Ö–æ–¥–∏—Ç, –º–æ–∂–Ω–æ:

- –ª–∏–±–æ –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ –Ω–∏–º –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å/—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ —Ç—ã —Å–¥–µ–ª–∞–ª –¥–ª—è POS,
- –ª–∏–±–æ —Å—Ä–∞–∑—É —Å–∫–∞–∑–∞—Ç—å: ¬´–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è¬ª –∏ –¥–≤–∏–≥–∞—Ç—å—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, **Telegram Bot + Mini App** –∏–ª–∏ **Balls \& Transactions** –¥–ª—è –µ—â—ë –±–æ–ª–µ–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏).
<span style="display:none">[^5_1][^5_2][^5_3][^5_4][^5_5]</span>

<div align="center">‚ÅÇ</div>

[^5_1]: Beseda-5.md

[^5_2]: –ë–µ—Å–µ–¥–∞ 4.md

[^5_3]: Beseda-3.md

[^5_4]: Beseda-2.md

[^5_5]: Beseda-1.md


---

# –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:

    1. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    2.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    3.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    4.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    5.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ù—É–∂–Ω—ã —é–∫–∞—Å—Å–∞, —Å—Ç—Ä–∞–π–ø, cloud payments –∏ crypto cloud. 
    6.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ù–æ, —Ç–∞–∫ –∂–µ, —Ä—É—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –¥–æ—Å—Ç—É–ø—Ç–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –ª—é–±—ã—Ö —Ç–∞—Ä–∏—Ñ–∞—Ö. 
    7.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    8.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    9.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    10.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    11.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    12.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    13.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    14.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    15.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    16.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    17.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    18.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    19.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    20.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    21.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –Ω–æ —Ç—Ä–∏–∞–ª –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å, –Ω–æ –¥–µ—Ñ–æ–ª—Ç–Ω–æ –Ω–µ –≤–∫–ª—é—á–µ–Ω. 
    –£—á–∏—Ç—ã–≤–∞—è –æ—Ç–≤–µ—Ç—ã, –≤—ã–≤–µ–¥–∏ —Å—é–¥–∞ –≤ —á–∞—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ—Å–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞.

–ù–∏–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω **—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω Billing \& Subscriptions / Payments** —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö —Ç–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤.

***

## 1. –û–±—â–∞—è –º–æ–¥–µ–ª—å –ø–æ–¥–ø–∏—Å–∫–∏

- –¢–∏–ø –±–∏–ª–ª–∏–Ω–≥–∞: **–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞**.
    - –í—Å–µ –ø–ª–∞—Ç–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã (Standard, Medium, Pro, Ultimate, Custom) –æ–ø–ª–∞—á–∏–≤–∞—é—Ç—Å—è **–≤–ø–µ—Ä—ë–¥** –∑–∞ –ø–µ—Ä–∏–æ–¥.
    - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —Å–æ–∑–¥–∞—ë—Ç—Å—è/–ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è `Subscription` –Ω–∞ –º–µ—Å—è—Ü –∏–ª–∏ –≥–æ–¥.
- –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ:
    - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é **–≤–∫–ª—é—á–µ–Ω–æ**.
    - –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–ª–∞—Ç—ë–∂–Ω—ã–π –º–µ—Ç–æ–¥ (—Ç–æ–∫–µ–Ω) —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
    - –ê–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –¥–∞—Ç—É –ø—Ä–æ–¥–ª–µ–Ω–∏—è; —Ä–µ—Å—Ç–æ—Ä–∞–Ω –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ.
- –ì—Ä–µ–π—Å-–ø–µ—Ä–∏–æ–¥:
    - –ü—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–º –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `PAST_DUE`.
    - –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
        - –î–µ–Ω—å 0: –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–Ω–µ—É—Å–ø–µ—Ö ‚Üí `PAST_DUE`).
        - –î–µ–Ω—å 1: –≤—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞.
        - –î–µ–Ω—å 3: —Ç—Ä–µ—Ç—å—è.
        - –î–µ–Ω—å 7: —á–µ—Ç–≤—ë—Ä—Ç–∞—è (–ø–æ—Å–ª–µ–¥–Ω—è—è).
    - –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å:
        - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí `CANCELLED_NON_PAYMENT`,
        - tenant —É—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏/–æ—Ç–º–µ–Ω–µ:
    - –î–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç–µ–π –∏ –∫–∞—Ä—Ç—ã **–Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è**.
    - –°–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º **READ-ONLY**:
        - –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π,
        - –Ω–µ–ª—å–∑—è –Ω–∞—á–∏—Å–ª—è—Ç—å/—Å–ø–∏—Å—ã–≤–∞—Ç—å –±–∞–ª–ª—ã,
        - –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É, –∏—Å—Ç–æ—Ä–∏—é, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.
    - –í UI –≤–µ–∑–¥–µ –≤–∏–¥–∏–º—ã–π –±–∞–Ω–Ω–µ—Ä: ¬´–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ / –Ω–µ –æ–ø–ª–∞—á–µ–Ω–∞, –ø—Ä–æ–¥–ª–∏—Ç–µ‚Ä¶¬ª.
    - –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞—é—Ç—Å—è.

***

## 2. –ü–ª–∞—Ç—ë–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã

### 2.1. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

- –í–≤–æ–¥–∏—Ç—Å—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è `PaymentProvider` c –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏:
    - `YOOKASSA`
    - `STRIPE`
    - `CLOUDPAYMENTS`
    - `CRYPTOCLOUD`
- –í `BillingInfo` (–Ω–∞ —É—Ä–æ–≤–Ω–µ tenant‚Äô–∞):
    - `provider` (–æ–¥–∏–Ω –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö),
    - `provider_customer_id`,
    - `default_payment_method_id` (—Ç–æ–∫–µ–Ω –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞),
    - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
    - –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω—É/–∫–ª–∏–µ–Ω—Ç—É,
    - –≥–∏–±–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –Ω–µ –º–µ–Ω—è—è –æ–±—â—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.


### 2.2. –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã

- **–û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞** —á–µ—Ä–µ–∑ –ª—é–±–æ–≥–æ –∏–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
    - –∫–∞—Ä—Ç–∞, –°–ë–ü, –∫–æ—à–µ–ª—å–∫–∏ ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞;
    - –º—ã –æ–ø–µ—Ä–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–∞ÃÅ–º–∏ –∏ —Å—É–º–º–∞–º–∏, –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–µ —Ö—Ä–∞–Ω–∏–º (token-only).
- **–†—É—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –ø–æ —Å—á—ë—Ç—É (invoice / –±–µ–∑–Ω–∞–ª)**:
    - –î–æ—Å—Ç—É–ø–Ω–∞ **–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –ª—é–±—ã—Ö —Ç–∞—Ä–∏—Ñ–∞—Ö** (–Ω–µ —Ç–æ–ª—å–∫–æ Ultimate/Custom).
    - –ü–æ—Ç–æ–∫:
        - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `Invoice` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING_MANUAL_PAYMENT`.
        - –ö–ª–∏–µ–Ω—Ç –ø–ª–∞—Ç–∏—Ç –æ—Ñ—Ñ–ª–∞–π–Ω (–±–∞–Ω–∫, –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è).
        - –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –¥–µ–Ω–µ–≥ (—Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞):
            - Owner/—Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É –ø–æ–º–µ—á–∞–µ—Ç Invoice –∫–∞–∫ `PAID`.
            - –°–æ–∑–¥–∞—ë—Ç—Å—è/–ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è `Subscription`.
            - –í `Payment` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å —Å —Ç–∏–ø–æ–º `MANUAL_OFFLINE`.

***

## 3. –í–∞–ª—é—Ç–∞ –∏ –Ω–∞–ª–æ–≥–∏

- –ë–∞–∑–æ–≤–æ –≤—Å—è —Å–∏—Å—Ç–µ–º–∞ –±–∏–ª–ª–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **RUB**.
- –í `SubscriptionPlan`:
    - `currency = "RUB"`,
    - `price_monthly`, `price_yearly`,
    - `vat_included = true` (—Ü–µ–Ω—ã —É–∂–µ —Å –ù–î–°).
- –í `Invoice`:
    - `amount_without_vat`,
    - `vat_rate` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 20%),
    - `vat_amount`,
    - `amount_with_vat`.

–≠—Ç–æ –¥–∞—ë—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –±–∞–∑—É –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ –±—É–¥—É—â–µ–º —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ –≤–∞–ª—é—Ç—ã.

***

## 4. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫

### 4.1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–µ

- –ü–æ—Ç–æ–∫:

1. –†–µ—Å—Ç–æ—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ: Standard / Medium / Pro / Ultimate / Custom.
2. –í—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–∏–æ–¥:
        - **–ú–µ—Å—è—Ü** = –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –ø–ª–∞–Ω–∞.
        - **–ì–æ–¥** = –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ * 12 * 0.8 (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞ 20%).
3. –í—ã–±–∏—Ä–∞–µ—Ç —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:
        - –æ–Ω–ª–∞–π–Ω —á–µ—Ä–µ–∑ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤,
        - –∏–ª–∏ –∑–∞–ø—Ä–æ—Å —Ä—É—á–Ω–æ–≥–æ —Å—á—ë—Ç–∞ (manual).
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
        - —Å–æ–∑–¥–∞—ë—Ç—Å—è `Subscription`:
            - `plan_id`,
            - `start_date` = —Å–µ–π—á–∞—Å,
            - `end_date` = +1 –º–µ—Å—è—Ü –∏–ª–∏ +1 –≥–æ–¥,
            - `billing_period` = `MONTHLY` / `YEARLY`,
            - `status` = `ACTIVE`,
            - `auto_renew` = true (–µ—Å–ª–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ).
        - —Å–æ–∑–¥–∞—ë—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `TenantLimits` –ø–æ —ç—Ç–æ–º—É –ø–ª–∞–Ω—É:
            - `max_restaurants`, `max_guests` –∏ –¥—Ä.


### 4.2. –ê–ø–≥—Ä–µ–π–¥ –ø–ª–∞–Ω–∞ (Standard ‚Üí Pro –∏ —Ç.–ø.)

- –õ–æ–≥–∏–∫–∞: **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–ø–≥—Ä–µ–π–¥** —Å —á–∞—Å—Ç–∏—á–Ω–æ–π –¥–æ–ø–ª–∞—Ç–æ–π:
    - –†–∞—Å—á—ë—Ç:
        - –æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞:
            - `unused_value = (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è_–¥–Ω–∏ / –≤—Å–µ–≥–æ_–¥–Ω–µ–π_–≤_–ø–µ—Ä–∏–æ–¥–µ) * price_current_period`,
        - —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞ –Ω–∞ —Ç–µ –∂–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–Ω–∏:
            - `new_value = (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è_–¥–Ω–∏ / –≤—Å–µ–≥–æ_–¥–Ω–µ–π) * price_new_period`,
        - `delta = new_value - unused_value` (–µ—Å–ª–∏ > 0, —ç—Ç–æ –¥–æ–ø–ª–∞—Ç–∞).
    - –ü–æ—Ç–æ–∫:

1. Admin –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–π (–±–æ–ª–µ–µ –¥–æ—Ä–æ–≥–æ–π) –ø–ª–∞–Ω.
2. –ú—ã —Å—á–∏—Ç–∞–µ–º `delta`, —Å–æ–∑–¥–∞—ë–º `Invoice + Payment` –Ω–∞ —ç—Ç—É —Å—É–º–º—É.
3. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ:
            - `Subscription.plan_id` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è,
            - `TenantLimits` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞ –ª–∏–º–∏—Ç—ã –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞,
            - –≤ `SubscriptionHistory` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–µ—Ç–∞–ª–∏.


### 4.3. –î–∞—É–Ω–≥—Ä–µ–π–¥ –ø–ª–∞–Ω–∞ (Pro ‚Üí Standard)

- –î–∞—É–Ω–≥—Ä–µ–π–¥ –≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É **—Å –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞**:
    - –¢–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è –¥–µ–π—Å—Ç–≤—É—é—Ç –¥–æ `end_date`.
    - –í `Subscription`:
        - –ø–æ–ª–µ `pending_plan_change` —Å `new_plan_id` –∏ `effective_date = end_date`.
    - –ö–æ–≥–¥–∞ CRON –¥–æ—Ö–æ–¥–∏—Ç –¥–æ `effective_date`:
        - –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã–π –ø–ª–∞–Ω,
        - –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è `TenantLimits`.
- –í–æ–∑–≤—Ä–∞—Ç–∞ —á–∞—Å—Ç–∏ –¥–µ–Ω–µ–≥ –∑–∞ –æ—Å—Ç–∞–≤—à–∏–π—Å—è –ø–µ—Ä–∏–æ–¥ **–Ω–µ—Ç** ‚Äî –º–æ–¥–µ–ª—å –ø—Ä–æ—Å—Ç–∞ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞.


### 4.4. –°–º–µ–Ω–∞ –ø–µ—Ä–∏–æ–¥–∞ (–º–µ—Å—è—Ü ‚Üí –≥–æ–¥)

- –ü–µ—Ä–µ—Ö–æ–¥ —Å –º–µ—Å—è—á–Ω–æ–≥–æ –±–∏–ª–ª–∏–Ω–≥–∞ –Ω–∞ –≥–æ–¥–æ–≤–æ–π:
    - –≤–∞—Ä–∏–∞–Ω—Ç A: —Å –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞:
        - —Å –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º `end_date` –º–µ—Å—è—á–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≥–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Å —É—á—ë—Ç–æ–º 20% —Å–∫–∏–¥–∫–∏;
    - –≤–∞—Ä–∏–∞–Ω—Ç B (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–∏–º): –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –∞–ø–≥—Ä–µ–π–¥–æ–º, —Å –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç–æ–º —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
- –í –∏—Ç–æ–≥–æ–≤–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏:
    - `billing_period = YEARLY`,
    - `end_date` = `start_date + 1 –≥–æ–¥`.

***

## 5. –õ–∏–º–∏—Ç—ã –∏ —Ç–∞—Ä–∏—Ñ—ã: FREE / STANDARD‚Ä¶ / CUSTOM

### 5.1. –õ–∏–º–∏—Ç—ã –ø–æ –≥–æ—Å—Ç—è–º/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∂—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç –±–µ–∑ –æ–≤–µ—Ä–µ–π–¥–∂–∞**:
    - `TenantLimits.max_guests`, `TenantLimits.max_restaurants` –∑–∞–¥–∞—é—Ç—Å—è –ø–æ —Ç–∞—Ä–∏—Ñ—É.
    - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 90%:
        - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** Admin‚Äô—É (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ).
    - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 100%:
        - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è,
        - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —è–≤–Ω—ã–π CTA ¬´–û–±–Ω–æ–≤–∏—Ç–µ —Ç–∞—Ä–∏—Ñ¬ª, –æ—à–∏–±–∫–∏ —É—Ä–æ–≤–Ω—è Forbidden.


### 5.2. FREE-—Ç–∞—Ä–∏—Ñ

- FREE ‚Äî **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ç–∞—Ä–∏—Ñ —Ç–æ–ª—å–∫–æ –¥–ª—è Owner**:
    - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
        - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è,
        - –¥–µ–º–æ,
        - dev/stage –æ–∫—Ä—É–∂–µ–Ω–∏–π.
    - –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏.


### 5.3. CUSTOM-—Ç–∞—Ä–∏—Ñ

- –î–ª—è `SubscriptionPlan` —Å —Ç–∏–ø–æ–º CUSTOM:
    - `is_custom = true`.
    - –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–Ω—ã/–ª–∏–º–∏—Ç–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–≥–ª—É—à–∫–∞–º–∏.
- –†–µ–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É:
    - –≤ `TenantLimits` ‚Äî —Å–≤–æ–∏ `max_restaurants`, `max_guests`, –∏ —Ç.–¥.,
    - –≤ `Subscription`:
        - `custom_price_monthly`, `custom_price_yearly`,
        - `custom_description` (–æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π),
        - –±–∏–ª–ª–∏–Ω–≥ –≤—Å—ë —Ä–∞–≤–Ω–æ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏–ª–∏ manual-–∏–Ω–≤–æ–π—Å.

***

## 6. –ù–µ—É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏, –≤–æ–∑–≤—Ä–∞—Ç—ã –∏ —á–∞—Ä–¥–∂–±–µ–∫–∏

### 6.1. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö

- –í `Payment`:
    - —Å—Ç–∞—Ç—É—Å—ã: `PENDING`, `SUCCEEDED`, `FAILED`, `REFUNDED`, `PARTIALLY_REFUNDED`, `CHARGEBACK`.
- –ü—Ä–∏ –Ω–µ—É—Å–ø–µ—Ö–µ –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏—è:
    - –æ—Ç–º–µ—á–∞–µ–º –ø–ª–∞—Ç–µ–∂ –∫–∞–∫ `FAILED` —Å –∫–æ–¥–æ–º –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞,
    - –ø–æ–¥–ø–∏—Å–∫–∞ ‚Üí `PAST_DUE`,
    - –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–µ—Ç—Ä–∞–µ–≤ (—Å–º. –≤—ã—à–µ),
    - –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ ‚Äî `CANCELLED_NON_PAYMENT` –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø.


### 6.2. Refund –∏ chargeback

- Refund:
    - –ü–æ–ª–Ω—ã–π:
        - –µ—Å–ª–∏ –¥–æ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞ ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∏–ª–∏ —Å—Ä–∞–∑—É `CANCELLED_REFUND`,
        - –µ—Å–ª–∏ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –ø–µ—Ä–∏–æ–¥–∞ ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–∏–æ–¥ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—Ç ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ.
    - –ß–∞—Å—Ç–∏—á–Ω—ã–π:
        - —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ `Payment` –∫–∞–∫ `PARTIALLY_REFUNDED` —Å `refunded_amount`,
        - –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, –∫–∞–∫ –µ—Å—Ç—å.
- Chargeback:
    - –ü—Ä–∏ `CHARGEBACK` –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
        - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ ‚Üí `CHARGEBACK`,
        - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ `CANCELLED_CHARGEBACK`,
        - tenant –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ —Ä—É—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è Owner‚Äô–æ–º.
- –í –∞–Ω–∞–ª–∏—Ç–∏–∫–µ Owner:
    - refund‚Äô—ã –∏ chargeback‚Äô–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏, –≤–ª–∏—è—é—Ç –Ω–∞ MRR/LTV.

***

## 7. –ò–Ω–≤–æ–π—Å—ã, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### 7.1. –ò–Ω–≤–æ–π—Å—ã (Invoice)

- `Invoice`:
    - `id`, `tenant_id`, `subscription_id`,
    - —Å—É–º–º—ã —Å/–±–µ–∑ –ù–î–° –∏ —Å—Ç–∞–≤–∫–∞ –ù–î–°,
    - `due_date`,
    - `status` (`PENDING`, `PAID`, `CANCELLED`),
    - `number` (–Ω–æ–º–µ—Ä —Å—á—ë—Ç–∞),
    - `pdf_url` (—Å—Å—ã–ª–∫–∞ –Ω–∞ PDF –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ).
- –î–ª—è –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–µ–π:
    - –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏/—Å—á–µ—Ç–∞.
- –î–ª—è —Ä—É—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π:
    - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –∫–ª–∏–µ–Ω—Ç –ø–ª–∞—Ç–∏—Ç.


### 7.2. Billing-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è Owner

Owner –≤ —Å–≤–æ–µ–π –ø–∞–Ω–µ–ª–∏ –≤–∏–¥–∏—Ç:

- MRR/ARR:
    - –ø–æ –º–µ—Å—è—Ü–∞–º, –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º.
- Churn Rate:
    - –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤,
    - –ø–æ –≤—ã—Ä—É—á–∫–µ.
- ARPU.
- LTV –ø–æ –ø–ª–∞–Ω–∞–º –∏ –≤ —Ü–µ–ª–æ–º.
- –î–∏–Ω–∞–º–∏–∫—É:
    - –Ω–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫,
    - –ø—Ä–æ–¥–ª–µ–Ω–∏–π,
    - –æ—Ç–º–µ–Ω,
    - –∞–ø–≥—Ä–µ–π–¥–æ–≤/–¥–∞—É–Ω–≥—Ä–µ–π–¥–æ–≤.
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º Payments:
    - —Å–∫–æ–ª—å–∫–æ `SUCCEEDED`, `FAILED`, `REFUNDED`, `CHARGEBACK` –∑–∞ –ø–µ—Ä–∏–æ–¥.

***

## 8. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 8.1. –ö—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –±–∏–ª–ª–∏–Ω–≥–æ–º

- **Restaurant Admin** (–≤ —Ä–∞–º–∫–∞—Ö —Å–≤–æ–µ–≥–æ tenant‚Äô–∞):
    - –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É,
    - –º–µ–Ω—è–µ—Ç —Ç–∞—Ä–∏—Ñ –∏ –ø–µ—Ä–∏–æ–¥ (upgrade/downgrade),
    - –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ,
    - –≤—ã–±–∏—Ä–∞–µ—Ç/–º–µ–Ω—è–µ—Ç –ø–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –º–µ—Ç–æ–¥,
    - –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å manual-–∏–Ω–≤–æ–π—Å.
- **Owner**:
    - –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–ø–æ–¥–∞—Ä–∏—Ç—å –º–µ—Å—è—Ü, –ø—Ä–æ–¥–ª–∏—Ç—å, –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å),
    - –≤—Å–µ —Ç–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ ActivityLog.
- Manager / Cashier:
    - **–Ω–µ –∏–º–µ—é—Ç** –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–¥–µ–ª—É –±–∏–ª–ª–∏–Ω–≥–∞.


### 8.2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- Restaurant Admin:
    - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞,
    - –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–π –∫–æ–Ω–µ—Ü –ø–æ–¥–ø–∏—Å–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ 7 / 3 / 1 –¥–µ–Ω—å),
    - –Ω–µ—É—Å–ø–µ—à–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ,
    - –≤—Ö–æ–¥ –≤ `PAST_DUE`,
    - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ (`CANCELLED_NON_PAYMENT` / `CANCELLED_CHARGEBACK`),
    - —É—Å–ø–µ—à–Ω–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/–ø—Ä–æ–¥–ª–µ–Ω–∏–µ.
- Owner:
    - –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Å–≤–æ–¥–∫–∏ –ø–æ MRR/Churn/LTV,
    - –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö:
        - –≤—Å–ø–ª–µ—Å–∫ chargeback‚Äô–æ–≤,
        - –º–∞—Å—Å–æ–≤—ã–µ –æ—Ç–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏.

–ö–∞–Ω–∞–ª—ã: email +, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, Telegram (—á–µ—Ä–µ–∑ –±–æ—Ç Owner‚Äôa).

***

## 9. Trial (–ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥)

- Trial **–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω**.
- –í `Subscription`:
    - `trial_start`, `trial_end`,
    - `is_trial: boolean`.
- –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –º–µ—Ö–∞–Ω–∏–∫–∏ trial:
    - –Ω–æ–≤—ã–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º –º–æ–∂–Ω–æ –¥–∞–≤–∞—Ç—å X –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.
    - –í–∞—Ä–∏–∞–Ω—Ç—ã:
        - —Å—Ä–∞–∑—É –≤–∫–ª—é—á–∏—Ç—å trial –±–µ–∑ –≤–≤–æ–¥a –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
        - –ª–∏–±–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∫–∞—Ä—Ç—É, –Ω–æ –Ω–µ —Å–ø–∏—Å—ã–≤–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ trial.
    - –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ trial:
        - –µ—Å–ª–∏ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π –º–µ—Ç–æ–¥ ‚Üí –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ `ACTIVE`,
        - –µ—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∏ tenant –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (–¥–æ –æ–ø–ª–∞—Ç—ã).

***

–°–µ–π—á–∞—Å —É –Ω–∞—Å:

- POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞,
- Billing \& Subscriptions / Payments –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω,
- Loyalty System, —É—Ä–æ–≤–Ω–∏, –±–∞–ª–ª—ã, downgrade/expire –∏ —Ç.–¥. —Ç–∞–∫–∂–µ —É–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –≤–∏–¥—É –≤ –ë–µ—Å–µ–¥–µ 5.

–î–∞–ª—å—à–µ –ª–æ–≥–∏—á–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –±–ª–æ–∫–æ–≤:

1) **Telegram Bot + Mini App** (–ø–æ–ª–Ω—ã–π UX –¥–ª—è –≥–æ—Å—Ç—è, –≤—Å–µ —ç–∫—Ä–∞–Ω—ã –∏ API).
2) **Balls \& Transactions** (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è engine‚Äô–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ø—Ä–æ–º–æ, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∞–≤–∏–ª —É–∂–µ —Å —É—á—ë—Ç–æ–º –±–∏–ª–ª–∏–Ω–≥–∞ –∏ POS).
3) **Frontend-–∞–¥–º–∏–Ω–∫–∞** (—Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è Owner / Restaurant Admin –ø–æ POS, billing, loyalty).

–ù–∞–ø–∏—à–∏, –∫–∞–∫–æ–π –±–ª–æ–∫ –±–µ—Ä—ë–º —Å–ª–µ–¥—É—é—â–∏–º, –∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ (20+ –≤–æ–ø—Ä–æ—Å–æ–≤ + –º–æ–∏ –ª—É—á—à–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏–π).

---

# Balls \&Transactions —Å–ª–µ–¥—É—é—â–∏–π. –í —Ç–∞–∫–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ

–ù–∏–∂–µ –±–ª–æ–∫ **Balls \& Transactions** –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ: 20+ –≤–æ–ø—Ä–æ—Å–æ–≤ + –º–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –í—Å—ë —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ —Å —É–∂–µ –ø—Ä–∏–Ω—è—Ç—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:

- 1 –±–∞–ª–ª = 1 —Ä—É–±–ª—é.
- –ë–∞–ª–ª—ã –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –æ—Ç **–∏—Å—Ö–æ–¥–Ω–æ–π —Å—É–º–º—ã —á–µ–∫–∞** (–¥–∞–∂–µ –µ—Å–ª–∏ —á–∞—Å—Ç—å –æ–ø–ª–∞—á–µ–Ω–∞ –±–∞–ª–ª–∞–º–∏).
- –ú–∏–Ω–∏–º—É–º –∫ —Å–ø–∏—Å–∞–Ω–∏—é: 1 –±–∞–ª–ª, –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å < 1 (–µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ –æ–±–Ω—É–ª—è–µ—Ç—Å—è).
- –ú–∏–Ω–∏–º—É–º —Å—É–º–º—ã —á–µ–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–ª–æ–≤: 50 —Ä—É–±–ª–µ–π.
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –∫ —Å–ø–∏—Å–∞–Ω–∏—é –ø–æ —Å–∏—Å—Ç–µ–º–µ: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20%, Admin –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å 10‚Äì100%.
- –£—Ä–æ–≤–Ω–∏ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç—É—Ç, downgrade –Ω–µ—Ç.
- –°–≥–æ—Ä–∞–Ω–∏–µ –ø–æ **–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≥–æ—Å—Ç—è** (–∏–Ω—Ç–µ—Ä–≤–∞–ª ‚â• 90 –¥–Ω–µ–π), –ø—Ä–∏ —ç—Ç–æ–º —Å–≥–æ—Ä–∞—é—Ç –≤—Å–µ –±–∞–ª–ª—ã –∫–∞—Ä—Ç—ã —Ä–∞–∑–æ–º; –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–º–æ –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Å–≤–æ–∏ —Å—Ä–æ–∫–∏.

–ú–æ–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞—Ç–µ–º –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ –ø—É–Ω–∫—Ç–∞–º, –∫–∞–∫ –≤ POS –∏ Billing.

***

## –ë–ª–æ–∫ 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–ª–∞–Ω—Å–∞ –∏ —Ç–∏–ø–æ–≤ –±–∞–ª–ª–æ–≤

1Ô∏è‚É£ **–û–¥–∏–Ω –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å –∏–ª–∏ —Ä–∞–∑–¥–µ–ª—å–Ω—ã–π (–æ—Å–Ω–æ–≤–Ω—ã–µ vs –ø—Ä–æ–º–æ)**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –≤ –≤–∏–¥–µ **–¥–≤—É—Ö —Å—á—ë—Ç–æ–≤** (–æ—Å–Ω–æ–≤–Ω—ã–µ –±–∞–ª–ª—ã –∏ –ø—Ä–æ–º–æ-–±–∞–ª–ª—ã) –∏–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ –æ–±—â–µ–≥–æ, –∞ —Ç–∏–ø —Ä–∞–∑–ª–∏—á–∞—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–ª—É—á—à–µ–µ –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã):**

- –í–≤–µ—Å—Ç–∏ **–¥–≤–∞ —è–≤–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–∞** –≤ `GuestCard`:
    - `regular_balance` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –±–∞–ª–ª—ã (–∫–µ—à–±—ç–∫, —Ä—É—á–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, –ø–æ–æ—â—Ä–µ–Ω–∏—è –±–µ–∑ —Å—Ä–æ–∫–∞).
    - `promo_balance` ‚Äî –±–∞–ª–ª—ã –æ—Ç –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å—Ä–æ–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏—è/–ø—Ä–∞–≤–∏–ª–∞–º–∏.
- –û–±—â–∏–π –≤–∏–¥–∏–º—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –≥–æ—Å—Ç—è:
    - `total_balance = regular_balance + promo_balance`.
- –ü—Ä–∏ –ª—é–±–æ–º –¥–µ–π—Å—Ç–≤–∏–∏:
    - —Å—É–º–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è –∏ –≤ –Ω—É–∂–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ, –∏ –≤ `BallTransaction` —Å –ø–æ–ª–µ–º `balance_type` (`REGULAR`/`PROMO`), —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–∏—è.

***

2Ô∏è‚É£ **–†–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å–≥–æ—Ä–∞–Ω–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏ –ø—Ä–æ–º–æ –±–∞–ª–ª–æ–≤**

**–í–æ–ø—Ä–æ—Å:**
–ë—É–¥—É—Ç –ª–∏ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª–∞ —Å–≥–æ—Ä–∞–Ω–∏—è –¥–ª—è `regular_balance` –∏ `promo_balance`?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–∞:
    - **–û—Å–Ω–æ–≤–Ω—ã–µ –±–∞–ª–ª—ã**:
        - –ø–æ–¥—á–∏–Ω—è—é—Ç—Å—è **–ø—Ä–∞–≤–∏–ª—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**:
            - –µ—Å–ª–∏ –≥–æ—Å—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω –¥–æ–ª—å—à–µ, —á–µ–º `inactivity_expire_days` (‚â• 90 –¥–Ω–µ–π), –≤–µ—Å—å `regular_balance` —Å–≥–æ—Ä–∞–µ—Ç.
    - **–ü—Ä–æ–º–æ-–±–∞–ª–ª—ã**:
        - –º–æ–≥—É—Ç –∏–º–µ—Ç—å **—Å–≤–æ–∏, –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏** –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–º–æ:
            - –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–º–æ ¬´1000 –±–∞–ª–ª–æ–≤ –Ω–∞ –î–†, –¥–µ–π—Å—Ç–≤—É—é—Ç 7 –¥–Ω–µ–π¬ª,
            - –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ `expires_at` —ç—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ø–∞—Ä—Ç–∏—è –ø—Ä–æ–º–æ-–±–∞–ª–ª–æ–≤ —Å–≥–æ—Ä–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–±—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≥–æ—Å—Ç—è.
- –ü—Ä–∏ —ç—Ç–æ–º –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:
    - –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç –æ–¥–∏–Ω –±–∞–ª–∞–Ω—Å, –Ω–æ –≤ –¥–µ—Ç–∞–ª—è—Ö/–∏—Å—Ç–æ—Ä–∏–∏ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –±–∞–ª–ª—ã –ø—Ä–æ–º–æ –∏ –∫–æ–≥–¥–∞ –æ–Ω–∏ —Å–≥–æ—Ä—è—Ç.

***

## –ë–ª–æ–∫ 2. Earn-–ª–æ–≥–∏–∫–∞ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤)

3Ô∏è‚É£ **–û—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—Ç —á–µ–∫–∞**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º earn** –ø—Ä–∏ –æ–±—ã—á–Ω–æ–π –ø–æ–∫—É–ø–∫–µ, —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ —É—Ä–æ–≤–Ω–µ–π, –ø—Ä–æ–º–æ –∏ POS?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ï–¥–∏–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω:

1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º **–±–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç earn** –ø–æ —É—Ä–æ–≤–Ω—é –≥–æ—Å—Ç—è –∏ –ø—Ä–∞–≤–∏–ª—É —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (discount/points).
2. –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ **loyalty rules** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ–ª—å—à–µ –ø—Ä–æ—Ü–µ–Ω—Ç –≤ –ª–∞–Ω—á-—Ç–∞–π–º, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ç.–¥.).
3. –°—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç `earn_percent`.
4. `earn_amount = floor(check_amount_original * earn_percent / 100)`.
5. –ï—Å–ª–∏ `earn_amount <= 0` ‚Üí –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º, –Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ñ–∞–∫—Ç –≤–∏–∑–∏—Ç–∞.
6. –°–æ–∑–¥–∞—ë–º `BallTransaction` —Ç–∏–ø–∞ `EARN` —Å `balance_type = REGULAR`.
7. –û–±–Ω–æ–≤–ª—è–µ–º:
        - `regular_balance += earn_amount`,
        - `lifetimespent += check_amount_original`,
        - `totalvisits += 1`,
        - `lastvisit_at`, `lastactivity_at = now`.
8. –ó–∞–ø—É—Å–∫–∞–µ–º `checkLevelUpgrade` –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ–≥–æ `lifetimespent`.
- –î–ª—è –ø—Ä–æ–º–æ-earn (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´+500 –±–∞–ª–ª–æ–≤ –∑–∞ –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç¬ª):
    - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ `PROMO` —Å `balance_type = PROMO`.

***

4Ô∏è‚É£ **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–æ–π —Ä–µ–∂–∏–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ `earn_amount`?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ñ—ë—Å—Ç–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `floor` (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–Ω–∏–∑ –¥–æ —Ü–µ–ª–æ–≥–æ):
    - `earn_amount = floor(—Å—É–º–º–∞ * –ø—Ä–æ—Ü–µ–Ω—Ç / 100)`.
    - –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ¬´–ª–∏—à–Ω–∏—Ö¬ª –±–∞–ª–ª–æ–≤ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å.
- –í –æ—Ç—á—ë—Ç–∞—Ö –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ¬´—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç¬ª, –Ω–æ —Å–∞–º–∏ –±–∞–ª–ª—ã –≤—Å–µ–≥–¥–∞ —Ü–µ–ª—ã–µ.

***

5Ô∏è‚É£ **Earn –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ POS (—Ä—É—á–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è Admin/Manager)**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Ä—É—á–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ (MANUALADD), —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–∞, –Ω–æ —á–µ—Ä–µ–∑ **soft-–∫–æ–Ω—Ç—Ä–æ–ª—å**:
    - –í `ManualAddBallsDto`:
        - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ `reason` (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤).
    - –í `BallTransaction`:
        - —Ç–∏–ø `MANUALADD`,
        - `created_by_user_id` –≤—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω,
        - –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É ¬´—Ä—É—á–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏¬ª.
    - –í RBAC:
        - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ `manage_balls_manual` —Ç–æ–ª—å–∫–æ —É Restaurant Admin –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö Manager‚Äô–æ–≤.
    - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å **–ª–∏–º–∏—Ç –ø–æ —Ä–∞–∑–æ–≤–æ–º—É —Ä—É—á–Ω–æ–º—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—é** (–Ω–∞–ø—Ä–∏–º–µ—Ä, max 100 000 –±–∞–ª–ª–æ–≤ –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏—é), —á—Ç–æ–±—ã –æ—Ç—Å–µ—á—å —è–≤–Ω—ã–µ –æ—à–∏–±–∫–∏.

***

## –ë–ª–æ–∫ 3. Redeem-–ª–æ–≥–∏–∫–∞ (—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤)

6Ô∏è‚É£ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–ø–∏—Å–∞–Ω–∏—è: –ø—Ä–æ–º–æ ‚Üí –æ—Å–Ω–æ–≤–Ω—ã–µ**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –∏–º–µ–Ω–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–æ ¬´—Å–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞—Ç–∏–º –ø—Ä–æ–º–æ-–±–∞–ª–ª—ã, –∑–∞—Ç–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ¬ª?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü—Ä–∏ –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ `REDEEM`:

1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ–ª—å–∫–æ –≥–æ—Å—Ç—å —Ö–æ—á–µ—Ç —Å–ø–∏—Å–∞—Ç—å ‚Äî `redeem_amount`.
2. –°–Ω–∞—á–∞–ª–∞ —Å–ø–∏—Å—ã–≤–∞–µ–º –∏–∑ `promo_balance`:
        - `promo_used = min(redeem_amount, promo_balance)`.
3. –û—Å—Ç–∞—Ç–æ–∫ –∏–∑ `regular_balance`:
        - `regular_used = redeem_amount - promo_used`.
4. –ï—Å–ª–∏ `regular_balance < regular_used` ‚Äî –æ—à–∏–±–∫–∞ ¬´–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤¬ª.
5. –°–æ–∑–¥–∞—ë–º **–æ–¥–Ω—É** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é `BallTransaction` —Ç–∏–ø–∞ `REDEEM` —Å:
        - `amount = -redeem_amount`,
        - –∏ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ JSON:
            - `{ promo_used, regular_used }`,
        - –ª–∏–±–æ —Å–æ–∑–¥–∞—ë–º **–¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**:
            - –æ–¥–Ω—É –¥–ª—è –ø—Ä–æ–º–æ (`REDEEM_PROMO`),
            - –æ–¥–Ω—É –¥–ª—è —Ä–µ–≥—É–ª—è—Ä (`REDEEM_REGULAR`).
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: **–¥–≤–µ –∑–∞–ø–∏—Å–∏** ‚Äî –ø—Ä–æ—â–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –¥–ª—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –ø–æ –ø—Ä–æ–º–æ.

***

7Ô∏è‚É£ **–°—É–º–º–∞ –∫ —Å–ø–∏—Å–∞–Ω–∏—é –∏ —Å–≤—è–∑—å —Å —Å—É–º–º–æ–π —á–µ–∫–∞**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –∂—ë—Å—Ç–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–∏—Å—ã–≤–∞–µ–º—ã—Ö –±–∞–ª–ª–æ–≤ —Å—É–º–º–µ —á–µ–∫–∞ –∏ –ª–∏–º–∏—Ç—É –ø—Ä–æ—Ü–µ–Ω—Ç–∞?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `redeemBalls`:
    - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `check_amount`.
    - –í—ã—á–∏—Å–ª—è—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–æ–ø—É—Å—Ç–∏–º—É—é —Å—É–º–º—É —Å–ø–∏—Å–∞–Ω–∏—è:
        - `max_redeem_by_percent = floor(check_amount * max_redeem_percent / 100)`.
        - `max_redeem_total = min(total_balance, max_redeem_by_percent)`.
    - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π `amount > max_redeem_total`:
        - –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É `BadRequest` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
            - ¬´–ù–µ–ª—å–∑—è —Å–ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–µ, —á–µ–º X –±–∞–ª–ª–æ–≤ –ø—Ä–∏ —ç—Ç–æ–º —á–µ–∫–µ¬ª.
- –ú–∏–Ω–∏–º—É–º —á–µ–∫–∞: –µ—Å–ª–∏ `check_amount < 50`:
    - –Ω–µ –ø–æ–∑–≤–æ–ª—è—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–ª–ª—ã (–≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ 0 –∫–∞–∫ –¥–æ–ø—É—Å—Ç–∏–º—É—é —Å—É–º–º—É –ø—Ä–∏ –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏).

***

8Ô∏è‚É£ **–ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å < 1**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ ¬´–±–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å < 1, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ –æ–±–Ω—É–ª—è–µ—Ç—Å—è¬ª?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü—Ä–∏ –ª—é–±–æ–º —Å–ø–∏—Å–∞–Ω–∏–∏ (`REDEEM`, `MANUALSUBTRACT`, `TRANSFER`):
    - —Ä–∞—Å—Å—á–∏—Ç–∞–≤ –Ω–æ–≤—ã–π –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å:
        - `new_total_balance = regular_balance + promo_balance - redeem_amount`.
    - –ï—Å–ª–∏ `new_total_balance < 1`:
        - –ª–∏–±–æ:
            - –∑–∞–ø—Ä–µ—â–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ —Å–ø–∏—Å—ã–≤–∞–Ω–∏–µ –Ω–µ –æ–±–Ω—É–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å),
        - –ª–∏–±–æ:
            - —Ä–∞–∑—Ä–µ—à–∞—Ç—å **–ø–æ–ª–Ω–æ–µ –æ–±–Ω—É–ª–µ–Ω–∏–µ** (–æ—Ç–¥–µ–ª—å–Ω—ã–º —Ñ–ª–∞–≥–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä `allow_full_zero` –¥–ª—è –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞–µ–≤, –∫–∞–∫ –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç—ã).
- –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏–∑ POS:
    - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–µ—Ç ¬´new_total_balance < 1¬ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É.

***

## –ë–ª–æ–∫ 4. Cancellation, idempotency –∏ —Å–≤—è–∑–∏ —Å POS/Promo

9Ô∏è‚É£ **–û—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Cancel) –∏ –≤–æ–∑–≤—Ä–∞—Ç –±–∞–ª–∞–Ω—Å–∞**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–¥–º–∏–Ω –ø–æ–Ω—è–ª, —á—Ç–æ —Ä—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±—ã–ª–æ –æ—à–∏–±–∫–æ–π)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –£–∂–µ –µ—Å—Ç—å `CancelBallTransaction` ‚Äî –¥–æ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
    - –ú–æ–∂–Ω–æ **–æ—Ç–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** —Ç–∏–ø–æ–≤:
        - `EARN`, `REDEEM`, `MANUALADD`, `MANUALSUBTRACT`, `PROMO`, (–∏, –≤–æ–∑–º–æ–∂–Ω–æ, `TRANSFER*` –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è).
    - –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ:
        - —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å —Å —Ñ–ª–∞–≥–æ–º `iscancelled = true`,
        - –≤ `GuestCard` **–≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–ª–∞–Ω—Å** –∫ `balance_before` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (regular/promo),
        - –ª–æ–≥–∏—Ä—É–µ–º –≤ ActivityLog,
        - —à–ª—ë–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–æ—Å—Ç—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
- –í–∞–∂–Ω–æ: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ `EXPIRE` (—Å–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤) –∏ `CHARGEBACK_ADJUST` (–µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è) **–Ω–µ –æ—Ç–º–µ–Ω—è–µ–º**, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

***

üîü **Idempotency –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å POS**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å earn/redeem, –∏–¥—É—â–∏—Ö –æ—Ç POS, –ø–æ–º–∏–º–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ `postransaction_id`?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å POS:
    - –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å `postransaction_id` –∏ `tenant_id`.
    - –í `BallTransaction` –≤–≤–æ–¥–∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å:
        - `(tenant_id, postransaction_id, transaction_origin)` –≥–¥–µ `transaction_origin` –º–æ–∂–µ—Ç –±—ã—Ç—å `EARN_FROM_CHECK`, `REDEEM_FROM_CHECK`, `PROMO_FROM_CHECK`.
    - –ï—Å–ª–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ POS-—Å–æ–±—ã—Ç–∏—è –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞—Ä—É—à–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:
        - —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å/—Å—Ç–∞—Ç—É—Å.

***

1Ô∏è‚É£1Ô∏è‚É£ **–°–≤—è–∑—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –ø—Ä–æ–º–æ-–ø—Ä–∞–≤–∏–ª–∞–º–∏**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —Å–≤—è–∑—ã–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–æ–º–æ (–¥–ª—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–º–æ)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í `BallTransaction`:
    - –ø–æ–ª–µ `promo_id` (nullable), —Å—Å—ã–ª–∫–∞ –Ω–∞ `LoyaltyPromo`.
    - –ø–æ–ª–µ `rule_id` (nullable), —Å—Å—ã–ª–∫–∞ –Ω–∞ `LoyaltyRule`.
- –í–≤–µ–¥—ë–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ constraint `(postransaction_id, loyaltyrule_id)` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥):
    - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —á–µ–∫—É –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞.
- –î–ª—è –ø—Ä–æ–º–æ-–Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `PromoBallGranted`, –Ω–æ —Å–≤—è–∑—å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–µ–¥—ë—Ç—Å—è —á–µ—Ä–µ–∑ `BallTransaction.id`.

***

## –ë–ª–æ–∫ 5. Expire-–ª–æ–≥–∏–∫–∞

1Ô∏è‚É£2Ô∏è‚É£ **–°–≥–æ—Ä–∞–Ω–∏–µ –ø–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–æ—Å–Ω–æ–≤–Ω—ã–µ –±–∞–ª–ª—ã)**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–æ–≤–æ–µ —Å–≥–æ—Ä–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í `GuestCard`:
    - `last_activity_at` ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ (earn, redeem, manual, –≤–∏–∑–∏—Ç –∏ —Ç.–¥.).
    - `inactivity_expire_days` ‚Äî –∏–∑ `LoyaltySystem`, –Ω–æ –Ω–µ –º–µ–Ω—å—à–µ 90.
- –ù–æ—á–Ω–æ–π/–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π CRON:
    - –∏—â–µ—Ç –≤—Å–µ –∫–∞—Ä—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö:
        - `status = ACTIVE`,
        - `regular_balance > 0`,
        - `now - last_activity_at > inactivity_expire_days`.
    - –î–ª—è –∫–∞–∂–¥–æ–π:
        - —Å–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é `EXPIRE` —Å:
            - `amount = -regular_balance`,
            - `balance_type = REGULAR`,
            - `balance_after_regular = 0`.
        - –æ–±–Ω–æ–≤–ª—è–µ—Ç `regular_balance = 0`, `balls_expire_at = null`.
        - –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ —à–ª—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã).

***

1Ô∏è‚É£3Ô∏è‚É£ **–°–≥–æ—Ä–∞–Ω–∏–µ –ø—Ä–æ–º–æ-–±–∞–ª–ª–æ–≤ –ø–æ —Å—Ä–æ–∫—É –ø—Ä–æ–º–æ**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —Å–∂–∏–≥–∞—Ç—å –ø—Ä–æ–º–æ-–±–∞–ª–ª—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –ø—Ä–æ–º–æ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –î–ª—è –ø—Ä–æ–º–æ, –≤—ã–¥–∞—é—â–∏—Ö –±–∞–ª–ª—ã:
    - —Ö—Ä–∞–Ω–∏—Ç—å **–¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏** –≤ `PromoBallGranted`:
        - `guest_card_id`,
        - `promo_id`,
        - `amount_initial`,
        - `amount_remaining`,
        - `expires_at`.
- CRON –¥–ª—è –ø—Ä–æ–º–æ:
    - –∏—â–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏, –≥–¥–µ `expires_at < now` –∏ `amount_remaining > 0`.
    - –î–ª—è –∫–∞–∂–¥–æ–π:
        - —Å–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é `EXPIRE` —Å `amount = -amount_remaining`, `balance_type = PROMO`, `promo_id`.
        - —É–º–µ–Ω—å—à–∞–µ—Ç `promo_balance` –Ω–∞ `amount_remaining`.
        - —Å—Ç–∞–≤–∏—Ç `amount_remaining = 0`.
        - –ª–æ–≥–∏—Ä—É–µ—Ç.
- –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–æ–º–æ-–±–∞–ª–ª—ã —Å–≥–æ—Ä–∞—é—Ç –ø–∞–∫–µ—Ç–∞–º–∏, –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å ‚Äî –ø–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

***

## –ë–ª–æ–∫ 6. –ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤ –º–µ–∂–¥—É –≥–æ—Å—Ç—è–º–∏

1Ô∏è‚É£4Ô∏è‚É£ **–õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –±–∞–ª–ª–æ–≤ (BallTransfer)**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–æ –ª–∏ —Ä–∞–∑—Ä–µ—à–∞—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –±–∞–ª–ª–æ–≤ –º–µ–∂–¥—É –≥–æ—Å—Ç—è–º–∏, –∏ –µ—Å–ª–∏ –¥–∞ ‚Äî –ø–æ –∫–∞–∫–∏–º –ø—Ä–∞–≤–∏–ª–∞–º?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–∏—Å—Ö–æ–¥—è –∏–∑ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π BallTransfer-—Å—Ö–µ–º—ã –≤ —Ñ–∞–π–ª–∞—Ö):**

- –û—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –∫–∞–∫ **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Ñ–∏—á—É**, —É–ø—Ä–∞–≤–ª—è–µ–º—É—é —Ñ–ª–∞–≥–æ–º –≤ `LoyaltySystem`:
    - `allow_transfers: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`).
- –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ:
    - –ø–µ—Ä–µ–≤–æ–¥ –≤–æ–∑–º–æ–∂–µ–Ω:
        - —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –ø–æ–ª—É—á–∞—Ç–µ–ª—è,
        - –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ tenant‚Äô–∞,
        - –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ–¥–Ω–∏–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º –∏–ª–∏ –≤—Å–µ–π —Å–µ—Ç—å—é (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç UNIFIED/SEPARATE).
    - –ë–∞–ª–ª—ã:
        - —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ `regular_balance` –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–ø—Ä–æ–º–æ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è),
        - –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –≤ `regular_balance` –ø–æ–ª—É—á–∞—Ç–µ–ª—è.
- –ú–µ—Ö–∞–Ω–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
    - –¥–≤—É—Ö—à–∞–≥–æ–≤–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SMS –∏–ª–∏ Telegram-–∫–æ–¥ (—É–∂–µ –≤ —Å—Ö–µ–º–µ BallTransfer –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω `verification_code` –∏ —Å—Ç–∞—Ç—É—Å—ã `PENDING` ‚Üí `VERIFIED` ‚Üí `COMPLETED`).

***

1Ô∏è‚É£5Ô∏è‚É£ **–ö–æ–º–∏—Å—Å–∏—è/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥—ã**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω—ã –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å—É–º–º–µ, —á–∞—Å—Ç–æ—Ç–µ –∏ –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –ø–µ—Ä–µ–≤–æ–¥—ã?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–≤–µ—Å—Ç–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –±–∞–∑–æ–≤—É—é –∑–∞—â–∏—Ç—É:
    - `min_transfer_amount = 1`,
    - `max_transfer_amount_per_operation`, –Ω–∞–ø—Ä–∏–º–µ—Ä 100 000 –±–∞–ª–ª–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ –≤ `LoyaltySystem`),
    - `max_transfer_amount_per_day` –Ω–∞ –≥–æ—Å—Ç—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ).
- –ö–æ–º–∏—Å—Å–∏—é –∑–∞ –ø–µ—Ä–µ–≤–æ–¥ **–Ω–µ –≤–≤–æ–¥–∏—Ç—å**, —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –º–µ—Ö–∞–Ω–∏–∫—É –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
    - –ï—Å–ª–∏ –∫–æ–≥–¥–∞-—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è, –µ—ë –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–æ–º–æ/–ø—Ä–∞–≤–∏–ª–æ, –Ω–æ —Å–µ–π—á–∞—Å —ç—Ç–æ –ª–∏—à–Ω–µ–µ.

***

## –ë–ª–æ–∫ 7. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

1Ô∏è‚É£6Ô∏è‚É£ **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –∫–∞—Ä—Ç–µ**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç –≥–æ–Ω–æ–∫ (–¥–≤–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è—é—Ç –±–∞–ª–∞–Ω—Å –æ–¥–Ω–æ–π –∫–∞—Ä—Ç—ã)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –±–∞–ª–∞–Ω—Å–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è:
    - –≤–Ω—É—Ç—Ä–∏ **–æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î**,
    - —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º row-level lock –Ω–∞ `GuestCard`:
        - –Ω–∞–ø—Ä–∏–º–µ—Ä, `SELECT ... FOR UPDATE` (–≤ Prisma/Nest —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `transaction` + `update` –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ).
- –í–∞–∂–Ω–æ:
    - –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Ç–æ–ª—å–∫–æ –≤ —Å–µ—Ä–≤–∏—Å–µ BallTransactionService**, –∞ –Ω–µ —Ä–∞—Å–∫–∏–¥–∞–Ω—ã –ø–æ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º.
    - –õ—é–±–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è earn/redeem/manual/expire/transfer:
        - —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ `regular_balance`/`promo_balance`,
        - —Å—á–∏—Ç–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è,
        - —Å–æ–∑–¥–∞—ë—Ç `BallTransaction`,
        - –æ–±–Ω–æ–≤–ª—è–µ—Ç `GuestCard`.

***

1Ô∏è‚É£7Ô∏è‚É£ **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –≤—Å–µ–≥–¥–∞ —Å–æ–±–ª—é–¥–∞—Ç—å—Å—è**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ –±–∏–∑–Ω–µ—Å-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω—É–∂–Ω–æ –∂—ë—Å—Ç–∫–æ –¥–µ—Ä–∂–∞—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:

- `regular_balance >= 0`, `promo_balance >= 0`.
- `regular_balance + promo_balance >= 0`.
- –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ –≤ —Ä–µ–∂–∏–º–µ –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω—É–ª–µ–Ω–∏—è:
    - `regular_balance + promo_balance >= 1` (–ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∞–Ω–∏—è).
- –õ—é–±–æ–π `BallTransaction`:
    - `balance_after = balance_before + amount` (–ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –±–∞–ª–∞–Ω—Å—É).
- –°—É–º–º–∞ –≤—Å–µ—Ö `PromoBallGranted.amount_remaining` –ø–æ –∫–∞—Ä—Ç–µ **–Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å** `promo_balance` (–º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É).

–í —Å–ª—É—á–∞—è—Ö –Ω–∞—Ä—É—à–µ–Ω–∏—è:

- –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–æ–º–∞–ª–∏—é –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `BalanceAnomaly`,
- –∑–∞–ø—É—Å–∫–∞—Ç—å reconciliation-job –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã.

***

## –ë–ª–æ–∫ 8. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º

1Ô∏è‚É£8Ô∏è‚É£ **–ê–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –±–∞–ª–ª–∞–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Å—á–∏—Ç–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ `BallTransaction` –¥–ª—è Restaurant Admin?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ/–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Å—Ä–µ–∑—ã (`AnalyticsDailySnapshot`):
    - –æ–±—â–µ–µ —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Å—Ç–µ–π,
    - —Å—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –∑–∞ –¥–µ–Ω—å (regular / promo –æ—Ç–¥–µ–ª—å–Ω–æ),
    - —Å—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –∑–∞ –¥–µ–Ω—å (regular / promo),
    - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Ç–∏–ø–∞–º (`EARN`, `REDEEM`, `PROMO`, `MANUALADD`, `MANUALSUBTRACT`, `EXPIRE`),
    - —Å—Ä–µ–¥–Ω–∏–π –∫–µ—à–±—ç–∫ % (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –∫ –≤—ã—Ä—É—á–∫–µ),
    - –¥–æ–ª—è —Å–ø–∏—Å–∞–Ω–∏–π –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º.
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –±–ª–æ–∫ –ø–æ –ø—Ä–æ–º–æ:
    - —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–º–æ-–±–∞–ª–ª–æ–≤ –Ω–∞—á–∏—Å–ª–µ–Ω–æ/—Å–ø–∏—Å–∞–Ω–æ/—Å–≥–æ—Ä–µ–ª–æ,
    - ROI –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–º–æ (—Å–≤—è–∑—å –≤—ã—Ä—É—á–∫–∏ –∏ –≤—ã–¥–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤).

***

1Ô∏è‚É£9Ô∏è‚É£ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≥–æ—Å—Ç—é**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≥–æ—Å—Ç—é —Å—Ç—Ä–æ–∏—Ç—å –∏–∑ `BallTransaction` –∏ `GuestVisit`?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ù–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –≥–æ—Å—Ç—è:
    - —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å + –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ,
    - `lifetime_spent` (–æ–±—â–∞—è —Å—É–º–º–∞ —á–µ–∫–æ–≤),
    - `lifetime_earned_points` (—Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –±—ã–ª–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ),
    - `lifetime_redeemed_points` (—Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Å–ø–∏—Å–∞–Ω–æ),
    - –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (earn/redeem/promo/expire/manual),
    - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è.
- –≠—Ç–æ —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –µ—Å—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏, –Ω–æ –≤–∞–∂–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å –∫–∞–∫ —Ü–µ–ª–µ–≤–æ–π –Ω–∞–±–æ—Ä.

***

## –ë–ª–æ–∫ 9. RBAC –∏ audit trail

2Ô∏è‚É£0Ô∏è‚É£ **–†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å –±–∞–ª–ª–∞–º–∏**

**–í–æ–ø—Ä–æ—Å:**
–ö—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∫–∞–∫–∏–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (EARN/REDEEM vs MANUALADD/MANUALSUBTRACT/EXPIRE/TRANSFER)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **Cashier:**
    - –º–æ–∂–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `EARN`/`REDEEM` —á–µ—Ä–µ–∑ POS (`manage_balls_pos`).
- **Manager:**
    - –º–æ–∂–µ—Ç:
        - –≤—Å—ë, —á—Ç–æ Cashier,
        - –ø–ª—é—Å —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ `MANUALADD`/`MANUALSUBTRACT` (–µ—Å–ª–∏ –µ–º—É –≤–∫–ª—é—á–µ–Ω–æ `manage_balls_manual`).
- **Restaurant Admin:**
    - –∏–º–µ–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∞ –ø–æ –±–∞–ª–ª–∞–º:
        - POS-–æ–ø–µ—Ä–∞—Ü–∏–∏,
        - —Ä—É—á–Ω—ã–µ,
        - –∑–∞–º–æ—Ä–æ–∑–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç,
        - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –∏ —É—Ä–æ–≤–Ω–µ–π.
- **Owner:**
    - –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏—Å–ø—Ä–∞–≤–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Å—Å–æ–≤—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏—è—Ö/–æ—à–∏–±–∫–∞—Ö).

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ **–ª–æ–≥–∏—Ä—É—é—Ç—Å—è** –≤ ActivityLog —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `userid`, `entitytype = BALLTRANSACTION`/`GUESTCARD`, `oldvalue/newvalue`, `reason`.

***

2Ô∏è‚É£1Ô∏è‚É£ **–£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ audit trail**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –º–∏–Ω–∏–º—É–º –Ω—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ–º–∏–º–æ —Å–∞–º–æ–π –∑–∞–ø–∏—Å–∏ –≤ `BallTransaction`?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í ActivityLog –ø—Ä–∏ –∫–∞–∂–¥–æ–π –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (MANUALADD, MANUALSUBTRACT, CANCEL, EXPIRE, TRANSFER):
    - `userid` (–∫—Ç–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª),
    - `guestcard_id`,
    - `transaction_id`,
    - `action_type` (`EARNBALLS`, `REDEEMBALLS`, `MANUALADDBALLS`, `MANUALSUBTRACTBALLS`, `EXPIREBALLS`, `TRANSFERBALLS`, `CANCELBALLTRANSACTION`),
    - `oldvalue` (–±–∞–ª–∞–Ω—Å –¥–æ),
    - `newvalue` (–±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ),
    - `reason` (–µ—Å–ª–∏ –±—ã–ª–æ),
    - `ipaddress`, `useragent` (–µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ –∏–∑ POS).
- –î–ª—è —á–∏—Å—Ç—ã—Ö POS-–æ–ø–µ—Ä–∞—Ü–∏–π:
    - –º–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—à–∏–±–∫–∏, –±–æ–ª—å—à–∏–µ —Å—É–º–º—ã), —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É—Ç—å –ª–æ–≥.

***

–ï—Å–ª–∏ —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–µ—à–µ–Ω–∏—è –≤ —Ü–µ–ª–æ–º —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ç–≤–æ–∏–º –≤–∏–¥–µ–Ω–∏–µ–º, –¥–∞–ª—å—à–µ –º–æ–∂–Ω–æ:

- –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ –ø—É–Ω–∫—Ç–∞–º (–∫–∞–∫ —Ä–∞–Ω—å—à–µ: ¬´–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ¬ª / —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã),
- –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫—Ä—É–ø–Ω–æ–º—É –±–ª–æ–∫—É ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, **Telegram Bot + Mini App** –∏–ª–∏ **Frontend –∞–¥–º–∏–Ω–∫–∏**.

---

# –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã :

    1. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    2.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    3.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    4.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    5.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    6.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    7.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    8.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    9.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    10.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    11.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    12.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    13.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    14.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    15.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    16.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    17.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    18.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    19.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    20.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    21.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    –£—á–∏—Ç—ã–≤–∞—è –æ—Ç–≤–µ—Ç—ã, –≤—ã–≤–µ–¥–∏ —Å—é–¥–∞ –≤ —á–∞—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ—Å–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞.

–ù–∏–∂–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω **Balls \& Transactions**.

***

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–ª–∞–Ω—Å–∞

### 1.1. –î–≤–∞ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ –∫–∞—Ä—Ç–µ

–í `GuestCard`:

- `regular_balance` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –±–∞–ª–ª—ã:
    - –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞ –ø–æ–∫—É–ø–∫–∏ (–∫–µ—à–±—ç–∫),
    - –∑–∞ —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (MANUALADD),
    - —É—á–∞—Å—Ç–≤—É—é—Ç –≤ —Å–≥–æ—Ä–∞–Ω–∏–∏ –ø–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
- `promo_balance` ‚Äî –ø—Ä–æ–º–æ-–±–∞–ª–ª—ã:
    - –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–æ–º–æ-–∞–∫—Ü–∏—è–º–∏ (–î–†, —Ä–µ—Ç–µ–Ω—à–Ω, —Å–ø–µ—Ü-–∫–∞–º–ø–∞–Ω–∏–∏),
    - –∂–∏–≤—É—Ç –ø–æ —Å–≤–æ–∏–º —Å—Ä–æ–∫–∞–º `expires_at` –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–º–æ-–ø–∞–∫–µ—Ç–æ–≤.

–û–±—â–∏–π –±–∞–ª–∞–Ω—Å:

- `total_balance = regular_balance + promo_balance` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–æ—Å—Ç—é.

–í `BallTransaction`:

- `balance_type: REGULAR | PROMO | MIXED` (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —è–≤–Ω–æ —Ç–∏–ø –∏–ª–∏ —Ä–∞–∑–±–∏–≤–∫—É –≤ JSON).

***

## 2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (EARN)

### 2.1. –ë–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º

–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —á–µ–∫–∞:

1. –ü–æ–ª—É—á–∞–µ–º **–∏—Å—Ö–æ–¥–Ω—É—é —Å—É–º–º—É —á–µ–∫–∞** (–¥–æ —Å–∫–∏–¥–æ–∫) `check_amount_original`.
2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π earn-–ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ:
    - —É—Ä–æ–≤–Ω—é –≥–æ—Å—Ç—è (Bronze/Silver/Gold –∏ –¥—Ä.),
    - —Ç–∏–ø—É —Å–∏—Å—Ç–µ–º—ã (discount/points).
3. –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ `LoyaltyRule`:
    - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ (–ª–∞–Ω—á 11‚Äì15),
    - –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤,
    - –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º –≥–æ—Å—Ç–µ–π –∏ —Ç.–¥.
4. –ü–æ–ª—É—á–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π `earn_percent`.
5. –°—á–∏—Ç–∞–µ–º:
    - `earn_amount = floor(check_amount_original * earn_percent / 100)`.
6. –ï—Å–ª–∏ `earn_amount <= 0` ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é EARN –Ω–µ —Å–æ–∑–¥–∞—ë–º (–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤–∏–∑–∏—Ç).
7. –°–æ–∑–¥–∞—ë–º `BallTransaction`:
    - `type = EARN`,
    - `amount = +earn_amount`,
    - `balance_type = REGULAR`,
    - `check_amount = check_amount_original`,
    - `postransaction_id` (–µ—Å–ª–∏ –∏–∑ POS),
    - `rule_id`/`promo_id` (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å).
8. –û–±–Ω–æ–≤–ª—è–µ–º `GuestCard`:
    - `regular_balance += earn_amount`,
    - `lifetimespent += check_amount_original`,
    - `totalvisits++`,
    - `lastvisit_at = now`,
    - `lastactivity_at = now`.
9. –ó–∞–ø—É—Å–∫–∞–µ–º `checkLevelUpgrade`:
    - —É—Ä–æ–≤–µ–Ω—å —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç—ë—Ç, downgrade –Ω–µ—Ç.

### 2.2. –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ

- –í—Å–µ–≥–¥–∞ `floor` (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–Ω–∏–∑ –¥–æ —Ü–µ–ª–æ–≥–æ):
    - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ¬´–ª–∏—à–Ω–∏—Ö¬ª –±–∞–ª–ª–æ–≤.


### 2.3. –†—É—á–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (MANUALADD)

- –î–æ—Å—Ç—É–ø–Ω—ã Manager/Admin (–ø–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º).
- DTO —Ç—Ä–µ–±—É–µ—Ç:
    - `amount`, `guest_card_id`, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π** `reason` (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤).
- –í `BallTransaction`:
    - `type = MANUALADD`,
    - `balance_type = REGULAR`,
    - `created_by_user_id` –≤—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω.
- –í–æ–∑–º–æ–∂–µ–Ω –ª–∏–º–∏—Ç –Ω–∞ `amount` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –º–∏–ª–ª–∏–∞—Ä–¥–∞ –±–∞–ª–ª–æ–≤).
- –í—Å–µ —Ç–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥—É—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É.

***

## 3. –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (REDEEM)

### 3.1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø—Ä–æ–º–æ ‚Üí –æ—Å–Ω–æ–≤–Ω—ã–µ

–ü—Ä–∏ –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∞–Ω–∏—è (`REDEEM`, —Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ —á–µ–∫—É):

1. –ó–∞–ø—Ä–æ—à–µ–Ω–æ `redeem_amount`.
2. –°–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞—Ç–∏–º `promo_balance`:
    - `promo_used = min(redeem_amount, promo_balance)`.
3. –û—Å—Ç–∞—Ç–æ–∫ ‚Äî –∏–∑ `regular_balance`:
    - `regular_used = redeem_amount - promo_used`.
4. –ï—Å–ª–∏ `regular_balance < regular_used`:
    - –æ—à–∏–±–∫–∞ ¬´–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤¬ª.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö:

- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî **–¥–≤–µ –∑–∞–ø–∏—Å–∏**:
    - `BallTransaction` —Å —Ç–∏–ø–æ–º `REDEEM_PROMO`, `amount = -promo_used`, `balance_type = PROMO`.
    - `BallTransaction` —Å —Ç–∏–ø–æ–º `REDEEM`, `amount = -regular_used`, `balance_type = REGULAR`.
- –õ–∏–±–æ –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å —Å JSON `{promo_used, regular_used}` ‚Äî –Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Å–≥–æ—Ä–∞–Ω–∏—è —É–¥–æ–±–Ω–µ–µ –¥–≤–∞.


### 3.2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å—É–º–º–µ —Å–ø–∏—Å–∞–Ω–∏—è

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `redeemBalls`:

- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—ë–º `check_amount`.
- –ü—Ä–æ–≤–µ—Ä—è–µ–º:

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —á–µ–∫–∞**:
        - –µ—Å–ª–∏ `check_amount < 50` ‚Äî –±–∞–ª–ª—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è (–æ—à–∏–±–∫–∞ –∏–ª–∏ `max_redeem = 0` –ø—Ä–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–º —Ä–∞—Å—á—ë—Ç–µ).
2. **–õ–∏–º–∏—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –∫ —Å–ø–∏—Å–∞–Ω–∏—é**:
        - `max_redeem_by_percent = floor(check_amount * max_redeem_percent / 100)`,
–≥–¥–µ `max_redeem_percent` –ø–æ —Å–∏—Å—Ç–µ–º–µ (–¥–µ—Ñ–æ–ª—Ç 20%, admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç 10‚Äì100).
3. **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç –ø–æ –±–∞–ª–∞–Ω—Å—É**:
        - `max_redeem_total = min(total_balance, max_redeem_by_percent)`.
- –ï—Å–ª–∏ `requested_amount > max_redeem_total`:
    - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É `Cannot redeem more than X balls for this check`.


### 3.3. –ë–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å < 1

- –ü–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ —Å–ø–∏—Å–∞–Ω–∏—è:
    - `new_total_balance = regular_balance + promo_balance - redeem_amount`.
- –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º—ã –Ω–µ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω—É–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã:
    - –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ–º `new_total_balance < 1`:
        - –ª–∏–±–æ —Å–Ω–∏–∂–∞–µ–º –¥–æ–ø—É—Å—Ç–∏–º—É—é —Å—É–º–º—É –ø—Ä–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–º —Ä–∞—Å—á—ë—Ç–µ,
        - –ª–∏–±–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–ø–∏—Å–∞–Ω–∏—è.

***

## 4. –û—Ç–º–µ–Ω–∞, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, —Å–≤—è–∑—å —Å POS –∏ –ø—Ä–æ–º–æ

### 4.1. –û—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (CANCEL)

- –ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å:
    - `EARN`, `REDEEM`, `MANUALADD`, `MANUALSUBTRACT`, `PROMO` (–∏, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ TRANSFER).
- –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ:
    - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç `iscancelled = true`, `cancelled_at`, `cancelled_by_user_id`, `cancellation_reason`.
    - `GuestCard`:
        - –±–∞–ª–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ `balance_before` –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É —Ç–∏–ø—É (regular/promo).
    - ActivityLog:
        - –ª–æ–≥–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ (–¥–æ/–ø–æ—Å–ª–µ, –ø—Ä–∏—á–∏–Ω–∞).
    - –ú–æ–∂–Ω–æ —É–≤–µ–¥–æ–º–∏—Ç—å –≥–æ—Å—Ç—è (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ—Ç–º–µ–Ω–∞ –∫–∞—Å–∞–µ—Ç—Å—è —Å–ø–∏—Å–∞–Ω–∏—è –∏–ª–∏ –∫—Ä—É–ø–Ω–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è).
- `EXPIRE` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å chargeback, –Ω–µ –æ—Ç–º–µ–Ω—è–µ–º.


### 4.2. Idempotency —Å POS

- –î–ª—è POS-—Å–æ–±—ã—Ç–∏–π:
    - –í `BallTransaction`:
        - —Å–æ—Ö—Ä–∞–Ω—è–µ–º `postransaction_id`,
        - `transaction_origin` (`EARN_FROM_CHECK`, `REDEEM_FROM_CHECK`, `PROMO_FROM_CHECK`).
    - –í–≤–æ–¥–∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å:
        - `(tenant_id, postransaction_id, transaction_origin)`.
- –ï—Å–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≥–æ –∂–µ POS-—á–µ–∫–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
    - —Å—Ä–∞–±–æ—Ç–∞–µ—Ç constraint ‚Üí —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ–≤—Ç–æ—Ä ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –¥—É–±–ª–µ–π.


### 4.3. –°–≤—è–∑—å —Å –ø—Ä–æ–º–æ –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏

- –í `BallTransaction`:
    - `promo_id` ‚Üí `LoyaltyPromo`,
    - `rule_id` ‚Üí `LoyaltyRule`.
- Constraint `(postransaction_id, loyaltyrule_id)`:
    - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∫ –æ–¥–Ω–æ–º—É —á–µ–∫—É –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞.

***

## 5. –°–≥–æ—Ä–∞–Ω–∏–µ (EXPIRE)

### 5.1. –°–≥–æ—Ä–∞–Ω–∏–µ –ø–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (regular_balance)

- –í `GuestCard`:
    - `lastactivity_at` ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö (earn, redeem, manual, visit).
    - `inactivity_expire_days` ‚Äî –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ `LoyaltySystem`, –º–∏–Ω–∏–º—É–º 90.
- –ù–æ—á–Ω–æ–π CRON:
    - –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∫–∞—Ä—Ç—ã:
        - `status = ACTIVE`,
        - `regular_balance > 0`,
        - `now - lastactivity_at > inactivity_expire_days`.
    - –î–ª—è –∫–∞–∂–¥–æ–π:
        - —Å–æ–∑–¥–∞—ë—Ç `BallTransaction` —Ç–∏–ø–∞ `EXPIRE`:
            - `amount = -regular_balance`,
            - `balance_type = REGULAR`,
            - `balance_before = regular_balance`, `balance_after = 0`.
        - –æ–±–Ω–æ–≤–ª—è–µ—Ç `regular_balance = 0`, `balls_expire_at = null`.
        - ActivityLog + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–æ—Å—Ç—é (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ).


### 5.2. –°–≥–æ—Ä–∞–Ω–∏–µ –ø—Ä–æ–º–æ-–±–∞–ª–ª–æ–≤ –ø–æ —Å—Ä–æ–∫—É –ø—Ä–æ–º–æ

- –û—Ç–¥–µ–ª—å–Ω–æ –≤–µ–¥—ë—Ç—Å—è `PromoBallGranted`:
    - `guest_card_id`,
    - `promo_id`,
    - `amount_initial`,
    - `amount_remaining`,
    - `expires_at`.
- CRON –Ω–∞ –ø—Ä–æ–º–æ:
    - –∏—â–µ—Ç –∑–∞–ø–∏—Å–∏, –≥–¥–µ `expires_at < now` –∏ `amount_remaining > 0`.
    - –î–ª—è –∫–∞–∂–¥–æ–π:
        - —Å–æ–∑–¥–∞—ë—Ç `BallTransaction` —Ç–∏–ø–∞ `EXPIRE`:
            - `amount = -amount_remaining`,
            - `balance_type = PROMO`,
            - `promo_id`.
        - —É–º–µ–Ω—å—à–∞–µ—Ç `promo_balance` –Ω–∞ —ç—Ç—É —Å—É–º–º—É,
        - `amount_remaining` —Å—Ç–∞–≤–∏—Ç –≤ 0.
        - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ).

***

## 6. –ü–µ—Ä–µ–≤–æ–¥—ã (BallTransfer)

### 6.1. –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

- –í `LoyaltySystem`:
    - `allow_transfers: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`).
- –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ:
    - –º–µ—Ç–æ–¥—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É ¬´–ø–µ—Ä–µ–≤–æ–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã¬ª.


### 6.2. –ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–≤–æ–¥–∞

- –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è:
    - –ø–µ—Ä–µ–≤–æ–¥ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ tenant‚Äô–∞,
    - –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è,
    - –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏–ª–∏ –≤—Å–µ–π —Å–µ—Ç–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç UNIFIED/SEPARATE; –ª–æ–≥–∏—á–Ω–æ –±—Ä–∞—Ç—å —Ä–µ–∂–∏–º UNIFIED: –≤—Å—è —Å–µ—Ç—å).
- –ë–∞–ª–ª—ã:
    - —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ `regular_balance` –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è,
    - –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –≤ `regular_balance` –ø–æ–ª—É—á–∞—Ç–µ–ª—è,
    - –ø—Ä–æ–º–æ-–±–∞–ª–ª—ã –Ω–µ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è.


### 6.3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ú–µ—Ö–∞–Ω–∏–∫–∞:
    - –¥–≤—É—Ö—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ SMS/Telegram:
        - `PENDING` ‚Üí –≤–≤–æ–¥ –∫–æ–¥–∞ ‚Üí `VERIFIED` ‚Üí `COMPLETED`.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
    - `min_transfer_amount = 1`,
    - `max_transfer_amount_per_operation` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –ª–∏–º–∏—Ç),
    - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `max_transfer_per_day` –ø–æ –≥–æ—Å—Ç—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ).
- –ö–æ–º–∏—Å—Å–∏–∏ –Ω–µ—Ç.

***

## 7. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

### 7.1. –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—â–∏–µ –±–∞–ª–∞–Ω—Å:
    - –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –ë–î-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏,
    - —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫–∏ `GuestCard` (row-level lock / `SELECT ... FOR UPDATE` —á–µ—Ä–µ–∑ Prisma).
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `BallTransactionService`:
    - –Ω–∏–∫–∞–∫–∏–µ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –º–µ–Ω—è—é—Ç `regular_balance`/`promo_balance` –Ω–∞–ø—Ä—è–º—É—é.


### 7.2. –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

–î–æ–ª–∂–Ω—ã –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è:

- `regular_balance >= 0`,
- `promo_balance >= 0`,
- `total_balance = regular_balance + promo_balance >= 0`,
- –ø—Ä–∏ –æ–±—ã—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å–ø–∏—Å–∞–Ω–∏—è (–±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω—É–ª–µ–Ω–∏—è):
    - `total_balance >= 1`,
- –¥–ª—è –∫–∞–∂–¥–æ–π `BallTransaction`:
    - `balance_after = balance_before + amount` (–ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –±–∞–ª–∞–Ω—Å—É),
- —Å—É–º–º–∞ `PromoBallGranted.amount_remaining` –ø–æ –∫–∞—Ä—Ç–µ ‚â§ `promo_balance`.

–ù–∞—Ä—É—à–µ–Ω–∏—è:

- —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `BalanceAnomaly`,
- –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π reconciliation-job –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã—è–≤–∏—Ç—å/–∏—Å–ø—Ä–∞–≤–∏—Ç—å (—Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º).

***

## 8. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### 8.1. –ü–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º

–ù–∞ –æ—Å–Ω–æ–≤–µ `BallTransaction` –∏ `GuestVisit`:

- –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ/–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Å—Ä–µ–∑—ã:
    - —Å—É–º–º–∞—Ä–Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ –±–∞–ª–ª–æ–≤ (regular / promo),
    - —Å—É–º–º–∞—Ä–Ω–æ —Å–ø–∏—Å–∞–Ω–æ –±–∞–ª–ª–æ–≤ (regular / promo),
    - —Å—Ä–µ–¥–Ω–∏–π –∫–µ—à–±—ç–∫ % (–Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã / –≤—ã—Ä—É—á–∫–∞),
    - –¥–æ–ª—è —Å–ø–∏—Å–∞–Ω–∏–π –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º,
    - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Ç–∏–ø–∞–º,
    - –æ–±—ä—ë–º —Å–≥–æ—Ä–µ–≤—à–∏—Ö –±–∞–ª–ª–æ–≤ (EXPIRE) –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º (–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å / –ø—Ä–æ–º–æ).


### 8.2. –ü–æ –≥–æ—Å—Ç—é

- `lifetime_spent`,
- `lifetime_earned_points`,
- `lifetime_redeemed_points`,
- —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å,
- –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞, –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ earn, –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ redeem,
- –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø–∞–º –∏ –ø–µ—Ä–∏–æ–¥–∞–º).

***

## 9. RBAC –∏ –∞—É–¥–∏—Ç

### 9.1. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

- **Cashier**:
    - —Ç–æ–ª—å–∫–æ POS-–æ–ø–µ—Ä–∞—Ü–∏–∏ (`EARN`/`REDEEM` —á–µ—Ä–µ–∑ POS), permission `manage_balls_pos`.
- **Manager**:
    - –≤—Å—ë, —á—Ç–æ Cashier,
    - –ø–ª—é—Å —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏ (`MANUALADD`, `MANUALSUBTRACT`) –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `manage_balls_manual`.
- **Restaurant Admin**:
    - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –±–∞–ª–ª–∞–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏:
        - POS, —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–∞—Ä—Ç, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.
- **Owner**:
    - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏, –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –º–∏–≥—Ä–∞—Ü–∏–∏.


### 9.2. Audit trail

- –í ActivityLog —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤—Å–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
    - `EARNBALLS`, `REDEEMBALLS`, `MANUALADDBALLS`, `MANUALSUBTRACTBALLS`, `EXPIREBALLS`, `TRANSFERBALLS`, `CANCELBALLTRANSACTION`, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã –∏ —Ç.–¥.
- –î–ª—è –∫–∞–∂–¥–æ–π:
    - `userid` (–∫—Ç–æ),
    - `guestcard_id`,
    - `transaction_id` (–µ—Å–ª–∏ –µ—Å—Ç—å),
    - `oldvalue` (–±–∞–ª–∞–Ω—Å –¥–æ),
    - `newvalue` (–±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ),
    - `reason` (–µ—Å–ª–∏ –±—ã–ª–æ),
    - `ipaddress`, `useragent` (–µ—Å–ª–∏ –Ω–µ POS).
- POS-–æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å –ª–æ–≥–∏, –Ω–æ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

***

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤–µ—Å—å engine –ø–æ –±–∞–ª–ª–∞–º:

- —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç **–æ—Å–Ω–æ–≤–Ω—ã–µ** –∏ **–ø—Ä–æ–º–æ** –±–∞–ª–ª—ã,
- —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ –∏ —É—Å—Ç–æ–π—á–∏–≤ –∫ –¥—É–±–ª—è–º/–ø–æ–≤—Ç–æ—Ä–∞–º –∏–∑ POS,
- –≤—Å—Ç—Ä–æ–µ–Ω –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É, –±–∏–ª–ª–∏–Ω–≥ –∏ POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

–î–∞–ª—å—à–µ –º–æ–∂–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:

- **Telegram Bot + Mini App** (UX –≥–æ—Å—Ç—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —ç–∫—Ä–∞–Ω—ã, API),
- –∏–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, **Frontend-–∞–¥–º–∏–Ω–∫—É** –¥–ª—è Owner/Restaurant Admin —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤.

–ù–∞–ø–∏—à–∏, –∫–∞–∫–æ–π –±–ª–æ–∫ –±–µ—Ä—ë–º —Å–ª–µ–¥—É—é—â–∏–º.

---

# Telegram Bot + Mini App —Å–ª–µ–¥—É—é—â–∏–π. –í —Ç–∞–∫–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ

–ù–∏–∂–µ –±–ª–æ–∫ **Telegram Bot + Mini App** –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ: 20+ –≤–æ–ø—Ä–æ—Å–æ–≤ + –º–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –í—Å—ë —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ —Å —É–∂–µ –ø—Ä–∏–Ω—è—Ç—ã–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏:

- –ì–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ 3 –∫–∞–Ω–∞–ª–∞: POS-–∞–≤—Ç–æ, —Å—Å—ã–ª–∫–∞-–∏–Ω–≤–∞–π—Ç, Telegram.
- –í Telegram –≥–æ—Å—Ç—å –≤–≤–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω, –ø–æ–ª—É—á–∞–µ—Ç SMS/–∫–æ–¥, —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å —Å–∏—Å—Ç–µ–º–æ–π.
- Telegram ID —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `User.telegram_id`.
- Mini App ‚Äî —ç—Ç–æ web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–Ω—É—Ç—Ä–∏ Telegram, –≥–¥–µ –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç —Å–≤–æ—é –∫–∞—Ä—Ç—É, –±–∞–ª–∞–Ω—Å, –∏—Å—Ç–æ—Ä–∏—é, QR/6-digit, –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–ª–ª—ã.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤, –ø—Ä–æ–º–æ, —É—Ä–æ–≤–Ω–∏, —Å–≥–æ—Ä–∞–Ω–∏–µ –∏ —Ç.–¥.

–ú–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ –ø—É–Ω–∫—Ç–∞–º, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –±–ª–æ–∫–∞—Ö.

***

## –ë–ª–æ–∫ 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

1Ô∏è‚É£ **Telegram Bot vs Mini App: —á—Ç–æ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞–º–æ–≥–æ –±–æ—Ç–∞ (–∫–æ–º–∞–Ω–¥—ã, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è) –∏ Mini App (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–Ω—É—Ç—Ä–∏ Telegram)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–ª—É—á—à–µ–µ –¥–ª—è —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã):**

- **Telegram Bot** (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å):
    - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `/start`.
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí SMS-–∫–æ–¥ ‚Üí –ø—Ä–∏–≤—è–∑–∫–∞ `telegram_id`.
    - –ö–æ–º–∞–Ω–¥—ã –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:
        - `/card` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, QR/6-digit (—Ç–µ–∫—Å—Ç–æ–º + –∫–∞—Ä—Ç–∏–Ω–∫–∞).
        - `/history` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ç–µ–∫—Å—Ç–æ–º).
        - `/promo` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ (—Ç–µ–∫—Å—Ç–æ–º).
        - `/support` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏.
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è-–ø—É—à–∏:
        - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤,
        - —Å–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è,
        - –Ω–æ–≤—ã–µ –ø—Ä–æ–º–æ,
        - —Å–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ + —Ñ–∞–∫—Ç).
- **Mini App** (web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å):
    - –ë–æ–≥–∞—Ç—ã–π UI:
        - –¥–∞—à–±–æ—Ä–¥ —Å –∫–∞—Ä—Ç–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, –ø—Ä–æ–≥—Ä–µ—Å—Å, QR/6-digit),
        - –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ñ–∏–ª—å—Ç—Ä—ã, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –¥–µ—Ç–∞–ª–∏),
        - –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏ (–∫–∞—Ä—Ç–æ—á–∫–∏, —É—Å–ª–æ–≤–∏—è, —Ç–∞–π–º–µ—Ä—ã),
        - –ø—Ä–æ—Ñ–∏–ª—å –≥–æ—Å—Ç—è (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, email, –¥–µ—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π),
        - –ø–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã),
        - –≤—ã—Ö–æ–¥/–æ—Ç–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞.
    - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:
        - –∫–Ω–æ–ø–∫–æ–π –≤ –º–µ–Ω—é –±–æ—Ç–∞,
        - inline-–∫–Ω–æ–ø–∫–æ–π –ø—Ä–∏ `/start`.

***

2Ô∏è‚É£ **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: frameworks –∏ libraries**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–æ–π —Å—Ç–µ–∫ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞ –∏ Mini App?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **Telegram Bot**:
    - Backend: NestJS + –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ **`telegraf`** (–∏–ª–∏ `node-telegram-bot-api` / `grammy`).
    - –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
        - `apps/telegram-bot/src/`:
            - `bot/` ‚Äî –∫–æ–º–∞–Ω–¥—ã, —Å—Ü–µ–Ω—ã (scenes), handlers.
            - `services/` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å backend API).
            - `keyboards/` ‚Äî inline/reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
            - `middleware/` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, rate-limiting.
            - `main.ts` ‚Äî –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞.
- **Mini App**:
    - Frontend: **React + Vite** (–≤ `apps/telegram-miniapp/`).
    - Telegram Web App SDK:
        - `@twa-dev/sdk` –∏–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π `window.Telegram.WebApp`.
    - UI:
        - Telegram-—Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∫–Ω–æ–ø–∫–∏, –∫–∞—Ä—Ç–æ—á–∫–∏, —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram).
    - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
        - –ø–æ `initData` –æ—Ç Telegram (–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ backend).
- –û–±—â–∏–µ:
    - Shared types –∏ utils –≤ `packages/shared/`.

***

3Ô∏è‚É£ **–•–æ—Å—Ç–∏–Ω–≥ –∏ deployment**

**–í–æ–ø—Ä–æ—Å:**
–ì–¥–µ —Ö–æ—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ Mini App, –∏ –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å CI/CD?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **Bot**:
    - Long polling (–¥–ª—è dev/stage).
    - Webhook (–¥–ª—è production):
        - endpoint: `POST /api/telegram/webhook`.
        - backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç update'—ã –æ—Ç Telegram.
    - –î–µ–ø–ª–æ–π:
        - Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º backend –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏).
- **Mini App**:
    - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π build (HTML/CSS/JS):
        - –¥–µ–ø–ª–æ–∏–º –Ω–∞ CDN (Cloudflare Pages, Vercel, –∏–ª–∏ S3 + CloudFront).
    - URL:
        - `https://miniapp.max-loyalty.com` –∏–ª–∏ `https://max-loyalty.com/miniapp`.
    - –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Mini App –∏–∑ Telegram:
        - –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `initData` —Å `user.id`, `auth_date`, `hash` –∏ –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ ‚Üí backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç.

***

## –ë–ª–æ–∫ 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram

4Ô∏è‚É£ **–ü–æ—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è —á–µ—Ä–µ–∑ –±–æ—Ç**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –∏–º–µ–Ω–Ω–æ –≥–æ—Å—Ç—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—É—Ç—å –æ—Ç `/start` –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã –≤ Telegram?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

1. –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `@max_loyalty_bot`).
2. –ù–∞–∂–∏–º–∞–µ—Ç `/start`.
3. –ë–æ—Ç:
    - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ,
    - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
        - inline-–∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º¬ª (request_contact) –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥.
4. –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
    - –±–æ—Ç —à–ª—ë—Ç SMS —Å 6-–∑–Ω–∞—á–Ω—ã–º –∫–æ–¥–æ–º (—á–µ—Ä–µ–∑ SMS-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: Twilio, SMSC –∏ –¥—Ä.).
5. –ì–æ—Å—Ç—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥.
6. Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–¥:
    - –µ—Å–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω:
        - —Å–æ–∑–¥–∞—ë—Ç/–Ω–∞—Ö–æ–¥–∏—Ç `User` –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É,
        - —Å–≤—è–∑—ã–≤–∞–µ—Ç `telegram_id`,
        - –µ—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤—ã–π –≥–æ—Å—Ç—å ‚Üí —Å–æ–∑–¥–∞—ë—Ç `GuestProfile`, `GuestCard` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `RegistrationSource.TELEGRAM`).
7. –ë–æ—Ç:
    - ¬´–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–∞—à–∞ –∫–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞.¬ª
    - inline-–∫–Ω–æ–ø–∫–∏:
        - ¬´üìá –ú–æ—è –∫–∞—Ä—Ç–∞¬ª ‚Üí Mini App,
        - ¬´üìä –ò—Å—Ç–æ—Ä–∏—è¬ª ‚Üí –∫–æ–º–∞–Ω–¥–∞ `/history`,
        - ¬´üéÅ –ê–∫—Ü–∏–∏¬ª ‚Üí –∫–æ–º–∞–Ω–¥–∞ `/promo`.

***

5Ô∏è‚É£ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –≥–æ—Å—Ç—è**

**–í–æ–ø—Ä–æ—Å:**
–ì–æ—Å—Ç—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω (—á–µ—Ä–µ–∑ POS –∏–ª–∏ —Å—Å—ã–ª–∫—É), –Ω–æ –µ—â—ë –Ω–µ —Å–≤—è–∑–∞–ª Telegram. –ö–∞–∫ –æ–Ω –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü—Ä–∏ `/start`:

1. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ `User` —Å —ç—Ç–∏–º `telegram_id`.
2. –ï—Å–ª–∏ –Ω–µ—Ç:
        - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω,
        - –∏—â–µ—Ç `User` —Å —Ç–∞–∫–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º,
        - –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω:
            - —à–ª—ë—Ç SMS-–∫–æ–¥,
            - –≥–æ—Å—Ç—å –≤–≤–æ–¥–∏—Ç ‚Üí –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è `telegram_id`.
        - –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω:
            - –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (–∫–∞–∫ –Ω–æ–≤—ã–π –≥–æ—Å—Ç—å, —Å–º. –ø.4).
3. –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å:
        - —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
- –í–∞–∂–Ω–æ:
    - –æ–¥–∏–Ω `telegram_id` = –æ–¥–∏–Ω `User` (unique constraint).

***

6Ô∏è‚É£ **–û—Ç–≤—è–∑–∫–∞ Telegram –æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –≥–æ—Å—Ç—å —Ö–æ—á–µ—Ç –æ—Ç–≤—è–∑–∞—Ç—å Telegram (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–¥–∞—ë—Ç –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ —É–¥–∞–ª–∏–ª Telegram)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í Mini App (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏) –∏–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É –±–æ—Ç–∞ `/unlink`:
    - –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: ¬´–í—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ Telegram¬ª,
    - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (inline-–∫–Ω–æ–ø–∫–∏ ¬´–î–∞¬ª / ¬´–û—Ç–º–µ–Ω–∞¬ª),
    - –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏:
        - `User.telegram_id = null`,
        - `User.telegram_username = null`,
        - —É–¥–∞–ª—è–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–∞—è `TelegramSession` (–µ—Å–ª–∏ –µ—Å—Ç—å),
        - ActivityLog: `action_type = UNLINK_TELEGRAM`.
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç —Å–Ω–æ–≤–∞ –ø—Ä–∏–≤—è–∑–∞—Ç—å Telegram –ø–æ –Ω–æ–≤–æ–π (—á–µ—Ä–µ–∑ `/start` + —Ç–µ–ª–µ—Ñ–æ–Ω + –∫–æ–¥).

***

## –ë–ª–æ–∫ 3. Mini App: UI –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

7Ô∏è‚É£ **–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω Mini App (Dashboard)**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ Mini App?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å (Hero-–±–ª–æ–∫)**:
    - –ò–º—è –≥–æ—Å—Ç—è: ¬´–ü—Ä–∏–≤–µ—Ç, –ò–≤–∞–Ω!¬ª
    - –ö–∞—Ä—Ç–æ—á–∫–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:
        - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏,
        - –±–∞–ª–∞–Ω—Å: `total_balance` (–±–æ–ª—å—à–∏–µ —Ü–∏—Ñ—Ä—ã),
        - —É—Ä–æ–≤–µ–Ω—å: ¬´Silver¬ª + –∏–∫–æ–Ω–∫–∞,
        - –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è (–µ—Å–ª–∏ –Ω–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π):
            - `lifetime_spent / next_level_threshold`,
        - QR-–∫–æ–¥ (–º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –ø–æ –∫–ª–∏–∫—É),
        - 6-digit –∫–æ–¥ (–∫—Ä—É–ø–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º).
- **–°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç—å**:
    - –ë–ª–æ–∫ ¬´–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏¬ª (3‚Äì5 –∑–∞–ø–∏—Å–µ–π):
        - –¥–∞—Ç–∞, —Ç–∏–ø (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ/–ø—Ä–æ–º–æ), —Å—É–º–º–∞, –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ,
        - –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—ë¬ª ‚Üí —ç–∫—Ä–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏.
    - –ë–ª–æ–∫ ¬´–ê–∫—Ü–∏–∏¬ª (–µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ):
        - 1‚Äì2 –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–º–æ —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª ‚Üí —ç–∫—Ä–∞–Ω –ø—Ä–æ–º–æ.
- **–ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å (–Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—è)**:
    - –ö–Ω–æ–ø–∫–∏:
        - ¬´üí≥ –ú–æ—è –∫–∞—Ä—Ç–∞¬ª (—Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω),
        - ¬´üìú –ò—Å—Ç–æ—Ä–∏—è¬ª,
        - ¬´üéÅ –ê–∫—Ü–∏–∏¬ª,
        - ¬´üë§ –ü—Ä–æ—Ñ–∏–ª—å¬ª,
        - ¬´üí∏ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –±–∞–ª–ª—ã¬ª (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ).

***

8Ô∏è‚É£ **–≠–∫—Ä–∞–Ω ¬´–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π¬ª**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –¥–µ—Ç–∞–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏–∏?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–§–∏–ª—å—Ç—Ä—ã**:
    - –ü–æ —Ç–∏–ø—É:
        - –í—Å–µ / –ù–∞—á–∏—Å–ª–µ–Ω–∏—è / –°–ø–∏—Å–∞–Ω–∏—è / –ü—Ä–æ–º–æ / –†—É—á–Ω—ã–µ / –°–≥–æ—Ä–∞–Ω–∏–µ.
    - –ü–æ –ø–µ—Ä–∏–æ–¥—É:
        - –ó–∞ –º–µ—Å—è—Ü / –ó–∞ –≥–æ–¥ / –í—Å—ë –≤—Ä–µ–º—è / –ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω.
- **–°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (–∫–∞—Ä—Ç–æ—á–∫–∏):
    - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è,
    - –¢–∏–ø (–∏–∫–æ–Ω–∫–∞ + –Ω–∞–∑–≤–∞–Ω–∏–µ: ¬´–ö–µ—à–±—ç–∫¬ª, ¬´–°–ø–∏—Å–∞–Ω–∏–µ¬ª, ¬´–ü–æ–¥–∞—Ä–æ–∫ –∫–æ –¥–Ω—é —Ä–æ–∂–¥–µ–Ω–∏—è¬ª),
    - –°—É–º–º–∞:
        - `+500` (–∑–µ–ª—ë–Ω—ã–º) –∏–ª–∏ `-100` (–∫—Ä–∞—Å–Ω—ã–º),
    - –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏,
    - –î–µ—Ç–∞–ª–∏ –ø–æ –∫–ª–∏–∫—É:
        - —Å–≤—è–∑–∞–Ω–Ω—ã–π —á–µ–∫ (—Å—É–º–º–∞ —á–µ–∫–∞, —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∫–∞—Å—Å–∏—Ä ‚Äî –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ),
        - —Å–≤—è–∑–∞–Ω–Ω–æ–µ –ø—Ä–æ–º–æ (–µ—Å–ª–∏ –µ—Å—Ç—å),
        - —Ä—É—á–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: `reason` –∏ `created_by`.
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏–ª–∏ infinite scroll.

***

9Ô∏è‚É£ **–≠–∫—Ä–∞–Ω ¬´–ê–∫—Ü–∏–∏ / –ü—Ä–æ–º–æ¬ª**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –±—É–¥—É—â–∏–µ –ø—Ä–æ–º–æ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏**:
    - ¬´–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ–π—á–∞—Å¬ª,
    - ¬´–°–∫–æ—Ä–æ –Ω–∞—á–Ω—É—Ç—Å—è¬ª,
    - ¬´–ò—Å—Ç—ë–∫—à–∏–µ¬ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏).
- **–ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ–º–æ**:
    - –ù–∞–∑–≤–∞–Ω–∏–µ,
    - –û–ø–∏—Å–∞–Ω–∏–µ,
    - –£—Å–ª–æ–≤–∏—è (—Ç–µ–∫—Å—Ç –∏–ª–∏ —Å–ø–∏—Å–æ–∫):
        - –Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–ó–∞–∫–∞–∂–∏—Ç–µ –Ω–∞ 1000 ‚ÇΩ –∏ –ø–æ–ª—É—á–∏—Ç–µ +500 –±–∞–ª–ª–æ–≤¬ª.
    - –¢–∞–π–º–µ—Ä (–µ—Å–ª–∏ —Å—Ä–æ—á–Ω–æ–µ):
        - ¬´–û—Å—Ç–∞–ª–æ—Å—å 3 –¥–Ω—è 5 —á–∞—Å–æ–≤¬ª,
    - –°—Ç–∞—Ç—É—Å (–µ—Å–ª–∏ –≥–æ—Å—Ç—å —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª):
        - ¬´–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç–æ –ø—Ä–æ–º–æ 2 —Ä–∞–∑–∞ –∏–∑ 3¬ª.
- –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É ‚Üí –¥–µ—Ç–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω —Å:
    - –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º —É—Å–ª–æ–≤–∏–π,
    - —Å—Ä–æ–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏—è,
    - –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

***

üîü **–≠–∫—Ä–∞–Ω ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–∏–¥–µ—Ç—å –≤ —Å–≤–æ—ë–º –ø—Ä–æ—Ñ–∏–ª–µ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–ë–ª–æ–∫–∏**:

1. **–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**:
        - –ò–º—è, —Ñ–∞–º–∏–ª–∏—è, –æ—Ç—á–µ—Å—Ç–≤–æ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º: —Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞).
        - –¢–µ–ª–µ—Ñ–æ–Ω (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä; —Å–º–µ–Ω–∞ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º).
        - Email (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å).
        - –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º: —Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞).
        - –ü–æ–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
2. **–î–µ—Ç–∏** (–µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞):
        - –°–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π (–∏–º—è, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è).
        - –ö–Ω–æ–ø–∫–∏ ¬´–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—ë–Ω–∫–∞¬ª, ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª, ¬´–£–¥–∞–ª–∏—Ç—å¬ª.
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**:
        - Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö/—Å–ø–∏—Å–∞–Ω–∏—è—Ö (–≤–∫–ª/–≤—ã–∫–ª).
        - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–º–æ (–≤–∫–ª/–≤—ã–∫–ª).
        - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è (–≤–∫–ª/–≤—ã–∫–ª).
        - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤ (–≤–∫–ª/–≤—ã–∫–ª).
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
        - –ö–Ω–æ–ø–∫–∞ ¬´–û—Ç–≤—è–∑–∞—Ç—å Telegram¬ª (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º).
        - –ö–Ω–æ–ø–∫–∞ ¬´–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç¬ª (GDPR, –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º).
5. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**:
        - –ö–æ–Ω—Ç–∞–∫—Ç—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏,
        - FAQ / –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.

***

1Ô∏è‚É£1Ô∏è‚É£ **–ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã)**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å UX –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –º–µ–∂–¥—É –≥–æ—Å—Ç—è–º–∏?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–≠–∫—Ä–∞–Ω ¬´–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –±–∞–ª–ª—ã¬ª**:

1. –ü–æ–ª–µ –≤–≤–æ–¥–∞: ¬´–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è¬ª (—Å –º–∞—Å–∫–æ–π +7).
2. –ü–æ–ª–µ –≤–≤–æ–¥–∞: ¬´–°—É–º–º–∞ –±–∞–ª–ª–æ–≤¬ª (–≤–∞–ª–∏–¥–∞—Ü–∏—è: min 1, max –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞, max_per_operation).
3. –ö–Ω–æ–ø–∫–∞ ¬´–î–∞–ª–µ–µ¬ª.
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º:
        - –∏–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω),
        - —Å—É–º–º—É –∫ –ø–µ—Ä–µ–≤–æ–¥—É,
        - –∏—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞,
        - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: ¬´–ü–µ—Ä–µ–≤–æ–¥ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å¬ª.
5. –ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å¬ª ‚Üí —à–ª—ë–º –∑–∞–ø—Ä–æ—Å –Ω–∞ backend:
        - —Å–æ–∑–¥–∞—ë—Ç—Å—è `BallTransfer` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING`,
        - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è SMS/Telegram-–∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è.
6. –ì–æ—Å—Ç—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ (–≤ Mini App –∏–ª–∏ –≤ –±–æ—Ç–µ).
7. –ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–¥–µ:
        - —Å—Ç–∞—Ç—É—Å `VERIFIED` ‚Üí `COMPLETED`,
        - –±–∞–ª–ª—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø–æ–ª—É—á–∞—Ç–µ–ª—é,
        - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±–æ–∏–º.
- **–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤**:
    - –û—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª –∏–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
        - ¬´–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ +79991234567, 500 –±–∞–ª–ª–æ–≤, 01.02.2026¬ª,
        - ¬´–ü–æ–ª—É—á–µ–Ω–æ –æ—Ç +79997654321, 200 –±–∞–ª–ª–æ–≤, 28.01.2026¬ª.

***

## –ë–ª–æ–∫ 4. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1Ô∏è‚É£2Ô∏è‚É£ **–ö–æ–º–∞–Ω–¥–∞ `/card`**

**–í–æ–ø—Ä–æ—Å:**
–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `/card` (–±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ –±–µ–∑ Mini App)?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```
üìá –í–∞—à–∞ –∫–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

üèÜ –£—Ä–æ–≤–µ–Ω—å: Silver
üí∞ –ë–∞–ª–∞–Ω—Å: 2 500 –±–∞–ª–ª–æ–≤
üìä –î–æ Gold: –µ—â—ë 2 500 ‚ÇΩ

üî¢ –ö–æ–¥: 123456
```

- –ü—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–µ —Ñ–æ—Ç–æ: QR-–∫–æ–¥ –∫–∞—Ä—Ç—ã (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É).
- Inline-–∫–Ω–æ–ø–∫–∏:
    - ¬´üì± –û—Ç–∫—Ä—ã—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏¬ª ‚Üí Mini App,
    - ¬´üìú –ò—Å—Ç–æ—Ä–∏—è¬ª ‚Üí `/history`.

***

1Ô∏è‚É£3Ô∏è‚É£ **–ö–æ–º–∞–Ω–¥–∞ `/history`**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í—ã–≤–µ—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5‚Äì10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:

```
üìú –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

01.02.2026 15:30
‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ +200 –±–∞–ª–ª–æ–≤
–ß–µ–∫: 2000 ‚ÇΩ
–ë–∞–ª–∞–Ω—Å: 2500

31.01.2026 18:45
‚ùå –°–ø–∏—Å–∞–Ω–æ -100 –±–∞–ª–ª–æ–≤
–ß–µ–∫: 1500 ‚ÇΩ
–ë–∞–ª–∞–Ω—Å: 2300

...
```

- Inline-–∫–Ω–æ–ø–∫–∏:
    - ¬´üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é¬ª ‚Üí Mini App (—ç–∫—Ä–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏),
    - ¬´üîô –ù–∞–∑–∞–¥¬ª.

***

1Ô∏è‚É£4Ô∏è‚É£ **–ö–æ–º–∞–Ω–¥–∞ `/promo`**

**–í–æ–ø—Ä–æ—Å:**
–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ:

```
üéÅ –ê–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏:

1Ô∏è‚É£ –î–≤–æ–π–Ω–æ–π –∫–µ—à–±—ç–∫ –≤ –æ–±–µ–¥
üìÖ –î–æ 10.02.2026
üïê 11:00 ‚Äì 15:00
üí∞ –ö–µ—à–±—ç–∫ 10% –≤–º–µ—Å—Ç–æ 5%

2Ô∏è‚É£ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è ‚Äî 500 –±–∞–ª–ª–æ–≤ –≤ –ø–æ–¥–∞—Ä–æ–∫
üìÖ –í —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ –î–†

...
```

- Inline-–∫–Ω–æ–ø–∫–∏:
    - ¬´üì± –ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª ‚Üí Mini App (—ç–∫—Ä–∞–Ω –ø—Ä–æ–º–æ),
    - ¬´üîô –ù–∞–∑–∞–¥¬ª.

***

1Ô∏è‚É£5Ô∏è‚É£ **–ö–æ–º–∞–Ω–¥–∞ `/support`**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ü—Ä–∏ `/support`:
    - –¢–µ–∫—Å—Ç —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏:

```
üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:
üìß Email: support@restaurant.com
üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67
üïê –ü–Ω‚Äì–ü—Ç, 10:00‚Äì19:00

–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å, –∏ –º—ã –æ—Ç–≤–µ—Ç–∏–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.
```

    - Inline-–∫–Ω–æ–ø–∫–∏:
        - ¬´‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ü–µ–Ω—É (scene) –¥–ª—è —Å–±–æ—Ä–∞ –≤–æ–ø—Ä–æ—Å–∞,
        - ¬´üîô –ù–∞–∑–∞–¥¬ª.
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –≥–æ—Å—Ç—è:
    - –µ—Å–ª–∏ –≥–æ—Å—Ç—å –ø–∏—à–µ—Ç –≤–Ω–µ –∫–æ–º–∞–Ω–¥:
        - –±–æ—Ç –º–æ–∂–µ—Ç:
            - –ª–∏–±–æ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (—Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ Restaurant Admin),
            - –ª–∏–±–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –±–∞–∑—É (`SupportTicket`) —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∞.

***

## –ë–ª–æ–∫ 5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Push-–Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

1Ô∏è‚É£6Ô∏è‚É£ **–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≥–æ—Å—Ç—é?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤**:
    - –¢–µ–∫—Å—Ç: ¬´‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ +200 –±–∞–ª–ª–æ–≤ –∑–∞ –ø–æ–∫—É–ø–∫—É –Ω–∞ 2000 ‚ÇΩ. –ë–∞–ª–∞–Ω—Å: 2500¬ª.
    - Inline-–∫–Ω–æ–ø–∫–∞: ¬´–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏¬ª ‚Üí Mini App (–∏—Å—Ç–æ—Ä–∏—è).
- **–°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤**:
    - –¢–µ–∫—Å—Ç: ¬´‚úÖ –°–ø–∏—Å–∞–Ω–æ -100 –±–∞–ª–ª–æ–≤. –ë–∞–ª–∞–Ω—Å: 2400¬ª.
- **–°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è**:
    - –¢–µ–∫—Å—Ç: ¬´üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è Gold. –¢–µ–ø–µ—Ä—å –∫–µ—à–±—ç–∫ 15%¬ª.
    - Inline-–∫–Ω–æ–ø–∫–∞: ¬´–ú–æ—è –∫–∞—Ä—Ç–∞¬ª ‚Üí Mini App.
- **–ù–æ–≤—ã–µ –ø—Ä–æ–º–æ**:
    - –¢–µ–∫—Å—Ç: ¬´üéÅ –ù–æ–≤–∞—è –∞–∫—Ü–∏—è: –î–≤–æ–π–Ω–æ–π –∫–µ—à–±—ç–∫ –≤ –æ–±–µ–¥! –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 10.02¬ª.
    - Inline-–∫–Ω–æ–ø–∫–∞: ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª ‚Üí Mini App (–ø—Ä–æ–º–æ).
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–≥–æ—Ä–∞–Ω–∏–∏**:
    - –ó–∞ N –¥–Ω–µ–π –¥–æ —Å–≥–æ—Ä–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ 7 –∏ –∑–∞ 1 –¥–µ–Ω—å):
        - –¢–µ–∫—Å—Ç: ¬´‚ö†Ô∏è –í–∞—à–∏ 500 –±–∞–ª–ª–æ–≤ —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –°–æ–≤–µ—Ä—à–∏—Ç–µ –ø–æ–∫—É–ø–∫—É, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö!¬ª
    - –ü–æ—Å–ª–µ —Ñ–∞–∫—Ç–∞ —Å–≥–æ—Ä–∞–Ω–∏—è:
        - –¢–µ–∫—Å—Ç: ¬´üòû –°–≥–æ—Ä–µ–ª–æ 500 –±–∞–ª–ª–æ–≤ –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ —á–∞—â–µ!¬ª
- **–ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤**:
    - –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é: ¬´‚úÖ –í—ã –ø–µ—Ä–µ–≤–µ–ª–∏ 100 –±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é +79991234567. –ë–∞–ª–∞–Ω—Å: 2400¬ª.
    - –ü–æ–ª—É—á–∞—Ç–µ–ª—é: ¬´üéÅ –í–∞–º –ø–µ—Ä–µ–≤–µ–ª–∏ 100 –±–∞–ª–ª–æ–≤ –æ—Ç +79997654321. –ë–∞–ª–∞–Ω—Å: 1100¬ª.
- **–†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (–µ—Å–ª–∏ Admin/Manager –Ω–∞—á–∏—Å–ª–∏–ª/—Å–ø–∏—Å–∞–ª –≤—Ä—É—á–Ω—É—é):
    - –¢–µ–∫—Å—Ç: ¬´‚ÑπÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞—á–∏—Å–ª–∏–ª –≤–∞–º +1000 –±–∞–ª–ª–æ–≤. –ü—Ä–∏—á–∏–Ω–∞: –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞ –æ—à–∏–±–∫—É. –ë–∞–ª–∞–Ω—Å: 3500¬ª.

***

1Ô∏è‚É£7Ô∏è‚É£ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –¥–∞—Ç—å –≥–æ—Å—Ç—é –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í Mini App (—ç–∫—Ä–∞–Ω ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª ‚Üí ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π¬ª):
    - –ß–µ–∫–±–æ–∫—Å—ã:
        - ‚òëÔ∏è –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤,
        - ‚òëÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è,
        - ‚òëÔ∏è –ù–æ–≤—ã–µ –∞–∫—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ,
        - ‚òëÔ∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤,
        - ‚òëÔ∏è –ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å—ë –≤–∫–ª—é—á–µ–Ω–æ.
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `GuestProfile`:
    - `notify_transactions`, `notify_level_change`, `notify_promo`, `notify_expire`, `notify_transfers`.
- –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
    - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–ª–∞–≥, —à–ª—ë–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `true`.

***

## –ë–ª–æ–∫ 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ rate-limiting

1Ô∏è‚É£8Ô∏è‚É£ **–í–∞–ª–∏–¥–∞—Ü–∏—è `initData` –∏–∑ Mini App**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ Mini App?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- Telegram –ø–µ—Ä–µ–¥–∞—ë—Ç `initData` –≤ query-–ø–∞—Ä–∞–º–µ—Ç—Ä–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Mini App.
- `initData` —Å–æ–¥–µ—Ä–∂–∏—Ç:
    - `user`, `auth_date`, `hash` –∏ –¥—Ä.
- Backend:

1. –ü–∞—Ä—Å–∏—Ç `initData`.
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å `hash` –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É:
        - `data_check_string = sorted key=value pairs (–∫—Ä–æ–º–µ hash)`,
        - `secret_key = HMAC-SHA256(bot_token, "WebAppData")`,
        - `hash_calculated = HMAC-SHA256(data_check_string, secret_key)`,
        - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º `hash`.
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `auth_date` (–Ω–µ —Å—Ç–∞—Ä—à–µ N –º–∏–Ω—É—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä 60).
4. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–Ω–æ:
        - —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏—é –¥–ª—è —ç—Ç–æ–≥–æ `telegram_id`,
        - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT –∏–ª–∏ session-—Ç–æ–∫–µ–Ω –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ API-–∑–∞–ø—Ä–æ—Å—ã –∏–∑ Mini App:
    - –∏–¥—É—Ç —Å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`.

***

1Ô∏è‚É£9Ô∏è‚É£ **Rate-limiting –¥–ª—è –±–æ—Ç–∞**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç —Å–ø–∞–º–∞/—Ñ–ª—É–¥–∞ –≤ Telegram-–±–æ—Ç–µ?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –ù–∞ —É—Ä–æ–≤–Ω–µ middleware –≤ –±–æ—Ç–µ:
    - –ü–æ `telegram_id`:
        - max N –∫–æ–º–∞–Ω–¥ –≤ –º–∏–Ω—É—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10),
        - max M SMS-–∫–æ–¥–æ–≤ –≤ —á–∞—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3).
    - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ:
        - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ¬ª,
        - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ X –º–∏–Ω—É—Ç.
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤:
    - Redis (key = `telegram_ratelimit:<telegram_id>`, TTL = 1 –º–∏–Ω—É—Ç–∞).

***

2Ô∏è‚É£0Ô∏è‚É£ **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–∏—à–∏–Ω–≥–∞ –∏ –ø–æ–¥–¥–µ–ª–∫–∏ QR/6-digit**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ–±–µ–∑–æ–ø–∞—Å–∏—Ç—å –≥–æ—Å—Ç—è –æ—Ç –∫—Ä–∞–∂–∏ –∫–æ–¥–∞ –∫–∞—Ä—Ç—ã?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **QR-–∫–æ–¥ –∏ 6-digit —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è**:
    - –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (earn/redeem) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –∫–æ–¥—ã.
    - –°—Ç–∞—Ä—ã–µ –∫–æ–¥—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏.
    - –≠—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `BallTransactionService.regenerateCodes`.
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞**:
    - –ü—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ QR/–≤–≤–æ–¥–µ 6-digit –Ω–∞ –∫–∞—Å—Å–µ:
        - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–¥ –µ—â—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏,
        - –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ‚Äî —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º.
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–ø—ã—Ç–∫–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
    - –ü—Ä–∏ –∫–∞–∂–¥–æ–º earn/redeem:
        - —à–ª—ë–º push –≤ Telegram: ¬´–ù–∞—á–∏—Å–ª–µ–Ω–æ/—Å–ø–∏—Å–∞–Ω–æ N –±–∞–ª–ª–æ–≤¬ª.
    - –ï—Å–ª–∏ –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç –Ω–µ–∑–Ω–∞–∫–æ–º—É—é –æ–ø–µ—Ä–∞—Ü–∏—é:
        - –º–æ–∂–µ—Ç —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —á–µ—Ä–µ–∑ `/support`.

***

## –ë–ª–æ–∫ 7. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

2Ô∏è‚É£1Ô∏è‚É£ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤**

**–í–æ–ø—Ä–æ—Å:**
–ù—É–∂–Ω–∞ –ª–∏ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –≤ –±–æ—Ç–µ –∏ Mini App?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (—Å —É—á—ë—Ç–æ–º MVP –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–æ—Å—Ç–∞):**

- **–ù–∞ —Å—Ç–∞—Ä—Ç–µ ‚Äî —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π**.
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –ø—Ä–∏—Ü–µ–ª–æ–º –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:
    - –í –±–æ—Ç–µ:
        - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É i18n (–Ω–∞–ø—Ä–∏–º–µ—Ä, `i18next` –∏–ª–∏ `telegraf-i18n`).
    - –í Mini App:
        - `react-i18next`.
    - –Ø–∑—ã–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è:
        - –∏–∑ `User.language_code` (–º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ Telegram API),
        - –∏–ª–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ—Ñ–∏–ª—è –≥–æ—Å—Ç—è.
- –í –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–∏—Ç—å:
    - –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∫–∞–∑–∞—Ö—Å–∫–∏–π, —Ç—É—Ä–µ—Ü–∫–∏–π –∏ –¥—Ä.

***

2Ô∏è‚É£2Ô∏è‚É£ **–ë—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω/—Å–µ—Ç—å**

**–í–æ–ø—Ä–æ—Å:**
–ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω/—Å–µ—Ç—å –∏–º–µ–ª ¬´—Å–≤–æ–π¬ª –±–æ—Ç —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º?

**–ú–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –í–∞—Ä–∏–∞–Ω—Ç—ã:

**A. –û–¥–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**:
    - –ù–∞–∑–≤–∞–Ω–∏–µ: `@max_loyalty_bot`.
    - –ü—Ä–∏ `/start`:
        - –≥–æ—Å—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω/—Å–µ—Ç—å (–≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ —Å `?start=restaurant_id`).
    - –í Mini App:
        - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–æ—Ç–∏–ø, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–≤–µ—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏).

**B. –û—Ç–¥–µ–ª—å–Ω—ã–µ –±–æ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏** (–±–æ–ª–µ–µ –ø—Ä–µ–º–∏—É–º):
    - –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞:
        - Owner —Å–æ–∑–¥–∞—ë—Ç –±–æ—Ç–∞ —á–µ—Ä–µ–∑ BotFather (–∏–ª–∏ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —ç—Ç–æ –∫–∞–∫ –æ–ø—Ü–∏—é –∑–∞ –¥–æ–ø. –ø–ª–∞—Ç—É).
    - –ù–∞—à backend:
        - —Ö—Ä–∞–Ω–∏—Ç `bot_token` –≤ `TelegramBot` (—Å–≤—è–∑—å —Å `tenant_id`).
    - –ö–∞–∂–¥—ã–π –±–æ—Ç:
        - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ –∫–æ–¥–æ–≤—É—é –±–∞–∑—É, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç —Å–≤–æ–µ–≥–æ —Ç–æ–∫–µ–Ω–∞.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è MVP**: –≤–∞—Ä–∏–∞–Ω—Ç A (–æ–¥–∏–Ω –±–æ—Ç).
- **–î–ª—è Premium/Enterprise**: –≤–∞—Ä–∏–∞–Ω—Ç B.

***

–ï—Å–ª–∏ —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏–π —Ç–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –¥–∞–ª—å—à–µ –º–æ–∂–Ω–æ:

- –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ –ø—É–Ω–∫—Ç–∞–º (–∫–∞–∫ —Ä–∞–Ω—å—à–µ: ¬´–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ¬ª / —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å),
- –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, **Frontend-–∞–¥–º–∏–Ω–∫–∞** (Owner/Restaurant Admin/Manager UI) –∏–ª–∏ **Analytics \& Reporting**.

---

# –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã :

    1. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    2.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. Backend: NestJS + –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ telegraf (–∏–ª–∏ node-telegram-bot-api / grammy) - –≤—ã–±–µ—Ä–∏ –∏–∑ —ç—Ç–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å–∞–º, –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—â–∏–π. A –≤ —ç—Ç–æ–º –ø—É–Ω–∫—Ç–µ(Telegram-—Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∫–Ω–æ–ø–∫–∏, –∫–∞—Ä—Ç–æ—á–∫–∏, —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram) -–î–µ—Ñ–æ–ª—Ç–Ω–æ, —Ç–∞–∫, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å —á—Ç–æ admin –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–∏–∑–∞–π–Ω –ø–æ —Å–≤–æ–µ–º—É —Ç–æ–∂–µ. 
    3.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    4.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    5.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. 
    6.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
    7.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ù–æ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –≤—ã—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è –∞–≤–∞—Ç–∞—Ä –≥–æ—Å—Ç—è. –í –ø–æ–ª–µ "–∏–º—è" —Ç–æ–ª—å–∫–æ –ò–º—è, –±–µ–∑ "–ø—Ä–∏–≤–µ—Ç". –ü–æ–¥ qr –∏ 6 –∑–Ω–∞—á–Ω—ã–º –∫–æ–¥–æ–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–Ω–æ–ø–∫–∞ "–æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥" - –≤—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ–±–∞ –∫–æ–¥–∞ (–¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∞ –∏—Ö —Å–∞–º–∞ –ø–æ –æ—à–∏–±–∫–µ). 
    8.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ù–æ: –§–∏–ª—å—Ç—Ä "—Ä—É—á–Ω—ã–µ" —É–±—Ä–∞—Ç—å.
    –í –º–µ—Å—Ç–µ : +500 (–∑–µ–ª—ë–Ω—ã–º) –∏–ª–∏ -100 (–∫—Ä–∞—Å–Ω—ã–º) - –∫—Ä–∞—Å–Ω—ã–π –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª–æ —Å–µ—Ä—ã–π.
–°–≤—è–∑–∞–Ω–Ω—ã–π —á–µ–∫ (—Å—É–º–º–∞ —á–µ–∫–∞, —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∑–∞–∫–∞–∑–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞, –∫–∞—Å—Å–∏—Ä ‚Äî –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ).
–î–µ—Ç–∞–ª–∏ reason –∏ created_by –≥–æ—Å—Ç—å –Ω–µ –≤–∏–¥–∏—Ç.
9. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
10.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
11.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
12.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
13.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
14.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
15.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –±–∞–∑—É (SupportTicket) —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∞.
16.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ù–æ, –ø–æ—Å–ª–µ —Ñ–∞–∫—Ç–∞ —Å–≥–æ—Ä–∞–Ω–∏—è –≥–æ—Å—Ç—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è. –ó–∞ —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è.
17.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
18.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
19.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
20.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
21.–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
22.–ó–¥–µ—Å—å —Å–¥–µ–ª–∞–µ–º —Ç–∞–∫: –ï—Å—Ç—å –æ–¥–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –ø–æ–ø–∞–¥–∞—è –≤ –∫–æ—Ç–æ—Ä—ã–π –≥–æ—Å—Ç—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏, –¥–∞–µ—Ç –¥–æ–±—Ä–æ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Ä–µ–∫–ª–∞–º—ã –∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö (–≠—Ç–æ –≤—Å–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏), –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –∏ –¥–∞–ª—å—à–µ, –∫–∞–∫ —Ç—ã –æ–ø–∏—Å–∞–ª. –ù–æ –µ—Å—Ç—å –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–æ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏ –¥–ª—è –ª—é–±–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞.

–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞:

    –ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å–≤–æ–µ–π –ø–∞–Ω–µ–ª–∏ Admin —Å–æ–∑–¥–∞—ë—Ç –±–æ—Ç–∞ —á–µ—Ä–µ–∑ BotFather –≤ –∞–∫–∫–∞—É–Ω—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º (–∏–ª–∏ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —ç—Ç–æ –∫–∞–∫ –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ owner). 
    –ù–∞—à backend:

—Ö—Ä–∞–Ω–∏—Ç bot_token –≤ TelegramBot (—Å–≤—è–∑—å —Å tenant_id).

–ö–∞–∂–¥—ã–π –±–æ—Ç:

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ –∫–æ–¥–æ–≤—É—é –±–∞–∑—É, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç —Å–≤–æ–µ–≥–æ —Ç–æ–∫–µ–Ω–∞.

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≥–æ—Å—Ç—å –ø–æ–ø–∞–¥–∞–µ—Ç —É–∂–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≥–¥–µ —É–∂–µ –≤—Å–µ —Ç–∞–∫, –∫–∞–∫ –º—ã —Å —Ç–æ–±–æ–π –æ–ø–∏—Å–∞–ª–∏.

–£—á–∏—Ç—ã–≤–∞—è –æ—Ç–≤–µ—Ç—ã, –≤—ã–≤–µ–¥–∏ —Å—é–¥–∞ –≤ —á–∞—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ—Å–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞.

–ù–∏–∂–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω **Telegram Bot + Mini App** —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö —Ç–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤.

***

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### 1.1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ: Bot vs Mini App

- **Telegram Bot** (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å):
    - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `/start`.
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí SMS-–∫–æ–¥ ‚Üí –ø—Ä–∏–≤—è–∑–∫–∞ `telegram_id`.
    - –ö–æ–º–∞–Ω–¥—ã –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:
        - `/card` ‚Äî –±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, QR/6-digit (—Ç–µ–∫—Å—Ç–æ–º + –∫–∞—Ä—Ç–∏–Ω–∫–∞).
        - `/history` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
        - `/promo` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ.
        - `/support` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞.
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è-–ø—É—à–∏:
        - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ **–Ω–µ —É–≤–µ–¥–æ–º–ª—è—é—Ç—Å—è**),
        - —Å–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è,
        - –Ω–æ–≤—ã–µ –ø—Ä–æ–º–æ,
        - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ (—Ñ–∞–∫—Ç —Å–≥–æ—Ä–∞–Ω–∏—è **–Ω–µ —É–≤–µ–¥–æ–º–ª—è–µ—Ç—Å—è**).
- **Mini App** (web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å):
    - –ë–æ–≥–∞—Ç—ã–π UI:
        - –¥–∞—à–±–æ—Ä–¥ —Å –∫–∞—Ä—Ç–æ–π (–±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, –ø—Ä–æ–≥—Ä–µ—Å—Å, QR/6-digit, –∞–≤–∞—Ç–∞—Ä –≥–æ—Å—Ç—è),
        - –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ñ–∏–ª—å—Ç—Ä—ã, –¥–µ—Ç–∞–ª–∏),
        - –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏,
        - –ø—Ä–æ—Ñ–∏–ª—å (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, email, –¥–µ—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π),
        - –ø–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã),
        - –≤—ã—Ö–æ–¥/–æ—Ç–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞.
    - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π –≤ –º–µ–Ω—é –±–æ—Ç–∞ –∏–ª–∏ inline-–∫–Ω–æ–ø–∫–æ–π –ø—Ä–∏ `/start`.

***

### 1.2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Telegram Bot**:
    - Backend: **NestJS + `telegraf`**.
        - **–ü–æ—á–µ–º—É `telegraf`**: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è, –∞–∫—Ç–∏–≤–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å –æ—Ç–ª–∏—á–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π TypeScript, middleware, —Å—Ü–µ–Ω (scenes), inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä –∏ webhook'–æ–≤. –ë–æ–ª–µ–µ –∑—Ä–µ–ª–∞—è –∏ —É–¥–æ–±–Ω–∞—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, —á–µ–º `node-telegram-bot-api`. `grammy` ‚Äî —Ö–æ—Ä–æ—à–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, –Ω–æ `telegraf` ‚Äî –∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è NestJS-—ç–∫–æ—Å–∏—Å—Ç–µ–º—ã.
    - –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
        - `apps/telegram-bot/src/`:
            - `bot/` ‚Äî –∫–æ–º–∞–Ω–¥—ã, —Å—Ü–µ–Ω—ã, handlers.
            - `services/` ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å backend API.
            - `keyboards/` ‚Äî inline/reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
            - `middleware/` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, rate-limiting.
            - `main.ts` ‚Äî –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞.
- **Mini App**:
    - Frontend: **React + Vite** (`apps/telegram-miniapp/`).
    - Telegram Web App SDK:
        - `@twa-dev/sdk`.
    - UI:
        - **–î–µ—Ñ–æ–ª—Ç–Ω–æ**: Telegram-—Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∫–Ω–æ–ø–∫–∏, –∫–∞—Ä—Ç–æ—á–∫–∏, —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram).
        - **–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è**: Admin –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–∏–∑–∞–π–Ω (—Ü–≤–µ—Ç–∞, –ª–æ–≥–æ—Ç–∏–ø—ã, —à—Ä–∏—Ñ—Ç—ã) –≤ —Å–≤–æ–µ–π –ø–∞–Ω–µ–ª–∏ ‚Üí —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ API –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ Mini App (CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ç–µ–º—ã).
- Shared:
    - `packages/shared/` ‚Äî –æ–±—â–∏–µ types, utils.

***

### 1.3. –•–æ—Å—Ç–∏–Ω–≥ –∏ deployment

- **Bot**:
    - Long polling (dev/stage).
    - Webhook (production):
        - `POST /api/telegram/webhook/:bot_token` (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π endpoint –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±–æ—Ç–æ–≤).
    - –î–µ–ø–ª–æ–π: Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –æ—Å–Ω–æ–≤–Ω—ã–º backend.
- **Mini App**:
    - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π build (HTML/CSS/JS):
        - CDN (Cloudflare Pages, Vercel, S3 + CloudFront).
    - URL: `https://miniapp.max-loyalty.com` –∏–ª–∏ `https://max-loyalty.com/miniapp`.
    - –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏:
        - –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `initData` ‚Üí backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç.

***

## 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### 2.1. –ü–æ—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è

1. –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –±–æ—Ç–∞.
2. –ù–∞–∂–∏–º–∞–µ—Ç `/start`.
3. –ë–æ—Ç:
    - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ,
    - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (inline-–∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º¬ª –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥).
4. –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
    - –±–æ—Ç —à–ª—ë—Ç SMS —Å 6-–∑–Ω–∞—á–Ω—ã–º –∫–æ–¥–æ–º.
5. –ì–æ—Å—Ç—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥.
6. Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç:
    - –µ—Å–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω:
        - —Å–æ–∑–¥–∞—ë—Ç/–Ω–∞—Ö–æ–¥–∏—Ç `User` –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É,
        - —Å–≤—è–∑—ã–≤–∞–µ—Ç `telegram_id`,
        - –µ—Å–ª–∏ –Ω–æ–≤—ã–π ‚Üí —Å–æ–∑–¥–∞—ë—Ç `GuestProfile`, `GuestCard` (`RegistrationSource.TELEGRAM`).
7. –ë–æ—Ç:
    - ¬´–í–∞—à–∞ –∫–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞.¬ª
    - inline-–∫–Ω–æ–ø–∫–∏:
        - ¬´üìá –ú–æ—è –∫–∞—Ä—Ç–∞¬ª ‚Üí Mini App,
        - ¬´üìä –ò—Å—Ç–æ—Ä–∏—è¬ª ‚Üí `/history`,
        - ¬´üéÅ –ê–∫—Ü–∏–∏¬ª ‚Üí `/promo`.

***

### 2.2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –≥–æ—Å—Ç—è

- –ü—Ä–∏ `/start`:

1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ `User` —Å —ç—Ç–∏–º `telegram_id`.
2. –ï—Å–ª–∏ –Ω–µ—Ç:
        - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω,
        - –∏—â–µ–º `User` —Å —Ç–∞–∫–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º,
        - –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Üí —à–ª—ë–º SMS-–∫–æ–¥ ‚Üí –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º `telegram_id`.
        - –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è.
3. –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.

***

### 2.3. –û—Ç–≤—è–∑–∫–∞ Telegram

- –í Mini App (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏) –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞ `/unlink`:
    - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: ¬´–í—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ Telegram¬ª,
    - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ,
    - –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏:
        - `User.telegram_id = null`,
        - `User.telegram_username = null`,
        - —É–¥–∞–ª—è–µ—Ç—Å—è `TelegramSession`,
        - ActivityLog: `UNLINK_TELEGRAM`.

***

## 3. Mini App: UI –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 3.1. –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (Dashboard)

**–í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å (Hero-–±–ª–æ–∫)**:

- **–ê–≤–∞—Ç–∞—Ä –≥–æ—Å—Ç—è** (—Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è Telegram –∏–ª–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä).
- **–ò–º—è –≥–æ—Å—Ç—è**: ¬´–ò–≤–∞–Ω¬ª (–±–µ–∑ ¬´–ü—Ä–∏–≤–µ—Ç¬ª).
- **–ö–∞—Ä—Ç–æ—á–∫–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**:
    - –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏,
    - –ë–∞–ª–∞–Ω—Å: `total_balance` (–∫—Ä—É–ø–Ω—ã–µ —Ü–∏—Ñ—Ä—ã),
    - –£—Ä–æ–≤–µ–Ω—å: ¬´Silver¬ª + –∏–∫–æ–Ω–∫–∞,
    - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è (–µ—Å–ª–∏ –Ω–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π):
        - `lifetime_spent / next_level_threshold`,
    - QR-–∫–æ–¥ (–º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –ø–æ –∫–ª–∏–∫—É),
    - 6-digit –∫–æ–¥ (–∫—Ä—É–ø–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º),
    - **–ö–Ω–æ–ø–∫–∞ ¬´–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥¬ª**:
        - –ø—Ä–∏ –∫–ª–∏–∫–µ:
            - –≤—ã–∑—ã–≤–∞–µ—Ç API `POST /api/guest-cards/:id/regenerate-codes`,
            - –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ–±–∞ –∫–æ–¥–∞ (QR + 6-digit) –≤—Ä—É—á–Ω—É—é,
            - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–¥—ã –Ω–∞ UI.

**–°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç—å**:

- –ë–ª–æ–∫ ¬´–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏¬ª (3‚Äì5 –∑–∞–ø–∏—Å–µ–π):
    - –¥–∞—Ç–∞, —Ç–∏–ø, —Å—É–º–º–∞, –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ,
    - –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—ë¬ª ‚Üí —ç–∫—Ä–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏.
- –ë–ª–æ–∫ ¬´–ê–∫—Ü–∏–∏¬ª (–µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ):
    - 1‚Äì2 –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–º–æ —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª.

**–ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å (–Ω–∞–≤–∏–≥–∞—Ü–∏—è)**:

- –ö–Ω–æ–ø–∫–∏:
    - ¬´üí≥ –ú–æ—è –∫–∞—Ä—Ç–∞¬ª (—Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω),
    - ¬´üìú –ò—Å—Ç–æ—Ä–∏—è¬ª,
    - ¬´üéÅ –ê–∫—Ü–∏–∏¬ª,
    - ¬´üë§ –ü—Ä–æ—Ñ–∏–ª—å¬ª,
    - ¬´üí∏ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –±–∞–ª–ª—ã¬ª (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ).

***

### 3.2. –≠–∫—Ä–∞–Ω ¬´–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π¬ª

**–§–∏–ª—å—Ç—Ä—ã**:

- –ü–æ —Ç–∏–ø—É:
    - –í—Å–µ / –ù–∞—á–∏—Å–ª–µ–Ω–∏—è / –°–ø–∏—Å–∞–Ω–∏—è / –ü—Ä–æ–º–æ / –°–≥–æ—Ä–∞–Ω–∏–µ (**—Ñ–∏–ª—å—Ç—Ä ¬´–†—É—á–Ω—ã–µ¬ª —É–±—Ä–∞–Ω**).
- –ü–æ –ø–µ—Ä–∏–æ–¥—É:
    - –ó–∞ –º–µ—Å—è—Ü / –ó–∞ –≥–æ–¥ / –í—Å—ë –≤—Ä–µ–º—è / –ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω.

**–°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (–∫–∞—Ä—Ç–æ—á–∫–∏):

- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è,
- –¢–∏–ø (–∏–∫–æ–Ω–∫–∞ + –Ω–∞–∑–≤–∞–Ω–∏–µ: ¬´–ö–µ—à–±—ç–∫¬ª, ¬´–°–ø–∏—Å–∞–Ω–∏–µ¬ª, ¬´–ü–æ–¥–∞—Ä–æ–∫ –∫–æ –¥–Ω—é —Ä–æ–∂–¥–µ–Ω–∏—è¬ª),
- –°—É–º–º–∞:
    - `+500` (–∑–µ–ª—ë–Ω—ã–º) –∏–ª–∏ `-100` (**—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–º**, –Ω–µ –∫—Ä–∞—Å–Ω—ã–º),
- –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏,
- **–î–µ—Ç–∞–ª–∏ –ø–æ –∫–ª–∏–∫—É**:
    - –°–≤—è–∑–∞–Ω–Ω—ã–π —á–µ–∫:
        - —Å—É–º–º–∞ —á–µ–∫–∞,
        - —Ä–µ—Å—Ç–æ—Ä–∞–Ω,
        - **–∑–∞–∫–∞–∑–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞** (–∏–∑ `POSTransaction.items`),
        - –∫–∞—Å—Å–∏—Ä (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ).
    - –°–≤—è–∑–∞–Ω–Ω–æ–µ –ø—Ä–æ–º–æ (–µ—Å–ª–∏ –µ—Å—Ç—å).
    - **–†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: `reason` –∏ `created_by` **–≥–æ—Å—Ç—å –ù–ï –≤–∏–¥–∏—Ç** (—ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤/–∞—É–¥–∏—Ç–∞).

–ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏–ª–∏ infinite scroll.

***

### 3.3. –≠–∫—Ä–∞–Ω ¬´–ê–∫—Ü–∏–∏ / –ü—Ä–æ–º–æ¬ª

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏**:

- ¬´–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ–π—á–∞—Å¬ª,
- ¬´–°–∫–æ—Ä–æ –Ω–∞—á–Ω—É—Ç—Å—è¬ª,
- ¬´–ò—Å—Ç—ë–∫—à–∏–µ¬ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

**–ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ–º–æ**:

- –ù–∞–∑–≤–∞–Ω–∏–µ,
- –û–ø–∏—Å–∞–Ω–∏–µ,
- –£—Å–ª–æ–≤–∏—è,
- –¢–∞–π–º–µ—Ä (–µ—Å–ª–∏ —Å—Ä–æ—á–Ω–æ–µ): ¬´–û—Å—Ç–∞–ª–æ—Å—å 3 –¥–Ω—è 5 —á–∞—Å–æ–≤¬ª,
- –°—Ç–∞—Ç—É—Å (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª): ¬´–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ 2 —Ä–∞–∑–∞ –∏–∑ 3¬ª.

–ö–ª–∏–∫ ‚Üí –¥–µ—Ç–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω —Å –ø–æ–ª–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏, —Å—Ä–æ–∫–∞–º–∏, –ª–∏–º–∏—Ç–∞–º–∏.

***

### 3.4. –≠–∫—Ä–∞–Ω ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª

**–ë–ª–æ–∫–∏**:

1. **–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**:
    - –ò–º—è, —Ñ–∞–º–∏–ª–∏—è, –æ—Ç—á–µ—Å—Ç–≤–æ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞).
    - –¢–µ–ª–µ—Ñ–æ–Ω (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä; —Å–º–µ–Ω–∞ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å).
    - Email (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å).
    - –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (—Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞).
    - –ü–æ–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
2. **–î–µ—Ç–∏** (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ):
    - –°–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π (–∏–º—è, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è).
    - ¬´–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—ë–Ω–∫–∞¬ª, ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª, ¬´–£–¥–∞–ª–∏—Ç—å¬ª.
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**:
    - Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö/—Å–ø–∏—Å–∞–Ω–∏—è—Ö (–≤–∫–ª/–≤—ã–∫–ª).
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–º–æ (–≤–∫–ª/–≤—ã–∫–ª).
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è (–≤–∫–ª/–≤—ã–∫–ª).
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤ (–≤–∫–ª/–≤—ã–∫–ª).
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
    - ¬´–û—Ç–≤—è–∑–∞—Ç—å Telegram¬ª (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º).
    - ¬´–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç¬ª (GDPR, –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º).
5. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**:
    - –ö–æ–Ω—Ç–∞–∫—Ç—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏,
    - FAQ / –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.

***

### 3.5. –ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤

**–≠–∫—Ä–∞–Ω ¬´–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –±–∞–ª–ª—ã¬ª**:

1. –ü–æ–ª–µ: ¬´–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è¬ª (–º–∞—Å–∫–∞ +7).
2. –ü–æ–ª–µ: ¬´–°—É–º–º–∞ –±–∞–ª–ª–æ–≤¬ª (–≤–∞–ª–∏–¥–∞—Ü–∏—è: min 1, max –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ, max_per_operation).
3. –ö–Ω–æ–ø–∫–∞ ¬´–î–∞–ª–µ–µ¬ª.
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º:
    - –∏–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω),
    - —Å—É–º–º—É –∫ –ø–µ—Ä–µ–≤–æ–¥—É,
    - –∏—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ,
    - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: ¬´–ü–µ—Ä–µ–≤–æ–¥ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å¬ª.
5. –ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å¬ª ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è `BallTransfer` (`PENDING`) ‚Üí SMS/Telegram-–∫–æ–¥.
6. –ì–æ—Å—Ç—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥.
7. –ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–¥–µ:
    - `VERIFIED` ‚Üí `COMPLETED`,
    - —Å–ø–∏—Å–∞–Ω–∏–µ/–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤,
    - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±–æ–∏–º.

**–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤**:

- –û—Ç–¥–µ–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏:
    - ¬´–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ +79991234567, 500 –±–∞–ª–ª–æ–≤, 01.02.2026¬ª,
    - ¬´–ü–æ–ª—É—á–µ–Ω–æ –æ—Ç +79997654321, 200 –±–∞–ª–ª–æ–≤, 28.01.2026¬ª.

***

## 4. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

### 4.1. –ö–æ–º–∞–Ω–¥–∞ `/card`

–¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
üìá –í–∞—à–∞ –∫–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

üèÜ –£—Ä–æ–≤–µ–Ω—å: Silver
üí∞ –ë–∞–ª–∞–Ω—Å: 2 500 –±–∞–ª–ª–æ–≤
üìä –î–æ Gold: –µ—â—ë 2 500 ‚ÇΩ

üî¢ –ö–æ–¥: 123456
```

–ü—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–µ —Ñ–æ—Ç–æ: QR-–∫–æ–¥ –∫–∞—Ä—Ç—ã.

Inline-–∫–Ω–æ–ø–∫–∏:

- ¬´üì± –û—Ç–∫—Ä—ã—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏¬ª ‚Üí Mini App,
- ¬´üìú –ò—Å—Ç–æ—Ä–∏—è¬ª ‚Üí `/history`.

***

### 4.2. –ö–æ–º–∞–Ω–¥–∞ `/history`

–ü–æ—Å–ª–µ–¥–Ω–∏–µ 5‚Äì10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:

```
üìú –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

01.02.2026 15:30
‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ +200 –±–∞–ª–ª–æ–≤
–ß–µ–∫: 2000 ‚ÇΩ
–ë–∞–ª–∞–Ω—Å: 2500

31.01.2026 18:45
‚ùå –°–ø–∏—Å–∞–Ω–æ -100 –±–∞–ª–ª–æ–≤
–ß–µ–∫: 1500 ‚ÇΩ
–ë–∞–ª–∞–Ω—Å: 2300

...
```

Inline-–∫–Ω–æ–ø–∫–∏:

- ¬´üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é¬ª ‚Üí Mini App,
- ¬´üîô –ù–∞–∑–∞–¥¬ª.

***

### 4.3. –ö–æ–º–∞–Ω–¥–∞ `/promo`

–°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ:

```
üéÅ –ê–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏:

1Ô∏è‚É£ –î–≤–æ–π–Ω–æ–π –∫–µ—à–±—ç–∫ –≤ –æ–±–µ–¥
üìÖ –î–æ 10.02.2026
üïê 11:00 ‚Äì 15:00
üí∞ –ö–µ—à–±—ç–∫ 10% –≤–º–µ—Å—Ç–æ 5%

2Ô∏è‚É£ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è ‚Äî 500 –±–∞–ª–ª–æ–≤ –≤ –ø–æ–¥–∞—Ä–æ–∫
üìÖ –í —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ –î–†

...
```

Inline-–∫–Ω–æ–ø–∫–∏:

- ¬´üì± –ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª ‚Üí Mini App,
- ¬´üîô –ù–∞–∑–∞–¥¬ª.

***

### 4.4. –ö–æ–º–∞–Ω–¥–∞ `/support`

–¢–µ–∫—Å—Ç —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏:

```
üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:
üìß Email: support@restaurant.com
üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67
üïê –ü–Ω‚Äì–ü—Ç, 10:00‚Äì19:00

–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å.
```

Inline-–∫–Ω–æ–ø–∫–∏:

- ¬´‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ü–µ–Ω—É —Å–±–æ—Ä–∞ –≤–æ–ø—Ä–æ—Å–∞.
- ¬´üîô –ù–∞–∑–∞–¥¬ª.

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –≥–æ—Å—Ç—è**:

- –ï—Å–ª–∏ –≥–æ—Å—Ç—å –ø–∏—à–µ—Ç –≤–Ω–µ –∫–æ–º–∞–Ω–¥:
    - **—Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É** (`SupportTicket`) —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º Restaurant Admin'–∞.

***

## 5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Push)

### 5.1. –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- **–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤** (–Ω–µ —Ä—É—á–Ω—ã–µ):
    - ¬´‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ +200 –±–∞–ª–ª–æ–≤ –∑–∞ –ø–æ–∫—É–ø–∫—É –Ω–∞ 2000 ‚ÇΩ. –ë–∞–ª–∞–Ω—Å: 2500¬ª.
    - Inline-–∫–Ω–æ–ø–∫–∞: ¬´–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏¬ª ‚Üí Mini App.
- **–°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤** (–Ω–µ —Ä—É—á–Ω—ã–µ):
    - ¬´‚úÖ –°–ø–∏—Å–∞–Ω–æ -100 –±–∞–ª–ª–æ–≤. –ë–∞–ª–∞–Ω—Å: 2400¬ª.
- **–°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è**:
    - ¬´üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è Gold. –¢–µ–ø–µ—Ä—å –∫–µ—à–±—ç–∫ 15%¬ª.
    - Inline-–∫–Ω–æ–ø–∫–∞: ¬´–ú–æ—è –∫–∞—Ä—Ç–∞¬ª ‚Üí Mini App.
- **–ù–æ–≤—ã–µ –ø—Ä–æ–º–æ**:
    - ¬´üéÅ –ù–æ–≤–∞—è –∞–∫—Ü–∏—è: –î–≤–æ–π–Ω–æ–π –∫–µ—à–±—ç–∫ –≤ –æ–±–µ–¥! –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 10.02¬ª.
    - Inline-–∫–Ω–æ–ø–∫–∞: ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª ‚Üí Mini App.
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–≥–æ—Ä–∞–Ω–∏–∏**:
    - –ó–∞ 7 –∏ –∑–∞ 1 –¥–µ–Ω—å –¥–æ —Å–≥–æ—Ä–∞–Ω–∏—è:
        - ¬´‚ö†Ô∏è –í–∞—à–∏ 500 –±–∞–ª–ª–æ–≤ —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –°–æ–≤–µ—Ä—à–∏—Ç–µ –ø–æ–∫—É–ø–∫—É!¬ª
    - **–ü–æ—Å–ª–µ —Ñ–∞–∫—Ç–∞ —Å–≥–æ—Ä–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**.
- **–ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤**:
    - –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é: ¬´‚úÖ –í—ã –ø–µ—Ä–µ–≤–µ–ª–∏ 100 –±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é +79991234567. –ë–∞–ª–∞–Ω—Å: 2400¬ª.
    - –ü–æ–ª—É—á–∞—Ç–µ–ª—é: ¬´üéÅ –í–∞–º –ø–µ—Ä–µ–≤–µ–ª–∏ 100 –±–∞–ª–ª–æ–≤ –æ—Ç +79997654321. –ë–∞–ª–∞–Ω—Å: 1100¬ª.
- **–†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
    - **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**.

***

### 5.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–í Mini App (–ü—Ä–æ—Ñ–∏–ª—å ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π):

- –ß–µ–∫–±–æ–∫—Å—ã:
    - ‚òëÔ∏è –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤,
    - ‚òëÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è,
    - ‚òëÔ∏è –ù–æ–≤—ã–µ –∞–∫—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ,
    - ‚òëÔ∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤,
    - ‚òëÔ∏è –ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–ª–æ–≤.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å—ë –≤–∫–ª—é—á–µ–Ω–æ.

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `GuestProfile`:

- `notify_transactions`, `notify_level_change`, `notify_promo`, `notify_expire`, `notify_transfers`.

***

## 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ rate-limiting

### 6.1. –í–∞–ª–∏–¥–∞—Ü–∏—è `initData` –∏–∑ Mini App

Backend:

1. –ü–∞—Ä—Å–∏—Ç `initData`.
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å `hash`:
    - `data_check_string = sorted key=value pairs (–∫—Ä–æ–º–µ hash)`,
    - `secret_key = HMAC-SHA256(bot_token, "WebAppData")`,
    - `hash_calculated = HMAC-SHA256(data_check_string, secret_key)`,
    - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º `hash`.
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `auth_date` (–Ω–µ —Å—Ç–∞—Ä—à–µ 60 –º–∏–Ω—É—Ç).
4. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–Ω–æ:
    - —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏—é –¥–ª—è `telegram_id`,
    - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT/session-—Ç–æ–∫–µ–Ω.

–í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ API-–∑–∞–ø—Ä–æ—Å—ã –∏–∑ Mini App –∏–¥—É—Ç —Å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º.

***

### 6.2. Rate-limiting –¥–ª—è –±–æ—Ç–∞

Middleware –≤ –±–æ—Ç–µ:

- –ü–æ `telegram_id`:
    - max 10 –∫–æ–º–∞–Ω–¥ –≤ –º–∏–Ω—É—Ç—É,
    - max 3 SMS-–∫–æ–¥–∞ –≤ —á–∞—Å.
- –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ:
    - —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ¬ª,
    - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ X –º–∏–Ω—É—Ç.

–•—Ä–∞–Ω–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤: Redis (`telegram_ratelimit:<telegram_id>`, TTL = 1 –º–∏–Ω).

***

### 6.3. –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–∏—à–∏–Ω–≥–∞ –∏ –ø–æ–¥–¥–µ–ª–∫–∏ QR/6-digit

- **–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–æ–≤**:
    - –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (earn/redeem) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ QR/6-digit.
    - –°—Ç–∞—Ä—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏.
- **–†—É—á–Ω–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è**:
    - –ö–Ω–æ–ø–∫–∞ ¬´–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥¬ª –≤ Mini App ‚Üí –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥—ã (–Ω–∞ —Å–ª—É—á–∞–π —Å–∏—Å—Ç–µ–º–Ω–æ–π –æ—à–∏–±–∫–∏).
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
    - –ü—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ QR/–≤–≤–æ–¥–µ 6-digit –Ω–∞ –∫–∞—Å—Å–µ:
        - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–¥ –µ—â—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏,
        - –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ‚Üí —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º.
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
    - –ü—Ä–∏ –∫–∞–∂–¥–æ–º earn/redeem —à–ª—ë–º push.
    - –ï—Å–ª–∏ –Ω–µ–∑–Ω–∞–∫–æ–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚Üí –≥–æ—Å—Ç—å —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `/support`.

***

## 7. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### 7.1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤

- **–ù–∞ —Å—Ç–∞—Ä—Ç–µ ‚Äî —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π**.
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –ø—Ä–∏—Ü–µ–ª–æ–º –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:
    - –í –±–æ—Ç–µ: `telegraf-i18n` –∏–ª–∏ `i18next`.
    - –í Mini App: `react-i18next`.
    - –Ø–∑—ã–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è:
        - –∏–∑ `User.language_code` (–∏–∑ Telegram API),
        - –∏–ª–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ—Ñ–∏–ª—è.
- –í –±—É–¥—É—â–µ–º: –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∫–∞–∑–∞—Ö—Å–∫–∏–π, —Ç—É—Ä–µ—Ü–∫–∏–π –∏ –¥—Ä.

***

### 7.2. –ë—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

**–†–µ—à–µ–Ω–∏–µ: –ì–∏–±—Ä–∏–¥–Ω–∞—è –º–æ–¥–µ–ª—å (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π + –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–æ—Ç—ã)**

#### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –±–æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

- –ù–∞–∑–≤–∞–Ω–∏–µ: `@max_loyalty_bot`.
- –ü–æ—Ç–æ–∫:

1. –ì–æ—Å—Ç—å –Ω–∞–∂–∏–º–∞–µ—Ç `/start`.
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**:
        - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞,
        - —à–ª—ë—Ç SMS-–∫–æ–¥,
        - –≥–æ—Å—Ç—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥.
3. **–°–æ–≥–ª–∞—Å–∏—è**:
        - –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (—á–µ–∫–±–æ–∫—Å),
        - –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ä–µ–∫–ª–∞–º—É (—á–µ–∫–±–æ–∫—Å),
        - –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö (—á–µ–∫–±–æ–∫—Å).
        - *(–≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)*
4. **–í—ã–±–æ—Ä —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**:
        - –°–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤/—Å–µ—Ç–µ–π (–∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –ø–æ–∏—Å–∫),
        - –≥–æ—Å—Ç—å –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—ã–π.
5. **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**:
        - –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞:
            - –≥–æ—Å—Ç—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** –Ω–∞ –±–æ—Ç–∞ —ç—Ç–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (deep link: `t.me/restaurant_bot?start=guest_auth_token`),
            - –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞:
                - —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è,
                - `telegram_id` —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω,
                - –≥–æ—Å—Ç—å —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–≤–æ—é –∫–∞—Ä—Ç—É (—É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω).


#### –û—Ç–¥–µ–ª—å–Ω—ã–µ –±–æ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏

**–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ª—é–±–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ Premium)**:

- –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞:

1. **Restaurant Admin** —Å–æ–∑–¥–∞—ë—Ç –±–æ—Ç–∞ —á–µ—Ä–µ–∑ BotFather –≤ –∞–∫–∫–∞—É–Ω—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≤ Telegram.
        - –ò–ª–∏ Owner –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —ç—Ç–æ –∫–∞–∫ –æ–ø—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ –Ω–µ–±–æ–ª—å—à—É—é –¥–æ–ø–ª–∞—Ç—É –∏–ª–∏ –∫–∞–∫ —á–∞—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
2. Admin –≤–≤–æ–¥–∏—Ç `bot_token` –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.
3. –ù–∞—à backend:
        - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `bot_token` –≤ —Ç–∞–±–ª–∏—Ü–µ `TelegramBot` (—Å–≤—è–∑—å —Å `tenant_id`).
4. –ö–∞–∂–¥—ã–π –±–æ—Ç:
        - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—É –∂–µ –∫–æ–¥–æ–≤—É—é –±–∞–∑—É**, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç —Å–≤–æ–µ–≥–æ —Ç–æ–∫–µ–Ω–∞,
        - webhook: `POST /api/telegram/webhook/:bot_token`,
        - –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ update'–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è `tenant_id` –ø–æ —Ç–æ–∫–µ–Ω—É.

**–ò—Ç–æ–≥–æ**: –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –≤—ã–±–æ—Ä–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞) ‚Üí –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞, –≥–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞—Ä—Ç–æ–π, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤—ã—à–µ. –õ–∏–±–æ –≥–æ—Å—Ç—å —Å—Ä–∞–∑—É –Ω–∞—Ö–æ–¥–∏—Ç –±–æ—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.

***

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã:

- **POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (PUSH/PULL, iiko/R-Keeper, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, reconciliation),
- **Billing \& Subscriptions** (4 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, —Ä—É—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏, trial, –≥—Ä–µ–π—Å-–ø–µ—Ä–∏–æ–¥, –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ),
- **Balls \& Transactions** (—Ä–∞–∑–¥–µ–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–ø–∏—Å–∞–Ω–∏—è, —Å–≥–æ—Ä–∞–Ω–∏–µ, –ø–µ—Ä–µ–≤–æ–¥—ã, audit trail),
- **Telegram Bot + Mini App** (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, UI, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –≥–∏–±—Ä–∏–¥–Ω–∞—è –º–æ–¥–µ–ª—å –±–æ—Ç–æ–≤).

–î–∞–ª—å—à–µ –ª–æ–≥–∏—á–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:

1. **Frontend-–∞–¥–º–∏–Ω–∫–∞** (Owner / Restaurant Admin / Manager / Cashier UI: —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —Å—Ü–µ–Ω–∞—Ä–∏–∏, RBAC).
2. **Analytics \& Reporting** (–º–µ—Ç—Ä–∏–∫–∏, –¥–∞—à–±–æ—Ä–¥—ã, —ç–∫—Å–ø–æ—Ä—Ç—ã).
3. **Database Schema** (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è Prisma-—Å—Ö–µ–º–∞ —Å–æ –≤—Å–µ–º–∏ entities, relations, indexes).

–ù–∞–ø–∏—à–∏, –∫–∞–∫–æ–π –±–ª–æ–∫ –±–µ—Ä—ë–º —Å–ª–µ–¥—É—é—â–∏–º.
